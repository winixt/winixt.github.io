{"title":"js å¼‚æ­¥è¿›åŒ–å²ä¹‹Promise","slug":"jså¼‚æ­¥è¿›åŒ–å²ä¹‹Promise","date":"2019-02-24T04:20:08.112Z","updated":"2019-02-24T04:20:08.112Z","comments":true,"path":"api/articles/jså¼‚æ­¥è¿›åŒ–å²ä¹‹Promise.json","photos":[],"link":"","excerpt":"åœ¨ä¸Šä¸€ç¯‡ js å¼‚æ­¥è¿›åŒ–å²ä¹‹å›è°ƒ æˆ‘ä»¬äº†è§£åˆ°åŸºäºå›è°ƒå¤„ç†å¼‚æ­¥é—®é¢˜å­˜åœ¨ä¸€äº›ç¼ºé™·ã€‚é‚£ä¹ˆ Promise æ˜¯ä»€ä¹ˆï¼Ÿèƒ½å¤Ÿè§£å†³å›è°ƒé€ æˆçš„é—®é¢˜å—ï¼Ÿåˆä¼šä¸ä¼šå¼•å…¥æ–°çš„é—®é¢˜ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚","covers":["https://ws3.sinaimg.cn/large/006tKfTcgy1fo2arjy216j31jk0vzn1j.jpg","https://ws1.sinaimg.cn/large/006tKfTcgy1fo2c2khvv8j30oo0dwt9c.jpg","https://ws3.sinaimg.cn/large/006tKfTcgy1fo2hg2scibj310e0pe763.jpg"],"content":"<p>åœ¨ä¸Šä¸€ç¯‡ <a href=\"/js%E5%BC%82%E6%AD%A5%E8%BF%9B%E5%8C%96%E5%8F%B2%E4%B9%8B%E5%9B%9E%E8%B0%83/\">js å¼‚æ­¥è¿›åŒ–å²ä¹‹å›è°ƒ</a> æˆ‘ä»¬äº†è§£åˆ°åŸºäºå›è°ƒå¤„ç†å¼‚æ­¥é—®é¢˜å­˜åœ¨ä¸€äº›ç¼ºé™·ã€‚é‚£ä¹ˆ Promise æ˜¯ä»€ä¹ˆï¼Ÿèƒ½å¤Ÿè§£å†³å›è°ƒé€ æˆçš„é—®é¢˜å—ï¼Ÿåˆä¼šä¸ä¼šå¼•å…¥æ–°çš„é—®é¢˜ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚</p>\n<a id=\"more\"></a>\n<p><img src=\"https://ws3.sinaimg.cn/large/006tKfTcgy1fo2arjy216j31jk0vzn1j.jpg\" alt=\"Promise\"></p>\n<h3 id=\"ä»€ä¹ˆæ˜¯-Promise\"><a href=\"#ä»€ä¹ˆæ˜¯-Promise\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯ Promise?\"></a>ä»€ä¹ˆæ˜¯ Promise?</h3><hr>\n<p>Promise è‹±æ–‡æ„æ€ï¼šæ‰¿è¯ºã€‚å—¯ï¼Œä¸€çœ‹å°±è§‰å¾—é è°±ï¼</p>\n<p>Promise åªæœ‰ä¸‰ç§çŠ¶æ€ï¼šæœªå†³è®®ã€resolveã€rejectï¼Œå¹¶ä¸”ä¸€æ—¦å†³è®®ï¼ŒçŠ¶æ€ä¸å¯åœ¨æ›´æ”¹ã€‚åªèƒ½ç”±æœªå†³è®® &gt; resolveï¼Œæˆ– æœªå†³è®® &gt; rejectï¼Œä¸¤æ¡çŠ¶æ€è½¬æ¢è·¯çº¿ï¼Œä¸èƒ½é€†è½¬ï¼Œresolve ä¹Ÿä¸èƒ½è½¬ä¸º rejectã€‚å¦‚å›¾ï¼š</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/006tKfTcgy1fo2c2khvv8j30oo0dwt9c.jpg\" alt=\"å›¾ç‰‡\"></p>\n<p>å°æ—¶å€™æœ‰ç©è¿‡é­ç‚®çš„å°æœ‹å‹å¯ä»¥ä¼šæƒ³åˆ°ï¼Œæœªå†³è®®çŠ¶æ€ä¸å°±åƒç‚¹ç‡ƒé­ç‚®ä¸€æ ·å—ï¼Ÿè¦ä¹ˆæˆåŠŸçˆ†ç‚¸(resolve)ï¼Œè¦ä¹ˆæ˜¯å“‘ç‚®(reject)ã€‚</p>\n<p>æ²¡é”™ï¼Œå°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ä¸æ˜ç™½ Promise æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>å¥½å§ï¼Œæˆ‘ä»¬ç»§ç»­ï¼Œä½ ä¼šæ˜ç™½çš„~</p>\n<p>I promise!</p>\n<h3 id=\"ç†è§£-Promise\"><a href=\"#ç†è§£-Promise\" class=\"headerlink\" title=\"ç†è§£ Promise\"></a>ç†è§£ Promise</h3><hr>\n<p>æˆ‘ä»¬å…ˆæ”¾ä¸‹å¯¹ Promise æ¦‚å¿µçš„çº ç»“ï¼Œé¦–å…ˆæƒ³æƒ³è¿™ä¸¤ä¸ªé—®é¢˜ï¼š</p>\n<ol>\n<li>es6 æä¾›çš„ Promise åŸºäºåº•å±‚å®ç°çš„é‚£äº›æ”¹å˜ï¼Œèƒ½å¦é€šè¿‡å›è°ƒç­‰å…¶ä»–æœºåˆ¶è¿›è¡Œæ¨¡æ‹Ÿï¼Ÿ</li>\n<li>Promise æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜è€Œå‡ºç°çš„ï¼Ÿ</li>\n</ol>\n<p>ä¸æ€¥ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªé—®é¢˜æ¥å¤„ç†ï½</p>\n<h4 id=\"es6-ä¹‹ä»»åŠ¡é˜Ÿåˆ—\"><a href=\"#es6-ä¹‹ä»»åŠ¡é˜Ÿåˆ—\" class=\"headerlink\" title=\"es6 ä¹‹ä»»åŠ¡é˜Ÿåˆ—\"></a>es6 ä¹‹ä»»åŠ¡é˜Ÿåˆ—</h4><p>åœ¨ es6 ä¸­æ–°å¢äº†ä¸€ä¸ªåä¸º<strong>ä»»åŠ¡é˜Ÿåˆ—</strong>çš„æ¦‚å¿µï¼Œè¯¥é˜Ÿåˆ—å»ºç«‹äºäº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¹‹ä¸Šã€‚è€Œ Promise çš„å¼‚æ­¥ç‰¹æ€§æ­£æ˜¯åŸºäºä»»åŠ¡é˜Ÿåˆ—ã€‚äº‹ä»¶å¾ªç¯é˜Ÿåˆ—æˆ‘ä»¬åœ¨<a href=\"https://winixt.me/js%E5%BC%82%E6%AD%A5%E8%BF%9B%E5%8C%96%E5%8F%B2%E4%B9%8B%E5%9B%9E%E8%B0%83/\" target=\"_blank\" rel=\"noopener\">js å¼‚æ­¥è¿›åŒ–å²ä¹‹å›è°ƒ</a>å·²ç»ä»‹ç»è¿‡ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†åˆ†æä¸‹ä»»åŠ¡é˜Ÿåˆ—ã€‚</p>\n<p>å¤§å®¶æ¥çœ‹çœ‹è¿™æ®µä»£ç è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå…ˆæœ‰è‡ªå·±çš„ç­”æ¡ˆå†å¾€ä¸‹çœ‹ï¼‰</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'A'</span>);</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">1</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'B'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">1</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'C'</span>);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'D'</span>);</span><br></pre></td></tr></table></figure>\n<p>æ­£ç¡®é¡ºåºæ˜¯ D &gt; B &gt; C &gt; A</p>\n<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºä»»åŠ¡é˜Ÿåˆ—æ˜¯å»ºç«‹åœ¨äº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¸Šçš„é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´â€¦.ç®—äº†æˆ‘ä¹Ÿè¯´ä¸æ¸…ï¼Œä¸Šå›¾ä¸Šå›¾</p>\n<p><img src=\"https://ws3.sinaimg.cn/large/006tKfTcgy1fo2hg2scibj310e0pe763.jpg\" alt=\"å›¾ç‰‡\"></p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œjs å¼•æ“ä¼šä¼˜å…ˆå¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œç›´åˆ°ä»»åŠ¡ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºæ‰è½¬è€Œæ‰§è¡Œäº‹ä»¶å¾ªç¯é˜Ÿåˆ—çš„äº‹ä»¶ã€‚æ‰€ä»¥ç†è®ºä¸Šè¯´ï¼Œä»»åŠ¡å¾ªç¯å¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯ï¼Œè¿›è€Œå¯¼è‡´ç¨‹åºé¥¿æ­»ï¼Œæ— æ³•è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ tickã€‚</p>\n<p>æ³¨ï¼šè¿™é‡Œä¸»è¦ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼ŒçœŸå®æƒ…å†µä¸æ˜¯è¿™æ ·çš„ï¼Œå…¶å®ä¸€ä¸ªæµè§ˆå™¨ç¯å¢ƒåªèƒ½æœ‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œè€Œä¸€ä¸ªäº‹ä»¶å¾ªç¯å¯ä»¥å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªä»»åŠ¡æºï¼‰ã€‚ç›¸åŒä»»åŠ¡æºçš„ä»»åŠ¡ï¼Œåªèƒ½æ”¾åˆ°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ä¸åŒä»»åŠ¡æºçš„ä»»åŠ¡ï¼Œå¯ä»¥æ”¾åˆ°ä¸åŒä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚</p>\n<p>æ˜¯ä¸æ˜¯æœ‰ç§ vip é€šé“çš„æ„Ÿè§‰ï¼Ÿã€æ»‘ç¨½ã€‘</p>\n<h4 id=\"Promise-ä¸-ä»»åŠ¡é˜Ÿåˆ—\"><a href=\"#Promise-ä¸-ä»»åŠ¡é˜Ÿåˆ—\" class=\"headerlink\" title=\"Promise ä¸ ä»»åŠ¡é˜Ÿåˆ—\"></a>Promise ä¸ ä»»åŠ¡é˜Ÿåˆ—</h4><p>ä¸ºä»€ä¹ˆ Promise è¦åŸºäºä»»åŠ¡é˜Ÿåˆ—å‘¢ï¼Ÿè¿™æ ·èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>\n<p>è¿™æ˜¯ä¸ºäº†æ»¡è¶³ä¸€äº›ä½å»¶è¿Ÿçš„å¼‚æ­¥æ“ä½œã€‚æ¯”å¦‚ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Promise.resolve(2).then(function(data) &#123;</span><br><span class=\"line\">  console.log(data)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>è¿™ç§å¯ä»¥ç›´æ¥åŒæ­¥è¿è¡Œï¼Œä½†æ˜¯åˆä¸å¾—ä¸å¼‚æ­¥è¿è¡Œçš„ä»£ç ï¼Œä½ ä¸å¸Œæœ›å®ƒæ’ä¸€ä¸ªé•¿é•¿çš„äº‹ä»¶é˜Ÿåˆ—å†æ‰§è¡Œå§ï¼Ÿ</p>\n<p>ä¸ºä»€ä¹ˆè¯´å¯ä»¥åŒæ­¥è¿è¡Œï¼Œä½†åˆä¸å¾—ä¸å¼‚æ­¥è¿è¡Œå‘¢ï¼Ÿ</p>\n<p>è¯·çœ‹ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">boo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">request(<span class=\"string\">'http://example.com'</span>, boo);</span><br><span class=\"line\"></span><br><span class=\"line\">a++;</span><br></pre></td></tr></table></figure>\n<p>è¯·é—®è¿™é‡Œæ‰“å° 0 è¿˜æ˜¯ 1ï¼Ÿè¦çœ‹æƒ…å†µè€Œå®šã€‚å¦‚æœ request æ˜¯åŒæ­¥çš„é‚£ä¹ˆæ‰“å° 0ï¼Œå¦‚æœæ˜¯å¼‚æ­¥åˆ™æ‰“å° 1ã€‚åœ¨çœŸå®çš„å¼€å‘ç¯å¢ƒä¸­é‡åˆ°è¿™ç§ä¸ç¡®å®šå› ç´ ä¼šé€ æˆæå¤§çš„éº»çƒ¦ã€‚</p>\n<p>æ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰è½»åŠŸ</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">boo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">func</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    request(<span class=\"string\">'http://example.com'</span>, resolve);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func().then(boo);</span><br><span class=\"line\"></span><br><span class=\"line\">a++;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·å¯ä»¥æ°¸è¿œä¿è¯ console è¾“å‡ºä¸º 1</p>\n<h4 id=\"Promise-ä¹‹å¹¶å‘\"><a href=\"#Promise-ä¹‹å¹¶å‘\" class=\"headerlink\" title=\"Promise ä¹‹å¹¶å‘\"></a>Promise ä¹‹å¹¶å‘</h4><p>æƒ³å¿…å¤§å¤šæ•°å‰ç«¯å·¥ç¨‹å¸ˆéƒ½é‡åˆ°è¿‡ä¸‹é¢ç±»ä¼¼çš„æƒ…å†µå§ï¼Ÿ</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> data1, data2;</span><br><span class=\"line\"></span><br><span class=\"line\">ajax(<span class=\"string\">'http://example.com?index=1'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">  data1 = data;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (data1 &amp;&amp; data2) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(data1 + data2); <span class=\"comment\">// console ä¾èµ–äºå¼‚æ­¥ç»“æœ data1 å’Œ data2</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">ajax(<span class=\"string\">'http://example.com?index=2'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">  data2 = data;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (data1 &amp;&amp; data2) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(data1 + data2); <span class=\"comment\">// console ä¾èµ–äºå¼‚æ­¥ç»“æœ data1 å’Œ data2</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>è¿™ä»£ç è™½ç„¶æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯çœ‹èµ·æ¥æ€»ä¸å¤ªä¼˜é›…ï¼Œè¯­å¥ if (data1 &amp;&amp; data2) å­˜åœ¨äºä¸¤ä¸ªåœ°æ–¹ï¼Œå¦‚æœ‰æ”¹åŠ¨ï¼Œéœ€è¦ä¸¤ä¸ªåœ°æ–¹éƒ½æ”¹ã€‚è®©æˆ‘ä»¬ç”¨ Promise è¯•è¯•ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">request</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    ajax(url, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!err) &#123;</span><br><span class=\"line\">        resolve(data);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        reject(err);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> p1 = request(<span class=\"string\">'http://example.com?index=1'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> p2 = request(<span class=\"string\">'http://example.com?index=2'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.all([p1, p2]).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(...data);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>æ˜¯ä¸æ˜¯ä¼˜é›…å¾ˆå¤šğŸ˜Š</p>\n<h4 id=\"Promise-ä¸å›è°ƒ\"><a href=\"#Promise-ä¸å›è°ƒ\" class=\"headerlink\" title=\"Promise ä¸å›è°ƒ\"></a>Promise ä¸å›è°ƒ</h4><p>æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡<a href=\"/js%E5%BC%82%E6%AD%A5%E8%BF%9B%E5%8C%96%E5%8F%B2%E4%B9%8B%E5%9B%9E%E8%B0%83/\">js å¼‚æ­¥è¿›åŒ–å²ä¹‹å›è°ƒ</a>ä¸­æåˆ°è¿‡è¿™ä¹ˆä¸€å¥è¯ï¼š</p>\n<p>å›è°ƒç›¸å½“äºå°†ä»£ç æ‰”è¿›ä¸€ä¸ªé»‘ç›’ï¼Œå‘ç”Ÿä»€ä¹ˆä½ æ— ä»å¾—çŸ¥ã€‚å½“é»‘ç›’è¿è¡Œå®Œäº†å®ƒçš„ä»£ç ï¼Œè‡ªåŠ¨ä¼šè°ƒç”¨ä½ çš„å›è°ƒå‡½æ•°ã€‚</p>\n<p>è€Œ Promise å´åè¿‡æ¥â€ç›‘å¬â€é»‘ç›’çš„è¿è¡Œæƒ…å†µï¼Œâ€ç›‘å¬â€åˆ°é»‘ç›’è¿è¡Œå®Œäº†ï¼Œå°±é©¬ä¸Šè°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚</p>\n<p>å‘ƒï¼Œæœ‰ç‚¹éš¾æ‡‚ï¼</p>\n<p>å¥½å§ï¼Œä¸Šä»£ç ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ç¬¬ä¸‰æ–¹ APIï¼ˆthirdAPI)ï¼Œç»“æŸè¿è¡Œåï¼Œè°ƒç”¨ func</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">func</span>(<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do somethind</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç¬¬ä¸‰æ–¹ API</span></span><br><span class=\"line\">thirdAPI(func)</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šæ˜¯å›è°ƒå­˜åœ¨çš„ä¸€ä¸ªä¿¡ä»»çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ— æ³•ä¿è¯ç¬¬ä¸‰æ–¹ APIï¼Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹è°ƒç”¨æˆ‘ä»¬çš„å‡½æ•° funcï¼Œå‡ºäº†é”™è¯¯æˆ‘ä»¬ä¹Ÿæ— æ³•ç›‘å¬ï¼Œç­‰ç­‰ä¸€ç³»åˆ—é—®é¢˜ã€‚ï¼ˆä¹Ÿå°±æ˜¯æŠŠæˆ‘ä»¬çš„ä»£ç æ‰”è¿›äº†é»‘ç›’ï¼‰</p>\n<p>é¦–å…ˆæƒ³æƒ³æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸èƒ½åœ¨è‡ªå·±çš„ç¯å¢ƒä¸‹è°ƒç”¨ func å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ thirdAPI ä»€ä¹ˆæ—¶å€™èƒ½å¤Ÿè¿è¡Œå®Œå‘€ï¼Œå› æ­¤ä¸çŸ¥é“è¯¥ä»€ä¹ˆæ—¶å€™è°ƒç”¨ func æ‰å¥½ã€‚</p>\n<p>æ—¢ç„¶è¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç›‘å¬åˆ° thirdAPI è¿è¡Œå®Œï¼Œå²‚ä¸æ˜¯å¯ä»¥åœ¨ç›‘å¬åˆ° thirdAPI è¿è¡Œå®Œå°±å¯ä»¥è°ƒç”¨æˆ‘ä»¬çš„ func äº†ï¼Ÿå°±åƒï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fulfilled</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">rejected</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç¬¬ä¸‰æ–¹ API</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">thirdAPI</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  ajax(url, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">      listener.emit(<span class=\"string\">'rejected'</span>, err)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      listener.emit(<span class=\"string\">'fulfilled'</span>, data)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> listener;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> listener = thirdAPI();</span><br><span class=\"line\"></span><br><span class=\"line\">listener.on(<span class=\"string\">'fulfilled'</span>, fulfilled);</span><br><span class=\"line\">listener.on(<span class=\"string\">'rejected'</span>, rejected);</span><br></pre></td></tr></table></figure>\n<p>è¿™å°±éå¸¸ç±»ä¼¼æˆ‘ä»¬çš„â€ç›‘å¬â€é»‘ç›’åŠŸèƒ½äº†ï¼Œä½†æ˜¯è¦æ‰‹åŠ¨å®ç°ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼ listenerã€‚</p>\n<p>æ”¹ç”¨ Promise åï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fulfilled</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">rejected</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç¬¬ä¸‰æ–¹ API</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">thirdAPI</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    ajax(url, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        reject(err)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        resolve</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// nice</span></span><br><span class=\"line\">thirdAPI().then(fulfilled, rejected);</span><br></pre></td></tr></table></figure>\n<h4 id=\"Promise-é“¾å¼æµ\"><a href=\"#Promise-é“¾å¼æµ\" class=\"headerlink\" title=\"Promise é“¾å¼æµ\"></a>Promise é“¾å¼æµ</h4><p>Promise å‡ºæ¥è¿™ä¹ˆä¹…äº†ï¼Œå³ä½¿æ²¡æœ‰ç›´æ¥ç”¨è¿‡ Promiseï¼Œç›¸ä¿¡ä¹Ÿé—´æ¥ç”¨è¿‡ä¸å°‘ã€‚ä¾‹å¦‚ï¼ŒFetch å°±æ˜¯åŸºäº Promise å°è£…çš„ï¼Œè¿™å—ä»£ç ä½ åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetch(<span class=\"string\">'http://example.com?index=1'</span>)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (res.ok) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> res.json();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"string\">\"Request Error\"</span>;</span><br><span class=\"line\">  &#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(data);</span><br><span class=\"line\">  &#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.error(err);</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢çš„ then â€¦ then â€¦ catch å°±æ˜¯ Promise çš„é“¾å¼æµã€‚catch ç¨åæˆ‘ä»¬åœ¨ä»‹ç»ï¼Œè¿™é‡Œå…ˆè¯´ä¸‹ thenã€‚</p>\n<p>è¿è¡Œ then ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆå¯ä»¥ä¸€ç›´ then ä¸‹å»ï¼Ÿ</p>\n<p>è¿è¡Œ then ä¹‹åï¼Œä¼šè¿”å›ä¸€ä¸ª Promiseã€‚å…·ä½“æ¥è¯´æ˜¯ Promise.resolve(/<em>then çš„è¿”å›å€¼</em>/)</p>\n<p>Promise.resolve çš„ä½œç”¨:  è¿”å›ä¸€ä¸ªä»¥ç»™å®šå€¼è§£æåçš„Promiseå¯¹è±¡ã€‚ä½†å¦‚æœè¿™ä¸ªå€¼æ˜¯ä¸ªthenableï¼ˆå³å¸¦æœ‰thenæ–¹æ³•ï¼‰ï¼Œè¿”å›çš„promiseä¼šâ€œè·Ÿéšâ€è¿™ä¸ªthenableçš„å¯¹è±¡ï¼Œé‡‡ç”¨å®ƒçš„æœ€ç»ˆçŠ¶æ€ï¼ˆæŒ‡resolved/rejected/pending/settledï¼‰ï¼›å¦åˆ™ä»¥è¯¥å€¼ä¸ºæˆåŠŸçŠ¶æ€è¿”å›promiseå¯¹è±¡ã€‚</p>\n<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œè™½ç„¶è²Œä¼¼éƒ¨åˆ†è§£å†³è·Ÿè¸ªå›è°ƒæ—¶ï¼Œè„‘å­è·³æ¥è·³å»çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘æƒ³è¯´çš„æ˜¯ then ä¹Ÿçƒ¦å‘€ï¼Œè™½ç„¶æ²¡å›è°ƒçƒ¦ï½ã€‚</p>\n<h4 id=\"Promise-é”™è¯¯å¤„ç†\"><a href=\"#Promise-é”™è¯¯å¤„ç†\" class=\"headerlink\" title=\"Promise é”™è¯¯å¤„ç†\"></a>Promise é”™è¯¯å¤„ç†</h4><p>Promise çš„é”™è¯¯å¤„ç†ï¼Œå¯ä»¥å°†å‡½æ•°æ”¾åœ¨ then çš„ç¬¬äºŒä¸ªå‚æ•°ä¸Šï¼Œä¹Ÿå¯ä»¥ç”¨ catch æ•è·ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">1</span>).then(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fulfilled</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// success</span></span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">rejected</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// error</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æˆ–è€…</span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">1</span>).then(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fulfilled</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// success</span></span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// error</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// then çš„ä¸¤ä¸ªå‚æ•°æœ‰é»˜è®¤å€¼</span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">1</span>).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value; <span class=\"comment\">// é»˜è®¤å°† value ç›´æ¥è¿”å›</span></span><br><span class=\"line\">&#125;ï¼Œ<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> err; <span class=\"comment\">// é»˜è®¤ç›´æ¥å°† err æŠ›å‡º</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>ä½†æ˜¯å¦‚æœ catch ä¸­ä¹Ÿå‘ç”Ÿé”™è¯¯å‘¢ï¼Ÿç”±è°æ¥æ•è·ï¼Ÿæ‰€ä»¥è¿™ä¹Ÿç®—æ˜¯ Promise çš„ä¸€ä¸ªç¼ºé™·ã€‚</p>\n<h4 id=\"Promise-é€‚é…ç‰ˆ\"><a href=\"#Promise-é€‚é…ç‰ˆ\" class=\"headerlink\" title=\"Promise é€‚é…ç‰ˆ\"></a>Promise é€‚é…ç‰ˆ</h4><p>å½“åœ¨ä¸æ”¯æŒ Promise çš„æµè§ˆå™¨å™¨ä¸­ä½¿ç”¨ Promise æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å…³çš„é€‚é…ç‰ˆï¼Œå…¶å®šä¹‰äº† Promise åŠå®ƒçš„æ‰€æœ‰ç›¸å…³ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼ŒNative PromiseAã€‚</p>\n<h3 id=\"Promise-API-æ¦‚è§ˆ\"><a href=\"#Promise-API-æ¦‚è§ˆ\" class=\"headerlink\" title=\"Promise API æ¦‚è§ˆ\"></a>Promise API æ¦‚è§ˆ</h3><hr>\n<p>ä¸Šæ–‡å·²ç»é›¶é›¶æ•£æ•£å±•ç¤ºäº†ä¸€äº› Promise API çš„ç”¨æ³•ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ã€‚</p>\n<h4 id=\"new-Promise-â€¦-æ„é€ å™¨\"><a href=\"#new-Promise-â€¦-æ„é€ å™¨\" class=\"headerlink\" title=\"new Promise(â€¦) æ„é€ å™¨\"></a>new Promise(â€¦) æ„é€ å™¨</h4><p>Promise æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå‡½æ•°æ˜¯åŒæ­¥è°ƒç”¨çš„ï¼Œå¹¶ä¸”æ¥å—ä¸¤ä¸ªå‚æ•°ï¼ˆresolve å’Œ rejectï¼‰ä½œä¸ºå›è°ƒï¼Œç”± js å¼•æ“æä¾›ï¼Œç”¨ä»¥ Promise å†³è®®ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'A'</span>);</span><br><span class=\"line\">  resolve();</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'B'</span>)</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'C'</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'D'</span>);</span><br></pre></td></tr></table></figure>\n<p>è¾“å‡ºé¡ºåºä¸ºï¼šA &gt; B &gt; D &gt; C</p>\n<p>reject å°±æ˜¯æ‹’ç»è¿™ä¸ª promiseï¼Œå½“å‘ç”Ÿé”™è¯¯æˆ–è€…å…¶ä»–å¼‚å¸¸çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨ rejectã€‚</p>\n<p>resolve å¯èƒ½æ˜¯å®Œæˆ promiseï¼Œä¹Ÿå¯èƒ½æ˜¯æ‹’ç» promiseã€‚è¦è§†ä¼ å…¥çš„å‚æ•°è€Œå®šï¼Œå½“ä¼ å…¥çš„å‚æ•°ä¸ºé promiseã€étenable çš„ç«‹å³å€¼ï¼Œè¿™ä¸ª promise å°±ä¼šç”¨è¿™ä¸ªå€¼å®Œæˆã€‚</p>\n<p>ä½†æ˜¯ï¼Œå¦‚æœä¼ ç»™ resolve çš„å€¼æ˜¯ promise æˆ– thenableï¼Œè¿™ä¸ªå€¼å°†ä¼šè¢«é€’å½’å±•å¼€ï¼Œå¹¶ä¸” promise å°†å–å…¶æœ€ç»ˆå†³è®®å€¼æˆ–çŠ¶æ€ã€‚ä¾‹å¦‚ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> errP = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"string\">'Error Promise'</span>;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">  resolve(errP);</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'å®ŒæˆPromise'</span>); <span class=\"comment\">// ä¸ä¼šæ‰§è¡Œ</span></span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(err) <span class=\"comment\">// Error Promsise</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"Promise-reject-â€¦-å’Œ-Promise-resolve-â€¦\"><a href=\"#Promise-reject-â€¦-å’Œ-Promise-resolve-â€¦\" class=\"headerlink\" title=\"Promise.reject(â€¦) å’Œ Promise.resolve(â€¦)\"></a>Promise.reject(â€¦) å’Œ Promise.resolve(â€¦)</h4><p>Promise.reject ç”¨æ¥åˆ›å»ºä¸€ä¸ªè¢«æ‹’ç»çš„ promiseã€‚ä¸ç®¡ä¼ å…¥ä»€ä¹ˆå‚æ•° thenable ä¹Ÿå¥½ã€promise ä¹Ÿå¥½ä¸ä¼šå¯¹å…¶è¿›è¡Œå±•å¼€ï¼Œæœ€ç»ˆå†³è®®éƒ½æ˜¯æ‹’ç»ã€‚ä¾‹å¦‚ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> p1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">  reject(<span class=\"string\">'some thing'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> p2 = <span class=\"built_in\">Promise</span>.reject(<span class=\"string\">'some thing'</span>);<span class=\"comment\">// p1 å’Œ p2 ç­‰ä»·</span></span><br></pre></td></tr></table></figure>\n<p>Promise.resolve ç”¨æ¥åˆ›å»ºä¸€ä¸ªå·²å®Œæˆçš„ promiseã€‚ä¸ Promise.reject ä¸åŒï¼Œå¦‚æœä¼ å…¥å€¼æ˜¯thenableï¼Œä¼šå¯¹å€¼è¿›è¡Œå±•å¼€ã€‚æœ€ç»ˆçš„å†³è®®å€¼å¯èƒ½æ˜¯å®Œæˆï¼Œä¹Ÿå¯èƒ½æ˜¯æ‹’ç»ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> errP = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"string\">'Error Promise'</span>;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(errP).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'å®ŒæˆPromise'</span>); <span class=\"comment\">// ä¸ä¼šæ‰§è¡Œ</span></span><br><span class=\"line\">&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(err) <span class=\"comment\">// Error Promsise</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">3</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(data); <span class=\"comment\">// 3</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>æ³¨ï¼šå¦‚æœä¼ å…¥çš„å€¼æ˜¯çœŸæ­£çš„ promiseï¼ŒPromise.resolve ä¼šç›´æ¥å°†è¿™ä¸ªå€¼è¿”å›ï¼Œä¸ä¼šåšå…¶ä»–æ“ä½œã€‚</p>\n<h4 id=\"then-â€¦-å’Œ-catch-â€¦\"><a href=\"#then-â€¦-å’Œ-catch-â€¦\" class=\"headerlink\" title=\"then(â€¦) å’Œ catch(â€¦)\"></a>then(â€¦) å’Œ catch(â€¦)</h4><p>æ¯ä¸ª Promise å®ä¾‹éƒ½ä¼šæœ‰ then å’Œ catch æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥ä¸º promise æ³¨å†Œå®Œæˆæˆ–æ‹’ç»å‡½æ•°ã€‚promise å†³è®®ä¹‹åä¼šè°ƒç”¨å…¶ä¸­ä¸€ä¸ªå‡½æ•°ï¼Œå®Œæˆ æˆ– æ‹’ç»ã€‚ä½†æ˜¯ä¸ä¼šä¸¤ä¸ªæ–¹æ³•éƒ½è°ƒç”¨ï¼Œåªèƒ½è°ƒç”¨å…¶ä¸­ä¸€ä¸ªï¼Œä¸”åªè°ƒç”¨ä¸€æ¬¡ã€‚è‡ªç„¶ä¹Ÿéƒ½æ˜¯å¼‚æ­¥çš„ã€‚</p>\n<p>then æ¥å—ä¸¤ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç¬¬ä¸€ä¸ªç”¨äºå®Œæˆï¼Œç¬¬äºŒä¸ªç”¨äºæ‹’ç»ã€‚ä¹Ÿéƒ½æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœæœ‰å“ªä¸ªå‚æ•°æ²¡æœ‰ä¼ æˆ–è€…ä¼ å…¥éå‡½æ•°å€¼éƒ½ä¼šè¢«é»˜è®¤å‡½æ•°å–ä»£ã€‚é»˜è®¤å®Œæˆå‡½æ•°åªæ˜¯ç®€å•çš„å°†å€¼è¿”å›ï¼Œé»˜è®¤æ‹’ç»å‡½æ•°ä¼šç®€å•çš„å°†å‡ºé”™åŸå› æŠ›å‡ºã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// then çš„ä¸¤ä¸ªå‚æ•°æœ‰é»˜è®¤å€¼</span></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">1</span>).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value; <span class=\"comment\">// é»˜è®¤å°† value ç›´æ¥è¿”å›</span></span><br><span class=\"line\">&#125;ï¼Œ<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> err; <span class=\"comment\">// é»˜è®¤ç›´æ¥å°† err æŠ›å‡º</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>catch åªæ¥å—ä¸€ä¸ªæ‹’ç»å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è‡ªåŠ¨é»˜è®¤æ›¿æ¢å›è°ƒã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">  resolve(<span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">p.then(<span class=\"literal\">null</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// catch å’Œ then(null, function) ç­‰ä»·</span></span><br><span class=\"line\">p.catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>then(â€¦) å’Œ catch(â€¦) éƒ½ä¼šåˆ›å»ºå¹¶è¿”å›çš„ä¸€ä¸ªæ–°çš„ promiseï¼Œè¿™ä¸ª promise å¯ç”¨äºå®ç° promise çš„é“¾å¼æµæ§åˆ¶ã€‚å¦‚æœå®Œæˆæˆ–æ‹’ç»å›è°ƒä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆè¿”å›çš„ promise æ˜¯æ‹’ç»çš„ã€‚å¦‚æœä»»æ„ä¸€ä¸ªå›è°ƒè¿”å› é promiseã€é thenable çš„ç«‹å³å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼ä¼šå½“ä½œè¿”å› promise çš„å®Œæˆå€¼ã€‚å¦‚æœå¤„ç†å‡½æ•°è¿”å›ä¸€ä¸ª promise æˆ– thenableï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°†ä¼šè¢«å±•å¼€ï¼Œå¹¶ä½œä¸ºè¿”å› promise çš„å†³è®®å€¼ã€‚</p>\n<h4 id=\"Promise-all-â€¦-å’Œ-Promise-race-â€¦\"><a href=\"#Promise-all-â€¦-å’Œ-Promise-race-â€¦\" class=\"headerlink\" title=\"Promise.all([â€¦]) å’Œ Promise.race([â€¦])\"></a>Promise.all([â€¦]) å’Œ Promise.race([â€¦])</h4><p>Promise.all([â€¦]) he Promise.race([â€¦]) éƒ½ä¼šåˆ›å»ºä¸€ä¸ª promise ä½œä¸ºè¿”å›å€¼ï¼Œå…¶å†³è®®å€¼ç”±ä¼ å…¥çš„ promise æ•°ç»„å†³å®šã€‚</p>\n<p>Promise.all([â€¦])ï¼Œåªæœ‰ä¼ å…¥çš„æ‰€æœ‰ promise éƒ½å®Œæˆï¼Œè¿”å›çš„ promise æ‰èƒ½å®Œæˆã€‚å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªçš„ promise è¢«æ‹’ç»ï¼Œé‚£ä¹ˆè¿”å›çš„ promise å°±ç«‹åˆ»è¢«æ‹’ç»ï¼Œå¹¶ä¸”æŠ›å¼ƒå…¶ä»– promise çš„å€¼ã€‚å¦‚æœå®Œæˆï¼Œä¼šå¾—åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰ promise çš„å®Œæˆå€¼ã€‚å¦‚æœæ‹’ç»ï¼Œåªä¼šå¾—åˆ°ç¬¬ä¸€ä¸ªè¢«æ‹’ç»çš„ promise çš„å†³ç»å€¼ã€‚</p>\n<p>Promise.race([â€¦])ï¼Œåªè¦ç¬¬ä¸€ä¸ª promise ï¼ˆå®Œæˆæˆ–æ‹’ç»ï¼‰ï¼Œé‚£ä¹ˆè¿”å›çš„ promise ç«‹å³ï¼ˆå®Œæˆæˆ–æ‹’ç»ï¼‰ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªå®Œæˆçš„ promise çš„å†³è®®å€¼ï¼Œä½œä¸ºè¿”å› promise çš„å†³è®®å€¼ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> p1 = <span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> p2 = <span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> p3 = <span class=\"built_in\">Promise</span>.reject(<span class=\"string\">'error'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.race([p3, p2, p1]).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(data);</span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(err)ï¼› <span class=\"comment\">// error</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>æ³¨ï¼šè‹¥ Promise.all([â€¦]) ä¼ å…¥ç©ºæ•°ç»„ï¼Œå®ƒä¼šç«‹å³å®Œæˆã€‚ä½† Promise.race([â€¦]) ä¼šæŒ‚ï¼Œæ°¸è¿œä¸ä¼šå†³è®®ã€‚</p>\n<p>ES6 Promise API éå¸¸ç›´è§‚ã€‚è‡³å°‘è¶³ä»¥å¤„ç†æœ€åŸºæœ¬çš„ä¸€äº›å¼‚æ­¥æƒ…å†µï¼Œä½†ä¹Ÿæœ‰å®ƒçš„å±€é™æ€§ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ã€‚</p>\n<h3 id=\"Promise-å±€é™\"><a href=\"#Promise-å±€é™\" class=\"headerlink\" title=\"Promise å±€é™\"></a>Promise å±€é™</h3><hr>\n<p>é¦–å…ˆæ˜¯å¤„ç†é”™è¯¯çš„é¡ºåºï¼Œå‰æ–‡æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡äº†ï¼Œå¯ä»¥ç¿»å›å»çœ‹çœ‹ã€‚</p>\n<p>å…¶æ¬¡æˆ‘è§‰çš„ then(â€¦) then(â€¦) then(â€¦) çš„å¾ˆçƒ¦ã€‚è™½ç„¶å®ƒéƒ¨åˆ†è§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ï½</p>\n<p>è¿˜æœ‰å…¶ä»–æ¯”è¾ƒç»†å¾®çš„é—®é¢˜ï¼Œæˆ‘æ²¡æœ‰ç›¸åº”çš„å®è·µä¸å¤ªå¥½è¯´ï¼Œæ¨èå„ä½çœ‹</p>\n<p><strong>ã€Šä½ ä¸çŸ¥é“çš„ javascript ä¸­å·ã€‹</strong></p>\n<p>è‡³äºä¸Šé¢çš„å°é—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿè¯·çœ‹ä¸‹ç¯‡</p>\n<p>jså¼‚æ­¥è¿›åŒ–å²ä¹‹ Generator</p>\n","categories":[{"name":"å¼‚æ­¥","slug":"å¼‚æ­¥","count":4,"path":"api/categories/å¼‚æ­¥.json"}],"tags":[{"name":"Promise","slug":"Promise","count":1,"path":"api/tags/Promise.json"}]}