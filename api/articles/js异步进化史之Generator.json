{"title":"js å¼‚æ­¥è¿›åŒ–å²ä¹‹Generator","slug":"jså¼‚æ­¥è¿›åŒ–å²ä¹‹Generator","date":"2019-02-24T04:20:08.112Z","updated":"2019-02-24T04:20:08.112Z","comments":true,"path":"api/articles/jså¼‚æ­¥è¿›åŒ–å²ä¹‹Generator.json","photos":[],"link":"","excerpt":"åœ¨ä»‹ç» Generator å’Œå¼‚æ­¥çš„å…³ç³»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ†æä¸‹ Generatorã€‚çœ‹çœ‹å®ƒç»™æˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆæƒŠå¥‡çš„è¡¨ç°ã€‚<br>","covers":["https://ws2.sinaimg.cn/large/006tKfTcgy1fo38ppgt76j30s20dsdyc.jpg"],"content":"<p>åœ¨ä»‹ç» Generator å’Œå¼‚æ­¥çš„å…³ç³»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ†æä¸‹ Generatorã€‚çœ‹çœ‹å®ƒç»™æˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆæƒŠå¥‡çš„è¡¨ç°ã€‚<br><a id=\"more\"></a><br><img src=\"https://ws2.sinaimg.cn/large/006tKfTcgy1fo38ppgt76j30s20dsdyc.jpg\" alt=\"å›¾ç‰‡\"></p>\n<p>ä¸‹æ–‡å°†ä¼šæŒ‰ç…§è¿™ä¸ªé¡ºåºé€æ­¥è§£æ Genenrator:</p>\n<ol>\n<li>ä»€ä¹ˆæ˜¯ Generator?</li>\n<li>Generator å’Œ iterator</li>\n<li>Generator å’Œ å¼‚æ­¥</li>\n</ol>\n<p>ç›¸ä¿¡çœ‹å®Œä¸‹æ–‡åï¼Œå†å›è¿‡å¤´æ¥çœ‹ä¸Šå›¾ yield æ˜¯å¤šä¹ˆè´´åˆ‡ğŸ˜Š</p>\n<h3 id=\"ä»€ä¹ˆæ˜¯-Generator\"><a href=\"#ä»€ä¹ˆæ˜¯-Generator\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯ Generator?\"></a>ä»€ä¹ˆæ˜¯ Generator?</h3><hr>\n<p>åœ¨ Generator ä¹‹å‰ï¼Œjs çš„å‡½æ•°æ˜¯ä¸€ä¸ªæœ€å°æ‰§è¡Œå•ä½ï¼Œä¸€æ—¦å¼€å§‹è¿è¡Œï¼Œå°±ä¼šè¿è¡Œåˆ°ç»“æŸï¼ŒæœŸé—´ä¸ä¼šæœ‰å…¶ä»–ä»£ç èƒ½å¤Ÿæ‰“æ–­å¹¶æ’å…¥å…¶é—´ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">  <span class=\"comment\">// æƒ³åœ¨è¿™é‡Œæš‚åœä¸€ä¸‹ï¼Œå…ˆå¯¹ a æ‰§è¡Œä¸€ä¸‹å…¶ä»–ç®—æ•°æ“ä½œï¼Œå†è¿›è¡Œä¸‹ä¸€æ­¥</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">main</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// è¦ä¹ˆæå‰å¯¹ a æ“ä½œ</span></span><br><span class=\"line\">  foo();</span><br><span class=\"line\">  <span class=\"comment\">// è¦ä¹ˆå»¶è¿Ÿå¯¹ a æ“ä½œ</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åƒä¸Šé¢è¿™æ ·çš„æ™®é€šå‡½æ•°ï¼Œæˆ‘ä»¬æ˜¯æ²¡æœ‰åŠæ³•å¯¹å…¶è¿›è¡Œä¸­æ–­çš„ï¼Œfoo å‡½æ•°æ‰“å°çš„ä¸¤ä¸ª a å§‹ç»ˆä¼šä¸€æ ·ã€‚</p>\n<p>è™½ç„¶å¾ˆå®¹æ˜“é€šè¿‡å…¶ä»–æ–¹å¼å®ç°ä¸Šè¿°éœ€æ±‚ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯è¿™ä¹ˆä»»æ€§ï¼Œå°±è¦åœ¨ä¸¤ä¸ª console ä¹‹é—´æš‚åœï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p>\n<p>Generator çŠ¹å¦‚å‘¨æ˜Ÿé©°ä¸ŠèµŒåœºï¼Œé£æµæ½‡æ´’çš„è¿›å…¥äº†æˆ‘ä»¬çš„è§†é‡\u0010\u0010\u0010ï½</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">  <span class=\"keyword\">yield</span>; <span class=\"comment\">// åœ¨è¿™é‡Œæš‚åœ</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">main</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æ„é€ ä¸€ä¸ª iterator æ§åˆ¶æ•´ä¸ª generator</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> it = foo();</span><br><span class=\"line\">  it.next();</span><br><span class=\"line\">  a ++;</span><br><span class=\"line\">  it.next();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">main(); <span class=\"comment\">// è¾“å‡º 1, 2</span></span><br></pre></td></tr></table></figure>\n<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½å‘ç°äº† foo å‡½æ•°çš„ä¸€äº›å˜åŒ–ï¼ˆå‘ç°çš„ä¸äº†çš„æ˜¯æœ‰å¤šç²—çš„å¿ƒå‘€ï½</p>\n<p>foo å‡½æ•°å‰é¢å¤šäº†ä¸€ä¸ª * ç¬¦å·ï¼Œå¹¶ä¸”ä¸¤ä¸ª console è¯­å¥ä¹‹é—´å¤šäº†ä¸€ä¸ª yield è¯­å¥ã€‚main ä¸­ foo çš„æ‰§è¡Œä¹Ÿæœ‰äº†å¾ˆå¤§æ”¹å˜ã€‚ä¸æ€¥æˆ‘ä»¬ä» main å‡½æ•°çš„æ‰§è¡Œå¼€å§‹ä¸€æ­¥ä¸€æ­¥æ¥åˆ†æï¼š</p>\n<ol>\n<li>it = foo()ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œç”Ÿæˆå™¨ *foo()ï¼Œè€Œæ˜¯æ„é€ äº†ä¸€ä¸ª iteratorï¼Œç”±è¿™ä¸ª iterator æ§åˆ¶ç”Ÿæˆå™¨çš„æ‰§è¡Œï¼›</li>\n<li>ç¬¬ä¸€æ¡ it.next() è¯­å¥å¯åŠ¨ç”Ÿæˆå™¨ *foo()ï¼Œå¹¶æ‰§è¡Œç¬¬ä¸€æ¡ console.log(a) è¯­å¥ï¼Œæ­¤æ—¶ a = 1ï¼›</li>\n<li>ç”Ÿæˆå™¨ <em>foo() é‡åˆ° yield è¯­å¥åœæ­¢ï¼Œå¹¶ä¸”åœ¨è¿™ç‚¹ä¸Šï¼Œç¬¬ä¸€æ¡ it.next è¯­å¥åœæ­¢ã€‚æ­¤æ—¶ </em>foo() ä»åœ¨è¿è¡Œå¹¶ä¸”æ˜¯æ´»è·ƒçš„ï¼Œä½†å¤„äºæš‚åœçŠ¶æ€ï¼›</li>\n<li>æ‰§è¡Œè¯­å¥ a ++ï¼Œæ­¤æ—¶ a = 2ï¼›</li>\n<li>æ‰§è¡Œç¬¬äºŒæ¡ it.next() è¯­å¥ï¼Œ*foo() ç”Ÿæˆå™¨ä»æš‚åœæ¢å¤æ‰§è¡Œï¼Œæ‰§è¡Œç¬¬äºŒæ¡ console.log(a) æ­¤æ—¶è¾“å‡º 2ï¼›</li>\n</ol>\n<p>å› æ­¤å¯ä»¥çœ‹å‡º Generator å‡½æ•°æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œå¯ä»¥åœ¨ä¸€å¤„æˆ–å¤šå¤„æš‚åœï¼Œå¹¶ä¸”ä¸ä¸€å®šè¦æ‰§è¡Œå®Œã€‚</p>\n<p>æ³¨ï¼šGenerator å‡½æ•°æœ‰ä¸‰ç§å†™æ³•ï¼šfunction <em>foo()ã€function\\</em> foo()ã€ function*foo()ã€‚å–œæ¬¢é‚£ç§éƒ½æ²¡æœ‰å…³ç³»ï¼ŒåšæŒä¸€ç§é£æ ¼å°±å¯ä»¥äº†ï¼Œä¸‹æ–‡å°†é‡‡ç”¨ç¬¬ä¸€ç§ã€‚</p>\n<h4 id=\"è¾“å…¥ä¸è¾“å‡º\"><a href=\"#è¾“å…¥ä¸è¾“å‡º\" class=\"headerlink\" title=\"è¾“å…¥ä¸è¾“å‡º\"></a>è¾“å…¥ä¸è¾“å‡º</h4><p>æˆ‘æˆ‘æˆ‘â€¦</p>\n<p>æˆ‘ä»€ä¹ˆæˆ‘ï¼Œç›´æ¥çœ‹ä»£ç </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> x = <span class=\"keyword\">yield</span>;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> it = foo();</span><br><span class=\"line\">it.next(); <span class=\"comment\">// è¿è¡Œåˆ° yield è¯­å¥æš‚åœ</span></span><br><span class=\"line\">it.next(<span class=\"number\">2</span>); <span class=\"comment\">// console å°†è¾“å‡º 2</span></span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥é€šè¿‡ next() æ–¹æ³•å‘ Generator å‡½æ•°å†…éƒ¨ä¼ é€’å€¼ã€‚</p>\n<blockquote>\n<p>æ³¨æ„ç¬¬ä¸€ä¸ª next() ä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œå³ä½¿ä¼ å‚æ•°è¿›å»ä¹Ÿä¼šè¢«å¿½ç•¥ï¼Œå› ä¸ºæ²¡æœ‰ç›¸åº”çš„  yield å—ç†</p>\n</blockquote>\n<p>å†çœ‹çœ‹è¾“å‡º</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> x = <span class=\"keyword\">yield</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x); <span class=\"comment\">// 2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> it = foo();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next()); <span class=\"comment\">// &#123;value: 1, done: false&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next(<span class=\"number\">2</span>)); <span class=\"comment\">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹å‡º next æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« valueã€done ä¸¤ä¸ªå­—æ®µ</p>\n<ul>\n<li>value: iterator è¿”å›çš„ä»»æ„ javascript å€¼</li>\n<li>done: è¡¨ç¤ºæ˜¯å¦éå†åˆ° iterator çš„æœ«ç«¯ï¼Œæ˜¯çš„è¯ done ä¸º true, å¦åˆ™ false</li>\n</ul>\n<p>é‚£ä¹ˆç¬¬äºŒä¸ª it.next() è¯­å¥çš„ value ä¸ºä»€ä¹ˆæ˜¯ undefined? å› ä¸ºæœ€åä¸€ä¸ª next çš„ value å€¼ä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼ˆreturnï¼‰ï¼Œé»˜è®¤è¿”å›å€¼ undefined</p>\n<h4 id=\"é”™è¯¯å¤„ç†\"><a href=\"#é”™è¯¯å¤„ç†\" class=\"headerlink\" title=\"é”™è¯¯å¤„ç†\"></a>é”™è¯¯å¤„ç†</h4><p>çœŸæ­£å¥å£®çš„ä»£ç æ˜¯éœ€è¦å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶çš„ï¼ŒGenerator ä¹Ÿä¸ä¾‹å¤–ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> x = <span class=\"keyword\">yield</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(x);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err); <span class=\"comment\">// ä¸ä¼šæ‰§è¡Œ</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> it = foo();</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  it.throw(<span class=\"string\">'generator Erorr'</span>)</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(err + <span class=\"string\">' outer'</span>); <span class=\"comment\">// æ‰§è¡Œ</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å› ä¸º *foo() hai æ²¡æœ‰å¯åŠ¨ï¼Œå°±æŠ›å‡ºé”™è¯¯ï¼Œåªèƒ½ä»å‡½æ•°å¤–éƒ¨è¿›è¡Œé”™è¯¯æ•è·ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> x = <span class=\"keyword\">yield</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(x);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err); <span class=\"comment\">// æ‰§è¡Œ</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> it = foo();</span><br><span class=\"line\"></span><br><span class=\"line\">it.next();</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  it.throw(<span class=\"string\">'generator Erorr'</span>)</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(err + <span class=\"string\">' outer'</span>); <span class=\"comment\">// ä¸æ‰§è¡Œ</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">+++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> x = <span class=\"keyword\">yield</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(x);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err); <span class=\"comment\">// request error</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> it = foo();</span><br><span class=\"line\">it.next();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">request</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  ajax(<span class=\"string\">'http://example.com'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">    it.throw(<span class=\"string\">'request error'</span>);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æŠ›å…¥ Generator é‡Œé¢çš„é”™è¯¯ï¼Œå¯ä»¥ç”±å†…éƒ¨æ•è·ï¼Œå¼‚æ­¥ä¹Ÿä¸€æ ·</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> x = <span class=\"keyword\">yield</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> it = foo();</span><br><span class=\"line\"></span><br><span class=\"line\">it.next();</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  it.throw(<span class=\"string\">'generator Erorr'</span>)</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(err + <span class=\"string\">' outer'</span>); <span class=\"comment\">// æ‰§è¡Œ generator æ²¡æœ‰æ•è·çš„å¾€å¤–æŠ›å‡º</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¤šä¸ª-iterator\"><a href=\"#å¤šä¸ª-iterator\" class=\"headerlink\" title=\"å¤šä¸ª iterator\"></a>å¤šä¸ª iterator</h4><p>ä¸çŸ¥é“å„ä½åŒå­¦æœ‰æ²¡æœ‰æ³¨æ„åˆ°ä¸Šæ–‡çš„ä¸€ä¸ªç»†èŠ‚ï¼Œæˆ‘å†™ Generator éƒ½æ˜¯ç”¨å¤§å†™ï¼ˆ js ç¼–ç¨‹ä¹ æƒ¯ï¼Œç±»é¦–å­—æ¯å¤§å†™ï¼‰ã€‚å› ä¸ºæˆ‘ä»¬ Generator ä¹Ÿè·Ÿç±»ç±»ä¼¼ï¼Œæ¯ç”Ÿæˆä¸€ä¸ª iterator ç›¸å½“äºç”Ÿæˆä¸€ä¸ªè¯¥ Generator çš„å®ä¾‹ã€‚æ¥ç©ä¸€ä¸ªå¥½ç©çš„ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> b = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  a++;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span>;</span><br><span class=\"line\">  b = a + b;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span>;</span><br><span class=\"line\">  b *=b;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a, b);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> it1 = foo();</span><br><span class=\"line\"><span class=\"keyword\">const</span> it2 = foo();</span><br><span class=\"line\"></span><br><span class=\"line\">it1.next(); <span class=\"comment\">// a = 2; b = 1;</span></span><br><span class=\"line\">it1.next(); <span class=\"comment\">// a = 2; b = 3;</span></span><br><span class=\"line\">it1.next(); <span class=\"comment\">// a = 2; b = 9;</span></span><br><span class=\"line\">it1.next(); <span class=\"comment\">// 2, 9;</span></span><br><span class=\"line\"></span><br><span class=\"line\">it2.next(); <span class=\"comment\">// a = 3; b = 9;</span></span><br><span class=\"line\">it2.next(); <span class=\"comment\">// a = 3; b = 12;</span></span><br><span class=\"line\">it2.next(); <span class=\"comment\">// a = 3; b = 144;</span></span><br><span class=\"line\">it2.next(); <span class=\"comment\">// 3, 144</span></span><br></pre></td></tr></table></figure>\n<p>å¥½äº†ï¼Œ åˆ°ç›®å‰æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œè®©æˆ‘ä»¬æ¢æ¢é¡ºåºï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">it1.next(); <span class=\"comment\">// a = 2; b = 1;</span></span><br><span class=\"line\">it2.next(); <span class=\"comment\">// a = 3; b = 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\">it1.next(); <span class=\"comment\">// a = 3; b = 4;</span></span><br><span class=\"line\">it2.next(); <span class=\"comment\">// a = 3; b = 7;</span></span><br><span class=\"line\"></span><br><span class=\"line\">it1.next(); <span class=\"comment\">// a = 3; b = 49</span></span><br><span class=\"line\">it2.next(); <span class=\"comment\">// a = 3; b = 49 * 49</span></span><br><span class=\"line\"></span><br><span class=\"line\">it1.next(); <span class=\"comment\">// 3, 49</span></span><br><span class=\"line\">it2.next(); <span class=\"comment\">// 3, 49 * 49</span></span><br></pre></td></tr></table></figure>\n<p>åªè¦å®‰æ’çš„åˆç†ï¼Œæ¢æ¢æ‰§è¡Œé¡ºåºå°±èƒ½å¾—åˆ°ä¸åŒçš„å€¼ã€‚è¿™è¿˜æ˜¯åªæœ‰ä¸¤ä¸ªå®ä¾‹ï¼Œæ›´å¤šå®ä¾‹å‘¢ï¼Ÿ*foo() è®¾è®¡çš„æ›´å·§å¦™å‘¢ï¼ŸæŠŠè¾“å…¥ï¼Œè¾“å‡ºåŠ ä¸Šå»å‘¢ï¼Ÿ ä¸æ­¢ä¸€ä¸ª Generator å…±äº«æ•°æ®å‘¢ï¼Ÿæ„Ÿè§‰å¯ä»¥å‡ºä¸ªè„‘åŠ›æ¸¸æˆäº†ï¼Œå“ˆå“ˆ</p>\n<p>é‚£åˆ°åº• iterator æ˜¯æ€ä¹ˆä¸€ä¸ªæœºåˆ¶å‘¢ï¼Ÿä¸‹é¢ä¸€èµ·æ¥çœ‹çœ‹</p>\n<h3 id=\"Generator-å’Œ-iterator\"><a href=\"#Generator-å’Œ-iterator\" class=\"headerlink\" title=\"Generator å’Œ iterator\"></a>Generator å’Œ iterator</h3><hr>\n<p>iterator æ˜¯ ES6 æå‡ºæ¥çš„ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œå®šä¹‰äº† iterator çš„ Object å¯ä»¥è¢« forâ€¦of å¾ªç¯ä½¿ç”¨ã€‚</p>\n<p>ç°åœ¨æœ‰ä¸€ä¸ªè¦æ±‚ï¼Œè¦ä½ æ‰“å°æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆå‰é¢ä¸¤ä½æ•°ç›¸åŠ ï¼Œä½œä¸ºç¬¬ä¸‰ä½æ•° 1,1,2,3,5,8â€¦..ï¼‰ï¼Œä½ å¾ˆå¯èƒ½å¾ˆå¿«å†™å‡ºä¸‹åˆ—ä»£ç </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> func = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> val1 = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> val2 = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (val1 === <span class=\"number\">0</span> &amp;&amp; val2 === <span class=\"number\">0</span>)  &#123;</span><br><span class=\"line\">      val2 = <span class=\"number\">1</span>;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = val1 + val2;</span><br><span class=\"line\">    val1 = val2;</span><br><span class=\"line\">    val2 = result;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(func()); <span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(func()); <span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(func()); <span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(func()); <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(func()); <span class=\"comment\">// 5</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(func()); <span class=\"comment\">// 8</span></span><br></pre></td></tr></table></figure>\n<p>è¦ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œæœ‰ç‚¹éº»çƒ¦å‘€ï¼Œæˆ‘ä»¬æ¥æ”¹æ”¹ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> func = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> val1 = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> val2 = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    [<span class=\"built_in\">Symbol</span>.iterator]: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;&#125;,</span><br><span class=\"line\">    next: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val1 === <span class=\"number\">0</span> &amp;&amp; val2 === <span class=\"number\">0</span>)  &#123;</span><br><span class=\"line\">        val2 = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">          value: <span class=\"number\">1</span>,</span><br><span class=\"line\">          done: <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> result = val1 + val2;</span><br><span class=\"line\">      val1 = val2;</span><br><span class=\"line\">      val2 = result;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        value: result,</span><br><span class=\"line\">        done: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> v <span class=\"keyword\">of</span> func) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(v);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (v &gt; <span class=\"number\">50</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; <span class=\"comment\">// 1, 1, 2, 3, 5, 8, 13, 21, 34, 55</span></span><br></pre></td></tr></table></figure>\n<p>forâ€¦of å¾ªç¯ä¼šæ¯æ¬¡å»è°ƒç”¨ next()ï¼Œç›´åˆ° done ä¸º trueã€‚ä¸Šé¢çš„ä»£ç å…¶å®å°±æ˜¯ä¸€ä¸ª iteratorï¼Œå› ä¸ºå®ƒçš„æ¥å£ä¸­æœ‰ä¸€ä¸ª next æ–¹æ³•ã€‚</p>\n<p>æ—¢ç„¶æˆ‘ä»¬ç”Ÿæˆå™¨ä¹Ÿæ˜¯è¿”å›çš„ä¹Ÿæ˜¯ iterator ï¼Œæˆ‘ä»¬å†æ¥æ”¹æ”¹ä¸Šé¢çš„ä»£ç ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">func</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> val1 = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> val2 = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (val1 === <span class=\"number\">0</span> &amp;&amp; val2 === <span class=\"number\">0</span>)  &#123;</span><br><span class=\"line\">        val2 = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> val2;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> result = val1 + val2;</span><br><span class=\"line\">      val1 = val2;</span><br><span class=\"line\">      val2 = result;</span><br><span class=\"line\">      <span class=\"keyword\">yield</span> result;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> v <span class=\"keyword\">of</span> func()) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(v);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (v &gt; <span class=\"number\">50</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125; <span class=\"comment\">// 1, 1, 2, 3, 5, 8, 13, 21, 34, 55</span></span><br></pre></td></tr></table></figure>\n<p>æ˜¯ä¸æ˜¯ä¼˜é›…å¾ˆå¤š ğŸ˜Š</p>\n<p>ä½†æ˜¯åƒä¸Šé¢çš„ä»£ç  while(true)ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯æ²¡æœ‰åŠæ³•åœæ­¢ Generator äº†ï¼Ÿ</p>\n<p>æœ‰ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹</p>\n<h4 id=\"åœæ­¢-Generator\"><a href=\"#åœæ­¢-Generator\" class=\"headerlink\" title=\"åœæ­¢ Generator\"></a>åœæ­¢ Generator</h4><p>ä¸Šé¢çš„ä¾‹å­ä¸­ break ä¹‹åï¼Œiterator è²Œä¼¼å°±å¤„äºæ°¸è¿œæŒ‚èµ·çŠ¶æ€äº†ã€‚å®é™…ä¸Šï¼Œforâ€¦of å¾ªç¯å‘ç”Ÿâ€œå¼‚å¸¸ç»“æŸâ€ï¼ˆæå‰ç»ˆæ­¢ï¼‰ï¼Œé€šå¸¸ç”± breakã€return æˆ–è€…æœªæ•è·å¼‚å¸¸å¼•èµ·ï¼Œä¼šå‘ Generator çš„ iterator å‘é€ä¸€ä¸ªä¿¡å·ä½¿å…¶ç»ˆæ­¢ã€‚</p>\n<p>å¯ä»¥è¿™æ ·ç”¨ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> it = func();</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> v <span class=\"keyword\">of</span> it &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(v);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (v &gt; <span class=\"number\">50</span>) &#123;</span><br><span class=\"line\">    it.return(<span class=\"string\">'hello world'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¦‚æœåœ¨ Generator å†…æœ‰ tryâ€¦finally è¯­å¥ï¼Œå®ƒå°†æ€»æ˜¯è¿è¡Œï¼Œå³ä½¿ç”Ÿæˆå™¨å¤–éƒ¨ç»“æŸã€‚å¦‚æœéœ€è¦æ¸…ç†èµ„æºçš„è¯ï¼ˆæ•°æ®åº“è¿æ¥ç­‰ï¼‰ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰ç”¨</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">func</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> val1 = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> val2 = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val1 === <span class=\"number\">0</span> &amp;&amp; val2 === <span class=\"number\">0</span>)  &#123;</span><br><span class=\"line\">          val2 = <span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">yield</span> val2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> result = val1 + val2;</span><br><span class=\"line\">        val1 = val2;</span><br><span class=\"line\">        val2 = result;</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åšæ¸…ç†å·¥ä½œ</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> ä¸æ˜¯è¯´å¥½æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜æ˜¯ Generator å’Œå¼‚æ­¥å˜›ï¼Ÿæ€ä¹ˆçœ‹äº†åŠå¤©ï¼Œå¼‚æ­¥çš„å½±å­éƒ½æ²¡è§ç€ï¼Ÿ</p>\n<p>ä¸æ€¥ä¸æ€¥ï¼Œç£¨åˆ€ä¸è¯¯ç æŸ´å·¥å˜›ã€‚</p>\n<p>action!</p>\n<h3 id=\"Generator-å’Œ-å¼‚æ­¥\"><a href=\"#Generator-å’Œ-å¼‚æ­¥\" class=\"headerlink\" title=\"Generator å’Œ å¼‚æ­¥\"></a>Generator å’Œ å¼‚æ­¥</h3><hr>\n<p>å…¶å®æˆ‘ä»¬ä¸Šé¢å·²ç»ç¨å¾®æåˆ°äº† Generator å’Œ å¼‚æ­¥ã€‚</p>\n<p>è¿‡å»åŠä¸ªä¸–çºªäº†è°è¿˜è®°å¾—å‘€ï¼Ÿå“¼ï¼</p>\n<p>å¥½å§ï½ï¼Œæˆ‘çš„é”…</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> text = yeild;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(text);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> it = foo();</span><br><span class=\"line\">it.next();</span><br><span class=\"line\"></span><br><span class=\"line\">ajax(<span class=\"string\">'http://example.com'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">    it.throw(err);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    it.next(data);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>å‰é¢ä»‹ç» Generator é”™è¯¯å¤„ç†çš„æ—¶å€™ï¼Œå·²ç»è¯´æ˜äº†å¯ä»¥ Generator æ•è·å¼‚æ­¥å¼‚å¸¸æ˜¯ä¸æ˜¯å¾ˆæ£’\u0010ï¼Ÿ</p>\n<p>è¿˜æœ‰ï¼Œä»”ç»†çœ‹çœ‹å‰é¢å¯¹çš„ä»£ç ï¼Œçœ‹ä¼¼åŒæ­¥æ‰§è¡Œï¼Œå®é™…ä¸Šå´å¯ä»¥å¼‚æ­¥ï¼Œæ˜¯ä¸æ˜¯æ›´åŠ æ£’æ£’ï¼Ÿ</p>\n<h4 id=\"Generator-å’Œ-Promise\"><a href=\"#Generator-å’Œ-Promise\" class=\"headerlink\" title=\"Generator å’Œ Promise\"></a>Generator å’Œ Promise</h4><p>æ—¢ç„¶ Promise èƒ½å¤Ÿè§£å†³å›è°ƒçš„ä¿¡ä»»çš„é—®é¢˜ï¼Œä¸æ¸…æ¥šå»ºè®®å…ˆçœ‹çœ‹<a href=\"/js%E5%BC%82%E6%AD%A5%E8%BF%9B%E5%8C%96%E5%8F%B2%E4%B9%8BPromise/\">js å¼‚æ­¥è¿›åŒ–å²ä¹‹Promise</a>ï¼Œæˆ‘ä»¬å°† Generator ä¸ Promise ç»“åˆèµ·æ¥çœ‹çœ‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">request</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    ajax(url, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        reject(err);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        resolve(data);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> text = yeild request(url);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(text);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> it = foo();</span><br><span class=\"line\"></span><br><span class=\"line\">it.next().value    </span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">    it.next(data);</span><br><span class=\"line\">  &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">    it.throw(err);</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n<p>æ˜¯ä¸æ˜¯ä¼˜é›…äº†å¾ˆå¤šï¼Ÿä¸ä»…è§£å†³äº† Promise å¤„ç†é”™è¯¯çš„é—®é¢˜ï¼Œè¿˜ä»¥æ›´åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥ä»£ç ã€‚</p>\n<p>ä½†æ˜¯è¿˜æœ‰ä¸ªå°å°çš„é—æ†¾ï¼Œthen è¿˜æ˜¯è¦æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨ã€‚å¦‚æœæœ‰ä»€ä¹ˆèƒ½å¤Ÿè‡ªåŠ¨å¤„ç† then å°±å¥½äº†ã€‚</p>\n<p>è¿˜çœŸæœ‰ï¼Œè¯·çœ‹è¿™ä¸ªç¼©å°ç‰ˆï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">run</span>(<span class=\"params\">gen</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> args = [].slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> it = gen.apply(<span class=\"keyword\">this</span>, args);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleNext</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> next = it.next(value);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleResult</span>(<span class=\"params\">next</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (next.done) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next.value;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve(next.value)</span><br><span class=\"line\">               .then(handleNext, <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleError</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">                 <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve(it.throw(err))</span><br><span class=\"line\">                        .then(handleResult);</span><br><span class=\"line\">               &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)(next);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç„¶åæˆ‘ä»¬çš„ä»£ç å°±å˜æˆäº†</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> text = yeild request(url);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(text);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">run(foo, <span class=\"string\">'http://example.com'</span>);</span><br></pre></td></tr></table></figure>\n<p>ç®€ç›´é€†å¤©äº†ï½ï¼Œå¼‚æ­¥ä»£ç åŒæ­¥å†™å‘€</p>\n<p>å¦‚æœä½ ç”¨ co åº“ï¼Œé‚£ä¹ˆä¸Šé¢çš„ä»£ç ä½ ä¼šéå¸¸ç†Ÿæ‚‰</p>\n<h4 id=\"Generator-å§”æ‰˜\"><a href=\"#Generator-å§”æ‰˜\" class=\"headerlink\" title=\"Generator å§”æ‰˜\"></a>Generator å§”æ‰˜</h4><p>è‡³ä»Šä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è¯•è¿‡åœ¨ Generator é‡Œé¢è°ƒç”¨ Generatorï¼Œå¦‚æœè°ƒç”¨ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> r1 = request(<span class=\"string\">'http://example.com?index1'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> r2 = request(<span class=\"string\">'http://example.com?index2'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> r2;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> r2 = run(foo);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> r3 = request(<span class=\"string\">'http://example.com?index3'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(r2);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">run(bar);</span><br></pre></td></tr></table></figure>\n<p>ä½ å¯èƒ½ä¼šé—®çœŸçš„éœ€è¦ä½¿ç”¨ä¸¤æ¬¡ run å‡½æ•°å—ï¼Ÿä¸èƒ½åƒæ™®é€šå‡½æ•°ä¸€æ ·ï¼Œç›´æ¥ä¸€ä¸ªè°ƒç”¨å¦å¤–ä¸€ä¸ªå—ï¼Ÿ</p>\n<p>å¯ä»¥çš„ï¼Œå°ä¼™å­ä½ å¾ˆèªæ˜</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'B'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'C'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'D'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'A'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = <span class=\"keyword\">yield</span> *foo();</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(result + <span class=\"string\">' return to bar'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'E'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'F'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> it = bar();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next().value); <span class=\"comment\">// A</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next().value); <span class=\"comment\">// B   æ­¤å¤„ it å·²ç»å§”æ‰˜åˆ° foo</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next().value); <span class=\"comment\">// C</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next().value); <span class=\"comment\">// E </span></span><br><span class=\"line\"><span class=\"comment\">// D return to bar</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next().value); <span class=\"comment\">// F</span></span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢è¿™ç§ iterator çš„è½¬æ¢ç§°ä¸º Generator å§”æ‰˜ã€‚</p>\n<p>äº‹ä»¶ä¹Ÿå¯ä»¥å§”æ‰˜ï¼ŒğŸ†’</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"string\">'B'</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err); <span class=\"comment\">// foo error</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'C'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'D'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'A'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = <span class=\"keyword\">yield</span> *foo();</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(result + <span class=\"string\">' return to bar'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'E'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'F'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> it = bar();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next().value); <span class=\"comment\">// A</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next().value); <span class=\"comment\">// B   æ­¤å¤„ it å·²ç»å§”æ‰˜åˆ° foo</span></span><br><span class=\"line\">it.throw(<span class=\"string\">'foo error'</span>);</span><br></pre></td></tr></table></figure>\n<p>ç„¶åæˆ‘ä»¬åˆšå¼€å§‹çš„ä»£ç å°±å¯ä»¥æ”¹ä¸ºåªéœ€è¦ä½¿ç”¨ä¸€æ¬¡ runï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> r1 = request(<span class=\"string\">'http://example.com?index1'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> r2 = request(<span class=\"string\">'http://example.com?index2'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> r2;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> r2 = *foo();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> r3 = request(<span class=\"string\">'http://example.com?index3'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(r2);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">run(bar);</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><hr>\n<p>Generator å·²ç»å¯ä»¥è®©æˆ‘ä»¬å®ç°ä»¥åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥ä»£ç äº†ï¼Œä½†æ˜¯æœ‰ä¸ªå°å°é—æ†¾ï¼Œå°±æ˜¯è¦é¢å¤–å¼•å…¥ Generator åº“ï¼Œä¾‹å¦‚ coï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> co = <span class=\"built_in\">require</span>(<span class=\"string\">'co'</span>);</span><br><span class=\"line\">co(<span class=\"function\"><span class=\"keyword\">function</span>* (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> text = <span class=\"keyword\">yield</span> requst(<span class=\"string\">'http://example.com'</span>)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(text);</span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>è€Œä¸”è¿˜å¤šäº† coï½</p>\n<p>å¾ˆå¥½æœ‰æè‡´çš„ç¼–ç¨‹æ€ç»´</p>\n<p>ES å·¥ä½œç»„çš„å¤§ä½¬ä»¬ä¹Ÿæ—©å·²æ´å¯Ÿåˆ°äº†è¿™ä¸€ç‚¹ï¼Œäºæ˜¯åœ¨ ES7 ä¸Šæ·»åŠ äº†æ›´ä¸ºå¼ºå¤§çš„å¼‚æ­¥å·¥å…·</p>\n<p><strong>async/await</strong></p>\n<p>è¯·çœ‹ä¸‹ä¸€ç¯‡ï¼šjså¼‚æ­¥è¿›åŒ–å²ä¹‹async</p>\n","categories":[{"name":"å¼‚æ­¥","slug":"å¼‚æ­¥","count":4,"path":"api/categories/å¼‚æ­¥.json"}],"tags":[{"name":"Generator","slug":"Generator","count":1,"path":"api/tags/Generator.json"}]}