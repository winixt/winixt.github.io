---
title: "多端共享实现"
date: 2019-04-01
categories: native
tags: 
- react-native
- Flutter
- 小程序
---

首先让我们思考一个问题，你觉得各个平台是否希望自己的生态被打破，不同平台的特性是否应该归为一致？答案显然是否定的，每个大的企业都希望圈起自己的一个生态圈。那么跨平台的方案最终都需要面对各个平台间差异性的问题，这种差异性导致写一次到处跑的愿景几乎落空。为什么说是几乎呢？技术的发展路线谁也说不上，也许将来会出现划时代的技术。Flutter 可能就是这方面的鼻祖。

<!-- more -->

## 目前跨平台解决方案

目前市面上跨平台的解决方案大致上可以分为两类：

* 使用平台支持的 web 技术：这些解决方案基本上加载了应用程序中的移动浏览器，并在改浏览器中执行所有的逻辑。如 PhoneGap。
* 本地跨平台：程序员编写的 code，可以自动转换为 Native 代码。这种方式的优点是近乎原生的性能，如 RN、weex 等。

RN、weex 现在虽然有了比较大的生态，目前也逐步被大公司抛弃。平台的差异性太大，里面有太多的坑都很难绕过去。有时候排查一个问题需要深入了解 Android 和 IOS。同时熟知 Android 和 IOS 还有 RN 等语言的人才，市场上也没多少个。

好消息是 FB 说准备对 react-native 重构，未来会更好🌹

## Flutter

Flutter 是 google 最近推出的跨平台开发框架。可以快速在 IOS、Android、Fuchsia上构建高质量的原生用户界面。那么 Flutter 是怎么解决跨平台的问题的呢？

Flutter 跨平台最核心的部分是它的高性能渲染引擎（Flutter Engine）。Flutter 不使用浏览器技术，也不使用 Native 的原生控件，它使用自己的渲染引擎来绘制 widget。

## 小程序

首先是平台为小程序提供了完整的基础库，通过基础库、双线程渲染等方式，提升了小程序启动的体验。

小程序也是通过 Webview + 原生组件实现的。与传统 webview 不同的是，小程序将采用双线程渲染，将喧嚷层和逻辑层分开。
* 逻辑层：创建一个单独的线程去执行 js，在这个环境下执行的都是有关小程序业务逻辑的代码。
* 渲染层：界面渲染相关的任务都在 webview 线程上执行，通过逻辑层的代码去控制渲染那些页面。一个小程序存在多个页面，所以渲染层存在多个 webview 线程。

这么设计的目的是为了防止开发者使用一些浏览器提供的接口，例如：页面跳转、操作DOM、动态执行脚本。可以避免大部分在浏览器中的安全性问题。

逻辑层和渲染层的通信会由 Native(微信客户端) 做中转，逻辑层发送网络请求也经由 Native 转发。

